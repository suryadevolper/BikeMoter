window.addEventListener('DOMContentLoaded',function(){
    function extendWarrantyRender() {
        var counter = 0;
        $('.extend-warranty-html').html('');
        var dataMapping = _getDataMapping();
        var extendWarrantyData = dataMapping.extendWarrantyData;
        var tenure = extendWarrantyData.insuranceTenure;
        var ins_code = extendWarrantyData.ins_code;
        var insuranceImg = extendWarrantyData.insurance_imgurl;
        var insurance_type = extendWarrantyData.type;
        var roi = selectedSchemeDataOnPdp.schemeRoi ? parseInt(selectedSchemeDataOnPdp.schemeRoi) / 100 : selectedSchemeDataOnPdp.schemeRoi;
        var divisionOfRoi = ''
        var calDivisionOfRoi = ""
        var addOfRoi = ""
        var mulOfRoi = "";
        var roundOfEmi = "";

        dataMapping.extendWarrantyArr && onChangeSellerID && dataMapping.extendWarrantyArr.forEach(function (eachSeller) {
            if (eachSeller.sellerId == onChangeSellerID) {
                 inusranceLi = '';
                if (eachSeller.insuranceArr.length) {
                    eachSeller.insuranceArr && eachSeller.insuranceArr.forEach(function (eachInsuarnce,index) {
                        divisionOfRoi = roi / 12;
                        calDivisionOfRoi = divisionOfRoi * tenure
                        addOfRoi = 1 + calDivisionOfRoi;
                        mulOfRoi = addOfRoi * eachInsuarnce.insurancePremium;
                        roundOfEmi = mulOfRoi / tenure;
                        var emi = Math.round(roundOfEmi);
                        var selectedInuranceCls = "  ";
                        var selectedInuranceChecked = "  ";
                        var inputId = 'ew-one-year-id-' + (++counter);
                        // var getEmi =  getRate(eachInsuarnce.insurancePremium, tenure)
                        if (index == 0) {
                            var noIDontWishLocal = localStorage.getItem("NoIDontWishClicked");
                            if (noIDontWishLocal) {
                                noIDontWishClicked = true;
                                $('#dont-need-ew').prop('checked', true);
                                $('.ew-plan-radio').prop('checked', false);
                                $('.ew-plan-box').removeClass('ew-selected-plan');
                                var extendWarrantyDataNudge = dataMapping.extendWarrantyData.nudgeMessage;
                                if (extendWarrantyDataNudge) {
                                    $('.dont-need-ew-tip').show();
                                    localStorage.setItem("NoIDontWishClicked", true);
                                } else {
                                    $('.dont-need-ew-tip').hide();
                                    localStorage.setItem("NoIDontWishClicked", true);
                                }
                            } else {
                                $('#dont-need-ew').prop('checked', false);
                                $('.dont-need-ew-tip').hide();
                                selectedInuranceCls = " ew-selected-plan ";
                                selectedInuranceChecked = " checked ";
                                ewDataForAddApi.term = eachInsuarnce.insuranceTerm;
                                ewDataForAddApi.noOfEmis = tenure;
                                ewDataForAddApi.price = eachInsuarnce.insurancePremium;
                                ewDataForAddApi.emiPerMonth = emi;
                                ewDataForAddApi.type = insurance_type;
                                ewDataForAddApi.ins_code = ins_code
                            }
                        }
                        inusranceLi += '' +
                            '<div class="ew-plan-box ew-select-year-plan-event' + selectedInuranceCls + '" data-premium="' + eachInsuarnce.insurancePremium + '" data-emi="' + emi + '" data-term="' + eachInsuarnce.insuranceTerm + '" data-ins-code=' + ins_code + ' data-insurance-type=' + insurance_type + ' data-noOfEmis=' + tenure + '>' +
                            '    <div class="ew-plan-chkbx">' +
                            '        <span></span>' +
                            '        <input id="' + inputId + '" type="radio" class="ew-plan-radio ew-plan-checkbox" name="ew-plan-radio" ' + selectedInuranceChecked + ' />' +
                            '        <label for="' + inputId + '" class="extend-warranty-event ew-plan-label ew-plan-lb"></label>' +
                            '    </div>' +
                            '    <div class="ew-ext-details">' +
                            '        <div class="ew-years">' +
                            '            <p class="ew-year">' + eachInsuarnce.insuranceTerm + ' Year</p>' +
                            '            <p class="ew-plan-price">@ ₹' + eachInsuarnce.insurancePremium + '</p>' +
                            '        </div>' +
                            '        <div class="ew-emi-details">' +
                            // '            <p class="no-cost-text"><span>&horbar;</span><span>&horbar;</span></p>' +
                            '            <p class="ew-emi-rate">₹ ' + emi + ' X ' + tenure + 'm</p>' +
                            '        </div>' +
                            '    </div>' +
                            '</div>';
                    })
                } else {
                    ewDataForAddApi = {
                        term: '',
                        noOfEmis: '',
                        price: '',
                        emiPerMonth: '',
                        type: '',
                        ins_code: ''
                    };
                }
                inusranceLi ? $("#extend-warranty-comp").removeClass("dsp-none") : $("#extend-warranty-comp").addClass("dsp-none")
                $('.extend-warranty-html').html(inusranceLi);
    
    
                addEventExtendwarrenty();
            }
    
    
        })
    
    
        // function rate(eachPremium , tenure) {
        //     var eachRate = '';
    
        //     eachRate = Math.round(eachPremium / tenure)
        //     return eachRate;
        // }
    
        /* if (extendWarrantyData.type == 'FoneSafe') {
            $('.extendWarranty-redirectionUrl').attr('href', domainUrl+"/emi-store/extend-warranty-page1.html");
        } else if (extendWarrantyData.type == 'AssetCare') {
            $('.extendWarranty-redirectionUrl').attr('href', domainUrl+"/emi-store/extend-warranty-page.html");
        } */
    
        // $('.insuranceType_logo').attr("src", insuranceImg);
    
        /* var typeLi = '';
        extendWarrantyDataObj[extendWarrantyData.type].forEach(function (each) {
            typeLi += '' +
                '<div class="ew-benefit-type">' +
                '    <img src="' + each.image + '" alt="img" />' +
                '    <span class="ew-benefit-name">' + each.text + '</span>' +
                '</div>';
    
        })
        $('.insurance-type-html').html(typeLi); */
        //$('#insurance-type').val(extendWarrantyData.type);
    
    
        Object.keys(extendWarrantyData).forEach(function (eachKey) {
            var val = extendWarrantyData[eachKey];
            __common_service.setElementValue(eachKey, val, document.getElementById("extend-warranty-comp"));
        })
    }
    render.extendWarranty = extendWarrantyRender;

})

 window.addEventListener('DOMContentLoaded',function(){
    function bizExtendWarranty() {
        var dataMapping = _getDataMapping();
        var resp = dataMapping.productDetails.api.extendWarranty.response;
        dataMapping.extendWarrantyData = {};
        if(resp.insurance_plan){
            dataMapping.extendWarrantyData.nudgeMessage = resp.insurance_plan && resp.insurance_plan[0] && resp.insurance_plan[0].nudge_message;
            dataMapping.extendWarrantyData.type = resp.insurance_plan && resp.insurance_plan[0] && resp.insurance_plan[0].type;
            dataMapping.extendWarrantyData.insurance_imgurl = resp.insurance_plan && resp.insurance_plan[0] && resp.insurance_plan[0].insurance_imgurl;
            dataMapping.extendWarrantyData.insurance_name = resp.insurance_plan && resp.insurance_plan[0] && resp.insurance_plan[0].insurance_name;
            dataMapping.extendWarrantyData.ins_code = resp.insurance_plan && resp.insurance_plan[0] && resp.insurance_plan[0].ins_code;
            dataMapping.extendWarrantyData.redirection_url = resp.insurance_plan && resp.insurance_plan[0] && resp.insurance_plan[0].redirection_url;
            var insuranceTenure = $('.absolute-monthduration').text()
            var tenure = parseInt(insuranceTenure.split(' ')[0]);
            dataMapping.extendWarrantyData.insuranceTenure = tenure

        }
        
        dataMapping.extendWarrantyArr = [];
        resp.sellers && resp.sellers.forEach(function (eachSeller) {
            var obj = {}
            obj.sellerName = eachSeller.SellerName;
            obj.sellerId = eachSeller.SellerId;
            obj.insuranceArr = [];
            eachSeller.Insurance && eachSeller.Insurance.forEach(function (eachInsurance) {
                var insuranceobj = {};
                insuranceobj.insuranceTerm = eachInsurance.insurance_term
                // insuranceobj.insurancePremium = eachInsurance.insurance_premium
                insuranceobj.insurancePremium = eachInsurance.insurance_premium
                insuranceobj.insuranceId = eachInsurance.insurance_id
                obj.insuranceArr.push(insuranceobj);
            })
            dataMapping.extendWarrantyArr.push(obj);
        })
        _setDataMapping(dataMapping);
        render.extendWarranty();
    }
    
    biz.extendWarranty = bizExtendWarranty;
 })

function addEventExtendwarrenty() {
    $('.extend-warranty-event').click(function () {
        var eventaction = $(this).parents(".ew-select-year-plan-event").find(".ew-year").text()
        if ($(this).parents('.ew-plan-box').hasClass('ew-selected-plan')) {

        } else {
            $('.ew-plan-checkbox').prop('checked', false);
            $(this).siblings('.ew-plan-checkbox').prop('checked', true);
            $(this).parents('.ew-plan-box').addClass('ew-selected-plan');
            $(this).parents('.ew-plan-box').siblings('.ew-plan-box').removeClass('ew-selected-plan');
        }
        // Remove checked attribute from - No, I do not wish to secure my product
        $('#dont-need-ew').prop('checked', false);
        $('.dont-need-ew-tip').hide();
        var premium = $(this).parents('.ew-plan-box').attr('data-premium');
        var emi = $(this).parents('.ew-plan-box').attr('data-emi');
        var term = $(this).parents('.ew-plan-box').attr('data-term');
        var insCode = $(this).parents('.ew-plan-box').attr('data-ins-code');
        var insuranceType = $(this).parents('.ew-plan-box').attr('data-insurance-type');
        var noOfEmis = $(this).parents('.ew-plan-box').attr('data-noOfEmis');
        ewDataForAddApi.price = premium;
        ewDataForAddApi.emiPerMonth = emi;
        ewDataForAddApi.term = term;
        ewDataForAddApi.ins_code = insCode ;
        ewDataForAddApi.type = insuranceType ;
        ewDataForAddApi.noOfEmis = noOfEmis ;
        noIDontWishClicked = false;
        localStorage.removeItem("NoIDontWishClicked");
        dlExtendWarrantySelectInsurance();
        dlSelectPlan(eventaction);
    })

    // Show/hide tip div if Plan not selected
    $('#dont-need-ew').click(function () {
        noIDontWishClicked = true;
        if ($(this).is(":checked")) {
            var dataMapping = _getDataMapping();
            var extendWarrantyDataNudge = dataMapping.extendWarrantyData.nudgeMessage;
            if (extendWarrantyDataNudge) {
                $('.dont-need-ew-tip').show();
                localStorage.setItem("NoIDontWishClicked", true);
            } else {
                $('.dont-need-ew-tip').hide();
                localStorage.setItem("NoIDontWishClicked", true);
            }

        } else {
            $('.dont-need-ew-tip').hide();
            localStorage.removeItem("NoIDontWishClicked");
        }
        // Unselect plan on - No, I do not wish to secure my product
        $('.ew-plan-radio').prop('checked', false);
        $('.ew-plan-box').removeClass('ew-selected-plan');
        ewDataForAddApi = {
            term : '',
            noOfEmis : '',
            price: '',
            emiPerMonth: '',
            type: '',
            ins_code: ''
        };
    })


    $('.view-more-benefit-event').on("click", function () {
        dlExtendWarrantyMoreBenefit();
        dlViewMoreBenefit()
    })
    $('.select-unselect-event').on("click", function () {
        dlExtendWarrantySelectUnselect();
        dlCheckBoxClick();
    })
}


window.addEventListener('DOMContentLoaded',function(){
    function apiExtendWarrantyOnLoad() {
        var cityId = localStorage.getItem("cityId");
    
        var url = "/content/emistoremarketplace/api.protectplan." + skuName.replace(/[.]/g, "@") + "." + cityId + ".json";
        sendApiRequest("", url, "", "GET", function (status, resp) {
            if (status && resp && resp.status) {
                    /*
                status = true
                resp = {
                    "status": true,
                    "insurance_plan": [
                        {
                            "type": "AssetCare",
                            "ins_code": "MGI",
                            "insurance_imgurl": "https://estore.dev.bfsgodirect.com/emistore/media/stores/default/ins-icon_1_1.png",
                            "insurance_name": "Fonesafe Insurance",
                            "insurance_txt": "Get 2 year additional warranty for Fonesafe",
                            "redirection_url": "www.yahoo.com",
                            "nudge_message": "nudge message need to send based on categoryid send in request"
                        }
                    ],
                    "sellers": [
                        {
                            "SellerId": 1101,
                            "SellerName": "BALAJI MOBILE SHOPPEE_BPES D",
                            "DealerGroupId": 57007,
                            "DeliveryType": "3",
                            "Location": "SHOP NO8 INDRAPRASHT BUILDING SR NO 215 218 219 MAJARI ROAD HADAPSAR PUNE,IN FRONT SHITALADEVI MANDIR,INDIA,PUNE",
                            "Insurance": [
    
                                {
                                    "term": 1, "insurance_premium": 1924, "insurance_term": 1, "dealer_group_code": 0, "insurance_id": "a0U1t0000016MiEEAU", "Master_Unique_Key__c": "a0U1t0000016MiEEAU"
                                }
                                ,
    
                                {
                                    "term": 2, "insurance_premium": 1524, "insurance_term": 2, "dealer_group_code": 0, "insurance_id": "a0U1t0000016MiEEAU", "Master_Unique_Key__c": "a0U1t0000016MiEEAU"
                                }
                                ,
    
                                {
                                    "term": 3, "insurance_premium": 1724, "insurance_term": 3, "dealer_group_code": 0, "insurance_id": "a0U1t0000016MiEEAU", "Master_Unique_Key__c": "a0U1t0000016MiEEAU"
                                }
                                ,
                            ]
                        },
                        {
                            "SellerId": 123549,
                            "SellerName": "YUVA SHOPPEE_PUNE_BPES DPF_9",
                            "DealerGroupId": 70088,
                            "DeliveryType": "3",
                            "Location": "SHOP NO 02 GANESH VISHWA BLD D Y PATIL COLLEGE,OPP SBI BANK,India,PUNE",
                            "Insurance": [
    
                                { "term": 1, "insurance_premium": 1924, "insurance_term": 1, "dealer_group_code": 0, "insurance_id": "a0U1t0000016MiEEAU", "Master_Unique_Key__c": "a0U1t0000016MiEEAU" }
                            ]
                        }
    
                    ],
                    "message": "Success"
                }
                // */
                var dataMapping = _getDataMapping();
                dataMapping.productDetails.api.extendWarranty.response = resp;
                dataMapping.productDetails.api.extendWarranty.status = status;
                _setDataMapping(dataMapping);
                biz.extendWarranty();
            }else{
                $('.extend-warranty-comp').addClass('dsp-none');
            }
        }, "", "json", false)
    }
    api.extendWarrantyOnLoad = apiExtendWarrantyOnLoad
})
var extendWarrantyDataObj = {
    "FoneSafe": [
        {
            text: "Physical and liquid damages",
            image: "/content/dam/emistoremarketplace/ew-images/Path%2030710.svg",
            
        },
        {
            text: "Lost or theft",
            image: "/content/dam/emistoremarketplace/ew-images/criminal.svg",
        },
        {
            text: "Safeguards data",
            image: "/content/dam/emistoremarketplace/ew-images/Group%2019837.svg",
        }
    ],
    "AssetCare": [
        {
            text: "Nationwide Repair Network",
            image: "/content/dam/emistoremarketplace/ew-images/Icon%20metro-tools.svg",
        },
        {
            text: "Coverage up to invoice amount",
            image: "/content/dam/emistoremarketplace/ew-images/Icon%20awesome-coins.svg",
        },
        {
            text: "Dedicated Helpline",
            image: "/content/dam/emistoremarketplace/ew-images/Icon%20ionic-ios-call.svg",
        }
    ]
}


// window.addEventListener('DOMContentLoaded', function() {
//     api.extendWarrantyOnLoad();
// })
var ewDataForAddApi = {
    term : '',
    noOfEmis : '',
    price: '',
    emiPerMonth: '',
    type: '',
    ins_code: ''
};

var noIDontWishClicked = false ;
var categoryID = null;
categoryID = $('[name=categoryID]').attr('content').split(',')[0].split('[')[1];
sessionStorage.setItem('categoryID', categoryID);
function toggleInstaLoader(stat) {
    if (stat) {
        // $('.icn-loader').addClass('sh');
        $(".instapopup-skeleton-loader").removeClass("dsp-none").siblings().addClass("insta-dsp-none");
        $(".instapop-parent").addClass("dsp-none");
    } else {
        // $('.icn-loader').removeClass('sh');
        $(".instapopup-skeleton-loader").addClass("dsp-none").siblings().removeClass("insta-dsp-none");
        $(".instapop-parent").removeClass("dsp-none");
    }
}

window.addEventListener('DOMContentLoaded', function() {
    $('.icnpopup-close').on('click', function () {
        $(this).parents('.instacheck-popup').addClass('instacheck-pop-hide');
        emiChangePopupFlag = true;
        $('body').removeClass('overflow-hidden');
    });

    $('.icnpopup-lvl-bk').on('click', function () {
        toggleInstaLoader(true);
        setTimeout(function () {
            toggleInstaLoader(false);
        }, 1000)
        $(this).parents('.icn-modal-l2-sh').addClass('dsp-none');
        $('.icnpopup-l1').removeClass('dsp-none');
        $(this).parents(".Term-Condition-popup-div").addClass("dsp-none");
    });

    $('.inpopup').on('click', function () {
        $('.icnpopup-l1').addClass('dsp-none');
        var popup = $(this).attr('data-inpop').trim();
        if(popup == "icn-emischeme"){
            dlEmiSchemeChange()
        }
        $('#' + popup).removeClass('dsp-none');
    });


    $('.icn-estbl-rd-fn').on('change', function () {
        $(this).parents('.icn-estbl-rw').addClass('selected').siblings().removeClass('selected');
    });

    $('.icn-pybl-vm-fn').on('click', function () {
        var scrollDiv = $('.icn-prddt-scrl-content-w');
        var _this = $(this);
        var stat = _this.attr('data-view').trim();
        if (stat == "more") {
            // $('#icn-pybl-details-sh').addClass('sh-all');
            $('#icn-pybl-details-sh').slideDown();

            _this.text('View Less');
            _this.attr('data-view', 'less');
            scrollDiv.animate({ scrollTop: scrollDiv.outerHeight() });
        }
        else {
            // $('#icn-pybl-details-sh').removeClass('sh-all');
            $('#icn-pybl-details-sh').slideUp();
            _this.text('View More');
            _this.attr('data-view', 'more');
        }
    });

    $('.icn-tick-chk-fn').on('click', function () {
        if (!$(this).is(':checked')) {
            $('#al-insurance-pop').addClass('showpopup');
        }
    });

    $('.cl-inmodal').on('click', function () {
        $(this).parents('.icn-inner-modal').removeClass('showpopup');
        if ($(this).hasClass("exchange-cancel")) {
            // exchange   
        } else {
            // $('.icn-tick-chk-fn').prop('checked', true);
        }
    });

    $('.dl-ins-prd').on('click', function () {
        $(this).parents('.icn-inner-modal').removeClass('showpopup');
        // $('.icn-tick-chk-fn').prop('checked',false);
    });


    // POPUP INNER SHOW HIDE ON CONDITION
    $('.icn-limit-proceed').on('click', function () {
        var _this = $(this);
        _this.parents('.icn-limit-modal-wh').addClass('dsp-none');
        $('.icn-prdins-modal-wh').removeClass('dsp-none');
    });

    $('.icn-apc-btn-fn').on('click', function () {
        // Add coupon
        $('.t-ap-c').addClass('dsp-none');
        $('.t-apd-c').removeClass('dsp-none');
        // toggleInstaLoader(true);
        // setTimeout(function () {
        //     toggleInstaLoader(false);
        // }, 1000)
        $(this).parents('.icn-modal-l2-sh').addClass('dsp-none');
        $('.icnpopup-l1').removeClass('dsp-none');
    });
    $('.icn-rmvcoup-cd').on('click', function () {
        // Remove coupon
        // $(this).parents('.icn-dn-promocd-w').addClass('dsp-none').siblings().removeClass('dsp-none');
		dlTWOPDPEmiPromoChange();
        api.InstaCouponRemove();
    });
    //

    /* $("#insta-place-your-order-btn").on("click",function (e) {
        $('#al-insta-otp-pop').addClass('showpopup');
        api.instaPlaceOrder();
    }) */

    $(".pd-insta-clcl-btn").on("click", function (e) {
        $('#al-insta-otp-pop').removeClass('showpopup');
    })

    // new-popup-payblestore js
    $(".view-show-text").on("click", function () {
        if ($(this).hasClass("hide-details")) {
            $(this).parents().siblings(".pyble-show-content-w").addClass("dsp-none");
            $(this).text("View Details");
            $(this).removeClass("hide-details");
        } else {
            $(this).addClass("hide-details");
            $(this).parents().siblings(".pyble-show-content-w").removeClass("dsp-none");
            $(this).text("Hide Details");
        }
    })
    
    $(".view-show-text-event").on("click", function () {
        if ($(this).hasClass("hide-details-bank")) {
            $(this).parents().siblings(".bank-details-content").addClass("dsp-none");
            $(this).text("View Details");
            dlInstaBuyViewDetails("Hide Details");
            $(this).removeClass("hide-details-bank");
        } else {
            $(this).addClass("hide-details-bank");
            $(this).parents().siblings(".bank-details-content").removeClass("dsp-none");
            $(this).text("Hide Details");
            dlInstaBuyViewDetails("View Details");
        }
    })
    
    // view detials-hide-detials js start//
    $(".view-show-text-data").on("click", function () {
		dlViewHideDetails($(this));

        $(".hide-show-text-data").show();
        $(".payment-summ-prod-main").show();
        $(".view-show-text-data").hide();
        document.getElementsByClassName('payment-summ-prod-main')[0].scrollIntoView({ behavior: 'smooth'});
    })
    $(".hide-show-text-data").on("click", function () {
		dlViewHideDetails($(this));
        $(".view-show-text-data").show();
        $(".payment-summ-prod-main").hide();
        $(".hide-show-text-data").hide();
    });
     // view detials-hide-detials js end//
        

    // $(".term-condition-popup").on("click", function(){
    //     $(this).parents(".instacheck-modal-content").find(".Term-Condition-popup-div").removeClass("dsp-none");
    //     $(this).parents(".instacheck-modal-content").find(".icn-modal-l2-sh").addClass("dsp-none");
    //     $(this).parents(".icn-modal-l2-container").find(".icn-modal-l2-nav-w").addClass("dsp-none");
    // })

    if (window.matchMedia("(max-width: 766px)").matches){
        $('body').on('click', function (e) {
            let curTarget = e.target;
            if ($(curTarget).hasClass('instacheck-popup')) {
                $('.instacheck-innerwrapper').css({
                    'visibility': 'visible',
                })
                $('.upfront-tooltip-con').css({
                    'visibility': 'hidden',
                })
            }
        })
    }

});
/************** Insta Popup Api Js Start **************/

/************** Insta Popup Api Start **************/
function apiInstaPopup() {
    instaCallBack && toggleInstaLoader(true);
    var customerUserId = decodeURIComponent(readCookie("perpetual_session")).split("|")[0];
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var reqObj = {
        customer_user_id: customerUserId
    };
    sendApiRequest(reqObj, baseUrl + "/rest/V1/instabuy/popup", "", "POST", function (status, resp) {
    /*
        status = true;
        resp = {
            "item": {
              "quote_id": 12105,
              "quote_item_id": 23337,
              "name": "Vibrant Samsung A7 (2016) 16 GB Gold",
              "price": "₹27,987",
              "total_cost": "₹27,987"
            },
            "insurance": [
              {
                "item_id": "23337",
                "sub_sku": "BAGIC",
                "data_ck": "QkFHSUMqXjE0NDg=",
                "amount": "₹1,448",
                "no_of_emis": 8,
                "ins_emi": 181,
                "insurance_term": "",
                "ins_code": "",
                "insurance_name": "MobiProtect",
                "insurance_text": "",
                "is_insurance_selected": true,
                "formated_insurance_price": "₹1,448"
              }
            ],
            "bank_details": [
              {
                "BankName__c": "XXXXXXXXXX"
              }
            ],
            "exchange": {
              "status": false,
              "reference_id": null,
              "exchange_amount": null,
              "description": null,
              "know_more_link": null
            },
            "cd_exchange": {
              "status": false,
              "id": null,
              "ref_id": null,
              "category_id": null,
              "brand_id": null,
              "item_id": null,
              "pickup_charge": null,
              "exchange_value": null,
              "visitor_id": null,
              "is_active": null,
              "flag": null
            },
            "coupon": {
              "status": false,
              "name": "",
              "coupon_code": null,
              "description": ""
            },
            "address": {
              "status": true,
              "default_address_id": 1377,
              "default_address": "505 Gundecha Palace , PUNE - 480880, MAHARASHTRA",
              "address_list": [
                {
                  "id": "849",
                  "name": "N S"
                },
                {
                  "id": "1112",
                  "name": "N S"
                },
                {
                  "id": "1116",
                  "name": "Home"
                },
                {
                  "id": "1366",
                  "name": "Home"
                },
                {
                  "id": "1377",
                  "name": "Home"
                },
                {
                  "id": "1422",
                  "name": "Home"
                }
              ]
            },
            "dynamic_down_payment": {
              "item_id": 23337,
              "emi_amount": "₹7,500",
              "tenure": 8,
              "offer_price": "₹1,00,000",
              "on_road_price": "₹1,00,000",
              "processing_fee": "555",
              "delivery_charges": "Free",
              "convenience_fee": "₹350",
              "down_payment_amount": "₹40,000",
              "cash_amount": "₹0",
              "total_pay_now": "₹40,000",
              "discount_amount": "0",
              "total_cost": "₹27,987",
              "total_loan_amount": "-₹12,013",
              "net_loan_amount": "-₹12,013",
              "remaining_emis": "8",
              "exchaneg_offer": "0",
              "mrp": "₹34700",
              "save_amount": null,
              "is_dynamic_downpayment": false,
              "deliverybyhrs_before5": "",
              "deliverybyhrs_after5": "",
              "tat": "",
              "product_orp": "₹1,00,000",
              "payment_to_dealer": "₹40,000",
              "stamp_duty": "₹1250",
              "hypothecation_charges": "₹15151",
              "documentation_charges": "₹120",
              "product_cost": " ₹1,59,000",
              "personal_accident_insurance": "₹ 15,000",
              "payable_emi": "₹2020",
               "scheme_roi": "2",
               'scheme_irr': 18.00,
               "ex_showroom_price_c": "140000",
                "insurance_c": "4000",
                "rto_c": "6000"
            },
            "is_otp_session_valid": false,
            "otp_message": "",
            "redirect_to_checkout": false,
            "delivery_preference": "1",
            "dealer_address": "1st Floor, Western Edge,PUNE,MAHARASHTRA,411017",
            "dealer_name": "Vijay Sales Pune",
            "scheme_list": [
              {
                "scheme_id": 51510,
                "product_orp": 100000,
                "net_loan_amount": 60000,
                "emi_amount": 6000,
                "down_payment": "₹40000",
                "emi_month": 7,
                "processing_fee": "₹0",
                "is_default": "0",
                "tenure": 10,
                "advance_emi": "₹3.00",
                "SchemeScore": 13,
                "MARGINMONERY_SPECIAL": "",
                "SchemeType": 1,
                "emi_insuranceamt": 0,
                "emi_amount_with_ins": "₹6000",
                "special_offer_text": "",
                "is_lowest_emi": true,
                "down_payment_amount": 40000,
                'scheme_roi': 87,
                'scheme_irr': 18.00
              },
              {
                "scheme_id": 52228,
                "product_orp": 100000,
                "net_loan_amount": 60000,
                "emi_amount": 6000,
                "down_payment": "₹40000",
                "emi_month": 8,
                "processing_fee": "₹0",
                "is_default": "0",
                "tenure": 10,
                "advance_emi": "₹2.00",
                "SchemeScore": 13,
                "MARGINMONERY_SPECIAL": "",
                "SchemeType": 1,
                "emi_insuranceamt": 0,
                "emi_amount_with_ins": "₹6000",
                "special_offer_text": "",
                "is_lowest_emi": 0,
                "down_payment_amount": 40000,
                'scheme_roi': 84,
                'scheme_irr': 12.00

              },
              {
                "scheme_id": 52624,
                "product_orp": 100000,
                "net_loan_amount": 60000,
                "emi_amount": 6667,
                "down_payment": "₹40000",
                "emi_month": 6,
                "processing_fee": "₹0",
                "is_default": "0",
                "tenure": 9,
                "advance_emi": "₹3.00",
                "SchemeScore": 2,
                "MARGINMONERY_SPECIAL": "",
                "SchemeType": 1,
                "emi_insuranceamt": 0,
                "emi_amount_with_ins": "₹6667",
                "special_offer_text": "",
                "is_lowest_emi": 0,
                "down_payment_amount": 40000,
                'scheme_roi': 88,
                'scheme_irr': 27.00

              },
              {
                "scheme_id": 51613,
                "product_orp": 100000,
                "net_loan_amount": 60000,
                "emi_amount": 7500,
                "down_payment": "₹40000",
                "emi_month": 8,
                "processing_fee": "₹0",
                "is_default": "1",
                "tenure": 8,
                "advance_emi": "₹0.00",
                "SchemeScore": 3,
                "MARGINMONERY_SPECIAL": "",
                "SchemeType": 1,
                "emi_insuranceamt": 556,
                "emi_amount_with_ins": "₹7500",
                "special_offer_text": "",
                "is_lowest_emi": 0,
                "down_payment_amount": 40000,
                'scheme_roi': 8,
                'scheme_irr': 25.00

              }
            ],
            "popup_restriction_config": "Hello",
            "dealer_delivery_type": "",
            "onlinedp_flag": "1",
            "downpayment_flag": "1",
            "online_downpayment_text": "Seller only accepts online downpayment",
            "online_downpament_tooltip_text": "Downpayment to be paid using UPI, Net Banking, Debit & Credit Cards after order is successfully placed",
            "installation_flag": "0",
            "installation_charges": "0",
            "mandate": "1",
             "annualised_ROI" : "10.25%"
          }
         // */ 
        var dataMapping = _getDataMapping();
        dataMapping.instaPopupData.api.instaPopup.response = resp;
        _setDataMapping(dataMapping);
        if (status) {
            /* if (showInstaPopupFlag == "show-insta-details") {
                showInstaPopup("show-insta-details");
            } else {
                showInstaPopup("show-insta-limit");
            } */
            var srcImg =  $('.popup-close-icn').attr('data-src')
            $('.popup-close-icn').attr('src', srcImg);
            showInstaPopup("show-insta-details");
            biz.instaPopup();
             /*   if (instaSchemeChanged) {
                emiChangeToasterInstabuy();
                instaSchemeChanged = false;
            }
 */        }
        if (instaCallBack) {
            toggleInstaLoader(false);
            showInstaCouponSuccess(instaCallBackMsg, instaCallBackMsgStatus, nottitleneedFlag);
            instaCallBack = false;
            nottitleneedFlag = false;
        } else {
            // showLoader(false);
            toggleInstaLoader(false);
            try {
                instapopupload();
            } catch (err) {
                console.error('%c ' + err, 'color:red')
            }
        }
    }, custToken, "json");
}
api.instaPopup = apiInstaPopup;

function apiInstaPlaceOrder() {
    $(".otp-error-msg").text("").parents(".pd-prodotp-field-w").removeClass("pd-incorrect");
    $(".invalidErrorMsg").html("");
    $(".invalidErrorMsg").css("color", "#707070");
    // $(".resend-err-msg").text("");
    var customerUserId = $user.getCustomerUserId();
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    reqObj = {
        customer_user_id: customerUserId,
        payment_method: {
            method: "checkmo"
        },
        amazon_kindel: null,
        isInstaBuy: true
    };

    var otpVal = $(".pd-otp-fn").val();
    if (flagInstaPlaceoder.orderId && flagInstaPlaceoder.verifyOtp) {
        // verify otp
        // reqObj.amazon_kindel = null;
        // reqObj.isInstaBuy = true;
        reqObj.order_id = flagInstaPlaceoder.orderId;
        reqObj.otp = toEncryptDecryptAES(otpVal, "en");
    }
    if (flagInstaPlaceoder.orderId && flagInstaPlaceoder.resend) {
        // resend otp
        // reqObj.amazon_kindel = null;
        // reqObj.isInstaBuy = true;
        reqObj.order_id = flagInstaPlaceoder.orderId;
    }
    if (flagInstaPlaceoder.placeorder) {
        var _gaVal = "";
        if (readCookie("_ga")) {
            var _gaarr = readCookie("_ga").split(".");
            _gaarr.splice(0, 2);
            _gaVal = _gaarr.join(".");
        }
        reqObj.gaid = _gaVal;
        reqObj.lat = locationlatitude;
        reqObj.long = locationlongitude;
    }
    flagInstaPlaceoder.verifyOtp = false;

    // CTA capture log call Start
    var customerMagentoId = __get_perpetual_session("m_customer_id");
    payload = {
        "key": "abc",
        "data":
        {
            "sku":skuName,
            "mcustomerid": customerMagentoId,
            "mobileno": __get_perpetual_session("mobile_number"),
            "cta": "TWOP",
        }
    }
    var apiUrl = domainUrl + "/dps/web/api/ctacapturelog"
    sendApiRequest(payload, apiUrl, "", "POST", function (status, resp) {
        console.log(resp, status);
    })
    // CTA capture log call End


    sendApiRequest(reqObj, testUrl + "/rest/V1/place/order", "", "POST",
        function (status, resp) {
             /* 
           status = true;
           resp= {
               "status": true,
               "message": "success",
               "redirect_url": "URL CAME FROM DOCPOD",
               "url": null,
               "order_id": "NjAwMV9CTEY=",
               "otp_flag": 0,
               "transaction_id": "MjA4Mzg5MjAwMV9CTEY="
                } 
    //*/
            try {
                globalDataLayerObj.instaTransactionId = resp.transaction_id ? reverseStr(atob(resp.transaction_id)).split("_")[1] : "";
                instaBuyNowDataLayer("Place_Order");
            } catch (error) {
                console.error('%c ' + error, 'color:orange');
            }
            buttonLoaderToggle($("#insta-place-your-order-btn"), false);
            var dataMapping = _getDataMapping();
            dataMapping.instaPopupData.api.placeorder.response = resp;
            dataMapping.instaPopupData.api.placeorder.status = status;
            _setDataMapping(dataMapping);
            // biz.instaPlaceOrder()
            biz.instaPlaceOrderTwoWheeler()
        }, custToken, "json");
}
api.instaPlaceOrder = apiInstaPlaceOrder;

function apiInstaPlaceOrderAfterOTP() {
    apiSuccessfull = false;
    api.instaPlaceOrderAfterOTP.id = 'ordersApi'
    $(".otp-error-msg").text("").parents(".pd-prodotp-field-w").removeClass("pd-incorrect");
    $(".invalidErrorMsg").html("");
    $(".invalidErrorMsg").css("color", "#707070");
    // $(".resend-err-msg").text("");
    var customerUserId = $user.getCustomerUserId();
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var reqObj = {
        customer_user_id: customerUserId,
        payment_method: {
            method: "checkmo"
        },
        amazon_kindel: null,
        isInstaBuy: true
    };

    // var otpVal = $(".pd-otp-fn").val();
    if (flagInstaPlaceoder.orderId && flagInstaPlaceoder.verifyOtp) {
        // verify otp
        reqObj.order_id = flagInstaPlaceoder.orderId;
        reqObj.otp = toEncryptDecryptAES(instaBuyOTPVal,'en');

    // CTA capture log call Start
    var customerMagentoId = __get_perpetual_session("m_customer_id");
    payload = {
        "key": "abc",
        "data":
            { "isInstaBuy": true, "mcustomerid": customerMagentoId, "otp": reqObj.otp , "cta": "IBSOTP", "order_id": reqObj.order_id }
        }
    var apiUrl = domainUrl + "/dps/web/api/ctacapturelog"
    sendApiRequest(payload, apiUrl, "", "POST", function (status, resp) {
    console.log(resp, status);
    })
    // CTA capture log call End

    }
    if (flagInstaPlaceoder.orderId && flagInstaPlaceoder.resend) {
        // resend otp
        reqObj.order_id = flagInstaPlaceoder.orderId;
    }
    if (flagInstaPlaceoder.placeorder) {
        var _gaVal = "";
        if (readCookie("_ga")) {
            var _gaarr = readCookie("_ga").split(".");
            _gaarr.splice(0, 2);
            _gaVal = _gaarr.join(".");
        }
        reqObj.gaid = _gaVal;
        reqObj.lat = locationlatitude;
        reqObj.long = locationlongitude;
    }

    if (otpAtosToHitAgain) {
        reqObj.order_id = flagInstaPlaceoder.orderId;
        otpAtosToHitAgain =  false;
    }
    if(flagInstaPlaceoder.orderId && autosRequeryResCode98 || flagInstaPlaceoder.verifyOtp ){
        var respType;
        atosRequeryWaitingTimeOutID =  setTimeout(() => {
            respType =  _getDataMapping().instaPopupData.api.placeorder.response.resp_type
            if(apiSuccessfull == false){
                biz.atosRequeryApiHit();
                atosRequeryRespAvail = true;
            }
        }, 20000);
    }
    if(autosRequeryResCode98){
        reqObj.atos_rescode = true;
        reqObj.otp = toEncryptDecryptAES(instaBuyOTPVal,'en');
        reqObj.order_id = flagInstaPlaceoder.orderId;
        autosRequeryResCode98 = false;
    }

    flagInstaPlaceoder.verifyOtp = false;

    sendApiRequest(reqObj, testUrl + "/rest/V1/order/confirm", "", "POST",
        function (status, resp) {
            /*
            status = true;
            resp = {
                "status": true,
                "message": "OTP has been sent  successfully on your registered mobile number 3030",
                "redirect_url": "thankyou",
                "url": "",
                "order_id": "NzY1NjkyMl9CTEY=",
                "transaction_id" : "NzY1NjkyMl9CTEY="
            }
            // */
            if(!atosRequeryRespAvail){
                apiSuccessfull = true;
                try {
                    globalDataLayerObj.instaTransactionId = resp.transaction_id ? reverseStr(atob(resp.transaction_id)).split("_")[1] : "";
                    // instaBuyNowDataLayer("Place_Order");
                } catch (error) {
                    console.error('%c ' + error, 'color:orange');
                }
                buttonLoaderToggle($("#insta-place-your-order-btn"), false);
                var dataMapping = _getDataMapping();
                dataMapping.instaPopupData.api.placeorder.response = resp;
                dataMapping.instaPopupData.api.placeorder.status = status;
                _setDataMapping(dataMapping);
                biz.instaPlaceOrder(api.instaPlaceOrderAfterOTP.id);
                api.elkLogs('instabuy_otp_popup',"initial_load");
            }
        }, custToken, "json");
}
api.instaPlaceOrderAfterOTP = apiInstaPlaceOrderAfterOTP;
/************** Insta Popup Api End **************/
/************** Insta Insurance Api Start **************/
function apiAddInstaInsurance() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/cart/add-insurance";
    var data = $("#insta-popup").find(".insuranceSelected-cb").attr("data-id").split("_");
    var reqObj = {
        "sub_sku": data[0],
        "amount": data[1],
        "code": data[2],
        "emi_per_month": data[3],
        "no_of_emis": data[4],
        "quote_item_id": data[5],
        "quote_id": data[6]
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        if (status && resp == "true") {
            var dataMapping = _getDataMapping();
            dataMapping.productDetails.insuranceSelected = true;
            dataMapping.instaPopupData.insuranceSelected = true;
            var insuranceType = dataMapping.instaPopupData.insurance[0].subSku ? dataMapping.instaPopupData.insurance[0].subSku : dataMapping.extendWarrantyData.type;
            $("#insta-popup").find(".insuranceSelected-cb").prop("checked", true);
            _setDataMapping(dataMapping);
            instaCallBack = true;
            api.instaPopup();
            instaCallBackMsg = '' + insuranceType + ' insurance added successfully!';
            instaCallBackMsgStatus = status;
            try {
                dlInsuranceSelecteNUnSelect(globalDataLayerObj.currTarget);
            } catch (err) {
                console.error(err);
            }
        }
    }, custToken, "text");
}
api.addInstaInsurance = apiAddInstaInsurance;

function apiRemoveInstaInsurance() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/cart/remove-insurance";
    var data = $("#insta-popup").find(".insuranceSelected-cb").attr("data-id").split("_");
    var reqObj = {
        "sub_sku": data[0],
        "quote_item_id": data[5]
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        if (status && resp == "true") {
            var dataMapping = _getDataMapping();
            dataMapping.productDetails.insuranceSelected = false;
            dataMapping.instaPopupData.insuranceSelected = false;
            var insuranceType = dataMapping.instaPopupData.insurance[0].subSku ? dataMapping.instaPopupData.insurance[0].subSku : dataMapping.extendWarrantyData.type;
            $("#insta-popup").find(".insuranceSelected-cb").prop("checked", false);
            _setDataMapping(dataMapping);
            instaCallBack = true;
            api.instaPopup();
            instaCallBackMsg = '' + insuranceType + ' insurance removed successfully!';
            instaCallBackMsgStatus = status;
            try {
                dlInsuranceSelecteNUnSelect(globalDataLayerObj.currTarget);
            } catch (err) {
                console.error(err);
            }
        }
    }, custToken, "text");
}
api.removeInstaInsurance = apiRemoveInstaInsurance;

/************** Insta Insurance Api End **************/
/************** Insta Exchange Api Start **************/
function apiRemoveInstaExchange() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/cart/delete-cdexchange";
    var reqObj = {
        "ref_id": "sEOOlRTZtq1558680124-3852",
        "is_pdp": true
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        if (status && resp == "true") {
            $("#insta-popup").find("#insta-exchange").remove();
            api.instaPopup();
        }
    }, custToken, "text");
}
api.removeInstaExchange = apiRemoveInstaExchange;
/************** Insta Exchange Api End **************/
/************** Insta Scheme Api Start **************/
function apiInstaSchemeSelection() {
    var dataMapping = _getDataMapping();
    var itemId = dataMapping.instaPopupData.quoteItemId;
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/instabuy/schemes/update";
    var reqObj = {
        item_id: itemId,
        scheme_id: selectedSchemeId
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
         instaCallBack = resp.status && status ? true : false; 
        nottitleneedFlag = true;
        api.instaPopup();
         instaCallBackMsg = resp.status ? "EMI Scheme has been changed!" : "";
        instaCallBackMsgStatus = resp.status; 
        // toggleInstaLoader(false);
    }, custToken, "json");
    popUpSchemeInfoDataLayer(selectedSchemeId);
}
api.instaSchemeSelection = apiInstaSchemeSelection;
/************** Insta Scheme Api End **************/
/************** Insta Coupon Api Start **************/
function apiInstaCouponList() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/cart/coupons";
    var reqObj = {
        "dealer": onChangeSellerID,
        "city": localStorage.getItem("cityId"),
        "product_code" : selectedDeliverySeller.Offer.ProductCode
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        /*
        status = true;
        resp = {
            "status": true,
            "message": "Coupon List",
            "coupon": [
                {
                    "rule_id": "603",
                    "coupon_id": "562",
                    "code": "adityatesting",
                    "payment_method": "",
                    "coupon_description": "This is for you. pleaese take it",
                    "Tnc": "Only if you apply this exactly at 3pm"
                },
                {
                    "rule_id": "604",
                    "coupon_id": "562",
                    "code": "adityatesting2",
                    "payment_method": "",
                    "coupon_description": "This is for you. pleaese take it",
                    "Tnc": "Only if you apply this exactly at 3pm"
                },
                {
                    "rule_id": "605",
                    "coupon_id": "562",
                    "code": "adityatesting3",
                    "payment_method": "",
                    "coupon_description": "This is for you. pleaese take it",
                    "Tnc": "Only if you apply this exactly at 3pm"
                },
            ]
        }
        // */
        if (status && resp) {
            var dataMapping = _getDataMapping();
            resp = typeof resp == "object" ? resp : JSON.parse(resp);
            dataMapping.instaPopupData.api.couponList.response = resp;
            _setDataMapping(dataMapping);
            biz.instaCouponList();
        }
        toggleInstaLoader(false);
    }, custToken, "text");
}
api.instaCouponList = apiInstaCouponList;

function apiInstaCouponApply() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/cart/coupon/apply";
    var reqObj = {
        "coupon_code": selectedCouponCode,
        "city_id": localStorage.getItem("cityId"),
        "AssetCategoryID": "",             //new keys from here
        "mobileNumber": "",              //AES 256 + Base64
        "modelCode": "",
        "customerId": "",                       //custtoken
        "dealerIds": "",                       //
        "GrossLoanAmount": "", 
        "idNum":  "",                       //AES 256 + Base64  // ruleid from coupns resp
        "offerId":  "",                      //AES 256 + Base64 // coupon_id -- (from couponlistresp)
        "cashbackByAmount": ""  
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        /* 
        status = true;
        resp = {
            "status": true,
            "message": "Promo code applied successfully",
            "promo_code": "test123",
            "promo_name": "test",
            "promo_description": "test"
        }
        //  */
        if (status && resp) {
            resp = typeof resp == "object" ? resp : JSON.parse(resp);
            if (resp.status) {
                $('.t-ap-c').addClass('dsp-none');
                $('.t-apd-c').removeClass('dsp-none');

                instaCallBack = true;
                api.instaPopup();
                instaCallBackMsg = resp.message;
                instaCallBackMsgStatus = resp.status;
            } else {
                showInstaCouponSuccess(resp.message, resp.status);
                toggleInstaLoader(false);
            }
            // $(".insta-coupon-success-msg").addClass("show-popup").find(".coupon-msg").text(resp.message);
        }
    }, custToken, "text");
}
api.instaCouponApply = apiInstaCouponApply;

function apiInstaCouponRemove() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/cart/coupon/remove";
    var reqObj = {
        "coupon_code": selectedCouponId,
        "city_id": localStorage.getItem("cityId")
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        /* 
        status = true;
        resp = {
            "status": true,
            "message": "Coupon hasbeen removed from your cart",
            "promo_code": null,
            "promo_name": null,
            "promo_description": null
        }
        //  */
        instaCallBack = false;
        if (status && resp) {
            resp = typeof resp == "object" ? resp : JSON.parse(resp);
            if (resp.status) {
                $('.t-ap-c').removeClass('dsp-none');
                $('.t-apd-c').addClass('dsp-none');

                instaCallBack = true;
                api.instaPopup();
                instaCallBackMsg = resp.message;
                instaCallBackMsgStatus = resp.status;
            } else {
                showInstaCouponSuccess(resp.message, resp.status);
                toggleInstaLoader(false);
            }
            // showInstaCouponSuccess(resp.message);
            // $(".insta-coupon-success-msg").addClass("show-popup").find(".coupon-msg").text(resp.message);
        }
    }, custToken, "text");
}
api.InstaCouponRemove = apiInstaCouponRemove;
/************** Insta Coupon Api End **************/
/************** Insta Reward Api Start **************/
function apiInstaRewardApply() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/customers/reward/add";
    var reqObj = {
        "ItemId": quoteItemId
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        /* 
        status = true;
        resp = {
            "status": true,
            "message": "Reward Added Successfully .!",
            "rewards": 1200
        }

        //  */
        if (status && resp) {
            resp = typeof resp == "object" ? resp : JSON.parse(resp);
            if (resp.status) {
                showInstaReward('show-added');
            } else {

            }
            instaCallBack = true;
            api.instaPopup();
            instaCallBackMsg = resp.message;
            instaCallBackMsgStatus = resp.status;
            // showInstaCouponSuccess(resp.message);
            // $(".insta-coupon-success-msg").addClass("show-popup").find(".coupon-msg").text(resp.message);
        }
    }, custToken, "text");
}
api.instaRewardApply = apiInstaRewardApply

function apiInstaRewardRemove() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : ""
    var apiUrl = baseUrl + "/rest/V1/customers/reward/remove";
    var reqObj = {
        "ItemId": quoteItemId
    }
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        /* 
        status = true;
        resp = {
            "status": true,
            "message": "Reward Removed Successfully .!",
            "rewards": 1200
        }
        //  */
        if (status && resp) {
            resp = typeof resp == "object" ? resp : JSON.parse(resp);
            if (resp.status) {
                showInstaReward('show-removed');
            } else {

            }
            instaCallBack = true;
            api.instaPopup();
            instaCallBackMsg = resp.message;
            instaCallBackMsgStatus = resp.status;
            // showInstaCouponSuccess(resp.message);
            // $(".insta-coupon-success-msg").addClass("show-popup").find(".coupon-msg").text(resp.message);
        }
    }, custToken, "text");
}
api.instaRewardRemove = apiInstaRewardRemove

/************** Insta Reward Api End **************/


/************** Insta Popup Api Js End **************/
/************** Insta Popup Render Js Start **************/

/************** Insta Popup Render Start **************/
function renderInstaPopup() {
    var dataMapping = _getDataMapping();
    var instaPopupData = dataMapping.instaPopupData;
    var exchangeDetails = instaPopupData.exchangeDetails;
    var instaPopupComp = document.getElementById("insta-popup");

    Object.keys(dataMapping.instaPopupData).forEach(function (eachKey) {
        var val = instaPopupData[eachKey];
        __common_service.setElementValue(eachKey, val, instaPopupComp);
    })
    // /* 

    instaPopupData.productDiscountAmt > 0 ? $(instaPopupComp).find(".invalid-discount-sec").removeClass("dsp-none") : $(instaPopupComp).find(".invalid-discount-sec").addClass("dsp-none");

    var homeDeliveryStatus = "Delivery " + getInstaDeliveryTime();
    $(".insta-home-delivery-tat").html(homeDeliveryStatus);
    var currDate = new Date();
    currDate.setDate(currDate.getDate() + 3);
    var dayRomanStr = getRomanWord(currDate);
    var dayRomanStr = "";
    var storeDeliveryStatus = (currDate.getDate()) + dayRomanStr + " " + __months_in_words[currDate.getMonth()] + " " + currDate.getFullYear();
    $(".insta-store-delivery-tat").html("Pick up the product on or before " + storeDeliveryStatus); 

    if (instaPopupData.insurance.length <= 0) {
        $(".extended-warranty").css("display", "none")
    }else{
        if(instaPopupData.insurance[0].isSelected){
            $(".including-addon-evt").removeClass('dsp-none');
        }else{
            $(".including-addon-evt").addClass('dsp-none');
        }
    }
    if(!(instaPopupData.rewardAppliedVal || instaPopupData.rewardAppliedVal > 0)){
        $(".reward-text").text("₹0")
    }

    if (instaPopupData.isRewardSelected) {
        $(".downPaymentAmountStrike-txt").removeClass("dsp-none")
        $("#remove-desc").show(); 
        $("#redeem-desc").hide();
    } else {
        $(".downPaymentAmountStrike-txt").addClass("dsp-none")
        $("#remove-desc").hide();
        $("#redeem-desc").show();
    }
    if (instaPopupData.rewardPointsApplied == null && instaPopupData.rewardAppliedVal == null) {
        $(".bonus-div").addClass("dsp-none")
        $("#rewardAmtDeliveryToolTip").css("display", "none")
    }
   /*  if (instaPopupData.deliveryPreference == 1) {
        $(".icn-pickup-home").removeClass("dsp-none");
        $(".icn-pickup-store").addClass("dsp-none");
        $(".payable-txt").text("Payable at Delivery");
    } else {
        $(".icn-pickup-home").addClass("dsp-none");
        $(".icn-pickup-store").removeClass("dsp-none");
        $(".payable-txt").text("Payable at Store");
        if (__get_perpetual_session("doc_required_flag") == "Y") {
            $(".want-home-delivery-sec").addClass("dsp-none");
        } else if (__get_perpetual_session("doc_required_flag") == "N") {
            $(".want-home-delivery-sec").removeClass("dsp-none");
        }
    } */
    if (instaPopupData.onlineDPFlag == 1 && instaPopupData.downPaymentFlag > 0 && instaPopupData.downPaymentFlag <= 3) {
        $(".payable-txt").text("Payable Now");
    } else if (instaPopupData.onlineDPFlag == 0 || (instaPopupData.downPaymentFlag == 4 || !instaPopupData.downPaymentFlag)) {
        $(".payable-txt").text("Payable to seller");
    }
    /* if (instaPopupData.isDownPaymentText) {
        $(".dp-tooltip-parent").css("display", "flex");
    } else {
        $(".dp-tooltip-parent").css("display", "none");
    } */
    
    if(instaPopupData.personalAccidentInsurance <= 0){
        $(".accident-issurance-parent").addClass("dsp-none")
    }else{
        $(".accident-issurance-parent").removeClass("dsp-none")
    }
    if(instaPopupData.installationChargesRs > 0){
        $(".installtion-charges-parent").removeClass("i-dsp-none")
    }else if(!instaPopupData.installationChargesRs){
        $(".installtion-charges-parent").addClass("i-dsp-none")
    }
    var diffrence= instaPopupData.productMrp - instaPopupData.productORPrs
    if(diffrence <= 0){
     $(".save-offer").hide()
     $(".actual-price ").hide()
    }
     

    $(".insta-insurance-root").html(insuranceHTML);
    var insuranceHTML = '';
    dataMapping.instaPopupData.insurance.forEach(function (eachInsurance, index) {
        if (index == 0) {
            if (eachInsurance.isSelected) {
                $(".extended-warranty-sec").css("display", "flex")
            } else {
                $(".extended-warranty-sec").css("display", "none")
            }
            insuranceHTML += getInstaInsuranceHTML(eachInsurance);
        }
    })
    if (exchangeDetails && exchangeDetails.status) {
        insuranceHTML += getInstaInsuranceHTML({ name: "exchange" });
    }
    $(".insta-insurance-root").html(insuranceHTML);



    if (instaPopupData.isCouponApply) {
        $('.t-ap-c').addClass('dsp-none');
        $('.t-apd-c').removeClass('dsp-none');
    } else {
        $('.t-ap-c').removeClass('dsp-none');
        $('.t-apd-c').addClass('dsp-none');
    }

    if (instaPopupData.isRewardSelected) {
        $("#rewardAmtDeliveryToolTip").removeClass("dps-none");
        showInstaReward('show-added');
    } else {
        $("#rewardAmtDeliveryToolTip").addClass("dps-none");
        showInstaReward('show-removed');
    }
    render.instaSchemeList();
    addEventInsta()
    replaceExtraCharWithDots($(".sub-insta-address"),83)
    if (window.matchMedia("(max-width: 766px)").matches) {
        replaceExtraCharWithDots($(".icn-proddt-ofrprice"),39)
    }else{
        replaceExtraCharWithDots($(".icn-proddt-ofrprice"),50)
    }
    //  */
}
render.instaPopup = renderInstaPopup;
/************** Insta Popup Render End **************/

/************** Insta Scheme Render Start **************/
function renderInstaSchemeList() {
    $(".insta-scheme-item").remove();
    var dataMapping = _getDataMapping();
    var instaPopupData = dataMapping.instaPopupData;
    var productOfferPriceRs = "";
    if (instaPopupData.insurance.length) {
        if (instaPopupData.insurance[0].isSelected) {
            productOfferPriceRs = instaPopupData.productTotalCost
        } else {
            productOfferPriceRs = instaPopupData.productOfferPriceRs
        }

    } else {
        productOfferPriceRs = instaPopupData.productOfferPriceRs
    }
    var schemes = instaPopupData.schemeList;
    var lowestEmiInstaSchemeId;


    (function getLowestEmiTagScheme() {
        var instaSchemeClone = JSON.parse(JSON.stringify(schemes));
        instaSchemeClone.sort(function (a, b) {
            if (a.emi_amount !== b.emi_amount) return (a.emi_amount < b.emi_amount) ? -1 : 1;
            if (parseInt(a.down_payment.split('₹')[1]) !== parseInt(b.down_payment.split('₹')[1])) return (parseInt(a.down_payment.split('₹')[1]) < parseInt(b.down_payment.split('₹')[1])) ? -1 : 1;
            return (a.tenure < b.tenure) ? -1 : 1;
        });
        lowestEmiInstaSchemeId = instaSchemeClone[0].scheme_id;
    })();

    $(".selected-inst-scheme-div").addClass("dsp-none");
    schemes.forEach(function (eachscheme, index) {
        // instaPopupData.scheme_list && instaPopupData.scheme_list.forEach(function (eachscheme) {
        var scheme_id = eachscheme.scheme_id;
        var emi_amount = eachscheme.emi_amount;
        var down_payment = eachscheme.down_payment;
        var emi_month = eachscheme.emi_month;
        var processing_fee = eachscheme.processing_fee;
        var tenure = eachscheme.tenure;
        var advance_emi = eachscheme.advance_emi;
        var special_offer_text = eachscheme.special_offer_text;
        var scheme_roi = eachscheme.scheme_irr;
       // var SchemeIRR = 
        var schemeChangeAmount= emi_amount;
        var emiInsurance=eachscheme.emi_amount_with_ins
        var isChecked = '';
        var isSelected = '';
        var specialClass = "";
        var borderClass = "";
        if (eachscheme.is_default == 1) {
            isChecked = "checked";
            isSelected = "selected";
            if (special_offer_text) {
                $(".selected-inst-scheme-div").removeClass("dsp-none");
                $(".selected-inst-scheme-txt").text(special_offer_text);
            }
        }
        var processing_fee_hide = '';
        if (!processing_fee || processing_fee == "₹0") {
            processing_fee_hide = 'dsp-none" ';
        }
        if (special_offer_text) { // ₹100.00 Cashback
            specialClass = ""
            borderClass = " ins-border "
        } else {
            specialClass = " dsp-none "
            borderClass = ""
        }
        // if (eachscheme.is_default == "1") {
            if (instaPopupData.insurance && instaPopupData.insurance[0] && instaPopupData.insurance[0].isSelected) {
                schemeChangeAmount = emiInsurance;
            } else {
                schemeChangeAmount = " ₹ " + emi_amount;
            }
        // }
        /* var lowestEmiClass;
        if (schemes.length == 1) {
            lowestEmiClass = " dsp-none ";
        } else {
            lowestEmiClass = lowestEmiInstaSchemeId == scheme_id ? '' : 'dsp-none';

        } */
        var eachschemeDiv = '' +
            '<label class="icn-estbl-rw insta-scheme-item ' + isSelected + ' ' + borderClass + ' ">' +
            '<div class="icn-estbl-w lowest-emi-popup-div-w">' +
        /*     '<div class="lowest-emi-popup-div">' +
            '        <span class="lowest-emi-text-span">Lowest EMI</span>' +
            '    </div>' + */
            '    <div>' +
            '    <div class="icn-estbl-cell ins f-col icn-estbl-cell--lg">' +
            '        <label class="icn-estbl-lbl">' +
            '            <input type="radio" class="icn-estbl-rd icn-estbl-rd-fn" name="icn-esheme" data-id="' + scheme_id + '" ' + isChecked + '>' +
            '            <span class="icn-estbl-rd-des"></span>' +
            '        </label>' +
            '        <span class="icn-estbl-txt dsp-block ft-reg">' + schemeChangeAmount + ' X ' + emi_month + 'm</span>' +
            '    </div>' +
            '    <div class="icn-estbl-cell ins">' +
            '        <span class="icn-estbl-txt dsp-block ft-reg">' + down_payment + '</span>' +
            '    </div>' +
            '    <div class="icn-estbl-cell ins">' +
            '        <span class="icn-estbl-txt dsp-block ft-reg">'+scheme_roi+'%</span>' +
            '    </div>' +
            /* '    <div class="icn-estbl-cell ins">' +
            '        <span class="icn-estbl-txt dsp-block ft-reg">' + (productOfferPriceRs) + '</span>' +
            '        <span class="icn-es-rt-txt dsp-block ft-reg processing-fee-txt ' + processing_fee_hide + '">+ ' + processing_fee + '*</span>' +
            '    </div>' + */
            '    </div>' +
            '</div>' +
            '<div class="special-offer-div-w offer-popup-btm ' + specialClass + '">' +
            '    <div class="special-offer-div">' +
            '        <div class="special-offer-div-content">' +
            '            <img class="lozad" data-src="/content/dam/emistoremarketplace/index/specialoffer/availoffer.png" alt="offer">' +
            '            <span class="special-offer-content-text">' + special_offer_text + '</span>' +
            '        </div>' +
            '    </div>' +
            '</div>' +
            '</label>';
        $(".insta-scheme-list").append(eachschemeDiv);
        // emiOptionsListTrim();
    });

    if ($(".processing-fee-txt.dsp-none").length == $(".processing-fee-txt").length) {
        $(".processing-fee-span").addClass("dsp-none");
    } else {
        $(".processing-fee-span").removeClass("dsp-none");
    }
    addEventInstaScheme();

    /********** Check for non loggedIn user click on BuyNow START **********/
    if (emiStoreApiData.get('isLastSelectedScheme')) {
        emiStoreApiData.set('isLastSelectedScheme', false);
        schemes.forEach(function (eachData) {
            if (eachData.is_default) {
                if (emiStoreApiData.get('lastSelectedSchemeId') == eachData.scheme_id) {
                } else {
                    emiChangeToasterInstabuy();
                }
            }
        });
        /********** Check for non loggedIn user click on BuyNow END **********/
    } else {
        if (emiChangePopupFlag) {
            onloadSchemeChangedCheck();
        }
    }
}



render.instaSchemeList = renderInstaSchemeList;
/************** Insta Scheme Render End **************/
/************** Insta Coupon Api Start **************/
function renderInstaCouponList() {
    var dataMapping = _getDataMapping();
    var couponList = dataMapping.instaPopupData.couponList;
    var coupanListHTML = "";
    if (couponList && couponList.length) {
        couponList.forEach(function (eachCoupon) {
            coupanListHTML += getInstaCounponListHTML(eachCoupon);
        })
        $(".insta-coupon-list").html(coupanListHTML);
        $(".insta-no-coupon-list").addClass("dsp-none").prev().removeClass("dsp-none");
        addEventInstaCoupon();
    } else {
        $(".insta-coupon-list").html("");
        $(".insta-no-coupon-list").removeClass("dsp-none").prev().addClass("dsp-none");
    }

}
render.instaCouponList = renderInstaCouponList;
/************** Insta Coupon Api End **************/
/************** Insta Popup Render Js End **************/

/************** Insta Popup Render HTML Start **************/

function getInstaInsuranceHTML(instaInsurance) {
    var amount = (instaInsurance.offerPrice);
    var name = instaInsurance.name;
    var text = instaInsurance.text;
    var isSelected = instaInsurance.isSelected ? "checked" : "";
    var className = "icn-tick-chk-fn insuranceSelected-cb";
    var data = instaInsurance.subSku + "_" + instaInsurance.amount + "_" +
        instaInsurance.ins_code + "_" + instaInsurance.ins_emi + "_" +
        instaInsurance.noOfEmis + "_" + instaInsurance.quoteItemId + "_" +
        instaInsurance.quoteId;
    var html = '';
    var exchangeid = "";
    if (instaInsurance.name == "exchange") {
        exchangeid = "insta-exchange"
        name = "Exchange";
        text = "";
        amount = "";
        data = "exchange-id";
        isSelected = "checked";
        className = "icn-tick-chk-ex-fn"
    }
    html = '' +
        '<div class="icn-mobprotect-plan-w icn-pct-bdr icn-pct-bdr--all" ' + (exchangeid ? 'id="' + exchangeid + '"' : '') + '>' +
        '    <label class="icn-tick-chk-lbl">' +
        '        <input type="checkbox" name="' + name + '" class="checkInsurance-event dsp-none icn-tick-chk ' + className + ' " ' + isSelected + ' data-id="' + data + '">' +
        '        <span class="icn-tick-chk-des"></span>' +
        '    </label>' +
        '    <div class="icn-mobprotect-plan-dts-w">' +
        '        <div class="icn-mobprotect-tl-w">' +
        '            <span class="icn-mobprotect-tl ft-med dsp-block"> ' + name + ' </span>' +
        '            <span class="icn-mobprotect-tl ft-reg dsp-block">' + text + ' </span>' +
        '            <span class="icn-mobprotect-tl mobprotecttc-text icn-blue-color">T&C</span>' +
        '        </div>' +
        '        <div class="icn-mobprotect-price-w">' +
        '            <span class="icn-mobprotect-tl ft-reg dsp-block"> ' + (amount ? 'MRP: ' : '') + amount + '</span>' +
        '        </div>' +
        '    </div>' +
        '</div>';
    return html;
}


function getInstaCounponListHTML(instaCoupon) {
    var tncHideClass = " dsp-none ";
    if (instaCoupon.Tnc) {
        tncHideClass = " ";
    }
    var html = '';
    html = '' +
        '<div class="icn-promos-avl-li insta-coupon-item" data-id="' + instaCoupon.coupon_id + '_' + instaCoupon.code + '">' +
        '    <div class="icn-promos-avl-li-ct icn-pop-pd-x">' +
        '        <div class="icn-promos-avl-li-tp mb-16">' +
        '            <span class="icn-promos-card dsp-ib ft-med">' + instaCoupon.code + '</span>' +
        '            <span class="icn-promos-apply-btn dsp-block icn-apc-btn-fn insta-coupon-apply apply-promocode">Apply</span>' +
        '        </div>' +
        '        <div class="icn-promos-desc-w">' +
        '            <span class="dsp-block icn-promos-desc-txt ft-reg">' +
        '' + instaCoupon.coupon_description +
        '                <span class="icn-link-txt term-condition-popup ' + tncHideClass + ' " data-msg=" ' + instaCoupon.Tnc + ' ">T&amp;C</span>' +
        '            </span>' +
        '        </div>' +
        '    </div>' +
        '</div>';
    return html;
}
/************** Insta Popup Render HTML End **************/

function showInstaPopup(val) {
    $("#insta-popup").addClass("instacheck-pop-hide");
    $(".instacheck-modal-wh.icn-limit-modal-wh").addClass("dsp-none");
    $(".instacheck-modal-wh.icn-prdins-modal-wh").addClass("dsp-none");
    $('#al-insta-otp-pop').removeClass('showpopup');

    if ("show-insta-limit" == val) {
        $("#insta-popup").removeClass("instacheck-pop-hide");
        $(".instacheck-modal-wh.icn-limit-modal-wh").removeClass("dsp-none");

    } else if ("show-insta-details" == val) {
        $("#insta-popup").removeClass("instacheck-pop-hide");
        $(".instacheck-modal-wh.icn-prdins-modal-wh").removeClass("dsp-none");

        // Hide Scheme Section
        $('.icnpopup-lvl-bk').parents('.icn-modal-l2-sh').addClass('dsp-none');
        $('.icnpopup-l1').removeClass('dsp-none');
    } else {

    }
}


function showInstaCouponSuccess(msgText, status, nottitleneed) {
    if (nottitleneed) {
        $(".insta-coupon-success-msg").find(".icn-scs-tl").addClass("dsp-none");
    } else {
        $(".insta-coupon-success-msg").find(".icn-scs-tl").removeClass("dsp-none");
    }
    if (status) {
        $(".insta-coupon-success-msg").find(".coupon-msg").text(msgText);
        $('.insta-coupon-success-msg').addClass('showpopup');
        var appliedcoupon = $(".insta-applied-coupon").find(".applied-coupon");
        $(appliedcoupon).eq(0).text(selectedCouponCode); // code
        $(appliedcoupon).eq(1).text(); // -1000
        $(appliedcoupon).eq(2).text(); // 1000
        setTimeout(function () {
            $('.insta-coupon-success-msg').removeClass('showpopup');
        }, 3000);
    } else {
        $(".insta-coupon-fail-msg").find(".coupon-msg").text(msgText);
        $('.insta-coupon-fail-msg').addClass('showpopup');
        var appliedcoupon = $(".insta-applied-coupon").find(".applied-coupon");
        $(appliedcoupon).eq(0).text(selectedCouponCode); // code
        $(appliedcoupon).eq(1).text(); // -1000
        $(appliedcoupon).eq(2).text(); // 1000
        setTimeout(function () {
            $('.insta-coupon-fail-msg').removeClass('showpopup');
        }, 3000);
    }
}

function showInstaReward(val) {
    if (val == "show-added") {
        $("#reward-amount").show();
        $("#reward-remove").show();
        $("#redeem-button").hide();
        $("#remove-desc").show();
        $("#redeem-desc").hide();
    } else if (val == "show-removed") {
        $("#reward-amount").hide();
        $("#reward-remove").hide();
        $("#redeem-button").show();
        $("#remove-desc").hide();
        $("#redeem-desc").show();
    }
}


/************** Insta Popup Biz Js Start **************/
/************** Insta Popup Event Start **************/
$(document).ready(function(e) {
        $(".coupon-list-event").on("click", function(e) {
            if ($(this).find(".insta-applied-coupon").hasClass("dsp-none")) {
                toggleInstaLoader(true);
                api.instaCouponList();
            }
        })

        $(".bajaj-tnc-link").on("click", function() {
            var textVal = $(this).text();
            var tncflag = true;
            // $(this).attr("target","_blank");
            // dlInstaBuyViewDetails(textVal);
            dlInstaBuyTandC(tncflag);
            window.open(" https://www.bajajmall.in/emi-store/terms-and-conditions/two-wheeler-tnc-checkout.html", "_blank");
        });

        $('.insta-otp-dl-event').on('click', function() {
            var textVal = $(this).text()
            dlInstaBuyOtpConfirmation(textVal);
            $(this).attr('href', 'https://www.bajajmall.in/emi-store/legal-and-compliance/bfl-emi-card-t-c.html')
        })

        $(".custom-coupon-apply").on("click", function(e) {
            var val = $(".custom-coupon-input").val();
            selectedCouponId = val;
            selectedCouponCode = val;
            toggleInstaLoader(true);
            $(".custom-coupon-input").val("");
            api.instaCouponApply();

            try {
                customerId = __get_perpetual_session("customer_id");
                if(customerId != "undefined"){
                                customerId = parseInt(reverseStr(atob(decodeURIComponent(customerId).split("|"))).split('_')[1]);
                            }
                var productName = $(".info-prod-head").eq(0).text();
                var availableToSpend = __common_service.getOnlyNumber(localStorage.emiStoreCreditLimit);
                globalDataLayerObj.promoCode = $(".custom-coupon-input").val();
                globalDataLayerObj.customerId = customerId;
                globalDataLayerObj.productName = productName;
                globalDataLayerObj.availableToSpend = availableToSpend;
                dlApplyCouponBtnClick();
				$('#insta-popup').data('promo-code',$(".custom-coupon-input").val());
            } catch (error) {
                console.error(error)
            }


        })

        $("#reward-remove").click(function(e) {
            toggleInstaLoader(true);
            api.instaRewardRemove();
        });

        $("#redeem-button").click(function(e) {
            api.instaRewardApply();
        });
        /************* Insta Placeorder API Start *************/
        $("#insta-place-your-order-btn").on("click", function(e) {
            flagInstaPlaceoder.placeorder = true;
            buttonLoaderToggle(this, true);
            api.instaPlaceOrder();
            // instaBuyNowDataLayer("Place_Order");
        })
        $(".placeorder-submit-btn").on("click", function(e) {
            flagInstaPlaceoder.verifyOtp = true;
            $(".placeorder-submit-btn").addClass("pd-disabled");
            // logInEventsClick("Submit-otp");
            // instaBuyNowDataLayer("Submit");
            api.instaPlaceOrderAfterOTP();
        })
        $(".placeorder-cancel-btn").on("click", function() {
            instaBuyNowDataLayer("Cancel");
            $("#instacheck-popup-summary").addClass("instacheck-pop-hide");
            $("#instacheck-popup").addClass("instacheck-pop-hide");
            showInstaPopup(false);
        })
        $(".placeorder-resend-btn").on("click", function(e) {
            flagInstaPlaceoder.resend = true;
            instaBuyNowDataLayer("resend_otp");
            $(".placeorder-submit-btn").addClass("pd-disabled");
            setTimeOut(3);
            // instaBuyNowDataLayer("Resend-otp");
            //api.instaPlaceOrder();
            api.instaPlaceOrderAfterOTP();

        })
        $(".checkout-redirect-btn").on("click", function(e) {
            if ($(this).hasClass('icn-pp-adr-edit')) {
                dlInstaBuyEditAddress();
            }
            // instaBuyNowDataLayer("Checkout");
            location.href = baseUrl + "/instacheckout?referrer_url=" + location.href;
            // https://www.bajajfinservmarkets.in/emistore/instacheckout?referrerurl=
        })

        $('.dl-ins-prd').on('click', function(e) {
            $(this).parents('.icn-inner-modal').removeClass('showpopup');
            api.removeInstaInsurance();
            // $('.icn-tick-chk-fn').prop('checked', false);
            globalDataLayerObj.currTarget = e;
        });
        $('.dl-exch-prd').on('click', function() {
            $(this).parents('.icn-inner-modal').removeClass('showpopup');
            api.removeInstaExchange();
            // $('.icn-tick-chk-fn').prop('checked', false);
        });
        /* Insta Placeorder API END */
        twoWhInstapopupTooltip();
    })
    /************** Insta Popup Event End **************/
    /************** Insta Popup Biz Start **************/
function bizInstaPopup() {
    var dataMapping = _getDataMapping();
    var resp = dataMapping.instaPopupData.api.instaPopup.response;
    var instaPopupData = dataMapping.instaPopupData;

    quoteItemId = resp.item.quote_item_id;
    instaPopupData.quoteId = resp.item.quote_id;
    instaPopupData.quoteItemId = resp.item.quote_item_id;
    instaPopupData.productName = resp.item.name.trim();
    instaPopupData.productImage = $(".pc-single-img").attr("src");
    instaPopupData.productOfferPriceRs = resp.item.price;
    instaPopupData.productTotalCost = resp.item.total_cost;
    instaPopupData.productOfferPrice = __common_service.getAmountInNumber(instaPopupData.productOfferPriceRs);
    instaPopupData.productMrp = dataMapping.productDetails.productMrp;
    instaPopupData.productDiscountAmt = __common_service.getDiscount(instaPopupData.productMrp, instaPopupData.productOfferPrice, "in-amount");

    instaPopupData.deliveryPreference = resp.delivery_preference;
    instaPopupData.installationChargesRs = resp.installation_charges ? resp.installation_charges : "";
    instaPopupData.selectedSeller = resp.dealer_name;
    instaPopupData.dealerAddress = resp.dealer_address;
    instaPopupData.dealerAddress = instaPopupData.dealerAddress.charAt(0).toUpperCase() + instaPopupData.dealerAddress.slice(1).toLowerCase();
    instaPopupData.dealerAddress = instaPopupData.dealerAddress.replaceAll(',',', ');
    instaPopupData.defaultAddressStatus = resp.address.status;
    instaPopupData.defaultAddress = resp.address.default_address;
    instaPopupData.defaultAddress = instaPopupData.defaultAddress.charAt(0).toUpperCase() + instaPopupData.defaultAddress.slice(1).toLowerCase();
    instaPopupData.defaultAddressId = resp.address.default_address_id;
    instaPopupData.exShowroomAmt = resp.dynamic_down_payment.ex_showroom_price_c;
    instaPopupData.insuranceAmt = resp.dynamic_down_payment.insurance_c;
    instaPopupData.rtoAmt = resp.dynamic_down_payment.rto_c;

    instaPopupData.downPaymentFlag = resp.downpayment_flag;
    instaPopupData.onlineDPFlag = resp.onlinedp_flag;
    instaPopupData.payableAtStore = resp.dynamic_down_payment.total_pay_now;
    instaPopupData.totalProductCost = resp.dynamic_down_payment.total_cost;
    // instaPopupData.allTotalLoanAmount = resp.dynamic_down_payment.offer_price;
    instaPopupData.totalLoanAmount = resp.dynamic_down_payment.total_loan_amount;
    instaPopupData.discountAmount = resp.dynamic_down_payment.discount_amount;
    // instaPopupData.tenure = resp.dynamic_down_payment.tenure;
    instaPopupData.tenure = resp.dynamic_down_payment.remaining_emis;
    if(resp.insurance && resp.insurance[0] && resp.insurance[0].is_insurance_selected){
        var insuranceSelectedAmount = parseInt(resp.dynamic_down_payment.emi_amount.split('₹')[1].replace(',', '').trim()) + resp.insurance[0].ins_emi;
        instaPopupData.emiAmount  = '₹ '+ insuranceSelectedAmount.toLocaleString();
    }else{
        instaPopupData.emiAmount = resp.dynamic_down_payment.emi_amount;
    }
    instaPopupData.netLoanAmount = resp.dynamic_down_payment.net_loan_amount;
    //instaPopupData.downPaymentAmount = resp.dynamic_down_payment.down_payment_amount;
    instaPopupData.downPaymentAmt = resp.dynamic_down_payment.down_payment_amount;
    instaPopupData.rewardPointsApplied = resp.dynamic_down_payment.rewards_points_applied;
    instaPopupData.processingFee = resp.dynamic_down_payment.processing_fee;
    var deleveryFee = resp.dynamic_down_payment.delivery_charges
    if (deleveryFee == 0 || deleveryFee == null || deleveryFee == "NA") {
        instaPopupData.deliveryFee = "Free"
    } else {
        instaPopupData.deliveryFee = resp.dynamic_down_payment.delivery_charges
    }
    instaPopupData.convenienceFee = resp.dynamic_down_payment.convenience_fee || "₹0";



    instaPopupData.isRewardSelected = resp.dynamic_down_payment.is_reward_selected;
    instaPopupData.rewardAmount = resp.dynamic_down_payment.rewards;
    instaPopupData.rewardPoints = resp.dynamic_down_payment.total_rewards_points;
    instaPopupData.rewardAppliedVal = resp.dynamic_down_payment.rewards_applied;
    instaPopupData.rewardApplied = instaPopupData.isRewardSelected ? "-" + resp.dynamic_down_payment.rewards_applied : "-₹0";
    // instaPopupData.downPaymentAmount = resp.dynamic_down_payment.down_payment_rewards;
    instaPopupData.downPaymentAmount = resp.dynamic_down_payment.down_payment_amount;
    instaPopupData.downPaymentAmountStrike = resp.dynamic_down_payment.down_payment_amount;
    instaPopupData.installationCharges = resp.dynamic_down_payment["Installation Charges"];

    // var banckAccount = resp.bank_details[0].BankAccountNumber__c;
    // var hiddenAccountNo = banckAccount ? banckAccount.replace(/.(?=.{4})/g, 'X') : "";
    // instaPopupData.bankAccountNumber = hiddenAccountNo ? hiddenAccountNo : "XXXXXXXXXX";
    // instaPopupData.bankIFSCCode = resp.bank_details[0].Bank_IFSC__c ? resp.bank_details[0].Bank_IFSC__c : "XXXXXXXXXX";
    // instaPopupData.bankName = resp.bank_details[0].BankName__c ? resp.bank_details[0].BankName__c : "XXXXXXXXXX"


    var banckAccount = (resp.bank_details[0] && resp.bank_details[0].BankAccountNumber__c) ? resp.bank_details[0].BankAccountNumber__c :"";
    var hiddenAccountNo = banckAccount ? banckAccount.replace(/.(?=.{4})/g, 'X') : "";
    instaPopupData.bankAccountNumber = hiddenAccountNo ? hiddenAccountNo : "XXXXXXXXXX";
    instaPopupData.bankIFSCCode = resp?.bank_details[0]?.Bank_IFSC__c ? resp.bank_details[0].Bank_IFSC__c : "XXXXXXXXXX";
    instaPopupData.bankName = resp?.bank_details[0]?.BankName__c ? resp.bank_details[0].BankName__c : "XXXXXXXXXX"

    instaPopupData.downPaymentText = resp.online_downpayment_text;
    instaPopupData.tooltipText = resp.online_downpament_tooltip_text;
    instaPopupData.isDownPaymentText = resp.online_downpayment_text && resp.online_downpament_tooltip_text ? true : false;
    
    //****************************************Two Wheeler insta buy new api popup********************************************** */
    instaPopupData.onRoadPrice = resp.dynamic_down_payment.on_road_price;
    instaPopupData.productORP = resp.dynamic_down_payment.product_orp;
    instaPopupData.mrp = resp.dynamic_down_payment.mrp;
    instaPopupData.paymentToDealer = resp.dynamic_down_payment.payment_to_dealer;
    instaPopupData.stampDuty = resp.dynamic_down_payment.stamp_duty;
    instaPopupData.hypothecationCharges = resp.dynamic_down_payment.hypothecation_charges;
    instaPopupData.documentCharges = resp.dynamic_down_payment.documentation_charges;
    instaPopupData.productCost = resp.dynamic_down_payment.product_cost;
    instaPopupData.personalAccidentInsurance = resp.dynamic_down_payment && resp.dynamic_down_payment.personal_accident_insurance ? resp.dynamic_down_payment.personal_accident_insurance.split("₹")[1] : 0;
    instaPopupData.payableEMI = resp.dynamic_down_payment.payable_emi;
    instaPopupData.schemeROI = resp.dynamic_down_payment.scheme_roi && resp.dynamic_down_payment.scheme_roi ? resp.dynamic_down_payment.scheme_roi : "";
    instaPopupData.SchemeIRR = resp.dynamic_down_payment.scheme_irr && resp.dynamic_down_payment.scheme_irr ? resp.dynamic_down_payment.scheme_irr : "";
    instaPopupData.annualisedROI = resp.annualised_ROI;
    instaPopupData.offerPrice = resp.offer_price;
    instaPopupData.schemeList = resp.scheme_list;
    
    instaPopupData.productORPrs= __common_service.getAmountInNumber(instaPopupData.productORP);
    instaPopupData.productMrp=__common_service.getAmountInNumber(instaPopupData.mrp); 
    instaPopupData.saveAmount=__common_service.getDiscount(instaPopupData.productMrp, instaPopupData.productORPrs,"in-amount");
    
    //****************************************Two Wheeler insta buy new api popup********************************************** */


    instaPopupData.schemeList && instaPopupData.schemeList.forEach(function(eachScheme){
        if (eachScheme.is_default == "1") {
            instaPopupData.emiWithIns = eachScheme.emi_amount_with_ins;
            instaPopupData.emiSchemeList = eachScheme.emi_amount;
            instaPopupData.emiSchemeInsurance = eachScheme.emi_insuranceamt ? eachScheme.emi_insuranceamt : 0;
            if (resp.insurance && resp.insurance[0] && resp.insurance[0].is_insurance_selected) {
                instaPopupData.schemeChangeAmount = eachScheme.emi_amount_with_ins;
            } else {
                instaPopupData.schemeChangeAmount =" ₹ " + eachScheme.emi_amount;
            }

        }
    })


    instaPopupData.isCouponApply = false;
    if (resp.coupon) {
        instaPopupData.isCouponApply = resp.coupon.status;
        instaPopupData.couponCode = resp.coupon.coupon_code;
        instaPopupData.couponDescription = resp.coupon.description;
        // instaPopupData.couponDescription = resp.coupon.description + " " + instaPopupData.discountAmount;
    }

    instaPopupData.exchangeDetails = resp.exchange;
    instaPopupData.schemeList = resp.scheme_list;

    /* productData.sellers && productData.sellers.forEach(function (eachseller) {
        if (eachseller.SellerId == onChangeSellerID) {
            instaPopupData.selectedSeller = eachseller.SellerName;
        }
    }) */

    // /* 
    instaPopupData.insurance = [];
    resp.insurance.forEach(function(eachInsurance, index) {
            var obj = {};
            obj.quoteId = resp.item.quote_id;
            obj.quoteItemId = resp.item.quote_item_id;
            obj.name = eachInsurance.insurance_name;
            obj.text = eachInsurance.insurance_text;
            obj.isSelected = eachInsurance.is_insurance_selected;
            obj.offerPrice = (eachInsurance.formated_insurance_price);
            obj.itemId = eachInsurance.item_id;
            obj.amount = eachInsurance.amount;
            obj.subSku = eachInsurance.sub_sku;
            obj.noOfEmis = eachInsurance.no_of_emis;
            obj.ins_emi = eachInsurance.ins_emi;
            obj.ins_code = eachInsurance.ins_code;
            obj.data_ck = eachInsurance.data_ck;
            instaPopupData.insurance.push(obj);
            if (index == 0) {
                instaPopupData.extendWarenteeEMI = eachInsurance.ins_emi;
                instaPopupData.extendWarenteeEMIAmount = eachInsurance.amount;
            }
        })
        
        // */
    _setDataMapping(dataMapping);
    // instaPopupData.otpStatus = // resp.is_otp_session_valid;
    render.instaPopup();
}
biz.instaPopup = bizInstaPopup;

function bizInstaPlaceOrder() {
    var dataMapping = _getDataMapping();
    var status = dataMapping.instaPopupData.api.placeorder.status;
    var resp = dataMapping.instaPopupData.api.placeorder.response;

    if (status && resp.status) {
        // autoOtpReadOn();
        BflAutoReadOTP();
        $(".placeorder-submit-btn").addClass("pd-disabled");
        if (flagInstaPlaceoder.placeorder) {
            if (resp.otp_flag == 2) {
                // submit otp
                instaBuyNowDataLayer("Submit_success");
                location.href = resp.url;
            }

            
            flagInstaPlaceoder.placeorder = false;
            // populateInstaBuySummary();
            $('#al-insta-otp-pop').addClass('showpopup');
            setTimeOut(3);
            flagInstaPlaceoder.orderId = resp.order_id;
            $(".pd-otp-fn").val("");
            $(".invalidErrorMsg").html(resp.message);
        } else {
            if (resp.max_otp == 1) {
                $(".invalidErrorMsg").html(resp.message);
            } else if (resp.max_otp == 0) {
                $(".resend-err-msg").text(resp.message);
            } else if (resp.message == "INVALID OTP CODE") {
                // } else if (resp.message == "invalid otp code") {
                instaBuyNowDataLayer("Submit_fail");
                $(".otp-error-msg").text(resp.message).parents(".pd-prodotp-field-w").addClass("pd-incorrect");
            } else if (resp.otp_flag == 2) {
                // submit otp
                // instaBuyNowDataLayer("Submit_success");
                location.href = resp.url;
            } else if (resp.otp_flag == 0 || resp.otp_flag == 1) {
                $(".invalidErrorMsg").html(resp.message);
            } else {
                // instaBuyNowDataLayer("Submit_fail");
                // $(".otp-error-msg").text(resp.message).parents(".pd-prodotp-field-w").addClass("pd-incorrect");
            }
        }
    }
    if (flagInstaPlaceoder.resend) {
        $(".invalidErrorMsg").css("color", "#fd9c00");
    }
    $(".instacheck-placeorder .page-loader-circle").removeClass("right-circle");
    $(".instacheck-placeorder").css({
        "pointer-events": "auto",
        opacity: "1"
    });
    flagInstaPlaceoder.verifyOtp = false;
    flagInstaPlaceoder.resend = false;
}
biz.instaPlaceOrder = bizInstaPlaceOrder;
/************** Insta Popup Biz End **************/
/************** Insta Coupon Api Start **************/
function bizInstaCouponList() {
    var dataMapping = _getDataMapping();
    var resp = dataMapping.instaPopupData.api.couponList.response;
    dataMapping.instaPopupData.couponList = [];
    if (resp.status == true) {
        dataMapping.instaPopupData.couponList = resp.coupon;
    }
    _setDataMapping(dataMapping);
    render.instaCouponList();
}
biz.instaCouponList = bizInstaCouponList;
/************** Insta Coupon Api End **************/
/************** Insta Popup Biz Js End **************/

function addEventInsta() {

    $('.icn-tick-chk-fn').on('click', function(e) {
        // Insurance
        if (!$(this).is(':checked')) {
            $('#al-insurance-pop').addClass('showpopup');
        } else {
            api.addInstaInsurance();
            globalDataLayerObj.currTarget = e;
        }
        this.checked = !this.checked;
    });
    $('.icn-tick-chk-ex-fn').on('click', function() {
        // Exchange
        if (!$(this).is(':checked')) {
            if (this.name == "Exchange") {
                $('#al-exchange-pop').addClass('showpopup');
            }
        }
        this.checked = !this.checked;
    });
    $(".checkInsurance-event").on("change", function(e) {
        if ($(this).is(":checked")) {
            $(".extended-warranty").css("display", "block")
        } else {
            $(".extended-warranty").css("display", "none")
        }
    })
    $(".mobprotecttc-text").on("click", function() {
        var textVal = $(this).text();
        dlInstaBuyCTA(textVal);
        $(this).parents(".icn-modal-content-w").siblings(".tnc-content-w").removeClass("dsp-none");
        $(this).parents(".icn-modal-content-w").addClass("dsp-none");
    })

    $('.dl-payable-evt').on('click', function() {
        var textVal = $(this).text();
        dlInstaBuyCTA(textVal);
    })
}

function addEventInstaScheme() {
    $(".insta-scheme-item").each(function(i) {
        $(".insta-scheme-item").eq(i).find("input").on("click", function(e) {
            $(".insta-scheme-item").removeClass("selected");
            $(this).parents(".insta-scheme-item").addClass("selected");
            toggleInstaLoader(true);
            selectedSchemeId = this.dataset.id;
            showInstaPopupFlag = "show-insta-details";
            // instaSchemeChanged = true;
            emiChangePopupFlag = false;
            api.instaSchemeSelection();
        })
    })
}

function addEventInstaCoupon() {
    $(".insta-coupon-apply").on("click", function(e) {
        showInstaPopup("show-insta-details");
        var selectedCpn = $(this).parents(".insta-coupon-item").attr("data-id");
        selectedCouponId = selectedCpn.split("_")[0];
        selectedCouponCode = selectedCpn.split("_")[1];
        toggleInstaLoader(true);
        api.instaCouponApply();

        try {
            customerId = __get_perpetual_session("customer_id");
            if(customerId != "undefined"){
                                customerId = parseInt(reverseStr(atob(decodeURIComponent(customerId).split("|"))).split('_')[1]);
                            }
            var productName = $(".info-prod-head").eq(0).text();
            var availableToSpend = __common_service.getOnlyNumber(localStorage.emiStoreCreditLimit);
            globalDataLayerObj.promoCode = selectedCouponCode;
            globalDataLayerObj.customerId = customerId;
            globalDataLayerObj.productName = productName;
            globalDataLayerObj.availableToSpend = availableToSpend;
            dlApplyCouponBtnClick();
			$('#insta-popup').data('promo-code',selectedCouponCode);
        } catch (error) {
            console.error(error)
        }
    })
    $(".term-condition-popup").on("click", function() {
            // t&c click event
            var msg = $(this).attr("data-msg");
            $(".insta-coupon-tnc-html").html(msg);
            $(this).parents(".instacheck-modal-content").find(".Term-Condition-popup-div").removeClass("dsp-none");
            $(this).parents(".instacheck-modal-content").find(".icn-modal-l2-sh").addClass("dsp-none");
            $(this).parents(".icn-modal-l2-container").find(".icn-modal-l2-nav-w").addClass("dsp-none");
        })
        // $('.icn-apc-btn-fn').on('click', function () {
        //     // $('.t-ap-c').addClass('dsp-none');
        //     // $('.t-apd-c').removeClass('dsp-none');
        //     toggleInstaLoader(true);
        //     /* setTimeout(function () {
        //         toggleInstaLoader(false);
        //     }, 1000) */
        //     $(this).parents('.icn-modal-l2-sh').addClass('dsp-none');
        //     $('.icnpopup-l1').removeClass('dsp-none');
        // });

}

function getInstaDeliveryTime() {
    var dataMapping = _getDataMapping();

    var deliveryStatus = "";
    // var deliveryCharges = productData.sellers[onChangeSellerIndex].DeliveryCharges;
    var dynamicDownPayment = dataMapping.instaPopupData.api.instaPopup.response.dynamic_down_payment
    var deliverytat = dynamicDownPayment.tat;
    var tat = deliverytat;
    var default_tat_before5 = dynamicDownPayment.deliverybyhrs_before5;
    var default_tat_after5 = dynamicDownPayment.deliverybyhrs_after5;
    var tat = deliverytat;
    if (!deliverytat) {
        if (dynamicDownPayment.hasOwnProperty('deliverybyhrs_before5') || dynamicDownPayment.hasOwnProperty('deliverybyhrs_after5')) {
            var fivepm = new Date(new Date().setHours(17, 0, 0));
            if (fivepm > new Date()) {
                // Before 5pm
                tat = default_tat_before5 || "";
            } else {
                // After 5pm
                tat = default_tat_after5 || "";
            }
        } else {
            tat = deliverytat;
        }
    }

    if (tat === "" || (tat >= 0 && tat <= 5)) {
        // deliveryStatus = " "+new Date().toDateString()+" Today";
        var currDate = new Date();
        var dayRomanStr = getRomanWord(currDate);
        var aftermidnight = new Date(new Date().setHours(0, 0, 0, 0)).getTime();
        var beforeevening = new Date(new Date().setHours(17, 0, 0, 0)).getTime();
        var currtimming = new Date().getTime();
        if (aftermidnight < currtimming && currtimming < beforeevening) {
            deliveryStatus = "By " + currDate.getDate() +
                dayRomanStr + " " +
                __months_in_words[currDate.getMonth()] +
                " Today ";
        } else {
            var tommorow = new Date(new Date().getTime() + 1 * 24 * 60 * 60 * 1000);
            dayRomanStr = getRomanWord(tommorow);

            deliveryStatus = "By " + tommorow.getDate() +
                dayRomanStr + " " +
                __months_in_words[tommorow.getMonth()] +
                " Tomorrow ";
        }
    } else if (tat >= 6 && tat <= 24) {
        deliveryStatus = " in 1-2 days";
    } else if (tat >= 25 && tat <= 48) {
        deliveryStatus = "in 2-3 days";
    } else if (tat >= 49 && tat <= 72) {
        deliveryStatus = 'in 3-4 days';
    }
    else if (tat >= 73 && tat <= 96) {
        deliveryStatus = 'in 4-5 days';
    }
    else if (tat >= 97 && tat <= 120) {
        deliveryStatus = 'in 5-6 days';
    }
    else if (tat >= 121 && tat <= 144) {
        deliveryStatus = 'in 6-7 days';
    }
    else if (tat >= 145 && tat <= 168) {
        deliveryStatus = 'in 7-8 days';
    }
    else if (tat >= 169 && tat <= 192) {
        deliveryStatus = 'in 8-9 days';
    }
    else if (tat >= 193 && tat <= 216) {
        deliveryStatus = 'in 9-10 days';
    }
    else if (tat >= 217 && tat <= 240) {
        deliveryStatus = 'in 10-11 days';
    }
    else if (tat >= 241 && tat <= 264) {
        deliveryStatus = 'in 11-12 days';
    }
    else if (tat >= 265 && tat <= 288) {
        deliveryStatus = 'in 12-13 days';
    }
    else if (tat >= 289 && tat <= 312) {
        deliveryStatus = 'in 13-14 days';
    }
    else if (tat >= 313 && tat <= 336) {
        deliveryStatus = 'in 14-15 days';
    } else {
        console.warn("Delivery Date is not Valid ");
    }
    return deliveryStatus;
};

/********************** Emi scheme change Toaster biz Starts  *************************/
function emiChangeToasterInstabuy() {
    $(".instabut-scheme-change-parent").removeClass("dsp-none")
    setTimeout(function () {
        $(".instabut-scheme-change-parent").addClass("dsp-none")
    }, 5000)
}
/********************** Emi scheme change Toaster biz Ends  *************************/
/********************** Scheme Change Onload Check  Function biz Start *************************/
function onloadSchemeChangedCheck(){
    var dataMapping = _getDataMapping();
    var instaPopupSchemeData = dataMapping.instaPopupData.schemeList;
    var schemeIdPresent = false;
    instaPopupSchemeData.forEach(function(eachData){
        if(eachData.is_default){
            if(selectedSchemeDataOnPdp.schemeId == eachData.scheme_id){
              schemeIdPresent = true;
            }
        }
    })
    if(!schemeIdPresent){
        emiChangeToasterInstabuy();       
    }
}

/********************** Scheme Change Onload Check Function biz Ends  *************************/

/********************** two wheeler pdp biz start  *************************/

function bizInstaPlaceOrderTwoWheeler() {
    var dataMapping = _getDataMapping();
    var status = dataMapping.instaPopupData.api.placeorder.status;
    var resp = dataMapping.instaPopupData.api.placeorder.response;


    if (status) {
        if (resp.status) {
            var redirect_url = resp.redirect_url ? toEncryptDecryptAES(resp.redirect_url,'de') : resp.redirect_url
            location.href = redirect_url;
        } else {
            $("#insta-popup").addClass("instacheck-pop-hide");
            showToasterMsg("Failed to place order,please try again", false);
            window.location.reload();
        }
    } 
/* 
    flagInstaPlaceoder.verifyOtp = false;
    flagInstaPlaceoder.resend = false; */
}

function twoWhInstapopupTooltip(){
        // two wheeler pdp instapopup tooltip js start
        $('.upfront-deal-icn').click(function(){

            var instabuypopuptooltip = $(this).parent().find(".upfront-tooltip-con")
            if(instabuypopuptooltip.hasClass('dsp-none')){
                $(".upfront-tooltip-con").addClass('dsp-none');
                instabuypopuptooltip.removeClass('dsp-none');
                // $(this).parents(".upfront-dealer-dflex").siblings().find('.upfront-tooltip-con').addClass('dsp-none');
            }else{
                instabuypopuptooltip.addClass('dsp-none');
            }
            if (window.matchMedia("(max-width: 766px)").matches){
                    $('.instacheck-innerwrapper').css({
                    'visibility':'hidden',
                    })
                    $('.upfront-tooltip-con').css({
                    'visibility':'visible',
                    })
                    if ($('.instacheck-innerwrapper').css('visibility') == 'hidden') {
                        instabuypopuptooltip.addClass('dsp-none');
                    }
                    if ($('.upfront-tooltip-con').css('visibility') == 'visible') {
                        instabuypopuptooltip.removeClass('dsp-none');
                    }
                }
        })
        $('.instacheck-innerwrapper').on("click", function (e) {
            var click = e.target;
            if ($(click).hasClass("upfront-deal-icn") || $(click).parents().hasClass("upfront-tooltip-main")) {
                console.log("")
            } else {
                $('.upfront-tooltip-con').addClass('dsp-none');
            }
        })
        $(".in-got-btn-hmevt, .headinng-wrap-div-insta .backArrow-event").on("click", function() {
            $(this).parents(".upfront-tooltip-con").addClass("dsp-none");
            $('.instacheck-innerwrapper').css({
                 'visibility':'visible',
            })
        });
        // two wheeler pdp instapopup tooltip js end
}
biz.instaPlaceOrderTwoWheeler = bizInstaPlaceOrderTwoWheeler;

/********************** two wheeler pdp biz end  *************************/


/************** Insta Popup Init Js Start **************/
var selectedCouponCode = "";
var selectedCouponId = "";
var selectedSchemeId = "";
var showInstaPopupFlag = "";
var nottitleneedFlag = "";
var quoteItemId = "";
var timer;
var emiChangePopupFlag = true;
// var instaSchemeChanged = false;
var flagInstaPlaceoder = {
    resend: false,
    verifyOtp: false,
    orderId: null,
    placeorder: false
};
var instaCallBack = false;
var instaCallBackMsg = "", instaCallBackMsgStatus = false;
/************** Insta Popup Init Js End **************/

/****************************** PDP DELIVERY RENDER START ******************************/
/********** PUTNAME RENDER START **********/
/********** PUTNAME RENDER END   **********/
/****************************** PDP DELIVERY RENDER END ********************************/
/****************************** PDP SELLER BIZ START ******************************/

/********** CALL AFTER SELLER CHANGE BIZ START **********/
function callAfterSellerChange() {
    dl2wChangesDealer();
    //exotelIdentifierApi();
    //installationCharges();
    //api.onloadRewardPoint();
    // moreEmiOptions();
    biz.productDiscountOnChange();
    biz.extendWarranty();
    /* //api.onloadRewardPoint(); */
}

function bizProductDiscountOnChange() {
    var dataMapping = _getDataMapping();
    var productDetails = dataMapping.productDetails;
    var resp = dataMapping.productDetails.api.onloadPDPData.response;

    // productDetails.productOfferPrice = resp.lowest_offer_price[0].price

    var productOfferPrice = parseInt($(".absolute-discount-calc-offer-price").text().replace(/,/g, ''));
    // var productMrp = typeof resp.mrp == "string" ? parseInt(resp.mrp) : resp.mrp;
    var productMrp = parseInt($(".absolute-discount-calc-offer-mrpprice").text().replace(/,/g, ''));
    productDetails.productDiscountAmt = __common_service.getDiscount(productMrp, productOfferPrice, "in-amount");
    productDetails.productDiscountPercentage = __common_service.getDiscount(productMrp, productOfferPrice, "in-percentage");
    productDetails.isZeroDownpayment = resp.lowest_offer_price[0].zero_downpayment == 1 ? true : false;

    _setDataMapping(dataMapping);
    render.productPageData();
}
biz.productDiscountOnChange = bizProductDiscountOnChange;
/********** CALL AFTER SELLER CHANGE BIZ END   **********/


/********** Emi Scheme Popup BIZ START **********/
function showEmiChangeToaster() {
    $(".emi-change-toaster-parent").removeClass("dsp-none")
    setTimeout(function () {
        $(".emi-change-toaster-parent").addClass("dsp-none")
    }, 5000)
}
function eventSelectSeller() {
    $(".pdp-md-seller-licont").on("click", function () {
        localStorage.setItem("lastselectedSchemeId", '')
        selectDeliveryMethod(this);
        isMapOptionAvailable(true);
        loanPodInstaCreditApproval();
    })
    $(".select-seller-event").on("click", function () {
        localStorage.setItem("lastselectedSchemeId", '')
        selectDeliveryMethod(this);
        if (selectedDeliverySeller) {
            var threeSellerAfterClick = checkForDealerCompareSelectSort(selectedDeliverySeller,compareDealers);
            renderDealerComparision(threeSellerAfterClick);
        }
        isMapOptionAvailable(true);
        loanPodInstaCreditApproval();

    })
}


function checkForDealerCompareSelectSort(clickedDealer,existingCompareDealersArr){
    var sellerArrToReturn;
    var gotDealerArrIndex = existingCompareDealersArr.findIndex((eachCompareAvailSeller)=>clickedDealer.SellerId == eachCompareAvailSeller.SellerId);

    if(gotDealerArrIndex >= 0){
        var gotDealerObj = existingCompareDealersArr.filter((_,i) => gotDealerArrIndex !== i);
        sellerArrToReturn = [existingCompareDealersArr[gotDealerArrIndex],...gotDealerObj,]
    }else{
        sellerArrToReturn =  [clickedDealer,...existingCompareDealersArr.slice(0,2)];
    }

return sellerArrToReturn
}

window.addEventListener('DOMContentLoaded',function(){
    /* About the dealer section START */
    $('.about-dealer-parent').on('click', function () {
        $('.abt-seller-info').toggle();
        $(this).find(".show-abt-seller-hmevt").toggleClass("abt-seller-arrow-rotate");
    })
/* About the dealer section END */
})

// get direction mmy popup start here

$('.pdp-get-dir-hmevt').on('click', function () {
    $(".get-direction-mmy-popup-main-div").removeClass("dsp-none");
});
// get direction mmy popup end here

/********** Emi Scheme Popup BIZ END   **********/
$('.price-brkup-hmevt').on('click', priceBreakupOnSellerChange);
function priceBreakupOnSellerChange(){
    dlPricebreakup2W();
    $(".model-name-txt").text($(".info-prod-head").text())
    $(".ex-showroom-txt").text(__common_service.getAmount(selectedDeliverySeller.Ex_Showroom_Price__c)) 
    $(".road-tax-txt").text(__common_service.getAmount(selectedDeliverySeller.RTO__c)) 
    $(".insurance-txt").text(__common_service.getAmount(selectedDeliverySeller.Insurance__c))
    $(".on-road-price-txt").text(__common_service.getAmount(selectedDeliverySeller.on_road_price))
    $('#price-bk-popup').removeClass('dsp-none');
}
/********** PUTNAME BIZ START **********/
/********** PUTNAME BIZ END   **********/

$('.default-dealer_direction_event').on('click', function () {
    var dealerLat = $(this).attr('data-selected-dealer-latitude');
    var dealerLong = $(this).attr('data-selected-dealer-longitude');
    var custLat = $(this).attr('data-selected-customer-latitude');
    var custLong = $(this).attr('data-selected-customer-longitude');
    mapOpenedFromDefaultDealer = true;
    $(".buy-at-store-popup-w").removeClass("buy-at-store-hide");
    $('.get-direction-mmy-popup-main-div').removeClass('dsp-none');
    $("body").addClass("overflow-hidden");
    render.defaultDealerDirection(dealerLat, dealerLong, custLat, custLong);
})
$(".close-mmi-pop-hmevt").on("click", function () {
    /* condtion for storeDirection Map BackCTA Start */
    direction_plugin.remove();
    map.remove();
    $(".get-direction-mmy-popup-main-div").addClass("dsp-none");
    $("body").removeClass("overflow-hidden");
});
/********** PUTNAME BIZ END   **********/
function renderDefaultDealerDirection(dealerLat, dealerLong , custLat, custLong) {
    var custAddress = emiStoreApiData.get("selectedAddress");
    var placeName = selectedDeliverySeller.SellerName;
    distanceObj.custAddress = custAddress;
    distanceObj.placeName = placeName;
    distanceObj.dealer_Lat = dealerLat;
    distanceObj.dealer_Long = dealerLong;
    distanceObj.customer_Lat = custLat;
    distanceObj.customer_Long = custLong;
    render.LoadMap();
  /*   var fromLat =  '19.4946';
    var fromLong = '72.8604'; */
 /*    var fromLat = custLocationLat;
    var fromLong = custLocationLong; */

}
render.defaultDealerDirection = renderDefaultDealerDirection;

function renderloadMap(){
    var toLat = distanceObj.dealer_Lat;
    var toLong = distanceObj.dealer_Long;
    var fromLatlong = "";
    if(distanceObj.customer_Lat && distanceObj.customer_Long){
        fromLatlong = distanceObj.customer_Lat + ',' + distanceObj.customer_Long;
    }else{
        distanceObj.from_lat = "";
        distanceObj.from_long = ""
    }
    var toLatLong = toLat + ',' + toLong;
    map = new MapmyIndia.Map('map-div',
        {
            center: [19.016804, 73.096458],
            zoom: 5,
            search: false
        });
    /*direction plugin initialization*/
    if (toLat && toLong && distanceObj.customer_Long && distanceObj.customer_Lat) {
        var direction_option = {
            map: map,
            start: { label: distanceObj.custAddress, geoposition: fromLatlong },
            end: { label: distanceObj.placeName, geoposition: toLatLong }
        }
    } else if (distanceObj.from_lat == '' && distanceObj.from_long == '') {
        var direction_option = {
            map: map,
            start: { label: distanceObj.custAddress },
            end: { label: distanceObj.placeName, geoposition: toLatLong }
        }
    }
    direction_plugin = MapmyIndia.direction(direction_option);
}
render.LoadMap = renderloadMap;
/********** Get Directions DL START **********/
$('.getdirection-main-div').on('click', function(){
	dlGetDirectionsCTA2W();
});
/********** Get Directions DL END **********/

/****************************** PDP SELLER BIZ END ********************************/
function loanPodInstaCreditApproval() {
    var dataMapping = _getDataMapping();
    var status_code = dataMapping.customerDetails.api.icorsFetchOffer.status_code;
    var productCode = selectedDeliverySeller.Offer ? selectedDeliverySeller.Offer.ProductCode : "";
    var is_loan_pod_config = localStorage.getItem("is_loan_pod_config_2w");
    if(!status_code){
        localStorage.setItem("got_both_resp_flag","0") 
    }
    else if(status_code == "200" && is_loan_pod_config == "1" && selectedDeliverySeller.instant_credit_approval == true && (productCode == "RTW" || productCode == "UTW")){
        $(".two-wheeler-header-card-limit").addClass("i-dsp-none").css("display","none"); 
        $(".common-header-card-limit").addClass("i-dsp-none")
        $('.two-wheeler-instant-credit-tooltip').removeClass('i-dsp-none');
        localStorage.removeItem("got_both_resp_flag")
    }else if(status_code == "200"){
        $(".two-wheeler-header-card-limit").addClass("i-dsp-none").css("display","block"); 
        $(".common-header-card-limit").addClass("i-dsp-none")
        $('.two-wheeler-instant-credit-tooltip').addClass('i-dsp-none');
        localStorage.removeItem("got_both_resp_flag")
    }
}


console.log("PDP Details Biz JS");
window.addEventListener('DOMContentLoaded', function () {
    /********** PDP NOTIFY ME BIZ START **********/
        
    $(".email-id-outofstock").on("input", function (e) {
        e.preventDefault();
        var val = this.value;
        if(val && isValidateEmail(val) && isValidateMobile($(".mobile-no-outofstock").val())) {
            $(".notify-btn-outofstock").removeClass("disabled");
             $(".email-id-outofstock").removeClass("os-border-red");
        } else {
            $(".notify-btn-outofstock").addClass("disabled");
            $(".email-id-outofstock").addClass("os-border-red");
        }
        if(val && isValidateEmail(val)){
            $(".email-id-outofstock").removeClass("os-border-red");
        }
        if(!val && isValidateMobile($(".mobile-no-outofstock").val())){
             $(".notify-btn-outofstock").removeClass("disabled");
            $(".email-id-outofstock").removeClass("os-border-red");
        }
        if(!val){
            $(".email-id-outofstock").removeClass("os-border-red");
        }
    })
    $(".mobile-no-outofstock").on("input", function (e) {
        e.preventDefault();
        this.value = this.value.substr(0, 10);
        var val = this.value;
        if (val && isValidateMobile(val)) {
            $(".notify-btn-outofstock").removeClass("disabled");
             $(".mobile-no-outofstock").removeClass("os-border-red");
        } else {
            $(".notify-btn-outofstock").addClass("disabled");
            $(".mobile-no-outofstock").addClass("os-border-red");
        }
        if(($(".email-id-outofstock").val()) && !(isValidateEmail($(".email-id-outofstock").val()))){
            $(".notify-btn-outofstock").addClass("disabled");
        }
    })
    $(".notify-btn-outofstock").on("click", function (e) {
        e.preventDefault();
        callToNotifyMe();
        dlNotifyMe();
    })
    /********** PDP NOTIFY ME BIZ END **********/

    /********** 2w pdp city change Starts **********/
    $(".2wpdp-city-change-event").on("click",function(){
        if(window.matchMedia("(max-width: 766px)").matches){
            $("body").removeClass("nav-scroll")
            window.scrollTo(0,0)
        }
        $(".city_li > a").click()
    })
    /********** 2w pdp city change Ends **********/

})
/****************************** PDP DETAILS BIZ START ******************************/
function show2wLoanPodScreen(value){
    if(value){
        $(".loan-pod-phase-two").children().addClass("dsp-none")
        $(".loan-pod-phase-two").children("#"+value).removeClass("dsp-none")
        $('body').addClass('overflow-hidden');
    }else{
        $(".loan-pod-phase-two").children().addClass("dsp-none")
        $('body').removeClass('overflow-hidden');
    }
}
function bizProductPageData() {
    var dataMapping = _getDataMapping();
    var productDetails = dataMapping.productDetails;
    var resp = dataMapping.productDetails.api.onloadPDPData.response;
    var status = dataMapping.productDetails.api.onloadPDPData.status;

    if (resp && resp.status) {
        // productDetails.productOfferPrice = resp.lowest_offer_price[0].price
        productDetails.productOfferPrice = parseInt($(".absolute-discount-calc-offer-price").text().replace(/,/g, ''));
        if (resp.mrp) {
            productDetails.productMrp = typeof resp.mrp == "string" ? parseInt(resp.mrp) : resp.mrp;
        } else {
            productDetails.productMrp = parseInt($(".absolute-discount-calc-offer-mrpprice").text().replace(/,/g, ''));
        }
        productDetails.productDiscountAmt = __common_service.getDiscount(productDetails.productMrp, productDetails.productOfferPrice, "in-amount");
        productDetails.productDiscountPercentage = __common_service.getDiscount(productDetails.productMrp, productDetails.productOfferPrice, "in-percentage");
        productDetails.isZeroDownpayment = resp.lowest_offer_price[0].zero_downpayment == 1 ? true : false;
    }

    _setDataMapping(dataMapping);
    render.productPageData();
}
biz.productPageData = bizProductPageData;

/********** PDP PRICE BIZ START **********/
/********** PDP PRICE BIZ END   **********/
/********** PDP EMI BIZ START **********/
/********** PDP EMI BIZ END   **********/
/********** PDP SPECIAL OFFER BIZ START **********/
// 7020 special offer tnc tooltip close for mobile view
window.addEventListener('DOMContentLoaded', function () {
    // $(".custom-tooltip-mob-background").removeClass("display-none");
})
function specialOfferEvents() {
    $(".cross-back-btn-hmevt.mob-hmevt").on("click", function (e) {
        $(this).parents(".available-offers-new-list-more").find(".custom-tooltip-mob-background").addClass("display-none").removeClass("display-block");
        $('.tnCtooltip').addClass('dsp-none');
        e.stopPropagation();
    })
    $(".TnCtooltip.mob-hmevt").on("click", function (e) {
        $(this).parents(".available-offers-new-list-more").find(".custom-tooltip-mob-background").removeClass("display-none").addClass("display-block");
        $('.tnCtooltip').removeClass('dsp-none');
    })
}
/********** PDP SPECIAL OFFER BIZ END   **********/
/********** PDP OTHER BIZ START **********/
/********** PDP OTHER BIZ END   **********/
/****************************** PDP DETAILS BIZ END ********************************/

/****************************** PDP DETAILS RENDER START ******************************/
function renderProductPageData() {

    var dataMapping = _getDataMapping();
    var productDetails = dataMapping.productDetails;

    Object.keys(productDetails).forEach(function (eachKey) {
        var val = productDetails[eachKey];
        __common_service.setElementValue(eachKey, val);
    })

    // productDetails.isZeroDownpayment ? $(".productZerodownpayment-parent").removeClass("dsp-none") : $(".productZerodownpayment-parent").addClass("dsp-none");
    // productDetails.productDiscountPercentage > 0 ? $(".productDiscountPercentage-parent").removeClass("dsp-none") : $(".productDiscountPercentage-parent").addClass("dsp-none");
    productDetails.productDiscountAmt > 0 ? $(".invalid-discount-sec").removeClass("dsp-none") : $(".invalid-discount-sec").addClass("dsp-none");
    if(productDetails.productDiscountAmt > 0){
        $('.prod-mrp-txt').text("Offer Price: ")
    }
    /* consume value of nudge to show the top selling**/
    if (productData.nudge == null || productData.nudge == "") {
        $(".tp-seling-img").addClass("dsp-none")
    }    
}
render.productPageData = renderProductPageData;

/********** PDP PRICE RENDER START **********/

/********** PDP PRICE RENDER END   **********/
/********** PDP EMI RENDER START **********/
function showBottomNudgeMsgInViewMoreEmi(){
    if(!__is_loginUSer()){
        $(".pdp-non-login-tile").removeClass("dsp-none");
    }else{
        $(".pdp-non-login-tile").addClass("dsp-none");
    }
}
/********** PDP EMI RENDER END   **********/
/********** PDP SPECIAL OFFER RENDER START **********/
function renderSpecialOfferLI(data) {
    
    var div = '' +
        '<li class="available-offers-new-list clear-fix pdprev-emistable-cnt-li">' +
        '    <div class="revpdp-offerdiv-icon-w">' +
        '        <img src="/content/dam/emistoremarketplace/index/offer-for-design-dam/Offer -percent-icon.png">' +
        '    </div>' +
        '    <div class="available-offers-new-list-icon-back">' +
        '        <span class="available-offers-new-icon">' +
        '            <img class="lozad" data-src="/content/dam/emistoremarketplace/index/pdppage/gift-font.png" width="14px" height="14px" src="/content/dam/emistoremarketplace/index/pdppage/gift-font.png" data-loaded="true">' +
        '        </span>' +
        '    </div>' +
        '    <div class="available-offers-new-list-content">' +
        '        <span class="available-offers-title-txt"></span>' +
        '        <span class="available-offers-new-list-text">'+data.specialOffer+'</span>' +
        '    </div>' +
        '    <div class="available-offers-new-list-more">' +
        '        <span class="more-link TnCtooltip desk-mob pdp-left-sepr">' +
        '            <span class="ft-black">T &amp; C' +
        '                <div class="custom-tooltip-mob-background">' +
        '                    <div class="tnCtooltip dsp-none">' +
        '                        <div class="tnc-feature-w">' +
        '                            <div class="cross-icon-div pdp-modal-close">' +
        '                                <img class="cross-back-btn-hmevt desk-mob" src="/content/dam/emistoremarketplace/index/offer-tnc-imges/cross-btn.png" alt="cross-btn">' +
        '                            </div>' +
        '                            <div class="offer-fetaure-div">' +
        '                                <div class="offer-for-you-div">' +
        '                                    <span class="available-offers-tooltipText tnc-tooltiptext">Offers for you</span>' +
        '                                </div>' +
        '                                <div class="offer-for-you-feature-div">' +
        '                                    <ul>' +
        '                                        <li class="offer-for-you-feature-div-li">' +
        '                                            <span class="offer-for-you-text-q">'+data.tooltipText+'</span>' +
        // '                                            <span class="offer-for-you-text-A">Get 1 EMI Off on this Product</span>' +
        '                                        </li>' +
        '                                    </ul>' +
        '                                </div>' +
        '                                <div class="tnc-apply-text">' +
        '                                    <a href="'+data.TnCUrl+'" target="_blank">T&C apply</a>' +
        '                                </div>' +
        '                            </div>' +
        '                        </div>' +
        '                    </div>' +
        '                </div>' +
        '            </span>' +
        '        </span>' +
        '    </div>' +
        '</li>'
        return div;
    /* var div = '' +
        '<li class="special-offer-new-main-w pdprev-emistable-cnt-li">' +
        '    <div class="special-offer-image-div">' +
        '        <img src="/content/dam/emistoremarketplace/index/specialoffer/specofferupee.png" alt="Rsicon" />' +
        '    </div>' +
        '    <div class="special-offer-text-w">' +
        '        <span class="special-offer-text">' +
        '            ' + data.specialOffer +
        '            <span class="tnc-offer tooltiptest">' +
        '                T &amp; C' +
        '                <i class="custtooltip">' +
        '                    <span class="available-offers-tooltipText"> ' + data.tooltipText + ' </span>' +
        '                    <a href="' + data.TnCUrl + '"> Read&nbsp;&nbspMore </a>' +
        '                </i>' +
        '            </span>' +
        '        </span>' +
        '    </div>' +
        '    <div class="coupon-div-wrapper dsp-none">' +
        '        <img src="" alt="" />' +
        '        <span class="tap-to-copy-text">Tap to copy</span>' +
        '        <span class="coupon-code-text">MONEY20</span>' +
        '    </div>' +
        '</li>'; */
}

function renderMattressCIC() {
    /*
    productData.variants = [
        {
            "mattress_size": {
                "0": {
                    "value": 11489,
                    "label": "Single",
                    "selected": true,
                    "sku": "DurfiSingleCottonCandyMemoryFoamMattressinGrey78366Inch",
                    "url": "durfi-single-cotton-candy-memory-foam-mattress-in-grey-78-36-6-inch.html",
                    "disabled": [],
                    "image": "/d/u/durfio_base.jpg"
                },
                "1": {
                    "value": 11489,
                    "label": "Double",
                    "selected": true,
                    "sku": "DurfiSingleCottonCandyMemoryFoamMattressinGrey78366Inch",
                    "url": "durfi-single-cotton-candy-memory-foam-mattress-in-grey-78-36-6-inch.html",
                    "disabled": [],
                    "image": "/d/u/durfio_base.jpg"
                },
                "icon_image": "https://bfsd.qa.bfsgodirect.com/emistore/media/deliveryiconimages/default1626695448.png",
                "is_dropdown": "1"
            },
            "mattress_size_in_inches": {
                "0": {
                    "value": 11508,
                    "label": "78 x 36 Inch",
                    "selected": true,
                    "sku": "DurfiSingleCottonCandyMemoryFoamMattressinGrey78366Inch",
                    "url": "durfi-single-cotton-candy-memory-foam-mattress-in-grey-78-36-6-inch.html",
                    "disabled": [],
                    "image": "/d/u/durfio_base.jpg"
                },
                "1": {
                    "value": 11508,
                    "label": "78 x 37 Inch",
                    "selected": true,
                    "sku": "DurfiSingleCottonCandyMemoryFoamMattressinGrey78366Inch",
                    "url": "durfi-single-cotton-candy-memory-foam-mattress-in-grey-78-36-6-inch.html",
                    "disabled": [],
                    "image": "/d/u/durfio_base.jpg"
                },
                "icon_image": "https://bfsd.qa.bfsgodirect.com/emistore/media/deliveryiconimages/default1626695448.png",
                "is_dropdown": "1"
            },
            "mattress_configurations": {
                "0": {
                    "value": 15219,
                    "label": "72 X 32 Inch",
                    "selected": true,
                    "sku": "DurfiSingleCottonCandyMemoryFoamMattressinGrey78366Inch",
                    "url": "durfi-single-cotton-candy-memory-foam-mattress-in-grey-78-36-6-inch.html",
                    "disabled": [],
                    "image": "/d/u/durfio_base.jpg"
                },
                "icon_image": "https://bfsd.qa.bfsgodirect.com/emistore/media/deliveryiconimages/default1626695448.png"
            }
        }
    ]
    // */
    productData.variants && productData.variants.forEach(function (each) {
        var eachLi = '';
        var selectedDimensions = '';
        // var storageLi = '';
        // var colorLi = '';
        Object.keys(each).forEach(function (eachVariants) {
            var title;
            var currentVariant = eachVariants.replace(/_/g, ' ').toUpperCase();
            title= eachVariants.replace(/_/g, ' ').toUpperCase();
            console.group("title : ", title);
            var eachVariantObj = each[eachVariants];
            eachLi = '';
            var eachOtherLiFlag = false;
            var eachDropdownLiFlag = false;
            var eachOtherLi = ''
            var eachDropdownLi = ''

            eachVariantObj && Object.keys(eachVariantObj).forEach(function (key) {
                var eachVariantsItem = eachVariantObj[key];

                var url = eachVariantsItem.url;
                if (window.location.href.includes("/emi-store/")) {
                    url = window.location.href.split("/emi-store/")[0] + "/emi-store/" + eachVariantsItem.url;
                } else if (window.location.href.includes("/emistore/")) {
                    url = window.location.href.split("/emistore/")[0] + "/emistore/" + eachVariantsItem.url;
                }

                var label = eachVariantsItem.label;
                var isSelected = eachVariantsItem.selected ? ' active ' : '';
                var isDisabled = eachVariantsItem.disabled && eachVariantsItem.disabled.hasOwnProperty(parseInt(localStorage.getItem("cityId"))) ? '  ' : ' out-of-stock-prod-color tooltip '
                var notdisable = eachVariantsItem.selected == false ? eachVariantsItem.disabled.hasOwnProperty(parseInt(localStorage.getItem("cityId"))) : true;
                if (productData.status && eachVariantsItem.selected == true && notdisable == true) {
                    // link = "<a>";
                    isDisabled = "  ";
                }
                if (!productData.status && eachVariantsItem.selected == true && eachVariantsItem.disabled.hasOwnProperty(parseInt(localStorage.getItem("cityId"))) == false) {
                    isDisabled = " height-out-of-stock-size dash-out-of-stock ";
                }
                var data = "{'sku':'" + eachVariantsItem.sku + "','url':'" + url + "'}";
                var colorImage = baseUrl+"/media/catalog/product" + eachVariantsItem.image;
                var parents = "." + eachVariants + "-parents-div";
                isSelected && $(parents).find(".cic-hover-text").text(label);
                if (currentVariant != "INTERNAL STORAGE" && currentVariant != "COLOR" && currentVariant != "VARIANT TYPE") {
                    currentVariant = (eachVariantObj.is_dropdown == 1) ? "DROPDOWN" : "OTHER";
                }
                
                if(each[eachVariants].hasOwnProperty('frontend_label')){
                    title = each[eachVariants]['frontend_label'];
                }

                switch (currentVariant) {
                    case "VARIANT TYPE":
                        eachLi += label ? '' +
                        '<a href="' + url + '"><li class="prod-storage-li pdp-cic-hover' + isSelected + isDisabled + '"  data-name="' + label + '"> '+label+'</li>' : '</a>'

                        break;

                    case "COLOR":
                        

                        eachLi += label ? '' +
                        '    <a href="' + url + '">' +
                            '<li class="prod-color-li pdp-cic-hover' + isSelected + isDisabled + '" data-name="' + label + '">' +
                           
                            '        <img src="' + colorImage + '" alt="mobile-img" />' +
                           
                            '    <span class="tooltiptext tooltip-bottom"> Currently out of stock in this area. </span>' +
                            '</li>' : '' +'    </a>';

                        break;
                    // case "MATTRESS CONFIGURATIONS":
                    // case "MATTRESS DIMENSIONS":
                    case "DROPDOWN":
                        // eachVariants = "dimension";
                        if (isSelected.trim() == 'active') {
                            selectedDimensions = label;
                        }
                        eachDropdownLiFlag = true;
                        eachLi += label ? '' +
                            ' <a href="' + url + '">' +
                            '   <div class="Option-menu mattress-dimension-option">' +
                            '     <span class="option-menu-text ' + isSelected + isDisabled + ' dim-sel dl-getDimension" data-type="dimension" data-dimension-label= "'+label+'">' + label + '</span>' +
                            '   </div>' : '' +
                        ' </a>';
                        break;
                    default:
                        eachOtherLiFlag = true;
                        eachLi += label ? '' +
                            '<li class="mattress-li mattress-dimension-wrapper dl-getDimension ' + isSelected + isDisabled + '" data-type="height" data-dimension-label= "'+label+'"><a href="' + url + '">' + label + '</a></li>' : '';

                        break;
                }
            })

            eachDropdownLi = eachDropdownLiFlag ? '' +
                '<div class="mattress-dimension-wrapper  ' + eachVariants + '-parents-div">' +
                '    <div class="mattress-dimension-heading">' +
                '        <span class="size-icon-head">' +
                '            <img class="img-contain100  ' + eachVariants + '-src" src="/content/dam/emistoremarketplace/index/mattress-cic/size-icon.png" alt="size-icon" />' +
                '        </span>' +
                '        <h2 class="size-heading dimension-title">SELECT ' + title + '</h2>' +
                '    </div>' +
                '    <div class="mattress-dropdwon-div">' +
                '        <div class="mattress-selected ' + eachVariants + '-selected">' +
                '            <!-- <span class="dropdwon-text">Select from Dropdown</span> -->' +
                '            <input type="text" value="Select from Dropdown" class="dropdwon-text" readonly />' +
                '            <div class="arrow-div">' +
                '                <span class="arrow mattress-arrow"></span>' +
                '            </div>' +
                '        </div>' +
                '        <div class="mattress-option-menu dimension-html dsp-none">' +
                '            ' + eachLi +
                '        </div>' +
                '    </div>' +
                '</div>' : '';
            eachDropdownLiFlag && $(".other-cic-parents-div").after(eachDropdownLi);

            eachOtherLi = eachOtherLiFlag ? '' +
                '<div class="mattress-wrapper mattress-height-wrapper ' + eachVariants + '-parents-div">' +
                '    <div class="mattress-height-heading">' +
                '        <span class="size-icon-head">' +
                '            <img class="img-contain100 ' + eachVariants + '-src" src="/content/dam/emistoremarketplace/index/mattress-cic/size-icon.png" alt="size-icon" />' +
                '        </span>' +
                '        <h2 class="size-heading">SELECT ' + title + '</h2>' +
                '    </div>' +
                '    <ul class="mattress-height-ul">' + eachLi + '</ul>' +
                '</div>' : '';
            eachOtherLiFlag && $(".other-cic-parents-div").after(eachOtherLi);
           

            $("#oos-storage-variant").html();
            console.groupEnd("title : ", title);
            var img = eachVariantObj['icon_image'];
            var clsssHtml = "." + eachVariants + "-html";
            var clsssSrc = "." + eachVariants + "-src";
            var clsssTxt = "." + eachVariants + "-text";
            var parents = "." + eachVariants + "-parents-div"
            var classTitle = "." + eachVariants + "-title"
            var classSelected = "." + eachVariants + "-selected"
            $(clsssHtml).html(eachLi);
            $(clsssTxt).html(title + " :");
            $(classTitle).html("SELECT " + title + "");
            $(clsssSrc).attr("src", img);

            eachLi ? $(parents).removeClass("dsp-none") : $(parents).addClass("dsp-none");
            if (selectedDimensions) {
                $("" + classSelected + " .dropdwon-text").val(selectedDimensions).attr("value", selectedDimensions);
                $("" + classSelected + "").addClass("border-orange");
            }


        })

        if ($(".internal_storage-parents-div").hasClass("dsp-none") && $(".color-parents-div").hasClass("dsp-none")) {
            $(".mobile-color-varient-option").addClass("dsp-none");
        } else {
            $(".mobile-color-varient-option").removeClass("dsp-none");
        }

        $(".mattress-wrapper").length || $(".mattress-dimension-option").length ? $(".other-cic-mattress-div").removeClass("dsp-none") : $(".other-cic-mattress-div").addClass("dsp-none");
        $(".pdp-cic-hover").hover(function () {
            var txt = $(this).attr('data-name');
            $(this).parent().siblings().find('.cic-hover-text').text(txt)
        }, function () {
            var txt = $(this).siblings('.active').attr('data-name');
            $(this).parent().siblings().find('.cic-hover-text').text(txt)
        })
        $(".prod-color-li").click(function(){

            var activeRam = $(".dl-getDimension.active").attr("data-dimension-label");
            var activeStorage = $(".prod-storage-li.active").attr("data-name");
            var activeColor =  $(this).attr('data-name');
            dlSelectVariant(activeRam,activeStorage,activeColor);
        });
        $(".prod-storage-li").click(function(){ 
            var activeRam = $(".dl-getDimension.active").attr("data-dimension-label");
            var activeStorage = $(this).attr("data-name");
            var activeColor =  $('.prod-color-li.active').attr('data-name');
            dlSelectVariant(activeRam,activeStorage,activeColor);
        });
        /* dropdown-open-closed start */
        $(".mattress-selected").on("click", function (e) {
            e.preventDefault();
            e.stopPropagation();
            $(this).siblings(".mattress-option-menu").toggleClass("dsp-none");
            $(this).find(".arrow").toggleClass("arrow-up");
        });

        $('.mattress-option-menu').click(function (e) {
            e.stopPropagation();
        });

        $('body').click(function () {
            $('.mattress-option-menu').addClass('dsp-none');
            $(".mattress-arrow").removeClass("arrow-up");
        });
        
        $('.dl-getDimension').click(function(){
            var val = $(this).attr('data-dimension-label');
            if(val.indexOf("Inch") > 0 || val.indexOf("inch") > 0){
                callInstallationDimension(val);
            }
            var activeRam = $(this).attr("data-dimension-label");
            var activeStorage = $(".prod-storage-li.active").attr("data-name");
            var activeColor =  $(".prod-color-li.active").attr('data-name');
            dlSelectVariant(activeRam,activeStorage,activeColor);
        })
        /* dropdown-open-closed end */
    })
}
render.mattressCIC = renderMattressCIC
/********** PDP SPECIAL OFFER RENDER END   **********/
/********** PDP OTHER RENDER START **********/
/********** PDP OTHER RENDER END   **********/
/****************************** PDP DETAILS RENDER END ********************************/
var selectedvasproduct = 0,
    totalVasCostlimit = 0,
    mainproduct = 1,
    totalproducts = 1,
    onlyvastotalcost = 0,
    addpolicy = 0,
    mainprodcost = 0,
    fonesafecost = 0,
    totalproducttotalcost = 0,
    calclimit = 0,
    totalVasCostlimitmax = 0,
    BWEExchangeValue = 0,
    fonesafetotal = 0,
    reqObj = {},
    skuName = $('meta[name="productSku"]').attr('content'),
    productID = parseInt($('meta[name="entityID"]').attr('content'));
var fonesafecheck = 0;
var BWEtext = "";
var insUser;
var insValue;
var insuranceName = "";
var displayFullReviewFlag = false;
var callReviewApiFlag = $(".user-ratings-viewoption").attr("data-next");
var reviewInitPage = $(".user-ratings-viewoption").attr("next-page");
function __is_loginUSer() {
    var data = localStorage.getItem("perpetual_data");
    if (data) {
        return true;
    }
    return false;
}

function calcmax() {
    if ($('.absolute-discount-calc-offer-discountedprice').length) {
        calclimit = parseInt(($(".absolute-discount-calc-offer-discountedprice").html()).split(',').join(''));
    } else {
        calclimit = parseInt(($(".absolute-discount-calc-mrp-price").html()).split(',').join(''));
    }
}

// function to validate More EMI popup and pass values to EMI section available on page details based on selection of EMI plans Start
function absolutediscountcalculation() {
    var valueofEMI = (parseInt(($('.customCheckboxChecked').find('input[checked="checked"]').parents('.emi-pop-up-table-content-wrap').find('.emi-pop-up-table-content-data-amt-exactvalue').text()).split(',').join(''))).toLocaleString();
    $('.absolute-discount-calc-period-emicost').text(valueofEMI);
    var monthofEMI = $('input[checked="checked"]').parents('.emi-pop-up-table-content-wrap').find('.emi-pop-up-table-content-data-month').text();
    if (monthofEMI <= 9) {
        $('.absolute-discount-calc-period-monthduration').text('0' + monthofEMI + ' months');
    } else {
        $('.absolute-discount-calc-period-monthduration').text(monthofEMI + ' months');
    }
    var valueofdownpayment = (parseInt(($('.customCheckboxChecked').find('input[checked="checked"]').parents('.emi-pop-up-table-content-wrap').find('.emi-pop-up-table-content-data-amt-downpaymentvalue').text()).split(',').join(''))).toLocaleString();
    $('.absolute-discount-calc-downpaymentvalue,.EMI-detail-pop-up-downpaymentvalue').text(valueofdownpayment);
    calcEMIDetails();
}
// function to validate More EMI popup and pass values to EMI section available on page details based on selection of EMI plans END

//function to change Seller as per seller seleted in more seller popup Start
function changeseller() {
    var sellernametochange = $('.moreseller-popup-check.selected').parents('.moreseller-listitem').find('.moreseller-sellername').text();
    $('.seller-title').children('.seller-name').text(sellernametochange);
    var selleraddresstochange = $('.moreseller-popup-check.selected').parents('.moreseller-listitem').find('.moreseller-city').text();
    $('.seller-title').children('.seller-address').text(selleraddresstochange);
    $('#moreseller-pop-up').removeClass('popactive');
    $('#moreseller-pop-up').children().removeClass('activepopup');
    $('body').removeClass('noscrollbody');
}
//function to change Seller as per seller seleted in more seller popup END
// loader visibility function start
function showLoader(condition) {

    if (condition == true) {
        showInstaPopup("show-insta-details");
        toggleInstaLoader(true)
        /* 
        $(".pageloader-div").addClass('showpageloader').parents('body').addClass('noscrollbody');
        //  */
    } else {
        showInstaPopup(false);
        toggleInstaLoader(false)
        /* 
        $(".pageloader-div").removeClass('showpageloader').parents('body').removeClass('noscrollbody');
        //  */
    }
}
// loader visibility function END
//Scroll Function
window.addEventListener('DOMContentLoaded', function () {
    
    if ($(".faqwrapparent").find(".faques").length <= 5) {
        $(".faq-more").addClass("dsp-none");
    }
    $("body").on("click",".compare-buynow-event-dealer", function (){
        var url = $(this).parents('.pdprev-cmpprods-tdimg-ct').children().find('a').attr('href');
        var sellerId = $(this).parents('.pdprev-cmpprods-tdimg-ct').find('.pdprev-cmpprods-img').attr('sellerId');
        sellerId = btoa(sellerId+"_BFL");
        $(this).css({'opacity':'0.5', 'pointer-events': 'none'})
        localStorage.setItem('compareBuynowClick',true)
        location.href = url +"?sid="+sellerId;
    })

    $('.image-popup-link').on('click', function (e) {
        e.preventDefault();
    });

    if ($('.absolute-discount-calc-wrap').length) {
        //calcabsolutemoneysaved();
        // absolutediscountcalculation();
        calcmax();
    }

    // --view-more-seller pop up selection Start--
    $(".moreseller-listitem").click(function () {
        $(this).children(".moreseller-popup-check-icon").find(".moreseller-popup-check").addClass("selected");
        $(this).siblings().children(".moreseller-popup-check-icon").find(".moreseller-popup-check").removeClass("selected");
    });
    // --view-more-seller pop up selection END--

    // to open all pop common jquery Start
    $('.openpopup').on('click', function () {
        //seller change pop up  start
        
                if ($(this).hasClass('more-sellers')) {
                    var currentlyOptedSeller = $('.seller-name').text();
                    $(".moreseller-listitem").each(function () {
                        var selectText = $(this).find(".moreseller-sellername").text();
                        if (selectText == currentlyOptedSeller) {
                            $(this).find(".moreseller-popup-check").addClass("selected").parents(".moreseller-listitem").siblings().find(".moreseller-popup-check").removeClass("selected");
                        }
                    });
                }
        //seller change pop up  END
        var popupattr = $(this).attr('data-matchid');
        $('#' + popupattr).addClass('popactive');
        $('#' + popupattr).children().addClass('activepopup');
        $('body').addClass('noscrollbody');

        if ($(this).hasClass('opted')) {
            absolutediscountcalculation();
        }
        dlTWOPDPEmiSchemeChange();
        // pdpViewEmiOptionsDatalayer();
    });

    $(".write-review-event").on("click",function(){
        if(__is_loginUSer()){
            
                var popupattr = "writereview-pop-up"
                $('#' + popupattr).addClass('popactive');
                $('#' + popupattr).children().addClass('activepopup');
                $('body').addClass('noscrollbody');
            
        }else{
            localStorage.setItem("reviewClicked","true")
            showPopup("show-mobile")

        }
    })
    // to open all pop common jquery END

    //action on action close start
    $(".action-close").on('click', function () {
        if ($(this).parent().hasClass('youtubeinnerwrap')) {
            $('.youtubevideoiframe').attr('src', '');
            $('body').removeClass('noscrollbody');
            $(this).parents(".pop-up").removeClass('popactive');
            $(this).parents(".pop-up").children().removeClass('activepopup');
        } else {
            $('body').removeClass('noscrollbody');
            $(this).parents(".pop-up").removeClass('popactive');
            $(this).parents(".pop-up").children().removeClass('activepopup');
        }
        if ($(".seller--outofstock--message").hasClass("seller--hideElement") == false) {
            $(".seller--outofstock--message").addClass("seller--hideElement").siblings().show();
        }
    })
    //action on action close END

    //action on action close END


    $(".select-categoryoption").click(function () {
        $(this).siblings().addClass("showlist");
    });

    // Internaml memory selection div functionality start
    $(".storage-capacity-list").click(function () {
        if (!($(this).hasClass("storage-capacity-out"))) {
            var tempsize = $(this).children('.storage-checkbox').text();
            $('.storage-value-span').text(tempsize);
            $(this).addClass("storage-active").siblings().removeClass("storage-active");
        }
    });
    // internaml memory selection div functionality END

    //--available-options-end--

    // Imageposition on scroll start
    /*  var elements = $('.sticky');
     Stickyfill.add(elements); */


    $('.fixedbuttoncontinue').on('click', function () {
        $(this).parents('.modal-inner-wrap').find('.action-close').trigger("click");
        $(".pop-up").removeClass("popactive");
        $("body").removeClass("noscrollbody");
        $(".pop-up").children().removeClass('activepopup');
    });

    $('.fixedbuttoncontinue').on('click', function () {
        $(this).parents('.modal-inner-wrap-new').find('.action-close').trigger("click");
    });

    /* $('.closepopimg').on('click', function () {
        $(this).parent().find('.action-close').trigger("click");
    }); */

    // FAQ click jquery
    $("body").on("click",".que", function () {
        if ($(this).hasClass('active')) {
            if (window.innerWidth > 767) {
                $(this).parents('.faqwrapparent').find('.faques').children(".ans").slideUp().siblings().removeClass("active");
            }
            if (window.innerWidth < 768) {
                $(this).parents().children(".ans").slideUp().siblings().removeClass("active");
            }
        } else {
            if (window.innerWidth > 767) {
                $(this).parents('.faqwrapparent').find('.faques').children(".ans").slideUp().siblings().removeClass("active");
                $(this).next().slideToggle().siblings().toggleClass("active");
            }
            if (window.innerWidth < 768) {
                $(this).parents().siblings().children(".ans").slideUp().siblings().removeClass("active");
                $(this).next().slideToggle().siblings().toggleClass("active");
            }
        }
    });
    // FAQ click jquery

    function onscrl() {
        var scrll = $(window).scrollTop();
        $(window).scrollTop(scrll - 1);
    }
    // FAQ more faq and slide pop up jquery Start

    $('.forfaqadding').on('click', function () {
        if (window.innerWidth > 767) {
            if($(this).text().toLowerCase().includes("view more")){
                $('.faqwrapparent .faques:hidden').addClass('hiddenspecs');
                $('.faqwrapparent .faques:hidden').wrapAll("<div class='faqviewwrapper'></div>");
                $('.faqviewwrapper').stop().slideDown();
                // $(this).removeClass('forfaqadding');
                $(this).removeClass('hashidden');
                // $(this).addClass('forfaqremoving');
            }else{
                $('.faqviewwrapper').stop().slideUp();
                $(this).removeClass('forfaqremoving');
                $(this).addClass('forfaqadding');
            }
            /* if ($(this).hasClass('hashidden')) {
                $('.faqwrapparent .faques:hidden').addClass('hiddenspecs');
                $('.faqwrapparent .faques:hidden').wrapAll("<div class='faqviewwrapper'></div>");
                $('.faqviewwrapper').stop().slideDown();
                $(this).removeClass('forfaqadding');
                $(this).removeClass('hashidden');
                $(this).addClass('forfaqremoving');
            } else {
                $('.faqviewwrapper').stop().slideDown();
                $(this).removeClass('forfaqadding');
                $(this).addClass('forfaqremoving');
            } */
            $(".faq-more").text($(".faq-more").text().toLowerCase() == 'view more' ? 'View Less' : 'View More');  
            setTimeout(function () {
                onscrl();
            }, 300);
        }
        if (window.innerWidth < 768) {
            if ($(this).hasClass('hashidden')) {
                $('.faqwrapparent .faques:hidden').addClass('hiddenspecs');
                $('.faqwrapparent .faques:hidden').wrapAll("<div class='faqviewwrapper'></div>");
                $(this).removeClass('hashidden');
                var faqhtml = $(".faqviewwrapper").html();
                var firstfaq = $('.faques').eq(0);
                var secondfaq = $('.faques').eq(1);
                var thirdfaq = $('.faques').eq(2);
                var fourthfaq = $('.faques').eq(3);
                var fifthfaq = $('.faques').eq(4);
                $('.faqpopupinner').append(firstfaq.clone());
                $('.faqpopupinner').append(secondfaq.clone());
                $('.faqpopupinner').append(thirdfaq.clone());
                $('.faqpopupinner').append(fourthfaq.clone());
                $('.faqpopupinner').append(fifthfaq.clone());
                $('.faqpopupinner').append(faqhtml);
                $('#mobile-FAQ-div').addClass('popactive');
                $('#mobile-FAQ-div .modal-popup').addClass('activepopup');
                $('body').addClass('noscrollbody');
            } else {
                $('#mobile-FAQ-div').addClass('popactive');
                $('#mobile-FAQ-div .modal-popup').addClass('activepopup');
                $('body').addClass('noscrollbody');
            }
        }
    });

    $('.forfaqremoving').on('click', function () {
        if (window.innerWidth > 767) {
            $('.faqviewwrapper').stop().slideUp();
            $(this).removeClass('forfaqremoving');
            $(this).addClass('forfaqadding');
            $(".faq-more").text($(".faq-more").text() == "View Few FAQ's" ? "View Few FAQ's" : "View More"); 
            setTimeout(function () {
                onscrl();
            }, 300);
        }
    });

    // FAQ more faq and slide pop up jquery END

    $('.mobititlecommondiv i.fa-angle-left').on('click', function () {
        $(this).parents('.modal-inner-wrap').find('.action-close').trigger("click");
    });




    $('.foradding').on('click', function () {
        // if ($(this).hasClass('hashidden')) {
        //     $('.prodspecsparent .prodfeature-wrapper:hidden').addClass('hiddenspecs');
        //     $('.prodspecsparent .prodfeature-wrapper:hidden').wrapAll("<div class='speciviewwrapper'></div>");
        //     $('.speciviewwrapper').stop().slideDown();
        //     $(this).removeClass('foradding');
        //     $(this).removeClass('hashidden');
        //     $(this).addClass('forremoving');
        // } else {
        //     $('.speciviewwrapper').stop().slideDown();
        //     $(this).removeClass('foradding');
        //     $(this).addClass('forremoving');
        // }
        if($(this).text().toLowerCase().includes("view more")){
            $('.prodspecsparent .prodfeature-wrapper:hidden').addClass('hiddenspecs');
            $('.prodspecsparent .prodfeature-wrapper:hidden').wrapAll("<div class='speciviewwrapper'></div>");
            $('.speciviewwrapper').stop().slideDown();
            $(this).removeClass('foradding');
            $(this).removeClass('hashidden');
            $(this).addClass('forremoving');
        }else{
            $('.speciviewwrapper').stop().slideUp();
            $(this).removeClass('forremoving');
            $(this).addClass('foradding');
        }
        
        $(".specviewmore").text($(".specviewmore").text() == 'View Less' ? 'View More' : 'View Less');
        setTimeout(function () {
            onscrl();
        }, 300);

    });

    // $('.forremoving').on('click', function () {
    //     $('.speciviewwrapper').stop().slideUp();
    //     $(this).removeClass('forremoving');
    //     $(this).addClass('foradding');
    //     $(".specviewmore").text($(".specviewmore").text() == 'View Less' ? 'View More' : 'View Less');
    //     setTimeout(function () {
    //         onscrl();
    //     }, 300);
    // });
    // more specification END


    $('.formanuadding').on('click', function () {
        if($(this).text().trim() == "View All Features"){
            $('.manufac-prod-wrap .manfac-prod:hidden').addClass('hiddenspecs');
            $('.manufac-prod-wrap .manfac-prod:hidden').wrapAll("<div class='viewmorelesswrapper'></div>");
            $('.viewmorelesswrapper').stop().slideDown();
            $(this).removeClass('formanuadding');
            $(this).removeClass('hashidden');
            $(this).addClass('formanuremoving');
        }else{
            $('.viewmorelesswrapper').stop().slideUp();
            $(this).removeClass('formanuremoving');
            $(this).addClass('formanuadding');
        }
        /* if ($(this).hasClass('hashidden')) {
            $('.manufac-prod-wrap .manfac-prod:hidden').addClass('hiddenspecs');
            $('.manufac-prod-wrap .manfac-prod:hidden').wrapAll("<div class='viewmorelesswrapper'></div>");
            $('.viewmorelesswrapper').stop().slideDown();
            $(this).removeClass('formanuadding');
            $(this).removeClass('hashidden');
            $(this).addClass('formanuremoving');
        } else {
            $('.viewmorelesswrapper').stop().slideDown();
            $(this).removeClass('formanuadding');
            $(this).addClass('formanuremoving');
        } */
        $(".manfac-viewoption").text($(".manfac-viewoption").text() == 'View Less' ? 'View All Features' : 'View Less');
        setTimeout(function () {
            onscrl();
        }, 300);
    });

    $('.formanuremoving').on('click', function () {
        $('.viewmorelesswrapper').stop().slideUp();
        $(this).removeClass('formanuremoving');
        $(this).addClass('formanuadding');
        $(".manfac-viewoption").text($(".manfac-viewoption").text() == 'View Less' ? 'View All Features' : 'View Less');
        scrolltoDivFtm();
        setTimeout(function () {
            onscrl();
        }, 300);
    });
    // manufacturer view more option END

    // UserRating view more option Start
    $('.user-ratings-viewoption').on('click', function () {
        if (displayFullReviewFlag) {
            if (callReviewApiFlag == false) {
                return false;
            } else {
                callReviewApiFlag = true;
            }
            if (this.textContent === "View Less") {
                $(".usr-cmnts-wrap").html("");
            }
            reviewTrigger(reviewPageNo);
        } else {
            displayFullReviewFlag = true;
            $('.usr-cmnts-wrap .usr-cmnts:hidden').wrapAll("<div class='usrrating-viewoptionwrapper'></div>");

            if (emiStoreApiData.get("reviewResponseData")) {
                reviewInitPage = emiStoreApiData.get("reviewResponseData").pages;
            }
            if (reviewInitPage > 1) {
                $(".user-ratings-viewoption").text('View More');
            } else {
                $(".user-ratings-viewoption").text('View Less');
            }
            $('.usrrating-viewoptionwrapper').slideToggle();
            // $(".user-ratings-viewoption").text($(".user-ratings-viewoption").text() == 'View Few Reviews' ? 'View all 5 reviews' : 'View Few Reviews');

            setTimeout(function () { onscrl(); }, 300);
        }
    });

    $(".foruseradding").text("View More");
    $('.foruseradding').on('click', function () {
        if ($(this).hasClass('hashidden')) {
            $('.usr-cmnts-wrap .usr-cmnts:hidden').addClass('hiddenspecs');
            $('.usr-cmnts-wrap .usr-cmnts:hidden').wrapAll("<div class='usrrating-viewoptionwrapper'></div>");
            // $('.usrrating-viewoptionwrapper').stop().slideDown();
            $(this).removeClass('foruseradding');
            $(this).removeClass('hashidden');
            $(this).addClass('foruserremoving');
        } else {
            // $('.usrrating-viewoptionwrapper').stop().slideDown();
            $(this).removeClass('foruseradding');
            $(this).addClass('foruserremoving');
        }
        // $(".user-ratings-viewoption").text($(".user-ratings-viewoption").text() == 'View Few reviews' ? 'View all reviews' : 'View Few reviews');
        if (window.innerWidth > 767) {
            $(".usr-cmnts-wrap > .usr-cmnts").eq(1).find('.user-rating').css('border-bottom', '1px solid #cecece');
        }
        if (window.innerWidth < 768) {
            $(".usr-cmnts-wrap > .usr-cmnts").eq(1).css('border-bottom', '1px solid #cecece');
        }
        setTimeout(function () {
            onscrl();
        }, 300);
    });

    $('.foruserremoving').on('click', function () {
        // $('.usrrating-viewoptionwrapper').stop().slideUp();
        $(this).removeClass('foruserremoving');
        $(this).addClass('foruseradding');
        // $(".user-ratings-viewoption").text($(".user-ratings-viewoption").text() == 'View Few reviews' ? 'View all reviews' : 'View Few reviews');
        if (window.innerWidth > 767) {
            $(".usr-cmnts-wrap > .usr-cmnts").eq(1).find('.user-rating').css('border-bottom', '0');
        }
        if (window.innerWidth < 768) {
            $(".usr-cmnts-wrap > .usr-cmnts").eq(1).css('border-bottom', '0');
        }
        setTimeout(function () {
            onscrl();
        }, 300);
    });

    // manufacturer view more option start

    // jquery to remove
    // vas click jquery start
    $('.vas-selectbutton').on('click', function () {
        var select_btn = $(this, '.vas-selectbutton');
        if ($(this).hasClass("selected")) {
            $(this).removeClass("selected");
            selectedvasproduct = selectedvasproduct - 1;
            var vascurrentprice = parseInt(($(this).siblings('.vas-pricing').children('.vasprod-currentprice').html()).split(',').join(''));
            totalVasCostlimit = totalVasCostlimit - vascurrentprice;
            totalproducts = totalproducts - 1;
            $('.obreak-item-number').text(totalproducts);
            if ($('.overallbreakupdiv').length) {
                allproductoverallcost();
            }

        } else {
            var vascurrentprice = parseInt(($(this).siblings('.vas-pricing').children('.vasprod-currentprice').html()).split(',').join(''));
            if (totalVasCostlimit <= totalVasCostlimitmax) {
                totalVasCostlimit = totalVasCostlimit + vascurrentprice;
                if (totalVasCostlimit > totalVasCostlimitmax) {
                    totalVasCostlimit = totalVasCostlimit - vascurrentprice;
                    $('.vasmax-pop-up').addClass('popactive');
                    $('.vasmax-pop-up').children().addClass('activepopup');
                    $('body').addClass('noscrollbody');
                } else {
                    totalproducts = totalproducts + 1;
                    $(this).addClass("selected");
                    selectedvasproduct++;
                }


            }

            $('.obreak-item-number').text(totalproducts);

            if ($('.overallbreakupdiv').length) {
                allproductoverallcost();
            }
            if (selectedvasproduct == 1 || totalVasCostlimit < 500) {
                if ($(this).hasClass("selected")) {
                    $('.vasmin-pop-up').addClass('popactive');
                    $('.vasmin-pop-up').children().addClass('activepopup');
                    $('body').addClass('noscrollbody');
                }
            }


        }
    });
    // vas click jquery END

    // Vasmax Pop button jquery start 
    $('.vasmax-buttondiv .btn_orange').on("click", function () {
        $(this).parents('.modal-inner-wrap').find('.action-close').trigger("click");
    })
    // Vasmax Pop button jquery END 

    // Vasmin Pop up button jquery start 
    $('.vas-withoutitem').on("click", function () {
        $(".vas-selectbutton").removeClass('selected');
        $(this).parents('.modal-inner-wrap').find('.action-close').trigger("click");
        selectedvasproduct = 0;
        totalVasCostlimit = 0;
        if ($('.overallbreakupdiv').length) {
            allproductoverallcost();
        }
    })

    $('.vas-addmoreitem').on("click", function () {
        $(this).parents('.modal-inner-wrap').find('.action-close').trigger("click");
    })
    // Vasmin Pop up button jquery END 
    //description show more show less start
   
    var productDescContent = $(".prod-descrp-txt").text().length;
    if (productDescContent < 340) {
        $(".viewall-event").addClass("dsp-none");
    } else {
        $(".viewall-event").removeClass("dsp-none"); 
    $(".prod-descrp-txt").text(productDescContent.slice(0, 385) + "...");
    $(".viewall-event").addClass("viewmore")
    $(".viewall-event").text("View More");
    $(".viewall-event").on("click", function () {
        if ($(this).hasClass("viewmore")) {
            $(".prod-descrp-txt").text(productDescContent);
            $(".viewall-event").removeClass("viewmore")
            $(".viewall-event").addClass("viewless")
            $(".viewall-event").text("View less");
        } else {
            $(".prod-descrp-txt").text(productDescContent.slice(0, 385) + "...");
            $(".viewall-event").removeClass("viewless")
            $(".viewall-event").addClass("viewmore")
            $(".viewall-event").text("View More");
        }
    })
}
    // wishlist icon jquery start
    $('.added-wishlist-icon img').on('click', function () {
        if (__is_loginUSer()) {
            // $('.loginpopup').hide();
            showPopup(false);
            // $(this).parent().removeClass('active').next().addClass('active');
            if ($(this).parent().hasClass("active")) {
                api.removeWishList();
            } else {
                callToWishlist();
            }
        } else {
            // $(".select_card").hide();
            // $('.login-type-after').css('display', 'none');
            // $(".verify_otp").hide();
            // $(".leavels_otp").show();
            // $('.loginpopup').show();
            showPopup("show-mobile");
        }
        add_WishList_Click_Datalayer_PDP(); //wishListDataLayer call
    });
    $('.nonadded-wishlist-icon i').on('click', function () {
        window.location.replace(testUrl + "/wishlist/");
    });
    // wishlist icon jquery END

    // BWE Exchange popup Jquery Start

    $('.categoryoption-select, .brandoption-select, .productoption-select').on('change', function () {
        var selectonevalue = $(".categoryoption-select").val();
        var selecttwovalue = $(".brandoption-select").val();
        var selectthirdvalue = $(".productoption-select").val();
        if ((selectonevalue == "") && (selecttwovalue == "") && (selectthirdvalue == "")) {
            $('.BWE-actiondiv').removeClass('makevisible');
        } else {
            $('.BWE-actiondiv').addClass('makevisible');
        }
    });


    $(".bwe-Keep-product").on("click", function () {
        $(this).parents('.modal-inner-wrap').find('.action-close').trigger("click");
    });

    /*CDExchange remove button event */
    $("#BWE-remove-pop-up-cdexchange .bwe-remove-product").on("click", function () {
        $("#BWE-remove-pop-up-cdexchange").find('.modal-inner-wrap').find('.action-close').trigger("click");
        callToRemoveCdExchange();
    });

    // BWE Exchange popup Jquery END

    $('.sellerfixedbutton').on('click', function () {
        if ($('.moreseller-pop-up').length) {
            changeseller();
        }
    });

    /*=============================================
    =  JS 3-05-2019 - 3:55 PM - instacheck jquery  =
    =============================================*/
    $(".insta-viewless").on("click", function () {

        $(".viewless-wrapper").slideToggle();
        $(this).children('img').toggleClass("lessview");
        $('.togglerslidep').text($('.togglerslidep').text() == 'View Less' ? 'View More' : 'View Less');


    });

    $(".instacheck-innerwrapper .closepopimg img").on("click", function () {
        $('.instacheck-popup').addClass("instacheck-pop-hide");
        $("body").removeClass("noscrollbody");
        $('#pdp-nwschemedetails').addClass('show');
        $('#scheme-table').removeClass('show');
        $('.pdp-chscheme-btn-fn').show();
    });
    $(".promocodeQue").on("click", function () {
        $(".promocodescreen1").addClass('hidepromocodescreen');
        $(".promocodescreen2").removeClass('hidepromocodescreen');
    });
    $(".promocode-apply-button").on("click", function () {
        $(".promocode-apply-button-text .page-loader-circle").addClass("right-circle");
        // $(".promocodescreen2").addClass('hidepromocodescreen');
        // $(".promocodescreen3").removeClass('hidepromocodescreen');
    });

    $('.instacheck--Insurance-policy--div .vas-prodcheckbox').on('click', function () {
        var instapolicyID = $(this).parents(".instacheck--Insurance-policy--div").attr('instafonesafeid');
        if ($(this).hasClass("selected")) {
            $(this).removeClass("selected");

        } else {
            $(this).addClass("selected");
        }
        // calcEMIDetails();
    });
    /*=============================================
    =            END                              =
    =============================================*/
});

window.addEventListener('DOMContentLoaded', function () {
    function goToByScroll(id) {
        id = id.replace("link", "");
        $('html,body').animate({
            scrollTop: $("." + id).offset().top - 150
        },
            'slow');
    }

    $(".shifttodiv").click(function (e) {
        // var id = this.attr.divscroll;
        var id = $(this).attr("data-divscroll");
        scrollToDiv(id);
    });
    function scrollToDiv(id) {
        var headerHeight = $(".bfs-header-wrap").outerHeight();
        var divHeight = $("#" + id).offset().top;
        window.scrollTo(0, divHeight - headerHeight);
    }
    function goToSpecificationByScroll(id) {
        id = id.replace("link", "");
        $('html,body').animate({
            scrollTop: $("#" + id).offset().top - 50
        },
            'slow');
    }

    // Scroll function end

    //==========================
    //=   Document Ready start =
    //==========================


    $(".emi-pop-up-table-content.firstColumn").on("click", function (e) {
        $('.emi-pop-up-table-content-data').find('input').removeAttr('checked');
        $(this).find('input').attr('checked', 'checked');
        $('.customCheckbox').removeClass("customCheckboxChecked");
        $(this).parents('.emi-pop-up-table-content-wrap').find('.customCheckbox').addClass('customCheckboxChecked');
        absolutediscountcalculation();
        e.stopPropagation();
    });

    // if ($('.single-product-information').length) {
    //     $('body').css('margin-bottom', '45px');
    // }
    if (window.matchMedia("(max-width: 766px)").matches) {
        if ($('.single-product-information').length) {
            $('body').css('margin-bottom', '45px');
        }
    }else{
        if ($('.single-product-information').length) {
            $('body').css('margin-bottom', '0px');
        }
    }
    // out of stock button visibility handle start
    $('.outofstock-emailinputsdiv input, .outofstock-mobileinputsdiv input').on('keyup', function () {
        if ($(this).val() != '') {
            $('.outofstock-notifybtn .commonsubmitbutton').removeClass('pdpbtndisable');
        } else {
            $('.outofstock-notifybtn .commonsubmitbutton').addClass('pdpbtndisable');
        }
    });
    // out of stock button visibility handle END

    // Vertical Slick Slider start 
    $(".vertical-slider-div").css('opacity', '1');

    // Vertical Slick Slider END 

    // Single Image Slick Slider start 


    $(".single-image-slider").on('beforeChange', function (event, slick, currentSlide, nextSlide) {
        $('.single-image-slider .pdpslidervideo').attr('src', $('.single-image-slider .pdpslidervideo').attr('src'));
    });

    $(".image-slider-div").css('opacity', '1');
    // Single Image Slick Slider END

    if ($(".fonesafe-included-contentslider").hasClass("slick-initialized")) {
        $(".fonesafe-included-contentslider").slick("unslick");
    }
    // Protect Policy PACK Included Slick Slider Start 


    // Protect Policy PACK Included Slick Slider END 

    //rating is mandatory for submit btn logic 
    $(".ratestar").on("click", function () {
        if ($(".reviewSubmitBtn").hasClass("pdprev-disabled")) {
            $(".reviewSubmitBtn").removeClass("pdprev-disabled");
        }
    });
    //==========================
    //=   Document Ready END   =
    //==========================

    //==========================
    //=  Windows On Load start =
    //==========================




    /***Removed Code */

    $(".wrt-review, .faq-more").on("click", function () {
        $(".productdescmobdiv .imgparent img").attr("src", $(".pc-single-img").attr("src"));
        $(".productdescmobdiv .descpara p").html($(".info-prod-head").text());
    });

    var currentStar;
    /* 1. Visualizing things on Hover - See next part for action on click */
    $('.mainstar li').on('mouseover', function () {

        var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

        // Now highlight all the stars that's not after the current hovered star
        $(this).parent().children('li.ratestar').each(function (e) {
            if (e < onStar) {
                $(this).addClass('hover');
            } else {
                $(this).removeClass('hover');
            }
            if (onStar == 1) {
                $('.wr-rated-str-section p').text('Poor');
            }

            if (onStar == 2) {
                $('.wr-rated-str-section p').text('Fair');
            }

            if (onStar == 3) {
                $('.wr-rated-str-section p').text('Average');
            }

            if (onStar == 4) {
                $('.wr-rated-str-section p').text('Good');
            }

            if (onStar == 5) {
                $('.wr-rated-str-section p').text('Excellent');
            }
        });

    }).on('mouseout', function () {
        $(this).parent().children('li.ratestar').each(function (e) {
            $(this).removeClass('hover');

            if (currentStar == 1) {
                $('.wr-rated-str-section p').text('Poor');
            }

            if (currentStar == 2) {
                $('.wr-rated-str-section p').text('Fair');
            }

            if (currentStar == 3) {
                $('.wr-rated-str-section p').text('Average');
            }

            if (currentStar == 4) {
                $('.wr-rated-str-section p').text('Good');
            }

            if (currentStar == 5) {
                $('.wr-rated-str-section p').text('Excellent');
            }

            if (!currentStar) {
                $('.wr-rated-str-section p').text('');
            }

        });
    });


    /* 2. Action to perform on click */
    $('.mainstar li').on('click', function () {

        var onStar = parseInt($(this).data('value'), 10); // The star currently selected
        var stars = $(this).parent().children('li.ratestar');



        for (i = 0; i < stars.length; i++) {
            $(stars[i]).removeClass('selected');
        }

        for (i = 0; i < onStar; i++) {
            $(stars[i]).addClass('selected');
        }

        if (onStar == 1) {
            $('.wr-rated-str-section p').text('Poor');
        }

        if (onStar == 2) {
            $('.wr-rated-str-section p').text('Fair');
        }

        if (onStar == 3) {
            $('.wr-rated-str-section p').text('Average');
        }

        if (onStar == 4) {
            $('.wr-rated-str-section p').text('Good');
        }

        if (onStar == 5) {
            $('.wr-rated-str-section p').text('Excellent');
        }

        currentStar = $('.ratestar.selected').length;

    });

    // validation start

    $('.writereview-sbmt').on('click', function () {
        $('#writereview-pop-up').removeClass('popactive');
        $('#writereview-pop-up').children().removeClass('activepopup');
        $('body').removeClass('noscrollbody');
            callToWriteReview();
    })
    
    function bizopenWriteReview(callBack){
        $(".review-login-event").click();
        callBack();
    };
    biz.OpenWriteReview = bizopenWriteReview

    // validation END

    // request expert call start
    $('.gtExprtCl-numIP').on('keyup', function () {
        if (($(this).val() != '') && ($(this).val().length == 10)) {
            $('.gtExprtCl-request-pop-content .gtExprtCl-btn').removeClass('pdpbtndisable');
        } else {
            $('.gtExprtCl-request-pop-content .gtExprtCl-btn').addClass('pdpbtndisable');
        }
    });
    // request expert call END

    // validation END

    $('.commonsubmitbutton').on('click', function () {
        $(this).siblings('.commonsubmitanchhor').trigger('click');
    });


    /* Aditya || 11-05-2019 || 15:15 PM || START */

    // faq thumb jquery start
    $(".upthumb").on("click", function () {
        $(this).next().find(".fa-thumbs-o-down").removeClass("thumbs-active");
        $(".fa-thumbs-o-up", this).toggleClass("thumbs-active");
    });


    $(".downthumb").on("click", function () {
        $(this).prev().find(".fa-thumbs-o-up").removeClass("thumbs-active");
        $(".fa-thumbs-o-down", this).toggleClass("thumbs-active");
    });


    $('#productyoutubevideo').on('click', function (e) {
        e.preventDefault();
        var source = $(this).attr('href');
        $('.youtubevideoiframe').attr('src', source);
        $('#openvideopopup').addClass('popactive');
        $('#openvideopopup').children().addClass('activepopup');
        $('body').addClass('noscrollbody');
    });
    //scroll function call
    $(".movetoratings").click(function (e) {

        e.preventDefault();

        goToByScroll($(this).attr("id"));
    });
    $(".movetospecification").click(function (e) {

        e.preventDefault();

        goToSpecificationByScroll($(this).attr("id"));
    });
    //scroll function call end

    // Close PopUp - Start
    $(".closepopimg").on("click", function () {
        $(".pop-up").removeClass("popactive");
        $("body").removeClass("noscrollbody");
        $(".pop-up").children().removeClass('activepopup');
        if ($(".seller--outofstock--message").hasClass("seller--hideElement") == false) {
            $(".seller--outofstock--message").addClass("seller--hideElement").siblings().show();
        }
        $('.instacheck-popup').addClass('instacheck-pop-hide');
    });

    $("body").click(function(e){
        if($(e.target).hasClass("ft-black") || $(e.target).parents().hasClass("ft-black")){
            console.log("");
        }else{
            $('.tnCtooltip').addClass('dsp-none');
        }
    });
    $(".closepopimg-new-desktop").on("click", function () {
        $(".pop-up").removeClass("popactive");
        $("body").removeClass("noscrollbody");
        $(".pop-up").children().removeClass('activepopup');
        if ($(".seller--outofstock--message").hasClass("seller--hideElement") == false) {
            $(".seller--outofstock--message").addClass("seller--hideElement").siblings().show();
        }
        $('.instacheck-popup').addClass('instacheck-pop-hide');
    });
    $('.modal-popup,#moreseller-pop-up,#EMI-pop-up,#installcharge').click(function (e) {
        if (e.target == e.currentTarget) {
            $(".pop-up").removeClass("popactive");
            $("body").removeClass("noscrollbody");
            $(".pop-up").children().removeClass('activepopup');
            if ($(".seller--outofstock--message").hasClass("seller--hideElement") == false) {
                $(".seller--outofstock--message").addClass("seller--hideElement").siblings().show();
            }
        }

    });
    // Close PopUp End
    if (window.innerWidth > 768) {
        $(".instacheck-innerwrapper").on("click", function (e) {
            e.stopPropagation();
        });
        $(".instacheck-popup").on("click", function (event) {
            event.stopPropagation();
            if (!($(event.currentTarget).hasClass("instacheck-pop-hide"))) {
                $(this).addClass("instacheck-pop-hide");
                $("body").removeClass("noscrollbody");
            }
        });
    }




    /************ Web Share Api Start ***********/
    var currUrl = location.origin + location.pathname;
    var shareapiconf = {
        title: document.title,
        text: document.title,
        url: currUrl,
    };
    var btn = document.querySelector('.shareIcon');
    if (btn) {
        btn.addEventListener("click", function (e) {
            e.preventDefault();
            if (navigator.share) {
                navigator.share(shareapiconf)
                    .then(function () {
                    }).catch(function () {
                    });
            } else {
                console.warn(" web share api not supported ");
            }
        });
    }
    /************ Web Share Api End ***********/

    /************ call Me function start ***********/

    function showExprtCallRequestPop() {

        $("#getExpertCall").addClass('popactive');
        $("#getExpertCall").find('.modal-popup').addClass('activepopup');
        $('body').addClass('noscrollbody');

        // var cookieString = decodeURIComponent(readCookie("perpetual_session")).split("|");
        var mobileno = __get_perpetual_session("mobile_number");
        emiStoreApiData.set("sendmobileotp", mobileno);
        //var mobileNo =  $("#mobile").val() ?  $("#mobile").val(): $("#loginformMobileIP").val();
        var mobileNo = emiStoreApiData.get("sendmobileotp");
        $("#mobileNO").val(mobileNo).trigger('keyup');
    }

    /************ call Me function End ***********/
    /**************New instacheckpopup Js Start********/
    $(".pd-otp-fn").on("input", function () {

        if ($(this).val().length === 6) {
            $(this).parents(".pd-prodotp-form-w").find(".placeorder-submit-btn").removeClass("pd-disabled");
            $(this).parent().removeClass("pd-incorrect");
        } else {
            // $(this).parent().addClass("pd-incorrect");
            $(this).parents(".pd-prodotp-form-w").find(".placeorder-submit-btn").addClass("pd-disabled");

        }
    })

    /**************New instacheckpopup Js End********/

    /* PDP New Changes - 29-09-2020 - START */



    /************Registered Address POPup close function Start **************************/
    $(".popup-op").on("click", function () {
        $('body').addClass('noscrollbody');
        var popup = $(this).attr("data-popup");
        $("#" + popup).addClass("showpopup");
        showSellerSel(true);
        var selectedSellerSellerID = $("#defaultSelectedSeller").find("input").attr("data-sellerId");
        if ($("#storeVisitSelector").hasClass("selected")) {
            $("#store").find("input").prop("checked", false);
            $('[data-list="store"]').click()
            $("#store").find("input[data-sellerId='" + selectedSellerSellerID + "']").prop("checked", true);
        }
        dlViewMoreSellers();
        $('body').addClass('overflow-hidden');
    });

    $(".popup-close").on("click", function () {
        $('body').removeClass('noscrollbody');
        $(".pdp-modal-overlay").removeClass("showpopup");
        dlCrossIcon()
        isModalOpen = false;

    });
    $(".cross-icon-div-var-pop").on("click",function(){
        $("body").removeClass("overflow-hidden");
    });
    $(".pdp-model-pop-up").on("click",function(){
        $("body").removeClass("overflow-hidden");
    });

    $(".pdpdevlbtn-fn").on("click", function () {
        $(this).addClass("selected").siblings().removeClass("selected");
        var displayList = $(this).attr("data-list");
        $("#store").attr("data-toggle", "show").siblings().attr("data-toggle", "hide");
    });

    /* $(".pdp-delv-btns").on("click", function () {
        $(this).addClass("selected").siblings().removeClass("selected");
    }); */

    /* PDP New Changes - 29-09-2020 - END */
    if (matchMedia("(max-width: 767px)").matches) {
        $(".pdp-modal-overlay").on("click", function (e) {
            if (e.target == e.currentTarget) {
                $(this).removeClass("showpopup");
                $('body').removeClass('noscrollbody');
            }
        });
    } else {
        $(".pdp-modal").on("click", function (e) {
            if (e.target == e.currentTarget) {
                $(this).parent().removeClass("showpopup");
                $('body').removeClass('noscrollbody');
            }
        });
    }

    /************Registered Address POPup close function End **************************/
    /* InstaCheck Popup - Scheme Changes - 15-10-2020 - START */

    $(".pdp-chscheme-btn-fn").on("click", function () {
        changeEMISchemeclick();
        var toShow = $(this).attr("data-show");
        $("#" + toShow).addClass("show").siblings().removeClass("show");
        $(this).hide();
    });

    /* InstaCheck Popup - Scheme Changes - 15-10-2020 - END */

    /* Non-BFL USER POP START */
    $(".pdp-og-btn").on("click", function (e) {
        // $("#noemicard-popup").removeClass("showpopup");
        showNTBHelloUser(false);
    })
    /* Non-BFL USER POP END */
});
$('.pre-order-dl-event').on('click', function () {
    var modelid = $(this).attr("data-model-id")
    //preOrderCTADataLayer();
    dlPreBookPreOrder("Pre-Order-Now", modelid);
});

/****************************** Compare Similar Product Datalayer click event start  ******************************/
function CompareSimilarProductEvent() {
    $('.pdprev-cmpprods-event').on('click', function (e) {
        e.stopPropagation();
        var clickedProductName = $(this).attr("skuName");
        var productId = $(this).attr("entityID")
        productId = productId ? parseInt(productId) : "";
        dlCompareSimilarProduct(clickedProductName, productId);
    })
    $('.compare-buynow-event').on('click', function(){
        //dlbuynowclick();
        var url = $(this).parents('.pdprev-cmpprods-tdimg-ct').children().find('a').attr('href');
        $(this).css({'opacity':'0.5', 'pointer-events': 'none'})
        localStorage.setItem('compareBuynowClick',true)
        location.href = url;
    })
}

/****************************** Compare Similar Product Datalayer click event End ********************************/

/****************************** PRICE BREAKUP POPUP JS START ********************************/
    //On price breakup click
  /*   $('.price-brkup-hmevt').click(function(){
        $('#price-bk-popup').removeClass('dsp-none');
    }) */
    // Close Popup on click
    $('.modal-close-hmevt').on('click', function () {
        $(this).parents('.modal-bg-overlay:first').addClass('dsp-none');
    })
    // Close Popup on Background Click
    $('.modal-container-hmevt').on('click', function (e) {
        if (e.target == e.currentTarget) {
            $(this).parents('.modal-bg-overlay:first').addClass('dsp-none');
        }
    })
/****************************** PRICE BREAKUP POPUP JS END ********************************/




var flagOfpdpApiSuccess = false;
var isProductOutOfStock = false;
var onChangeSellerID = "";
var onChangeSellerIndex = 0;
var flagisUrlSellerNotAvailable = true;
var encodeSellerId = "";
var schemesID = "";
var productData = {};
var reqObj = {};
var selectedSchemeDataOnPdp = {
    schemeId: '',
    emi: '',
    downPayment: '',
    tenure: '',
    SchemeIRR: '',
    schemeRoi: '',
    SchemeLtvPercentage: ''
};
var test2= " ";
var insurancePriceDifference = "";
var reviewPageNo = 2;
var updateSeller = false;
var skuName = $('meta[name="productSku"]').attr("content");
var schemesIdNotFound = false;
var availableOptionsFlag = true;
var setSellerListCallFlag = true;
var selectaddressCalledDL = false;
var selectaddressCountForDl = 0;
var setSellerListFunctionFlag = true;
var selectedSchemeEWFlag=true;
var selectAddressDefaultdealerOnload;
/* sellerList popup for popup open to set a flag */
var sellersListPopUpFlag = false;
/* sellerList popup for popup open to set a flag */
if(emiStoreApiData){
    emiStoreApiData.set("offerprice", "");
}
var installationChargesData = {};
var extendWarrantyCallFlag2W = true
/*promise call*/
/*book now button insurance flag*/
var bookNow2wextendWarr =true;
var distanceObj = {};
var cIdAvailnUrl = false;
var compareDealers

function readCookie(name) {
    return (name = new RegExp('(?:^|;\\s*)' + ('' + name).replace(/[-[\]{}()*+?.,\\^$|#\s]/g, '\\$&') + '=([^;]*)').exec(document.cookie)) && name[1];
}
function updateCookiesCIDAvail() {
    if (isURLQueryKeyAvailable("cid")) {
        var urlParam = atob(urlParams.cid);
        var cityName = urlParam.split('|')[0].split('').reverse().join('');
        var cityId = urlParam.split('|')[1].split('_')[0].split('').reverse().join('')
        setCookie("selected_city", cityId, 90);
        setCookie("selected_city_name", cityName, 90);
        cIdAvailnUrl = true;
    }
}
function productPageLoadData() {
    updateCookiesCIDAvail();
    var url = new URL(window.location.href);
    var cityId = url.searchParams.get("cid")
    var sellerId = url.searchParams.get("sid")
    var encodeCityId = reverseStr(atob(cityId).split("_")[0]).split("|")[0];
    var encodeSellerId = reverseStr(atob(sellerId).split("_")[0]);
    var selectedCity = readCookie("selected_city");
    onRoadCityTxtRender();
    if (cityId && selectedCity != encodeCityId) {
        document.querySelector("#popular_city_" + encodeCityId).click();
    }

    if (sellerId) {
        if (!cityId) {
            // cityId = parseInt(localStorage.getItem("cityId"));
            cityId = parseInt(readCookie("selected_city"));
            encodeCityId = parseInt(readCookie("selected_city"));
        }
        var url = testUrl + "/rest/V1/product/" + skuName.replace(/[.]/g, "@") + "/city/" + encodeCityId + "/seller/" + encodeSellerId;
        // var url ="https://bfsd.qa.bfsgodirect.com/emistore/rest/V1/product/AppleiPhone732GBBlack/city/13/seller/275007";
        sendApiRequest(
            "",
            url,
            bearerTokenConfig,
            "GET",
            pdpDataResponseHandler,
            "",
            "",
            false,
            ""
        );
    }
    else {
        var selector = "";
        if (!cityId) {
            cityId = parseInt(localStorage.getItem("cityId"));
        } else {
            if (cIdAvailnUrl) {
                cityId = encodeCityId;
            } else {
                cityId = encodeCityId;
                document.querySelector("#popular_city_" + encodeCityId).click();
            }
        }
        if(__is_loginUSer()){
			var dataMapping = _getDataMapping();
		    var customerToken = dataMapping.customerDetails.api.customerToken;
		    customerToken = customerToken ? customerToken : "";

            selector = ".pdp." + skuName.replace(/[.]/g, "@") + "." + cityId + ".json"+"?sscid="+customerToken;
        }else{
            selector = ".pdp." + skuName.replace(/[.]/g, "@") + "." + cityId + ".json";
        }
        sendApiRequest(
            "",
            "/content/emistoremarketplace/pdpdata",
            "",
            "GET",
            pdpDataResponseHandler,
            "",
            "json",
            false,
            selector
        );
    }
}
$(".buy-emi-btn").css({
    "pointer-events": "none",
    opacity: 0.7
});

function instabuy2WUrlCheck() {
    if(urlParams.hasOwnProperty("buynow") || localStorage.getItem('compareBuynowClick')){
        if(urlParams.buynow == "1" || localStorage.getItem('compareBuynowClick')){
            api.extendWarrantyOnLoad();
            extendWarrantyCallFlag2W = true;
            setTimeout(function(){
                $('.book-now-btn').click();
            },1000);
            localStorage.removeItem('compareBuynowClick');
        }
    }
}

/* Change seller */
function updateSellerDetails(that) {
    if ($(".seller--outofstock--message").hasClass("seller--hideElement") == false) {
        $(".seller--outofstock--message").addClass("seller--hideElement").siblings().show();
    }
    var deliverysellerlistitem = $(that).parents(".deliverysellerlistitem");
    var sellerid = $(deliverysellerlistitem).find("input").attr("data-sellerId");
    var sellerName = $(deliverysellerlistitem).find(".sellerName").text();
    var sellerOfferPrice = $(deliverysellerlistitem).find(".sellerOfferPrice").text();
    var deliveryType = $(".delivertypepop").find("button.selected").attr("data-list");
    productData.sellers.forEach(function (each, index) {
        if (each.SellerId == sellerid) {
            onChangeSellerIndex = index;
            selectedDeliverySeller = each;
            onChangeSellerID = selectedDeliverySeller.SellerId;
        }
    });
    var currseller = productData.sellers[onChangeSellerIndex];
    if (currseller.Schemes && currseller.Schemes.length) {
        schemesID = currseller.Schemes[0].SchemeId;
        schemesIdNotFound = false;
        $("[data-matchid='EMI-pop-up']").show();
        $(".emicost-line").hide();
        // $(".emicost-line").show();
        $(".absolute-discount-label").show();
    } else {
        schemesIdNotFound = true;
        schemesID = 0;
        $(".fonesafeEMI-div").hide();
        $(".fonesafeEMIduration-div").hide();
        $(".emicost-line").hide();
        $("[data-matchid='EMI-pop-up']").hide();
        $(".absolute-discount-label").hide();
    }
    onChangeSellerID = onChangeSellerID;
    onChangeSellerIndex = onChangeSellerIndex;
    //pdpSellerOptionCheckDataLayer();
    callProductDetails();
    moreEmiOptions();
    callSpecialOffer();
    deliveDate();
    // getDeliveryStatusBySeller(selectedDeliverySeller);
    toogleDefaultSellerSchemeOffer();
}
/*on moreEmiOptions Change */

//description rendering changes start

function productDescriptionChange(bodyType) {
    if ($(".information-heading-para").html().replaceAll(" ", "") == "" && (bodyType != "" || bodyType != null)) {
        bodyType = "<span style='text-transform:capitalize;'>" + bodyType.replaceAll("_", " ") + "</span>";
        var str = "";
        $(".gen-tab-cell").each(function(e){
            if($(this).find("span").attr("id") != undefined)
                $(this).find("span").attr("id",$(this).find("span").attr("id").replaceAll(" ","-"));
        });
        var productName = $(".info-prod-head").html() != undefined ? $(".info-prod-head").html() : "";
        var fueltype = $("#spec-id-Fuel-Type").html() != undefined ? $("#spec-id-Fuel-Type").html() : "";
        var milage = $("#spec-id-Mileage").html() != undefined ? $("#spec-id-Mileage").html() : "";
        var fuelCapacity = $("#spec-id-Fuel-Capacity").html() != undefined ? $("#spec-id-Fuel-Capacity").html() : "";
        var batteryCapacity = $("#spec-id-Battery-Capacity").html() != undefined ? $("#spec-id-Battery-Capacity").html() : "";
        var range = $("#spec-id-Claimed-Range").html() != undefined ? $("#spec-id-Claimed-Range").html() : "";
        if (fueltype == "Electric") {
            str = `${productName} is a ${bodyType} with ${range} range and ${batteryCapacity} battery capacity.`;
        } else {
            str = `${productName} is a ${bodyType} with ${milage} mileage and ${fuelCapacity} fuel capacity.`;
        }
        $(".information-heading-para").html(str);
    }
}

//description rendering changes stop

/* onCategory Change in cdExchange */


showPdpOnloadSkeleton(true);
function pdpDataResponseHandler(e, responseData) {
    try {
        var dataMapping = _getDataMapping();
        dataMapping.productDetails.api.onloadPDPData.response = responseData;
        dataMapping.productDetails.api.onloadPDPData.status = e;
        _setDataMapping(dataMapping);
    } catch (error) {
    }
    showPdpOnloadSkeleton(false);
    if (e) {
        flagOfpdpApiSuccess = true;
        productData = responseData;
        productDescriptionChange(productData.asset_type?productData.asset_type:"");
        if (productData.status == true) {
            emiStoreApiData.set("productAvailable", "");
            emiStoreApiData.set("asset_type", productData.asset_type);
        } else {
            localStorage.removeItem('compareBuynowClick');
            emiStoreApiData.set("productmrp", productData.mrp);
            $(".outofstock-pincode-sec").removeClass("dsp-none");
            $(".outofstock-pincode-sec").removeClass("dsp-none");
            $(".oos-prd-ofs").removeClass("dsp-none");
            $(".greyout-outofstock").addClass("pdprev-prdoutofstock-bl");
            $(".offers-foryou").addClass("dsp-none");
            $(".curr-view").addClass("dsp-none");
            $(".book-nw-btn").addClass("dsp-none")
            emiStoreApiData.set("productAvailable", "Out of Stock");
            var oldUrl = window.location.href.replace(".html/", ".html");
            var url = new URL(oldUrl);
            var aurivalue = url.searchParams.get("auri");
            var aparmsvalue = url.searchParams.get("aparms");
            if (aurivalue && aparmsvalue) {
                var newaparms = aparmsvalue.replace(/\|/g, "=").replace(/__/g, "&");
                var otherparams = oldUrl.split("&");
                var parameters = "";
                otherparams.forEach(function (parameter, index) {
                    if (index > 1) {
                        parameters = parameters + "&" + parameter;
                    }
                });
                window.location.href =
                    "/emi-store/" +
                    aurivalue +
                    ".html?" +
                    newaparms +
                    parameters;
            } else if (aurivalue) {
                window.location.href =
                    "/emi-store/" +
                    aurivalue +
                    ".html";
            }
            if (localStorage.getItem('reviewClicked')) {
                $(".write-review-event").click()
                localStorage.removeItem('reviewClicked')
            }
        }
        render.mattressCIC();
        callFunctionToPoluateProductData();
        // reviewAndRatingTrigger();
        callLoginPopupOffer();
        callGalleryData();
        //installationCharges();
        onRoadCityTxtRender()
        instabuy2WUrlCheck();
    }
}
function onRoadCityTxtRender(){
    var onRoadCity = $("#selectedCity").text().toLowerCase()
    onRoadCity = onRoadCity[0].toLocaleUpperCase() + onRoadCity.slice(1);   
    $(".rt-on-road-city").text(onRoadCity)
}

/*function for get Viewers*/
function getViewers() {
    var viewers = Math.floor(Math.random() * 20) + 40;
    $(".stock-status-label-green p span").text(viewers);
}
/*function for get Available Products*/
function getAvailableProduct() {
    var products;
    var productStock = parseInt($(".stock-status-label-red p span").html());
    if (isNaN(productStock)) {
        products = Math.floor(Math.random() * 10) + 20;
    } else {
        products =
            productStock <= 15
                ? productStock <= 6
                    ? productStock
                    : productStock - 1
                : productStock - 2;
    }
    $(".stock-status-label-red p span").text(products);
}

/*  Function For Formatting of Price  */
function formattedPrice(price) {
    return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

/*  Funtion To Calculate Rating In Percentage */
function calculateRatingPercentage(totalReview, rating) {
    return ((rating / totalReview) * 100).toString() + "%";
}

/*Function For productgallery start*/
var callGalleryData = function callFunctionToPopulateGalleryData() {
    var productImage = productData.product_images;
    if (productData.lowest_em_i) {
        var productDownpayment = productData.lowest_em_i[0].zero_downpayment;
    }
    productDownpayment == 1 ? $(".specialOfferdiv").find(".zrodwnpay").show() : $(".specialOfferdiv").find(".zrodwnpay").css('display', 'none');
};
/*Function For productgallery end*/

/*  Function For Product Details start */
var callProductDetails = function callFunctionToProductDetails() {
    var mrp = parseInt(productData.mrp);
    var lowestOfferPrice = parseInt(productData.sellers[onChangeSellerIndex].Offer.Price);
    /* var inStockProduct = productData.sellers[onChangeSellerIndex].Offer.Inventory;
    var stockText;
    var nudgeText = productData.nudge; 
    if (nudgeText) {
        stockText = nudgeText;
        $(".stock-text").text(stockText);
    } else if (inStockProduct <= 10 && inStockProduct > 0) {
        stockText = "Only  " + inStockProduct + " left in stock!";
        $(".stock-text").text(stockText);
        $(".stock-status").show();
        $(".rating-div-z").show();
    } else {
        if (inStockProduct > 10) {
            $(".stock-status").hide();
            $(".rating-div-z").hide();
        }
    } */
    emiStoreApiData.set("offerprice", lowestOfferPrice);
    var percentOff = Math.round(((mrp - lowestOfferPrice) / mrp) * 100);
    var warrentyData = productData.warrenty;
    var tooltip = warrentyData.tooltip != null ? '<span class="brand-warranty-text-more tooltiptest"><a href="#">Know More</a><i class="custtooltip">' + warrentyData.tooltip + "</i></span>" : "";
    $(".brand-logo-image img").attr("src", warrentyData.icon);
    $(".brand-warranty-text").html(warrentyData.text);
    $(".brand-warranty-text").append(tooltip);
    $(".absolute-discount-calc-mrp-price").text(formattedPrice(mrp));
    $(".absolute-discount-calc-offer-price").text(
        formattedPrice(lowestOfferPrice)
    );
    $(".absolute-discount-calc-offer-mrpprice").text(formattedPrice(mrp));
    $(".absolute-moneysaved").html(percentOff + "% ");
    //$(".absolute-discount-innpercent").html(percentOff + "% off");
    //$(".absolute-moneysaved").text(formattedPrice(mrp - lowestOfferPrice));
    $(".absolute-discount-calc-mrp-price-wrap").find(".absolute-discount-calc-mrp-price").text(formattedPrice(mrp));
    // downpayment === 1 ? $('.absolute-discount-calc-downpaymentvalue').text(0) : $('.absolute-discount-calc-downpaymentvalue').text(1000);
    getViewers();
    getAvailableProduct();
    if (mrp <= lowestOfferPrice) {
        $(".absolute-discount-calc-discount-green").hide();
        $(".absolute-discount-calc-highlight-green").hide();
        $(".absolute-discount-calc-discount-green-mob").hide();
        // $(".off-m-price").hide();
    }
    else if (mrp > lowestOfferPrice) {
        $(".absolute-discount-calc-discount-green").show();
        $(".absolute-discount-calc-highlight-green").show();
        // $(".off-m-price").show();
    }
    if (percentOff <= 0) {
        // $(".off-m-price").hide();
        $(".absolute-discount-calc-discount-green").hide();
        $(".absolute-discount-calc-highlight-green").hide();
        $(".absolute-discount-calc-discount-green-mob").hide();
    }
    setInterval(function () {
        var viewers = Math.floor(Math.random() * 20) + 40;
        $(".stock-status-label-green p span").text(viewers);
    }, 35000);
    setInterval(function () {
        var products;
        var productStock = parseInt($(".stock-status-label-red p span").html());
        if (isNaN(productStock)) {
            products = Math.floor(Math.random() * 10) + 20;
        } else {
            products = productStock <= 15 ? productStock <= 6 ? productStock : productStock - 1 : productStock - 2;
        }
        $(".stock-status-label-red p span").text(products);
    }, 3.43 * 1000 * 60);
};
/*  Function For Product Details end */

/*Function For sellerInformation start*/
var callSellerDetails = function callFunctionToPopulateSellerData() {


    var url = new URL(window.location.href);
    var sellerId = url.searchParams.get("sid");

    var productSeller = productData.sellers;
    var sellerCount = 0;
    var listOfliElements = "";
    // var prevSellectedCity = readCookie("selected_city");
    if (productData.lowest_offer_price) {
        var selectedSeller = parseInt(productData.lowest_offer_price[0].seller);
    }
    if (sellerId) {
        encodeSellerId = reverseStr(atob(sellerId).split("_")[0]);
    }

    flagisUrlSellerNotAvailable = true;
    productSeller.forEach(function (sellers) {
        var sellID = parseInt(sellers.SellerId);
        if (encodeSellerId == sellID) {
            selectedSeller = encodeSellerId;
            updateSeller = true;
            flagisUrlSellerNotAvailable = false;
        }
    })
    for (var x in productSeller) {
        sellerCount++;
        var liHtmlElements = "";
        var productSellerName = productSeller[x].SellerName.split("#")[0];
        var productSellerCity = productSeller[x].SellerName.split("#")[1] == "" ? "NA" : productSeller[x].SellerName.split("#")[1];
        var sellID = parseInt(productData.sellers[x].SellerId);
        //  var cityID = parseInt(productData.sellers[x].DeliveryCharges.city_id);
        var data = "'id': " + "'" + sellID + "'" + ", 'index': " + "'" + x + "'";
        var hashTag = "#";
        if (productSellerCity == undefined) {
            productSellerCity = "";
            hashTag = "";

        }
        if (selectedSeller == sellID) {
            $(".seller-title")
                .find(".seller-name")
                .text(productSellerName);
            $(".seller-title")
                .find(".seller-address")
                .text(productSellerCity);
            listOfliElements +=
                '<li class="moreseller-listitem clear-fix"> <span class="moreseller-popup-check-icon"><span class="moreseller-popup-check selected"></span></span> <span class="moreseller-details-wrap"><span class="moreseller-sellername" data-seller="{' +
                data +
                '}">' +
                productSellerName +
                '</span><span class ="cityNotDefined">' + hashTag + '</span><span class="moreseller-city">' +
                productSellerCity +
                "</span></span> </li>";

        } else {
            liHtmlElements +=
                '<li class="moreseller-listitem clear-fix"> <span class="moreseller-popup-check-icon"><span class="moreseller-popup-check"></span></span> <span class="moreseller-details-wrap"><span class="moreseller-sellername" data-seller="{' +
                data +
                '}">' +
                productSellerName +
                '</span><span class ="cityNotDefined">' + hashTag + '</span><span class="moreseller-city">' +
                productSellerCity +
                "</span></span> </li>";
            listOfliElements += liHtmlElements;
        }
    }




    $(".moreseller-sellerlist").html("");
    $(".moreseller-sellerlist").append(listOfliElements);
    $(".more-sellers").html(" " + sellerCount - 1 + " more Sellers");
    $(".moreseller-listitem").click(function () {
        $(this)
            .children(".moreseller-popup-check-icon")
            .find(".moreseller-popup-check")
            .addClass("selected");
        $(this)
            .siblings()
            .children(".moreseller-popup-check-icon")
            .find(".moreseller-popup-check")
            .removeClass("selected");
    });
    if (productData.sellers) {

        productData.sellers.length == 1
            ? $(".more-sellers")
                .parent("li")
                .hide()
            : $(".more-sellers")
                .parent("li")
                .show();
    }


};
/*Function For sellerinformation end*/

/*Product Rating Function Start*/
var callReviewSuccess = function () {
    var reviewResponseData = dataStoreUtility
        .getPDS("emiStore-PDP")
        .get("reviewResponseData");
    var reviewsAndRatings = reviewResponseData.reviews_and_rating;
    var ratingClass = {
        "1": "one-stars",
        "2": "two-stars",
        "3": "three-stars",
        "4": "four-stars",
        "5": "five-stars"
    };
    if (reviewResponseData.status === true) {
        $(".user-ratings-viewoption").show();
        if (reviewResponseData.pages >= reviewResponseData.current_page) {
            $(".user-ratings-viewoption").text('View More');
            var reviewDiv = "";
            reviewsAndRatings.forEach(function (reviewAndRating) {
                var varifiedStyle = reviewAndRating.verified_user != 1 ? "not-verified" : "verified-img";
                reviewDiv +=
                    '<div class="usr-cmnts clear-fix hiddenspecs"><div class="user-rating"><p></p><div class="cust-rating-wrap"><ul class="cust-star-rate ' +
                    ratingClass[reviewAndRating.rating_value] +
                    '"><li class="cust-stars"><i class="fa fa-star"></i></li><li class="cust-stars"><i class="fa fa-star"></i></li><li class="cust-stars"><i class="fa fa-star"></i></li><li class="cust-stars"><i class="fa fa-star"></i></li><li class="cust-stars"><i class="fa fa-star"></i></li></ul></div><span class="pipe"></span><span>' +
                    reviewAndRating.title +
                    "</span><p></p><p>" +
                    reviewAndRating.detail.replace('&#8629', '\n') +
                    '</p></div><div class="usr-id"><p>' +
                    reviewAndRating.nickname +
                    '</p><div  class="' +
                    varifiedStyle +
                    '"><img src="/content/dam/emistoremarketplace/index/pdppage/verifiedbuyerlogo.png">Verified  Buyer</div></div></div>';

            });
            if (reviewPageNo === 1) {
                $(".usr-cmnts-wrap").append(reviewDiv);
            } else {
                $(".usrrating-viewoptionwrapper").append(reviewDiv);
            }
            reviewPageNo++;
            if (reviewResponseData.has_next === false || reviewResponseData.current_page >= reviewResponseData.pages) {
                if (displayFullReviewFlag) {
                    $(".user-ratings-viewoption").text('View Less');
                } else {
                    $(".user-ratings-viewoption").text('View More');
                }
                reviewPageNo = 1;
            }
        } else {
            $(".user-ratings-viewoption").text('View Less');
            reviewPageNo = 1;
        }
    } else if (reviewResponseData.status === false) {
        $(".user-ratings-viewoption").hide();

    } else {
        $(".user-ratings-viewoption").hide();

    }


}
var displayRating = function () {
    try {
        var ratingData = dataStoreUtility.getPDS("emiStore-PDP").get("ratingData");
        var ratingClass = {
            "1": "one-stars",
            "2": "two-stars",
            "3": "three-stars",
            "4": "four-stars",
            "5": "five-stars"
        };
        if (ratingData.status == true && ratingData.star_rating_percent && ratingData.star_rating_percent.length) {
            $(".rating-div").show();
            $(".pdp-rating-main").show();
            var averageRating = ratingData.average_rating;
            var x=averageRating.toFixed(1);
            var last = x[x.length - 1]
            if(last == '0'){
                x=~~x;
            }
            averageRating = x;
            $(".star span").text(averageRating);
            $(".rev-star span").text(averageRating + '/5');
            $(".rating-value span").text(averageRating);

            $(".rating .totalrating").text(ratingData.rating_count);
            $(".rating-text span").html(
                "Based on " + ratingData.rating_count + " Ratings"
            );

            $(".rev").html(" " + ratingData.review_count + " reviews");
            if (ratingData.review_count > 0) {
                $(".user-ratings-viewoption").show();
            }
            if (ratingData.review_count < 0) {
                $(".user-ratings-viewoption").hide();
            }

            $(".rating-value-div")
                .find(".cust-star-rate")
                .removeClass()
                .addClass("cust-star-rate " + ratingClass[Math.round(averageRating)]);
            $(".excellent").css(
                "width",
                ratingData.star_rating_percent[0][5].toFixed(1) + "%"
            );
            $('.excellent').parent().next().text(Math.round(ratingData.star_rating_percent[0][5]) + " %");
            $(".good").css(
                "width",
                ratingData.star_rating_percent[0][4].toFixed(1) + "%"
            );
            $('.good').parent().next().text(Math.round(ratingData.star_rating_percent[0][4]) + " %");

            $(".avarage").css(
                "width",
                ratingData.star_rating_percent[0][3].toFixed(1) + "%"
            );
            $('.avarage').parent().next().text(Math.round(ratingData.star_rating_percent[0][3]) + " %");

            $(".poor").css(
                "width",
                ratingData.star_rating_percent[0][2].toFixed(1) + "%"
            );
            $('.poor').parent().next().text(Math.round(ratingData.star_rating_percent[0][2]) + " %");

            $(".very-poor").css(
                "width",
                ratingData.star_rating_percent[0][1].toFixed(1) + "%"
            );
            $('.very-poor').parent().next().text(Math.round(ratingData.star_rating_percent[0][1]) + " %");

        } else if (ratingData.status == false) {
            $(".rating-div").hide();
            $(".pdp-rating-main").hide();
            if (ratingData.review_count < 0) {
                $(".user-ratings-viewoption").hide();
            }

        } else {
            $(".rating-div").hide();
            $(".pdp-rating-main").hide();
            if (ratingData.review_count < 0) {
                $(".user-ratings-viewoption").hide();
            }
        }
    } catch (err) {
        console.error(err);
    }
};



function ratingTrigger() {
    var productID = parseInt($('meta[name="entityID"]').attr("content"));
    var modelId = productData.id;
    var reqObj = {
        "product_type":"2w"
    }
    sendApiRequest(
        reqObj,
        baseUrl + "/rest/V1/ratings/product/" + productID + "/model/" + modelId,
        bearerTokenConfig,
        "POST",
        displayRatingSuccess,
        "",
        "json"
    );
}

//user rating update
function userRatingUpdate(_star,count){
    star=parseFloat(_star);
    cutStar=(star + "").split(".")[1];
    wholeStar=Math.floor(star);
    starHtml="";
    var starname=(cutStar != undefined) ? wholeStar + 1 : wholeStar;
    switch(starname){
      case 1: starname="one"; break;
      case 2: starname="two"; break;
      case 3: starname="three"; break;
      case 4: starname="four"; break;
      case 5: starname="five"; break;
    }
    starHtml += `<div class=img-rating><img src=/content/dam/emistoremarketplace/index/emi-mall-dam/new-review-rating/${starname}-star-color.svg ></img></div>`.repeat(wholeStar);
    if (cutStar != undefined) {
        wholeStar += 1;
        cutStar = (10 - cutStar) * 2.8 + 1;
        styl = "style=' clip-path: inset(2px " + cutStar.toString() + "px 0px 1px)'";
        starHtml += "<div class=img-rating><img " + styl + " src=/content/dam/emistoremarketplace/index/emi-mall-dam/new-review-rating/" + starname + "-star-color.svg ></img></div>";
        starHtml += `<div class=img-rating><img src=/content/dam/emistoremarketplace/index/emi-mall-dam/new-review-rating/star${wholeStar}.svg ></img></div>`.repeat(5 - wholeStar);
    } else {
        starHtml += `<div class=img-rating><img src=/content/dam/emistoremarketplace/index/emi-mall-dam/new-review-rating/star${wholeStar}.svg ></img></div>`.repeat(5 - wholeStar);
    }
      
    $(".rating-img").html(starHtml);
    $(".taotal-num-txt").html(star);
    $(".based-rating-txt-div").find("span").html("Based on "+count+" ratings");
    $(".img-rating").css("background-image","url("+domainUrl+"/content/dam/emistoremarketplace/index/emi-mall-dam/new-review-rating/star"+wholeStar+".svg)");
  }



function displayRatingSuccess(status, response) {
    // status = true;
    // response = {
    //     "review_count": 200,
    //     "rating_count": 2,
    //     "star_rating_counts": [
    //         {
    //             "1": 0,
    //             "2": 0,
    //             "3": 0,
    //             "4": 4,
    //             "5": 16
    //         }
    //     ],
    //     "star_rating_percent": [
    //         {
    //             "1": 10,
    //             "2": 20,
    //             "3":30,
    //             "4": 50,
    //             "5": 100
    //         }
    //     ],
    //     "average_rating": 4.8,
    //     "average_buying_rating": 3.4,
    //     "average_loan_rating": 2.4,
    // };

    if (status) {
        $('.submenu-text_review_tab').removeClass('dsp-none');
        if (response.rating_count) {
            var avg_rating = response.average_rating ? response.average_rating : "";
            var dataMapping = _getDataMapping();
            dataMapping.productDetails.review = avg_rating;
            _setDataMapping(dataMapping);
            renderDealerComparision(compareDealers);
            biz.setFloatingMenu();//FLOATING MENU RENDER

            if ($(".given-rating-review-div").length > 1) {                
               $(".rating-with-review").removeClass("i-dsp-none");
            } else {                
                $(".rating-no-review").removeClass("i-dsp-none");
            }
            $(".pr-gallery-ratings").find(".rev-star").find("span").html(response.average_rating+"/5");
            
            var allStartDiv = Array.from($('.rating-bar-size-div').find('.color-bar-div')).reverse();
            var starPercentArray = response.star_rating_percent[0];
            Object.keys(starPercentArray).forEach((each) => {
                $(allStartDiv[each - 1]).css('width', starPercentArray[each] + '%');
                $(allStartDiv[each - 1]).closest(".rating-num-img-bar").find(".percent-div").text(starPercentArray[each] + '%');
            });

            var allStartDiv = Array.from($('.rating-bar-mn-div').find('.color-bar-div')).reverse();
            var starPercentArray = response.star_rating_percent[0];
            Object.keys(starPercentArray).forEach((each) => {
                $(allStartDiv[each - 1]).css('width', starPercentArray[each] + '%');
                $(allStartDiv[each - 1]).closest(".rating-num-img-bar").find(".percent-div").text(starPercentArray[each] + '%');
            });

            $(".num-out-txt").text(response.average_rating);
            $(".prod-exp-rating").text(response.average_rating + "/5");
            $(".buy-exp-rating").text(response.average_buying_rating+ "/5");
            $(".loan-exp-rating").text(response.average_loan_rating+ "/5");
            userRatingUpdate(response.average_rating,response.rating_count);

        } else { 
            $(".pr-gallery-ratings").addClass("i-dsp-none");
            $(".user-rating-component").removeClass("i-dsp-none"); 
            $(".present-review-n-rating-div").addClass("i-dsp-none");
            $(".view-more-btn-r").addClass("i-dsp-none");
        }
    }
    else {
        $(".new-review-rating-parent-div").addClass("i-dsp-none");
        $('.submenu-text_review_tab').addClass('dsp-none');
        $(".new-review-rating-parent-div").remove()
    }
}
/*Product Rating Function End*/

/*Function For product moreEmiOptions start*/
var moreEmiOptions = function callToMoreEmiOptions() {
    // schemesID = productData.lowest_offer_price[0].scheme;
    var onLoadSchemeRoi;
    schemesID = productData.sellers[onChangeSellerIndex].Schemes[0].SchemeId
    var moreEmiOptionHtml = "";
    var schemeScoreOrder = productData.sellers[onChangeSellerIndex].Schemes;
    var promoByPassFlag = productData.sellers[onChangeSellerIndex].Bypass_promo__c ? productData.sellers[onChangeSellerIndex].Bypass_promo__c : "";
    var price = productData.sellers[onChangeSellerIndex].Offer.Price;
    var scheme = [];
    scheme = schemeScoreOrder;
    var emiPriceArray = [];
    var monthArray = [];
    var downPaymentPrice = [];
    var asset_category = "";
    var ltvSmallerScheme = [];
    var ltvGreaterScheme = [];
    var priceBreakupTwowPdp = [];
    var assetCategoryC=[];
        var schemeWith0Dp = [];
        var schemeWithNot0Dp = [];
        var allScheme = [];
        var allNonZroSchemeArr = [];
        var allSortedNonZeroScheme = [];
        var allZroDpSchemeFlag = false;
        var lowestSchemeArr = [];
        var caseFourAllSortedArr = [];
        var caseFourFlag = false
        var caseFourMixedAllSortedArr
        var caseFourMixedFlag = false

    
        for (var eachInnerScheme in scheme) {
            if(eachInnerScheme == 0 ){
                onLoadSchemeRoi = scheme[eachInnerScheme].SchemeIRR
            }
             eachAssetCategory = scheme[eachInnerScheme].Asset_Category__c;
            assetCategoryC.push(eachAssetCategory);
            var offerSchemeId = scheme[eachInnerScheme].SchemeId;
            var advance = scheme[eachInnerScheme].EMI;
            var tenur = scheme[eachInnerScheme].NetTenure;
            monthArray.push(tenur);
            var processFee = scheme[eachInnerScheme].ProcessingFee
            var schId = scheme[eachInnerScheme].SchemeId;
            var emi = advance;
            emiPriceArray.push(emi);
            var processStyle = (processFee > 0) ? '' : 'dsp-none';
            var downpayment = scheme[eachInnerScheme].Downpayment;
            downPaymentPrice.push(downpayment);
            var totalcost = price;
            var specialClass = ""
            var borderClass = ""
            var specialOffer = scheme[eachInnerScheme].special_offer_text;
            var schemeROI  = scheme[eachInnerScheme].SchemeIRR ? scheme[eachInnerScheme].SchemeIRR : 0 ;
            if (specialOffer) {
                specialClass = ""
                borderClass = " scheme-border "
            } else {
                specialClass = " dsp-none "
                borderClass = ""
            }
            var selectedSchemeClass = '';
            var selectedSchemeRadio = ''
            if (eachInnerScheme == 0) {
                selectedSchemeClass = "selected-scheme";
                selectedSchemeRadio = "checked";

            }
            var schemeData = {};
            schemeData.schemeId = offerSchemeId;
            schemeData.emi = emi;
            schemeData.downpayment = downpayment;
            schemeData.tenure = tenur;
            schemeData.SchemeIRR = scheme[eachInnerScheme].SchemeIRR; 
            schemeData.SchemeLtvPercentage = scheme[eachInnerScheme].LTV_Percentage__c;
            schemeData = JSON.stringify(schemeData);

            moreEmiOptionHtml +=
                '<div class="emi-pop-up-table-content-wrap pdprev-emistable-cnt-li lowest-emi-tag-li emi-pop-up-cursor ' + borderClass + ' ' + selectedSchemeClass + '" data-scheme-data=' + schemeData + '  data-assest-category="'+eachAssetCategory+'" data-scheme-data-id=' + offerSchemeId + '><div class="lowest-emi-tag-div dsp-none"><span class="lowest-emi-text">Lowest EMI</span></div><div class="emipopup-table-w"><label class="es-radio-label"> <input class="es-radio-inp" type="radio" name="emischeme" ' + selectedSchemeRadio + '> <span class="es-radio-checkmark"></span> </label><div class="emi-pop-up-table-content firstColumn emi-pop-up-cursor"><span class="emi-pop-up-table-content-data"><span class="emi-pop-up-table-content-data-wrap"><span class="emi-pop-up-table-content-data-amt emi-pop-up-table-content-data-amt-exactvalue emi-val">' +
                '₹ ' + formattedPrice(Math.round(emi)) +
                '</span><span class="emi-pop-up-table-content-data-x"> X </span> <span class="emi-pop-up-table-content-data-month">' +
                tenur + 'm' +
                '</span></span></span></div><div class="emi-pop-up-table-content"><span class="emi-pop-up-table-content-data"><span class="emi-pop-up-table-content-data-rs"><i class="fa fa-inr" aria-hidden="true"></i></span><span class="emi-pop-up-table-content-data-amt emi-pop-up-table-content-data-amt-downpaymentvalue">' +
                formattedPrice(Math.round(downpayment)) +
                '</span></span></div><div class="emi-pop-up-table-content emi-pop-up-table-content-data-per"><span class="emi-pop-up-table-content-data"><span class="emi-pop-up-table-content-data-rs"></span><span class="emi-pop-up-table-content-data-amt"> '+schemeROI+'%</span></span></div><div class="emi-pop-up-table-content dsp-none"><span class="emi-pop-up-table-content-data"><span class="emi-pop-up-table-content-data-rs"><i class="fa fa-inr" aria-hidden="true"></i></span><span class="emi-pop-up-table-content-data-amt "> ' +
                formattedPrice(Math.round(totalcost.toFixed(2))) +
                '</span></span><span class="emi-pop-up-table-content-data-highlight ' +
                processStyle +
                '">+ <span class="emi-pop-up-table-content-data-rs"><i class="fa fa-inr" aria-hidden="true"></i></span><span class="emi-pop-up-table-content-data-amt">' +
                processFee +
                "</span>*</span></div></div><div class='special-offer-div-w special-offer-text " + specialClass + "'><div class='special-offer-div'><div class='special-offer-div-content'><img src='/content/dam/emistoremarketplace/index/specialoffer/availoffer.png' alt='offer'><span class='special-offer-content-text'>" + specialOffer + "</span></div></div></div></div>";
        }
    $(".emi-pop-up-table-content-wrap").remove();
    $(".emi-table-container").append(moreEmiOptionHtml);



    $(".emi-pop-up-table-content-wrap").click(function(e) {
        if(!$(e.target).hasClass("scheme-arrow") && !$(e.target).hasClass("lowest-emi-text")){
            var schemeData = $(this).parents(".emi-pop-up-table-content-wrap").attr("data-scheme-data") ? $(this).parents(".emi-pop-up-table-content-wrap").attr("data-scheme-data") : $(this).attr("data-scheme-data")
            var schemeDataJSON = JSON.parse(schemeData)
            if(schemeDataJSON.schemeId == selectedSchemeDataOnPdp.schemeId){
                $(".pop-up").removeClass("popactive");
                $("body").removeClass("noscrollbody");
            }else{
                $(this).find('input[type="radio"]').prop('checked', true);
                $(this).addClass('selected-scheme').siblings().removeClass('selected-scheme');
                var selectedSchemeData = $(this).attr('data-scheme-data');
                var assetCat = $(this).attr('data-assest-category');
                selectedSchemeData = JSON.parse(selectedSchemeData);
                selectedSchemeDataOnPdp = selectedSchemeData;
                selectedSchemeDataOnPdp.twoWheelerAssetType = assetCat
                selectedSchemeDataOnPdp.schemeRoi = selectedSchemeData.schemeRoi
                selectedSchemeDataOnPdp.SchemeIRR = selectedSchemeData.SchemeIRR
                var schemeId = selectedSchemeData.schemeId;
                var emi = selectedSchemeData.emi
                var downPayment = selectedSchemeData.downpayment
                var tenure = selectedSchemeData.tenure   
                $(".schecme-roi").text(selectedSchemeDataOnPdp.SchemeIRR)
                populateEmiSectionDetails(emi, downPayment, tenure);
                showToasterMsg("EMI Scheme has been changed", true);
                emiStoreApiData.set("scheme_id", "");
                emiStoreApiData.set("scheme_id", schemeId);
                setSchemeIdLocalStorage();
                $(".pop-up").removeClass("popactive");
                $("body").removeClass("noscrollbody");
                dlSchemeSelection(schemeId);
                try {
                    sellersListPopUpFlag = isExtendDataAvail()
                    if (sellersListPopUpFlag) {
                        biz.extendWarranty();
                    } else {
                        api.extendWarrantyOnLoad();
                    }
                } catch (error) {
                }
            }

        }
    });

    emiOptionsListTrim();
    if (!$(".emi-pop-up-table-content-wrap").find(".customCheckbox.customCheckboxChecked").length) {
        $(".emi-pop-up-table-content-wrap").find(".customCheckbox").eq(0).addClass("customCheckboxChecked");
        $(".emi-pop-up-table-content-wrap").find(".customCheckbox").eq(0).find("input").attr("checked", true);
        schemesID = scheme[0].SchemeId;
    }





    if ($(".emi-pop-up-table-content-data-highlight.dsp-none").length == $(".emi-pop-up-table-content-data-highlight").length) {
        $(".emi-pop-up-fees-p").addClass("dsp-none");
        // $(".emi-pop-up-processing-fees").show();
    } else {
        $(".emi-pop-up-fees-p").removeClass("dsp-none");
    }
    var ZerothSchemeId = scheme[0].SchemeId;
    emiStoreApiData.set("scheme_id", "");
    emiStoreApiData.set("scheme_id", ZerothSchemeId);
    var advanceEmiPrice = emiPriceArray[0];
    $('.absolute-emicost').text(emiPriceArray[0].toLocaleString());
    var monthofEMI = monthArray[0];

    if (monthofEMI <= 9) {
        $('.absolute-monthduration').text('0' + monthofEMI + ' months');
    } else {
        $('.absolute-monthduration').text(monthofEMI + ' months');
    }

    $('.absolute-downpaymentvalue').text(downPaymentPrice[0].toLocaleString());
    emiStoreApiData.set("tenure", monthofEMI);
    emiStoreApiData.set("advance", advanceEmiPrice);
    selectedSchemeDataOnPdp.schemeId = ZerothSchemeId;
    selectedSchemeDataOnPdp.emi = advanceEmiPrice;
    selectedSchemeDataOnPdp.downPayment = downPaymentPrice[0];
    selectedSchemeDataOnPdp.tenure = monthofEMI;
    selectedSchemeDataOnPdp.SchemeIRR = onLoadSchemeRoi ;
    selectedSchemeDataOnPdp.twoWheelerAssetType=assetCategoryC[0];
    selectedSchemeDataOnPdp.SchemeLtvPercentage=scheme[0].LTV_Percentage__c;
    if (localStorage.getItem('nonLoggedInToLoggedInSchemeChange') || localStorage.dontShowSchemeToaster || schemeTosterCount == 0) {
        setTimeout(function(){
            schemeTosterCount++ ;
        },5000);
        localStorage.removeItem('nonLoggedInToLoggedInSchemeChange');
        localStorage.removeItem('dontShowSchemeToaster');
    } else {
        var defaultSeller = $("#defaultSelectedSeller").find("input").attr("data-sellerId");
        if(defaultSeller== onChangeSellerID){
                $(".pop-up").removeClass("popactive");
                $("body").removeClass("noscrollbody");
       
    }else{
        newSchemeLoadedToster();
    }
        
    }
    setSchemeIdLocalStorage();
    $(".schecme-roi").text(selectedSchemeDataOnPdp.SchemeIRR)
};

 /*  Price Breakup render statrts   */



function setSchemeIdLocalStorage(){
    try { 
        localStorage.setItem('lastselectedSchemeId', selectedSchemeDataOnPdp.schemeId);
    } catch (error) {
         console.error('ERROR ::::/n' + error);
    }
}

function newSchemeLoadedToster(){
    var lastSelectedSchemeId = localStorage.getItem("lastselectedSchemeId") ?  parseInt(localStorage.getItem("lastselectedSchemeId")) : '';
    if(lastSelectedSchemeId != selectedSchemeDataOnPdp.schemeId ) {
        showEmiChangeToaster();
    }
}

/*Function For product moreEmiOptions end*/

/*  Function to Delivery Details start */
var deliveDate = function callFunctionToPopulateDeliveryDate() {
    if (productData.product_video_url && productData.product_video_url.trim()) {
        $(".deliveryvideoanchor").attr("href", productData.product_video_url);
    } else {
        $(".deliveryvideoanchor").attr("href", "");
        $(".deliveryvideo").hide();
    }
    var deliveryStatus = "";
    var deliveryCharges = productData.sellers[onChangeSellerIndex].DeliveryCharges;
    var deliverytat = deliveryCharges.tat;
    var tat = deliverytat;
    var default_tat_before5 = deliveryCharges.default_tat_before5;
    var default_tat_after5 = deliveryCharges.default_tat_after5;
    var tat = deliverytat;
    if (deliverytat == null || deliverytat == "") {
        if (deliveryCharges.hasOwnProperty(default_tat_before5) || deliveryCharges.hasOwnProperty(default_tat_after5)) {
            var fivepm = new Date(new Date().setHours(17, 0, 0));
            if (fivepm > new Date()) {
                // Before 5pm
                tat = default_tat_before5 || "";
            } else {
                // After 5pm
                tat = default_tat_after5 || "";
            }
        } else {
            tat = deliverytat;
        }
    }
    var dayRomanobj = {
        0: " th ",
        1: " st ",
        2: " nd ",
        3: " rd ",

    }
    var months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
    ];
    if (tat === "" || (tat >= 0 && tat <= 5)) {
        var currDate = new Date();
        var dayRomanStr = getRomanWord(currDate);
        var aftermidnight = new Date(new Date().setHours(0, 0, 0, 0)).getTime();
        var beforeevening = new Date(new Date().setHours(17, 0, 0, 0)).getTime();
        var currtimming = new Date().getTime();
        if (aftermidnight < currtimming && currtimming < beforeevening) {
            deliveryStatus =
                '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery <span class="pipe"></span></span><span>' +
                +currDate.getDate() +
                dayRomanStr +
                months[currDate.getMonth()] +
                " Today </span>";
        } else {
            var tommorow = new Date(new Date().getTime() + 1 * 24 * 60 * 60 * 1000);
            dayRomanStr = getRomanWord(tommorow);

            deliveryStatus =
                '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery <span class="pipe"></span></span><span>' +
                + tommorow.getDate() +
                dayRomanStr +
                months[tommorow.getMonth()] +
                " Tomorrow </span>";
        }
    } else if (tat >= 6 && tat <= 24) {
        deliveryStatus =
            '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span> in 1-2 working days</span>';
    } else if (tat >= 25 && tat <= 48) {
        deliveryStatus =
            '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 2-3 working days</span>';
    }

    else if (tat >= 49 && tat <= 72) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 3-4 working days</span>';
    }
    else if (tat >= 73 && tat <= 96) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 4-5 working days</span>';
    }
    else if (tat >= 97 && tat <= 120) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 5-6 working days</span>';
    }
    else if (tat >= 121 && tat <= 144) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 6-7 working days</span>';
    }
    else if (tat >= 145 && tat <= 168) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 7-8 working days</span>';
    }
    else if (tat >= 169 && tat <= 192) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 8-9 working days</span>';
    }
    else if (tat >= 193 && tat <= 216) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 9-10 working days</span>';
    }
    else if (tat >= 217 && tat <= 240) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 10-11 working days</span>';
    }
    else if (tat >= 241 && tat <= 264) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 11-12 working days</span>';
    }
    else if (tat >= 265 && tat <= 288) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 12-13 working days</span>';
    }
    else if (tat >= 289 && tat <= 312) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 13-14 working days</span>';
    }
    else if (tat >= 313 && tat <= 336) {
        deliveryStatus = '<span><span class="free"><i class="fa fa-check" aria-hidden="true">Free</i></span> Delivery </span><span>in 14-15 working days</span>';
    }
    else {
        console.warn("Delivery Date is not Valid ");
    }

    $(".delivery-charges").html(deliveryStatus);
};
/*  Function to Delivery Details end */

/*Function For productProtedeliveryDatectPlanData  start*/


/*Function For productProtect end*/
/*  function for productColor start*/

/*  function for productColor End*/

/*  function for productInternalStoreage start*/

/*  function for productInternalStoreage end*/

/*  function for productSpecialOffer start*/
var callSpecialOffer = function callFunctionToPopulateProductSpecialOffer() {

    var specialofferli = "";
    var specialofferul = "";
    var productSpecialOfferDeals = productData.sellers[onChangeSellerIndex].Offer.SpecialOfferDeals;

    productSpecialOfferDeals = productSpecialOfferDeals.sort(function (a, b) {
        return a.weight - b.weight;
    });
    if (productSpecialOfferDeals.length > 0) {

        for (var specialOffer = 0; specialOffer < productSpecialOfferDeals.length; specialOffer++) {
            var productSpecialOffer = productSpecialOfferDeals[specialOffer].offer_desc;
            var tooltip = productSpecialOfferDeals[specialOffer].tooltip;
            var termsAndConditions = productSpecialOfferDeals[specialOffer].t_and_c;
            var sweight = productSpecialOfferDeals[specialOffer].weight;
            var tandc = (tooltip != "" && termsAndConditions != "") ? '<div class="available-offers-new-list-more"><span class="more-link tooltiptest pdp-left-sepr"><span class="ft-black">T &amp; C<i class="custtooltip"><span class="available-offers-tooltipText">' + tooltip + '</span><a href="' + termsAndConditions + '">Read&nbsp;&nbspMore</a></i> </span></span></div>' : "";
            /* 
            specialofferul += ('<li class="available-offers-new-list clear-fix pdprev-emistable-cnt-li"><div class="revpdp-offerdiv-icon-w"><img src="/content/dam/emistoremarketplace/index/offer-for-design-dam/Offer -percent-icon.png"></div><div class="available-offers-new-list-icon-back"><span class="available-offers-new-icon"><img class="lozad" data-src="/content/dam/emistoremarketplace/index/pdppage/gift-font.png" width="14px" height="14px" src="/content/dam/emistoremarketplace/index/pdppage/gift-font.png" data-loaded="true"></span></div><div class="available-offers-new-list-content"><span class="available-offers-title-txt"></span><span class="available-offers-new-list-text">' + productSpecialOffer + '</span></div>' + tandc + '</li>');
             */
            var specialOfferLocalObj = {};
            specialOfferLocalObj.specialOffer = productSpecialOffer;
            specialOfferLocalObj.tooltipText = tooltip;
            specialOfferLocalObj.TnCUrl = termsAndConditions;
            specialofferul += renderSpecialOfferLI(specialOfferLocalObj);
        }

    }
    $('.selleroffer').html('');
    if (specialofferul) {
        $('.selleroffer').append(specialofferul);
        $(".ft-black").click(function (){
            $('.dp-tooltip-content-div-main').addClass('dsp-none');
            if($(this).find('.tnCtooltip').hasClass('dsp-none')){
                $('.tnCtooltip').addClass('dsp-none');
                $(this).find('.tnCtooltip').removeClass('dsp-none');
            }
            else{
                $('.tnCtooltip').addClass('dsp-none');
                $(this).find('.tnCtooltip').addClass('dsp-none');
                
            }
        });
    }
    htmlDesktopMobileClass()
    if (window.matchMedia("(max-width: 766px)").matches){
        specialOfferEvents();
    }
    var StatusOfExchange = productData.exchange[0].status;
    // if ((productSpecialOfferDeals.length == 0 && (!productData.exchange || !StatusOfExchange))) {
    if ((productSpecialOfferDeals.length == 0 && (!productData.exchange || !StatusOfExchange))) {
        $(".offerSection").addClass("dsp-none")
    } else {
        $(".offerSection").removeClass("dsp-none");
    }
    emiOptionsListTrim();


}

/*  function for productSpecialOffer end*/

/* function for instacheckout start*/

/*  function for instacheckout end*/

/*Function for breadcrumbs */


/*Function for CryptoJS function for encryptData  Data function*/
function aesEncrypt(data) {
    var key = 'A44B19ADE76FAE00CB3BAED5B17630==';
    var iv = '890EA3DC9224CB2=';
    var cipher = CryptoJS.AES.encrypt(data, CryptoJS.enc.Utf8.parse(key), {
        iv: CryptoJS.enc.Utf8.parse(iv),
        padding: CryptoJS.pad.Pkcs7,
        mode: CryptoJS.mode.CBC
    });

    return cipher.toString();
}

/*Function for  Save Data function*/



function successCallComparePdp(e, response) {
    successCallComparePdpRevised(e, response);
}
function getDealerCompareHtml(each,index) {
    var baseImage = $('.pc-single-img-base-image').attr('src');
    var redirectionUrl = window.location.href;
    var entity_Id = productData.entity_id; 
    var productName = $(".info-prod-head").text();
    var sellerId = (each.SellerId).toString().split('').reverse().join('');
    if(index == 0){
        var is_currentView = '';
    }else{
        var is_currentView = 'dsp-none';
    }
    var dataMapping = _getDataMapping();
	var avgrat = dataMapping.productDetails.review;
    var isavg_rat = (avgrat == null || avgrat == "0") ? "dsp-none" : "";
    var starsHtml = '';
    var rnd = Math.trunc(avgrat);
    var cutStar = (avgrat + "").split(".")[1];
    var blank = 5 - rnd;

    for (var i = 0; i < rnd; i++) {
        starsHtml += '<img src="/content/dam/emistoremarketplace/index/similar-product/Vector.svg" alt="vector" style="clip-path:inset(0px 0px 0px 0px);">';

    }
    if (cutStar != undefined) {
        blank = blank - 1;
        cutStar = 13 - (cutStar * 1.3);
        starsHtml += '<img src="/content/dam/emistoremarketplace/index/similar-product/Vector.svg" alt="vector" style="clip-path:inset(0px ' + cutStar + 'px 0px 0px);">';
    }

    for (var i = 0; i < blank; i++) {
        starsHtml += '<img src="/content/dam/emistoremarketplace/index/similar-product/Vector-blank.svg" alt="vector">';
    }

    var productNameInfo = '<td class="pdprev-cmpprods-tdimg img-dealer-section-revamp txt-center">' +
    '<span class="pdprev-cmpprods-tdimg-ct">' +
    '<span class="pdprev-cmpprods-img pdprev-cmpprods-event" skuName="' + skuName + '" sellerId="' + sellerId + '" entityID="' +entity_Id + '" >' +
    '<a href= "' + redirectionUrl + '"><img src="' + baseImage + '"></a>' +
    '</span>' +
    '<span class="pdprev-currently txt-center '+is_currentView+'" >currently viewing </span>' +
    '<span class="pdprev-cmpprdtitle txt-center">' +
    '<span class="prd-name two-line-ellipsis">' + productName + '</span>' +
    '</span>' +
    '<span class="pdprev-vector txt-center '+isavg_rat+'">' +
    starsHtml + 
    '</span>' +
    '<span class="pdprev-button compare-buynow-event-dealer c-pointer txt-center dsp-block"> Book Now </span>' +
    '</span>'+
'</td>';

    return productNameInfo;
}
function renderDealerComparision(sellersToRender,clickFlag=false) {
        $('.pdprev-cmpprods-rw-dealer').html("");
        $('.img-dealer-section-revamp').html("");
        $('.productNameInfo1').html("");
        $(".revisedComparBody1").html("");
     var firstThreeData = [];
    sellersToRender.forEach((each) => {
        var eachProductDistance = each.Distance ?  Math.round(each["Distance"]*100)/100 : "N/A";

        var attrObj = {
            'Dealer Name': each.SellerName,
            'Store Distance': eachProductDistance,
            'On Road Price': each.on_road_price,
            'EMI Starts From': each.Schemes[0].EMI,
            'Tenure': each.Schemes[0].GrossTenure,
            'SellerId': each.SellerId
        }
        firstThreeData.push(attrObj);
    });

    firstThreeData.forEach((each,index)=>{
       let eachRenderHtml =  getDealerCompareHtml(each,index);
       $('.productNameInfo1').append(eachRenderHtml);
    });


    Object.keys(firstThreeData[0]).forEach((eachKey) => { 
        var specification;
        firstThreeData.forEach((each,index) => {
            var selectedProduct = '';
            if(index == 0){
            selectedProduct= 'pdp-compare-select-product';
            }
            var name = each[eachKey];
            if(eachKey == 'On Road Price'){
                name =  (name != null) ? "₹"+name.toLocaleString('en-IN') : "";
            }else if(eachKey == 'EMI Starts From'){
                name = (name != null) ?  "₹"+name.toLocaleString('en-IN')+"/m" : "";
            }else if(eachKey == 'Tenure'){
                name = name +" months";
            }else if(eachKey == 'Store Distance'){
                name = name != "N/A" ?  name +"km" : name;
            }
            if(eachKey != 'SellerId'){

            specification += '<td class="pdprev-cmpprods-td txt-center white-hg-box td-mob '+selectedProduct+'' + ' specificationClass' + '">' +
                '<span class="dsp-block pdp-black">' + name + '</span>' +
                '</td>';
            }
        });
        if(eachKey != 'SellerId'){
        var tr = '<tr class="pdprev-cmpprods-rw-ct pdprev-cmpprods-rw pdprev-cmpprods-rw-dealer specificationTag">' +
            '<th colspan="3" class="pdprev-cmpprods-th txt-left spactionLabel">' + eachKey + '</th>' +
            '</tr>' +
            '<tr class="pdprev-cmpprods-rw-ct specification-adjust pdprev-cmpprods-rw pdprev-cmpprods-rw-dealer specification">' + specification + '</tr>';
        $(".revisedComparBody1").append(tr);
        }

    })

}

function successCallComparePdpRevised(e, response) {
    if (typeof response === "string") {

        response = JSON.parse(response);
        if(response.status){
            biz.setFloatingMenu();//FLOATING MENU RENDER
            $('.submenu-text_compare_tab').removeClass('dsp-none');
        }else{
            $('.submenu-text_compare_tab').addClass('dsp-none');
            $('.submenu-text_compare_tab').remove();
        }
    }
    emiStoreApiData.set("Revisedpdpcompare", response);
    if (e == true) {
        
        var data = emiStoreApiData.get("Revisedpdpcompare");
        if (data.status) {
            $('.pdprev-compareprods-tbl-w-compare-similar-delear').addClass('i-dsp-none');
            $('.pdprev-compareprods-tbl-w-compare-similar-product').removeClass('i-dsp-none');
            $(".revisedCompareTableComponent").css("display", "block");
            var similarproducts = data.similiar_products[0];
            var similarproductskeys = Object.keys(data.similiar_products[0]);
            var attributes;
            similarproductskeys.forEach(function (key) {
                if (key == "P1" || key == "P2" || key == "P3") {
                    emiStoreApiData.set("similarproducts".key);
                    $(".revisedCompareTableComponent").css("display", "block");
                    $(".pdpCOmpareTableComponent").removeClass("hide-elem");
                    var skuName = similarproducts[key].skuname;
                    var avgrat = similarproducts[key].avg_rat;
                    var skuimage = similarproducts[key].skuimage;
                    var urlkey = similarproducts[key].urlkey;
                    var entityid = similarproducts[key].entityid;
                    var smartphone_battery = similarproducts[key].attribute.smartphone_battery;
                    var smartphone_primary_camera = similarproducts[key].attribute.smartphone_primary_camera;
                    var ram = similarproducts[key].attribute.ram;
                    var operating_system = similarproducts[key].attribute.operating_system;
                    var current_view = '';
                    if(key!='P1'){ 
                       var current_view= 'i-dsp-none' ;
                    }
                    var isavg_rat = (avgrat == null || avgrat == "0") ? "dsp-none" : "";
                    var starsHtml = '';
                    var rnd= Math.trunc(avgrat);
                    var cutStar=(avgrat + "").split(".")[1];
                    var blank =  5-rnd;
                    
                    for (var i = 0; i < rnd; i++) {
                            starsHtml += '<img src="/content/dam/emistoremarketplace/index/similar-product/Vector.svg" alt="vector" style="clip-path:inset(0px 0px 0px 0px);">';
                        
                    }
                    if (cutStar != undefined) {
                        blank = blank -1;
                        cutStar = 13- (cutStar * 1.3);
                        starsHtml += '<img src="/content/dam/emistoremarketplace/index/similar-product/Vector.svg" alt="vector" style="clip-path:inset(0px ' + cutStar + 'px 0px 0px);">';
                    }
                     
                    for (var i = 0; i <blank; i++) {
                        starsHtml += '<img src="/content/dam/emistoremarketplace/index/similar-product/Vector-blank.svg" alt="vector">';
                    }
                    var productNameInfo = '<td class="pdprev-cmpprods-tdimg txt-center">' +
                        '<span class="pdprev-cmpprods-tdimg-ct">' +
                        '<span class="pdprev-cmpprods-img pdprev-cmpprods-event" skuName="' + skuName + '" entityID="' + entityid + '" >' +
                        '<a href= "' + urlkey + '"><img src="' + skuimage + '"></a>' +
                        '</span>' +
                        '<span class="pdprev-currently txt-center '+current_view+'">currently viewing </span>' +
                        '<span class="pdprev-cmpprdtitle txt-center">' +
                        '<span class="prd-name two-line-ellipsis">' + skuName + '</span>' +
                        '</span>' +
                        '<span class="pdprev-vector txt-center '+isavg_rat+'">' +
                        starsHtml + 
                        '</span>' +
                        '<span class="pdprev-button txt-center compare-buynow-event dsp-block"> Book Now </span>' +
                        '<span class="compare-buy-now-btn compare-buynow-event c-pointer dsp-none">' +
                        '<span class="compare-buy-now-btn-text ">Book Now</span>' +
                        '</span>' +
                        '</span>'+
                    '</td>';
                    $(".productNameInfo").append(productNameInfo);
                    attributes = Object.keys(similarproducts[key].attribute);
                    
                }
                
            });
            CompareSimilarProductEvent();


            $(".prd-name").each(function () {
                var title = $(this).text();
                if (window.matchMedia("(max-width: 766px)").matches) {
                    if (title.length > 30) {
                        var replaceTitle = title.substring(0, 30) + "...";
                        $(this).text(replaceTitle);
                    }
                }else{
                    if (title.length > 50) {
                        var replaceTitle = title.substring(0, 50) + "...";
                        $(this).text(replaceTitle);
                    }
                }
            });

            var attributeKeyValue = "";
            attributes.forEach(function (attributekey) {
                var specification, specificationClass;
                similarproductskeys.forEach(function (key, index) {
                    if (index == 0) {
                        specificationClass = " pdp-compare-select-product "
                    } else {
                        specificationClass = "  "
                    }
                    if (key == "P1" || key == "P2" || key == "P3") {
                        attributeKeyValue = similarproducts[key].attribute[attributekey];
                        if(attributekey == "Price" ){
                            attributeKeyValue = attributeKeyValue.split("&#x20B9;")[1]
                            attributeKeyValue = "₹"+new Intl.NumberFormat("en-IN").format(attributeKeyValue)
                        }
                        if(attributekey == "EMI"){
                            attributeKeyValue = attributeKeyValue.split("&#x20B9;")[1]
                            attributeKeyValue = attributeKeyValue.split("/m")[0]
                            attributeKeyValue = "₹"+new Intl.NumberFormat("en-IN").format(attributeKeyValue)+"/m"
                        }
                        specification += '<td class="pdprev-cmpprods-td txt-center td-mob white-hg-box'+ specificationClass +'">' +
                            '<span class="dsp-block pdp-black">' + attributeKeyValue + '</span>' +
                            '</td>';
                    }
                });
                var tr = '<tr class="pdprev-cmpprods-rw-ct pdprev-cmpprods-rw specificationTag">' +
                    '<th colspan="3" class="pdprev-cmpprods-th txt-left spactionLabel">' + attributekey + '</th>' +
                    '</tr>' +
                    '<tr class="pdprev-cmpprods-rw-ct pdprev-cmpprods-rw specification">' + specification + '</tr>';
                $(".revisedComparBody").append(tr);

            });
            biz.setFloatingMenu();
        } else {
            $('.pdprev-compareprods-tbl-w-compare-similar-product').addClass('i-dsp-none');
            $(".pdprev-rel-deal-relevance").addClass("i-dsp-none");
            $('.pdprev-compareprods-tbl-w-compare-similar-delear').removeClass('i-dsp-none');
            $(".pdprev-rel-deal-dealer").addClass("active");
            // $(".revisedCompareTableComponent").hide();
            // $(".revisedCompareTableComponent").remove();
            biz.setFloatingMenu();
          
        }
    } else {
        biz.setFloatingMenu();
        $(".revisedCompareTableComponent").css("display", "none");
        if($('.img-dealer-section') && $('.img-dealer-section').length){
            $(".revisedCompareTableComponent").show();
        }
        $(".revisedCompareTableComponent").remove();
    }


}


/*Function for ComparePDP */
var callCompareProduct = function callFunctionToPopulateCompareProductData() {
    var cityID = readCookie("selected_city");
    var url = "/content/emistoremarketplace/api.pdp-similar." + skuName + "." + cityID + ".json";
    // var url = baseUrl + "/rest/V1/compare/sku/" + skuName + "/cityid/" + cityID;
    sendApiRequest(
        { urlType: "nonTransactionlUrl" },
        url,
        bearerTokenConfig,
        "GET",
        successCallComparePdp,
        "",
        "text",
        false
    );
}

function callFunctionToPoluateProductData() {
    flagOfpdpApiSuccess = productData != "" ? true : true;
    if (flagOfpdpApiSuccess) {
        isProductOutOfStock = productData.status;
        if (productData.status) {
            /* to clear is_seller_changed falg on load start */
            if (productData["vehicle_features"] && productData["vehicle_features"].length) {
                var product_tag = productData["vehicle_features"].length ? productData["vehicle_features"][0].product_tag : "";
                $(".ev-bike-evt").removeClass("dsp-none");
                $(".ev-bike-txt-evt").text(product_tag);
            }
            if (localStorage.getItem("is_seller_changed")) {
                localStorage.removeItem("is_seller_changed");
            }
            /* to clear is_seller_changed falg on load end */
            callPopulateDeliveryDetails();
            // schemesID = productData.lowest_offer_price[0].scheme;
            schemesID = productData.sellers[onChangeSellerIndex].Schemes[0].SchemeId
            $(".vas-sect").hide();
            $(".outofstock-div").hide();
            $(".available-offers-slider").hide();
            $(".inner-product-info").show();
            $(".buy-emi-btn").css({
                "pointer-events": "auto",
                opacity: 1
            });
            if (window.innerWidth < 991) {
                $(".breadcrumb--section").hide();
            }
            callProductDetails();
            //moreEmiOptions();
            //absolutediscountcalculation();
            // callSpecialOffer();
            if (__is_loginUSer()) {
                var addressId = localStorage.getItem("selectedAddress") ? localStorage.getItem("selectedAddress") : '';
                var cityId = localStorage.getItem("cityId") ? localStorage.getItem("cityId") : '';
                var customerPincode = readCookie("selected_city_pincode") ? readCookie("selected_city_pincode").split('|')[0] : '';
       
                if (customerPincode || addressId) {
                    if(addressId === 'undefined'){
                        setSellerList();
                        disablebutton();
                        api.extendWarrantyOnLoad();
                        if (!pdpProductImpressionDlCalled) {
                            ProductDataImpressions();
                        }
                    }else{
                        setSellerListFunctionFlag = false;
                        var delearcode = '';
                        // nddServiceAPiTrigger();
                        var pincodevalue = customerPincode;
                        selectaddressAPiTrigger(pincodevalue, addressId, delearcode);
                    }
                }
            } else {
                if (readCookie("selected_city_pincode")) {
                    setSellerListFunctionFlag = false;
                    var delearcode = '';
                    var addressId = '';
                    var pincodevalue = readCookie("selected_city_pincode").split('|')[0];
                    selectaddressAPiTrigger(pincodevalue, addressId, delearcode);
                }

            }
            // callSellerDetails();
            if (setSellerListFunctionFlag) {
                setSellerList();
                ProductDataImpressions();
                checkExtendWarrAfterLogin2wPDP() 
                callSpecialOffer();
            }
            // setSellerList(); 
            validateDocRequiredFlag();
            // callDeliveryriskType();
            // callColor();
            // callInternalStoreage();
            // callNetflix();
            // callCompareProduct();
            // protectPlanTrigger();
            // api.extendWarrantyOnLoad();
            $(".absolute-discount-calc-mrp").hide();
            if ($(window).width() > 321 && $(window).width() < 991) {
                $(".outofstock-div-mobile").hide();
            }
            deliveDate();

            //exotelIdentifierApi();
            // api.onloadRewardPoint();
            setTimeout(function () {
                onLoadDocumentFlag = true;
            }, 1000);

            $(".fonesafeparentwrapper").show();
            $(".available-offers-slider").show();
            $(".stock-status-label, .stock-status, .absolute-discount-label, .absolute-discount-calc-main, .absolute-discount-calc-offer-wrap, .available-offers-new-main, .seller-details, .delivery-details, .pdp-rating-main, #deliveryDetailsSection").show();
            /* if (!productData.sellers && !productData.exchange) {
                $(".offerSection").hide();
            } else {
                $(".offerSection").show();
            } */
            if (availableOptionsFlag) {
                $(".colorAndStorageSection").show();
                $('.colorAndStorageSection').removeClass('dsp-none');
            }
            $(".brand-warranty-wrap").show();
            $(".rating-div").show();
            $(".shop-option").show();
            // onload new requiredment
            $(".add-cart-btn").show();
            $(".buy-emi-btn").show();
            // ProductDataImpressions();
        } else {
            ProductDataImpressions();
            if ($(window).width() > 321 && $(window).width() < 991) {
                $(".outofstock-div-mobile").show();
            } else {
                $(".outofstock-div").show();
            }
            if (__is_loginUSer()) {
                // var stringFormat = decodeURIComponent(readCookie("perpetual_session")).split("|");
                var mobile = __get_perpetual_session("mobile_number");
                var email = __get_perpetual_session("email");
                $(".mobile-no-outofstock").val(mobile);
                if($(".mobile-no-outofstock").val() && $(".mobile-no-outofstock").val().length==10){
                    $(".notify-btn-outofstock").removeClass("disabled");
                }
                else{
                    $(".notify-btn-outofstock").addClass("disabled");
                }
                $(".email-id-outofstock").val(email);
                $(".email-id-outofstock").val('');
                $(".outofstock-innerwrapper .outofstock-mobileinputsdiv").find("input").val(mobile);
            }
            $(".absolute-discount-calc-main").show();
            $(".outofstock-note").hide();
            $(".absolute-discount-calc-mrp").show();
            $(".fonesafeparentwrapper").hide();
            $(".available-offers-slider").hide();
            $(".vas-sect").hide();
            $(".stock-status-label, .stock-status, .absolute-discount-label, .absolute-discount-calc-main, .absolute-discount-calc-offer-wrap, .available-offers-new-main, .seller-details, .delivery-details, #deliveryDetailsSection").hide();
            $('.colorAndStorageSection').addClass('dsp-none');
            $(".inner-product-info").show();
            $(".brand-warranty-wrap").hide();
            $(".rating-div").show();
            $(".pdp-rating-main").show();
            $(".shop-option").hide();
        }
    }


    if (updateSeller) {
        updateSellerDetails();
    }
    if (encodeSellerId && flagisUrlSellerNotAvailable) {
        $(".shop-option").hide();
        $(".absolute-discount-calc-offer-wrap").hide();
        $(".seller-details").hide();
        $(".delivery-details").hide();
        $(".absolute-discount-calc-main-more-wrap").hide();
        $(".available-offers-new-wrap").hide();
    }

    pdpCompareList();
    // callMefunction(); 
    ratingTrigger();
    biz.productPageData();
    //ProductDataImpressions();
    // pdpSellerOptionCheckDataLayer();
}

/*Function for PDP Get Compare List Start */
function pdpCompareList() {
	var dataMapping = _getDataMapping();
    var customerUserId = dataMapping.customerDetails.api.customerToken;
    if (__is_loginUSer()) {
    customerUserId = customerUserId ? customerUserId : "";
    }else{
        customerUserId = "";
    }

    var visitorID = localStorage.getItem("visitorID") == null ? "" : parseInt(localStorage.getItem("visitorID"));

    var compareApiReuest = {
        "visitorId": visitorID,
        "customerId": customerUserId
    }

    reqObj = {
        requestJson: compareApiReuest
    };

    apiUtility.plponload_compare_list(reqObj)
        .then(function (response) {
            emiStoreApiData.set("pdponload_compare_list", response);
            pdponload_compare_listResponseData = emiStoreApiData.get("pdponload_compare_list");
            localStorage.setItem("visitorID", pdponload_compare_listResponseData.visitor_id);
            var products = pdponload_compare_listResponseData.products;
            if (pdponload_compare_listResponseData.status) {
                var compareList = '';
                var compareUrl = pdponload_compare_listResponseData.compare_url;
                var i = 0;
                for (i = 0; i < 3; i++) {
                    var skuNamelist = "";
                    var url = "";
                    var ImageUrl = "";
                    if (products[i]) {
                        skuNamelist = products[i].sku;
                        url = products[i].url;
                        ImageUrl = products[i]["image-url"];

                        var skuName = $('meta[name="productSku"]').attr("content");
                        if (products[i].sku == skuName) {
                            $(".addtocomparetxt").addClass("hide-elem");
                            $(".addedtxt").removeClass("dsp-none");

                            $("a.compareUrl").attr("href", compareUrl);
                        }
                        else {
                            $(".addtocomparetxt").removeClass("hide-elem");
                        }
                    }
                }
            }
            else {
                $(".addtocomparetxt").removeClass("hide-elem");
            }
        })
        .catch(function (error) {
            emiStoreApiData.set("pdponload_compare_list", "");
            $(".addtocomparetxt").removeClass("hide-elem");
            pdponload_compare_listResponseData = emiStoreApiData.get("pdponload_compare_list");
            console.error("error in onload api response : ", error);
        });
}
/*Function for PDP Get Compare List End  */




/*Function for PDP ADD To Compare  */
function getRomanWord(date) {
    var date = new Date(date);
    var dd = date.getDate();
    var romanobj = {
        1: "st",
        2: "nd",
        3: "rd",
        11: "th",
        12: "th",
        13: "th",
    }
    if (dd < 20) {
        var romanword = romanobj[dd] ? romanobj[dd] : "th";
    } else {
        dd = dd.toString()[1];
        var romanword = romanobj[dd] ? romanobj[dd] : "th";
    }
    return romanword;
}

window.addEventListener('DOMContentLoaded',function(){
    setTimeout(function () {
        pdpDropOffDataLayer();
    }, 120000);
    $(".sellerfixedbutton").on("click", updateSellerDetails);

    $(document).on("change", ".categoryoption-select", function () {
        var cdExchange = dataStoreUtility.getPDS("emiStore-PDP").get("cdExchangePopup");
        var brandID = $(".categoryoption-select option:selected").attr("value");
        var brandOptions = "<option value='' selected='selected'>Select Brand</option>";
        var brandData = cdExchange.brand_list;
        for (var eachBrand in brandData) {
            var entity = brandData[eachBrand].entity_id;
            var brandName = brandData[eachBrand].brand_name;
            var categoryID = brandData[eachBrand].category_id;
            if (entity != null && entity != "" && (brandName != null && brandName != "") && categoryID == brandID) {
                brandOptions += "<option value='" + entity + "'>" + brandName + "</option>";
            }
        }
        $(".brandoption-select").html(brandOptions);
    });
    
    /* Onbrand change in cdExchange */
    $(document).on("change", ".brandoption-select", function () {
        var cdExchange = dataStoreUtility.getPDS("emiStore-PDP").get("cdExchangePopup");
        var entityID = $(".brandoption-select option:selected").attr("value");
        var productOptions = "<option value='' selected='selected'>Choose a Product</option>";
        var productOptionData = cdExchange.item_list;
        for (var eachproduct in productOptionData) {
            var id = productOptionData[eachproduct].id;
            var prodName = productOptionData[eachproduct].item_name;
            var brandID = productOptionData[eachproduct].brand_id;
            if (id != null && id != "" && (prodName != null && prodName != "") && entityID == brandID) {
                productOptions += "<option data='" + eachproduct + "' value='" + id + "'>" + prodName + "</option>";
            }
        }
        $(".productoption-select").html(productOptions);
    });
    /*on select Product in buy with exchange popup in cdExchage */
    $(document).on("change", ".productoption-select", function () {
        var arrindex = parseInt($(".productoption-select option:selected").attr("data"));
        var productDetails = dataStoreUtility.getPDS("emiStore-PDP").get("cdExchangePopup").item_list[arrindex];
        var price = parseInt($(".absolute-discount-calc-offer-discountedprice").html().split(",").join(""));
        var pickupCharge = parseInt(productDetails.pickup_charge);
        var exchangeValue = parseInt(productDetails.exchange_value);
        var totalPrice = price - (pickupCharge + exchangeValue);
        $(".cdexchange-price").html(formattedPrice(price));
        $(".cdexchange-pickupcharge").html(formattedPrice(pickupCharge));
        $(".cdexchange-discount").html(formattedPrice(exchangeValue));
        $(".cdexchange-totalprice").html(formattedPrice(totalPrice));
    });
    
    $("#callme").on("click", function () {

        // var cookieString = decodeURIComponent(readCookie("perpetual_session")).split("|");
        var fullNameArray = __get_perpetual_session("customer_name");
        var fullname = fullNameArray[0] + " " + fullNameArray[fullNameArray.length - 1];
        var customerName = fullname;
        var mobileno = $('#mobileNO').val() ? $('#mobileNO').val() : reverseStr(atob(cookieString[2])).split("_")[1];
        var encryptedMobileno = aesEncrypt(mobileno);
        var bflCustomerId = __get_perpetual_session("customer_id");
        var encryptedBflCustomerId = '';
        if (bflCustomerId == "0_BLF") {
            encryptedBflCustomerId = "";
        }
        else {
            var bflCustomer = bflCustomerId;
            encryptedBflCustomerId = aesEncrypt(bflCustomer);
        }
        var magentoCustomerId = __get_perpetual_session("m_customer_id");
        var encryptedMagentoCustomerId = aesEncrypt(magentoCustomerId);
        var cityName = localStorage.getItem("cityName");
        var visitedskuName = $('meta[name="productSku"]').attr("content");
        var sellerName = "";
        if (isProductOutOfStock == false) {
            sellerName = "";
    
        } else {
    
            sellerName = $(".sellerdeliveryhead-og-text").text();
        }
    
        reqObj = {
            requestJson: {
                "customerName": customerName,
                "mobile": encryptedMobileno,
                "bflCustId": encryptedBflCustomerId,
                "magentoCustId": encryptedMagentoCustomerId,
                "city": cityName,
                "visitedSku": visitedskuName,
                "sellerName": sellerName
            }
        };
        $(document).trigger("api:saveData", {
            data: reqObj,
            cb: function (e, responseObj) {
                var saveData = emiStoreApiData.get("saveData");
                if (e == true) {
                    if (saveData.status) {
                        $(".gtExprtCl-request-pop-content").hide();
                        $(".gtExprtCl-userInfoNo").text(mobileno);
                        $(".gtExprtCl-Sucess-pop-content").removeClass("hide-elem");
                    }
                    else {
                        $(".gtExprtCl-request-pop-content").hide();
                        $(".gtExprtCl-Error-pop-content").removeClass("hide-elem");
                    }
                } else {
                    // $(".expertCall-maindiv").hide();
                }
            }
        });
    });
    $(".pdprev-rel-deal-dealer").on("click", function () {
        $('.pdprev-rel-deal-relevance').removeClass('active');
        $('.pdprev-rel-deal-dealer').addClass('active');
        $('.pdprev-compareprods-tbl-w-compare-similar-product').addClass('i-dsp-none');
        $('.pdprev-compareprods-tbl-w-compare-similar-delear').removeClass('i-dsp-none');
    });  
    $(".pdprev-rel-deal-relevance").on("click", function () {
        $('.pdprev-rel-deal-dealer').removeClass('active');
        $('.pdprev-rel-deal-relevance').addClass('active');
        $('.pdprev-compareprods-tbl-w-compare-similar-delear').addClass('i-dsp-none');
        $('.pdprev-compareprods-tbl-w-compare-similar-product').removeClass('i-dsp-none');
    });    

})
function isExtendDataAvail() {
    var dataMapping = _getDataMapping();
    var resp = dataMapping.productDetails.api.extendWarranty.response;
    if (resp) {
        return true;
    }
    else {
        return false;
    }

}
/***************************** Funtion to check extend warranty call after login in 2w pdp *****************************/
function checkExtendWarrAfterLogin2wPDP(){
    try {
        if (twoWheelerPDPApiFlag) {
            api.extendWarrantyOnLoad()
        }
    } catch (error) {
        console.error(error)
    }
}
/***************************** Funtion to check extend warranty call after login in 2w pdp *****************************/
$(window).on('load', function() {
    $("html, body").animate({
        scrollTop: 0
    }, "fast");
});
var interval = setInterval(function() {
    callUnBxdOnScroll();
}, 1000);

function callUnBxdOnScroll() {
    if ($(this).scrollTop() != 0) {
        return;
    } else {
        clearInterval(interval);
    }
    $(window).scroll(function(event) {
        st = $(this).scrollTop();
        if (st > lastScrollTop) {
            if (!scrollDone) {
                scrollDone = true;
                // loadDataMoreLikeThis()
                //     .then(function (message) { })
                //     .catch(function (error) {
                //         console.log(error);
                //     });
                /*  loadDataRecentlyData()
                     .then(function (message) { })
                     .catch(function (error) {
                         console.log(error);
                     }); */
            }
        } else {

        }
        lastScrollTop = st;
    });
}

var scrollDone = false;
var lastScrollTop = 0;
var flagOfpdpApiSuccess = false;
var similarProductsData = {};
var recentlyViewedProductsData = {};
var skuName = $('meta[name="productSku"]').attr('content');
var unboxid = readCookie("unbxd.userId");
/*  Function For Formatting of Price  */
function formattedPrice(price) {
    return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function loadDataMoreLikeThis() {
    //  Similar Product
    var xhttp = new XMLHttpRequest();
    var parent = new Promise((resolve, reject) => {
        xhttp.onload = function() {
            if (this.readyState == 4 && this.status == 200) {
                flagOfpdpApiSuccess = true;
                if (this.responseText && typeof this.responseText === "string") {
                    similarProductsData = JSON.parse(this.responseText);
                }
                callsimilarProductsData();
            } else if (this.readyState == 4 && this.status != 200) {
                similarProductsData = JSON.parse(this.errorText);
                reject(similarProductsData);
            }
        };
    });
    var offerPrice = "";
    if (productData.status == true) {

        offerPrice = emiStoreApiData.get("offerprice");
    } else {
        offerPrice = productData.mrp || parseInt($(".absolute-discount-calc-mrp-price").text().replace(/,/g, '').trim());
    }
    var cityId = readCookie("selected_city");
    xhttp.open("POST", "/content/emistoremarketplace/unboxdata.more-like-this." + skuName + "." + offerPrice + "." + cityId + ".json", true);
    xhttp.send(JSON.stringify({ urlType: "nonTransactionlUrl" }));

    return parent;
}

var callsimilarProductsData = function callFunctionToPopulateSimilarProductsData() {
    var similarProductsli = "";
    var recentlyViewedli = "";
    // var similarProductDatas = similarProductsData.Recommendations;
    var similarProductDatas = similarProductsData.response && similarProductsData.response.products;
    $(".similar-product-btn").addClass('dsp-none')
    if(similarProductDatas &&similarProductDatas.length){
        for (var similarData = 0; similarData < similarProductDatas.length; similarData++) {
            var productId = similarProductDatas[similarData].id;
            var skuName = similarProductDatas[similarData].uniqueId;
            var productUrl = similarProductDatas[similarData].product_url;
            var productOfferPrice = parseInt(similarProductDatas[similarData].product_min_price);
            var productName = similarProductDatas[similarData].product_name;
            var productemi = parseInt(similarProductDatas[similarData].product_emi);
            var productMrp = parseInt(similarProductDatas[similarData].product_striked_off_price);
            var productImage = similarProductDatas[similarData].product_small_image_url;
            var productDiscountPrice = Math.trunc(((productMrp - productOfferPrice) / productMrp) * 100);
            var hideOldProductPrice = "";
            var dataObj = JSON.stringify({ productId: productId, skuName: skuName });
            var dataWishlist = "data-wishlist='" + dataObj + "'"
    
            if (productOfferPrice >= productMrp) {
                hideOldProductPrice = " hide-elem ";
            }
            similarProductsli += '<div class="topled-handler redirect-event wishlist-parent" ' + dataWishlist + ' data-url="' + productUrl + '" data-prod-id ="' + productId + '">' +
                '<li class="clearfix"><a href="javascript:void(0)">' +
                '<div class=" btnsection fav-icon"><p class="heartbtn">' +
                '<img id="heartBtns" class="wishlist-event wishlist wishlist-add-event wishlist-none active lozad" data-src="/content/dam/emistoremarketplace/index/pdppage/pdprevised-icon-heart.png" alt="wishlist">' +
                '<img id="heartBtns" class="wishlist-event wishlist wishlist-remove-event wishlist-none lozad" data-src="/content/dam/emistoremarketplace/index/pdppage/pdprevised-icon-wishlist-fill.svg" alt="wishlist">' +
                '</p></div><div class="prod-item-img">' +
                '<img src=' + productImage + ' alt="emi-store-img" class="inprod-img" loading="lazy">' +
                '</div><div class="tdslide-prod-info"><p class="tdslide-prod-titl onelinepara">' + productName + '</p>' +
                '<p class="tdslide-emi">EMI ₹ ' + formattedPrice(productemi) + '</p>' +
                '<div class="tdoffer-price"><span class="new-offer">₹' + formattedPrice(productOfferPrice) + '</span>' +
                '<span class="old-price ' + hideOldProductPrice + '">₹' + formattedPrice(productMrp) + '</span>' +
                '<span class="new-offer ' + hideOldProductPrice + '">' + productDiscountPrice + '% off</span>' +
                '</div></div>'+
                '</a>'+
                '</li>'+
                '</div>';
        }
    
        if (similarProductsli != "") {
            $(".similar-product-btn").removeClass('dsp-none')
           /*  if ($(".pattern2").hasClass("slick-initialized")) {
                $(".pattern2").slick("unslick");
            } */
            $(".pattern2").html("").html(similarProductsli);
            swiffySliderresponsive($("#more-like-this"));
            addEventWishlistProduct();
            
            $('.redirect-event').on('click', function(e) {
                var name = $(this).find('.tdslide-prod-titl').text();
                var productId = $(this).attr("data-prod-id");
                dlexploreProducts(name, productId);
                var currentEl = e.target
                var url = this.dataset.url;
                if (!$(currentEl).hasClass('wishlist')) {
                    window.open(url, '_blank')
                }
            })
            $(".similar-data").css("display", "block");
        } else {
            $(".pattern2").parents(".best-price-sect").hide();
        }

    }
    addEventSimilarProduct()
}

var callRecentlyViewedData = function callFunctionToPopulateRecentlyViewedProductsData() {
    var recentlyViewedli = "";
    var recentlyViewedData = recentlyViewedProductsData.Recommendations;
    if (!recentlyViewedData) {
        return true;
    }
    for (var viewedData = 0; viewedData < recentlyViewedData.length; viewedData++) {
        var productUrl = recentlyViewedData[viewedData].product_url;
        var productOfferPrice = recentlyViewedData[viewedData].product_min_price;
        var productName = recentlyViewedData[viewedData].product_name;
        var productemi = recentlyViewedData[viewedData].product_emi;
        var productMrp = recentlyViewedData[viewedData].product_striked_off_price;
        var productImage = recentlyViewedData[viewedData].product_small_image_url;
        var productDiscountPrice = Math.trunc(((productMrp - productOfferPrice) / productMrp) * 100);
        recentlyViewedli += '<div class="topled-handler"><li class="clearfix"><a href=' + productUrl + '><div class=" btnsection fav-icon"><p class="heartbtn"><img id="heartBtns" src="/content/dam/emistoremarketplace/index/pdppage/heartImg.png" alt="wishlist"></p></div><div class="prod-item-img"><img src=' + productImage + ' alt="emi-store-img" class="inprod-img"></div><div class="tdslide-prod-info"><p class="tdslide-prod-titl onelinepara">' + productName + '</p><p class="tdslide-emi">EMI ₹ ' + formattedPrice(productemi) + '</p><div class="tdoffer-price"><span class="new-offer">₹' + formattedPrice(productOfferPrice) + '</span><span class="old-price">₹' + formattedPrice(productMrp) + '</span><span class="new-offer">' + productDiscountPrice + '% off</span></div></div></a></li></div>';
    }

    if (recentlyViewedli != "") {
        if ($(".pattern1").hasClass("slick-initialized")) {
            $(".pattern1").slick("unslick");
        }
        $('.pattern1').html("").html(recentlyViewedli);
        $(".recent-data").css("display", "block");
        if ($('.pattern1').length) {
            $('.pattern1').slick({
                infinite: true,
                autoplay: true,
                slidesToShow: 6,
                slidesToScroll: 1,
                lazyLoad: 'ondemand',
                dots: false,
                centerPadding: '0px',
                responsive: [{
                    breakpoint: 1200,
                    settings: {
                        centerMode: true,
                        centerPadding: '0px',
                        slidesToShow: 4.8,
                        slidesToScroll: 1,
                        infinite: true,
                    }
                }, {
                    breakpoint: 992,
                    settings: {
                        arrows: false,
                        slidesToShow: 3.8,
                        slidesToScroll: 1,
                        centerMode: true,
                    }
                }, {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        centerPadding: '50px',
                        initialSlide: 3,
                        arrows: false,
                        centerMode: true,
                    }
                }]
            });
        }

    } else {
        $('.pattern1').parents(".best-price-sect").hide();
    }
}

function callFunctionToPopulateCarousalData() {
    flagOfpdpApiSuccess = similarProductsData != "" ? true : true;
    if (flagOfpdpApiSuccess) {
        if (similarProductsData.status) {
            callsimilarProductsData();
            callRecentlyViewedData();
        }
    }
}

/****************************** PDP PAGE SCRIPT START ********************************/
document.addEventListener("DOMContentLoaded", function () {
    
    /********** Pop up for restricted customers SCRIPT START   **********/
    $('.close-modal-icon-hmev').on("click", closeModal)
    $(".modal-inner-hmev").on("click", closeModal)

    function closeModal(e) {
        if (e.target == e.currentTarget) {
            $('.modal').addClass("dsp-none");
        }
    }
    /********** Pop up for restricted customers SCRIPT END   **********/
})

/********** TYPENAME SCRIPT START   **********/

/* SUBTYPE START */
/* SUBTYPE END   */
/********** TYPENAME SCRIPT END   **********/
/********** TYPENAME SCRIPT START   **********/

/* SUBTYPE START */

/* SUBTYPE END   */
/********** TYPENAME SCRIPT END   **********/



/********** PDP PAGE OTHER SCRIPT START   **********/


/* SUBTYPE START */
/* SUBTYPE END   */
/********** PDP PAGE OTHER SCRIPT END   **********/
/********** PDP PAGE POPUP SCRIPT START   **********/


/* SUBTYPE START */

/* SUBTYPE END   */
/********** PDP PAGE POPUP SCRIPT END   **********/
/****************************** PDP PAGE SCRIPT END ********************************/
var selectedDeliverySeller = "";
var pageonload = true;
var flagExotelOnloadCall = false;
var flagTriggerSellerChangeForDL = false;
var homeDelivarySellerId;
var visitStoreSellerId;
var homeDelivarySellerLength;
var visitStoreSellerLength;
var onLoadDocumentFlag = false;
var sellerChangedCount = 0;
var schemeTosterCount = 0;
var defaultSellerID = "";
var getDirectionHideFlag = false;
var latLongGotFlag = false;
var ratingClickFlag = false;
var insightObj = {}
var mmiApiflag = true;

var custLatFromNdd = "";
var custlongFromNdd = "";
function callPopulateDeliveryDetails() {
    // $("#homeDeliverySelector").hide();
    // $("#storeVisitSelector").hide();
    var deliveryType;
    var selectedSeller;
    if (productData.status) {
        var sellerScoreIsNull = false;

        productData.sellers.forEach(function (element, index) {
            if (element["SellerScore"] !== "" && element["SellerScore"] !== null && element["SellerScore"] !== undefined) {
                sellerScoreIsNull = false;
            }
            else {
                sellerScoreIsNull = true;
            }
        });

        if (!sellerScoreIsNull) {
            var pdpSellersData = productData["sellers"];
            var whileSwap;

            do {
                whileSwap = false;
                for (var counter = 0; counter < pdpSellersData.length - 1; counter++) {
                    if (pdpSellersData[counter]["SellerScore"] < pdpSellersData[counter + 1]["SellerScore"]) {
                        var tempVariable = pdpSellersData[counter];
                        pdpSellersData[counter] = pdpSellersData[counter + 1];
                        pdpSellersData[counter + 1] = tempVariable;

                        whileSwap = true;
                    }
                }
            }
            while (whileSwap);
            selectedSeller = pdpSellersData[0];
            deliveryType = pdpSellersData[0]["DeliveryType"];
        }
        else {
            onChangeSellerID = productData.lowest_offer_price[0].seller;
            schemesID = productData.sellers[onChangeSellerIndex].Schemes[0].SchemeId;
            var productDataSellersLength = productData.sellers.length
            console.time('hii')
            for (var i = 0; i < productDataSellersLength; i++) {
                if(productData.sellers[i].SellerId == onChangeSellerID){
                    onChangeSellerIndex = i;
                    selectedSeller = productData.sellers[i];
                    break;
                } 
            }
            console.timeEnd('hii')
        }

        $("#deliveryDetailsSection").show();
    } else {
        $("#deliveryDetailsSection").hide();
    }

    if (selectedSeller) {
        selectedDeliverySeller = selectedSeller;
        onChangeSellerID = selectedDeliverySeller.SellerId;
        schemesID = selectedDeliverySeller.Schemes[0].SchemeId;
        defaultSellerID = onChangeSellerID
        console.log("selectedSeller : ", selectedSeller);
        $(".delivery-seller-name").text(selectedSeller.SellerName);
        $(".delivery-seller-location").text(selectedSeller.Location);
        $("#defaultSelectedSeller").find("input").attr("data-sellerId", selectedSeller.SellerId);
        $("#defaultSelectedSeller").find("input").attr("data-deliveryType", selectedSeller.DeliveryType);
        $(".delivery-seller-price").text("₹  " + selectedSeller.Offer.Price.toLocaleString());

    }
    if (deliveryType == 1 || deliveryType == null) {
        // Home Delivery
        $("#homeDeliverySelector").show().addClass("selected");
        showDeliverySection("show-home");
    } else if (deliveryType == 2) {
        // Store Pick Up
        $("#storeVisitSelector").show().addClass("selected");
        showDeliverySection("show-store");
    } else if (deliveryType == 3) {
        // Both
        $("#homeDeliverySelector").show();
        $("#storeVisitSelector").show();
    } else {
        $("#homeDeliverySelector").hide();
        $("#storeVisitSelector").hide();
    }
/*     var deliveryStatus = getDeliveryStatusBySeller(selectedSeller);
    $("#deliveryStatus").html(deliveryStatus); */
    if (productData.status) {
        var minPriceArray = [];
        var minprice = "";
        for (var i = 0; i < productData.sellers.length; i++) {

            minprice = productData.sellers[i].Offer.Price;
            minPriceArray.push(minprice);
        }
        var lowPrice = Math.min.apply(Math, minPriceArray).toLocaleString();
        // console.log(minPriceArray);
        // console.log(lowPrice);
        $(".sellerlistpopup").text("View more sellers");
        if (productData.sellers.length <= 1) {
            $(".sellerlistpopup").hide();
        }
        else {
            $(".sellerlistpopup").show();
        }

    }


}

/********* Default Seller Scheme Start *************/
function toogleDefaultSellerSchemeOffer() {
    var defaultsecheme = productData.lowest_offer_price[0].scheme
    var defaultseller = productData.lowest_offer_price[0].seller;
    $(".schemeoffer").addClass("dsp-none");
    productData.sellers.forEach(function (eachseller) {
        if (eachseller.SellerId == defaultseller && defaultseller == onChangeSellerID) {
            for (var i in eachseller.Schemes) { 
                if (defaultsecheme == eachseller.Schemes[i].SchemeId) {
                    if (eachseller.Schemes[i].special_offer_text) {
                        $(".schemeoffer").removeClass("dsp-none");
                    }
                }
            }
        }
    });
}
/********* Default Seller Scheme End *************/

/********* Popup Seller List Start *************/

function setSellerList() {
    $(".no-seller-avail-info").addClass("dsp-none");
    var sellerList = productData["sellers"];
    var nddservicesellerList = [];
    nddservicesellerList = emiStoreApiData.get("nddServiceSellers");
    if (nddservicesellerList != undefined && nddservicesellerList != "") {
        sellerList = nddservicesellerList;
        if(nddservicesellerList.length > 1){
            compareDealers = sellerList.slice(0,3);

            if(nddservicesellerList){
                if($('.pdprev-compareprods-tbl-w-compare-similar-product').hasClass('i-dsp-none')){
                    $('.pdprev-rel-deal-dealer').removeClass('i-dsp-none');
                    $('.pdprev-compareprods-tbl-w-compare-similar-delear').removeClass('i-dsp-none');
            }else{
                    $('.pdprev-compareprods-tbl-w-compare-similar-delear').addClass('i-dsp-none');
            }
            if ($('.revisedCompareTableComponent').hasClass('hide-elem')) {
                $('.revisedCompareTableComponent').removeClass('hide-elem');
              // $('.pdprev-rel-deal-dealer').addClass('active');
                $(".revisedCompareTableComponent").show();

            }
            renderDealerComparision(compareDealers);
            }else{
                $('.pdprev-compareprods-tbl-w-compare-similar-delear').addClass('i-dsp-none');
            $('.pdprev-rel-deal-dealer').addClass('i-dsp-none');

            }
            
        }else{
            compareDealers=sellerList.slice(0,3);
            if (sellerList.length > 1) {
                if(compareDealers){
                    $('.pdprev-rel-deal-dealer').removeClass('i-dsp-none');
                    $('.pdprev-compareprods-tbl-w-compare-similar-delear').removeClass('i-dsp-none');
                    if ($('.revisedCompareTableComponent').hasClass('hide-elem')) {
                        $('.revisedCompareTableComponent').removeClass('hide-elem');
                      // $('.pdprev-rel-deal-dealer').addClass('active');
                        $(".revisedCompareTableComponent").show();
                        renderDealerComparision(compareDealers);
                    }
                }
            }else{
                $('.pdprev-compareprods-tbl-w-compare-similar-delear').addClass('i-dsp-none');
    $('.pdprev-rel-deal-dealer').addClass('i-dsp-none');
            }
        }
        emiStoreApiData.set("nddServiceSellers", "");
        selectAddressDefaultdealerOnload = sellerList ? sellerList[0] : "";
    }else{
        compareDealers=sellerList.slice(0,3);
            if (sellerList.length > 1) {
                if(compareDealers){
                    $('.pdprev-rel-deal-dealer').removeClass('i-dsp-none');
                    $('.pdprev-compareprods-tbl-w-compare-similar-delear').removeClass('i-dsp-none');
                    if ($('.revisedCompareTableComponent').hasClass('hide-elem')) {
                        $('.revisedCompareTableComponent').removeClass('hide-elem');
                      // $('.pdprev-rel-deal-dealer').addClass('active');
                        $(".revisedCompareTableComponent").show();
                        renderDealerComparision(compareDealers);
                    }
                }
            }else{
                $('.pdprev-compareprods-tbl-w-compare-similar-delear').addClass('i-dsp-none');
    $('.pdprev-rel-deal-dealer').addClass('i-dsp-none');
            }
        }
    var pdpSellersData = [];
    var pdpSellerDataWithOUtSellerScore = [];
    var homeDelivarySellerData = []; // Array for home delivery sellers unsorted
    var storeVisitSellerData = []; // Array for visit store sellers unsorted
    // funtion for sorting sellers in descending order of seller ranking
    this.sortArray = function (unsortedArray) {
        var array = unsortedArray;
        var whileSwap;
        do {
            whileSwap = false;
            for (var counter = 0; counter < array.length - 1; counter++) {
                if (array[counter]["SellerScore"] < array[counter + 1]["SellerScore"]) {
                    var tempVariable = array[counter];
                    array[counter] = array[counter + 1];
                    array[counter + 1] = tempVariable;

                    whileSwap = true;
                }
            }
        }
        while (whileSwap);
        return array;
    }

    sellerList.forEach(function (element, index) {
        if (index["SellerScore"] !== "")
            pdpSellersData.push(element);
        else
            pdpSellerDataWithOUtSellerScore.push(element)
    })

    if (pdpSellersData.length > 0) {
        pdpSellersData.forEach(function (element, index) {
            if (element["DeliveryType"] == "1" || element["DeliveryType"] == null)
                homeDelivarySellerData.push(element);
            else if (element["DeliveryType"] == "2" || element["DeliveryType"] == " " || element["DeliveryType"] == "")
                storeVisitSellerData.push(element);
            else if (element["DeliveryType"] == "3") {
                homeDelivarySellerData.push(element);
                storeVisitSellerData.push(element);
            }
        });
        homeDelivarySellerData = this.sortArray(homeDelivarySellerData);
        storeVisitSellerData = this.sortArray(storeVisitSellerData);
    }

    if (pdpSellerDataWithOUtSellerScore.length > 0) {
        pdpSellerDataWithOUtSellerScore.forEach(function (element, index) {
            if (element["DeliveryType"] == "1" || element["DeliveryType"] == null)
                homeDelivarySellerData.push(element);
            else if (element["DeliveryType"] == "2" || element["DeliveryType"] == " " || element["DeliveryType"] == "")
                storeVisitSellerData.push(element);
            else if (element["DeliveryType"] == "3") {
                homeDelivarySellerData.push(element);
                storeVisitSellerData.push(element);
            }
        });
    }

    homeDelivarySellerLength = homeDelivarySellerData.length;
    visitStoreSellerLength = storeVisitSellerData.length;

    $("#home").html("");
    if (homeDelivarySellerData.length > 0) {
        homeDelivarySellerId = homeDelivarySellerData[0].SellerId;
    }
    var interChangeSellerId = '';
    homeDelivarySellerData.forEach(function (element, index) {
        var sellerID = element["SellerId"];
        // if (index == 0) {
        //     homeDelivarySellerId = sellerID;
        // }
        var sellerName = element["SellerName"];
        var deliverySellerType = element["DeliveryType"] == null ? 'HOME_pickup' : element["DeliveryType"];
        var sellerOfferPrice = element["Offer"]["Price"].toLocaleString();
        var is_disabledSeller = element["is_disabled"];
        var distance = Math.round(element["Distance"]*100)/100 || "-";
        distance = (distance==undefined || distance == '-') ? "-" : distance + " Km";
        // interChangeSellerId = (is_disabledSeller == 0) && interChangeSellerId ? interChangeSellerId : sellerID ;
        if (is_disabledSeller) {
            var homeDel = "ndd-seller-popup";
            if ((readCookie("selected_city_pincode"))) {
                var pincode = decodeURI(readCookie("selected_city_pincode")).split("|")[0];
                $(".pincodeText").addClass("pincode-color-textfield");
                $(".main-pincode-input").addClass("input-color-change");
                $(".pincodeText").val("Unavailable for pincode -" + pincode);
            } else {
                $(".pincodeText").removeClass("pincode-color-textfield");
                $(".main-pincode-input").removeClass("input-color-change");
            }
        }
        if (is_disabledSeller != 1) {
            var servicehere = "dsp-none";
        }

        // '        <span class="seller-not-here ' + servicehere + '">Seller does not service here</span>' +
        // var str = (element);
        var sellerdiv = '<div class="pdp-md-seller-li mb-8 deliverysellerlistitem pdp-seller-bx"' + homeDel + '" " data-id="' + sellerID + '">' +
            '    <label class="pdp-md-addr-sel">' +
            '        <input name="home-seller" data-sellerId="' + sellerID + '" class="pdp-md-addr-rd pdpSellerRadio select-seller-event" type="radio" name="pdp-seller-sel-store" data-sellerDeliveryType="' + deliverySellerType + '" data-sellerTypeTab="home">' +
            '		 <span class="pdp-md-addr-rd-des"></span>' +
            '    </label>' +
            '    <div class="pdp-md-seller-licont">' +
            '        <div class="pdp-md-sellername">' +
            '            <span class="pdp-md-selname-text ft-med sellerName ft-bold">' + sellerName + '</span>' +
            '            <div class="pdp-delvto-free-w mt-8">' +
            '            </div>' +
            '        </div>' +
            '        <div class="pdp-md-sellerprice">' +
            // '            <span class="pdp-md-selname-text ft-med">Price</span>' +
            '            <span class="pdp-md-selname-text ft-med ws-nowrap sellerOfferPrice ft-bold">₹ ' + sellerOfferPrice + '</span>' +
            '        </div>' +
            '      <div class="pdp-md-sellerdistance">' +
            // '            <span class="pdp-md-selname-text">Price</span>' +
            '            <span class="pdp-md-selname-text ws-nowrap sellerOfferDistance ft-bold">' + distance + '</span>' +
            '        </div>'
            '    </div>' +
            '</div>';

        $("#home").append(sellerdiv);
    });
    $(function(){
        $('.pdp-seller-bx').click(function() {
        $('.pdp-seller-bx').removeClass('pdp-selector');
        $(this).addClass('pdp-selector');
        });
    });
    $("#store").html("");
    if (storeVisitSellerData.length > 0) {
        visitStoreSellerId = storeVisitSellerData[0].SellerId;
    }
    storeVisitSellerData.forEach(function (element, index) {
        var sellerID = element["SellerId"];
        // if (index == 0) {
        //     visitStoreSellerId = sellerID;
        // }

        var sellerName = element["SellerName"];
        var deliverySellerType = element["DeliveryType"] == null ? 'HOME_pickup' : element["DeliveryType"];
        var sellerOfferPrice = element["Offer"]["Price"].toLocaleString('en-IN');
        var is_disabledSeller = element["is_disabled"];
        var distance = Math.round(element["Distance"]*100)/100 || "-";
        distance = (distance==undefined || distance == '-') ? "-" : distance + " Km";

        // if (is_disabledSeller) {
        //  var storePick = "ndd-seller-popup";

        // }
        // if (is_disabledSeller != 1) {
        //     var servicehere = "dsp-none";
        // }
        var str = (element);
        var sellerdiv = '<div class="pdp-md-seller-li mb-8 deliverysellerlistitem pdp-seller-bx " data-id="' + str + '">' +
            '    <label class="pdp-md-addr-sel">' +
            '        <input name="home-seller" data-sellerId="' + sellerID + '" class="pdp-md-addr-rd pdpSellerRadio select-seller-event" type="radio" name="pdp-seller-sel-store" data-sellerDeliveryType="' + deliverySellerType + '" data-sellerTypeTab="store">' +
            '		 <span class="pdp-md-addr-rd-des"></span>' +
            '    </label>' +
            '    <div class="pdp-md-seller-licont">' +
            '        <div class="pdp-md-sellername pdp-sellertext">' +
            // '           <span class="seller-not-here "' + servicehere + '" ">Seller does not service here</span>' +
            '            <span class="pdp-md-selname-text sellerName ft-bold">' + sellerName + '</span>' +
            '            <div class="pdp-delvto-free-w mt-8">' +
            '            </div>' +
            '        </div>' +
            '        <div class="pdp-md-sellerprice">' +
            // '            <span class="pdp-md-selname-text">Price</span>' +
            '            <span class="pdp-md-selname-text ws-nowrap sellerOfferPrice ft-bold">₹ ' + sellerOfferPrice + '</span>' +
            '        </div>' +
            '       <div class="pdp-md-sellerdistance">' +
            // '            <span class="pdp-md-selname-text">Price</span>' +
            '            <span class="pdp-md-selname-text ws-nowrap sellerOfferDistance ft-bold">' + distance + '</span>' +
            '        </div>'
            '    </div>' +
            '</div>';

        $("#store").append(sellerdiv);
    });
    
$(function(){
        $('.pdp-seller-bx').click(function() {
        $('.pdp-seller-bx').removeClass('pdp-selector');
        $(this).addClass('pdp-selector');
        });
    });
    
    eventSelectSeller()
    var selectedSellerSellerID = $("#defaultSelectedSeller").find("input").attr("data-sellerId");
    $(".pdp-md-seller-list").each(function (i, eachData) {
        $(eachData).find("input").each(function (index, element) {
            if ($(element).attr("data-sellerId") == selectedSellerSellerID) {
                $(element).prop("checked", true);
                selectDeliveryMethod(element);
                if (element.dataset.sellerdeliverytype == "2") {
                    $('[data-list="store"]').click();
                } else {
                    $('[data-list="home"]').click();
                }
            }
        });
    })
    toogleDefaultSellerSchemeOffer();
    if (__is_loginUSer()) {
        var addressId = localStorage.getItem("selectedAddress");
        if (addressId) {
            getAddressApiTrigger();
        }
    }
    revieweClickedStorage();
    storeVisitSellerData && storeVisitSellerData.length <= 1 ? $(".sellerlistpopup").hide():$(".sellerlistpopup").show();
    isMapOptionAvailable();
    var dataMapping = _getDataMapping();
    var status_code = dataMapping.customerDetails.api.icorsFetchOffer.status_code;
    var productCode = selectedDeliverySeller.Offer ? selectedDeliverySeller.Offer.ProductCode : "";
    var is_loan_pod_config = localStorage.getItem("is_loan_pod_config_2w");
    if(!status_code){
        localStorage.setItem("got_both_resp_flag","0") 
    }
    if(status_code == "200" && is_loan_pod_config == "1" && selectedDeliverySeller.instant_credit_approval == true && (productCode == "RTW" || productCode == "UTW")){
        $(".two-wheeler-header-card-limit").addClass("i-dsp-none").css("display","none"); 
        $(".common-header-card-limit").addClass("i-dsp-none")
        $('.two-wheeler-instant-credit-tooltip').removeClass('i-dsp-none');
        localStorage.removeItem("got_both_resp_flag")
    }
    loanpodCongratulationPopup();
}


function selectDeliveryMethod(that) {
    if (sellersListPopUpFlag) {
        var flagValue = 1;
        localStorage.setItem("is_seller_changed", flagValue);
        sellersListPopUpFlag = false;
    }
    updateSellerDetails(that);
    var deliverysellerlistitem = $(that).parents(".deliverysellerlistitem");
    var sellerid = $(deliverysellerlistitem).find("input").attr("data-sellerId");
    var sellerName = $(deliverysellerlistitem).find(".sellerName").text();
    var sellerOfferPrice = $(deliverysellerlistitem).find(".sellerOfferPrice").text();
    var deliveryType = $(".delivertypepop").find("button.selected").attr("data-list");
    var pdpSellersLength = productData.sellers.length

    if(pdpSellersLength){
        for (var i = 0; i < pdpSellersLength; i++) {
            if (productData.sellers[i].SellerId == sellerid) {
                onChangeSellerIndex = i;
                selectedDeliverySeller = productData.sellers[i];
                onChangeSellerID = selectedDeliverySeller.SellerId;
                schemesID = selectedDeliverySeller.Schemes[0].SchemeId;
                selectAddressDefaultdealerOnload = selectedDeliverySeller;
                break;
            }
       }
    }

    var PreferredDealer = emiStoreApiData.get("PreferredDealer");
    if (PreferredDealer && PreferredDealer.length) {
        var hideprefered = false
        PreferredDealer.forEach(function (each, index) {
            if (each.SellerId == selectedDeliverySeller.SellerId) {
                hideprefered = true;
            }
        });
        if (hideprefered) {
            $(".PreferredsellerTag").removeClass("hide-elem");
        } else {
            $(".PreferredsellerTag").addClass("hide-elem");
        }
    }
    else {
        if (__is_loginUSer()) {
            // var stringFormat = decodeURIComponent(readCookie("perpetual_session")).split("|");
            if (__get_perpetual_session("preferred_dealer") == selectedDeliverySeller.SellerId) {
                $(".PreferredsellerTag").removeClass("hide-elem");
            } else {
                $(".PreferredsellerTag").addClass("hide-elem");
            }

        }
    }

    $(".delivery-seller-special-offer").hide();
    $(".delivery-seller-name").text(selectedDeliverySeller.SellerName);
    $(".delivery-seller-location").text(selectedDeliverySeller.Location);
    $("#defaultSelectedSeller").find("input").attr("data-sellerId", selectedDeliverySeller.SellerId);
    $("#defaultSelectedSeller").find("input").attr("data-deliveryType", selectedDeliverySeller.DeliveryType);
    $(".delivery-seller-price").text("₹  " + selectedDeliverySeller.Offer.Price.toLocaleString());
    // $("body").css("overflow", "");
    $('body').removeClass('noscrollbody');
    $(".pdp-modal-overlay").removeClass("showpopup");
    // isMapOptionAvailable();
    productData.sellers && productData.sellers.forEach(function (eachSeller) {
        if (eachSeller.SellerId == selectedDeliverySeller.SellerId) {
            if (eachSeller.Offer.SpecialOfferDeals.length) {
                // $(".delivery-seller-special-offer").text(eachSeller.Offer.SpecialOfferDeals[0].offers_description).show();
                $(".delivery-seller-special-offer").text(eachSeller.Offer.SpecialOfferDeals[0].offer_desc).show();
                trimTextEllipsis(30);
            }
        }
    })
    try {
        if (flagTriggerSellerChangeForDL) {
            pdpSellerOptionCheckDataLayer();
        }
    } catch (errorMsg) {
        console.warn('%c ', errorMsg, 'color:orange');
    }
    if (onLoadDocumentFlag) {
        callAfterSellerChange();
    }
    validateDocRequiredFlag();
    api.onLoadAboutDealer();
    if(sellerChangedCount >= 1){
        dlCallNddGovernance();
    }
    /* if(flagExotelOnloadCall){
        exotelIdentifierApi();
    }else{
        flagExotelOnloadCall = true;
    } */
    productNotAvailFromAddAPi();
    try{
        promocodeBannerDisplay();
    }catch(e){
        console.log(e);
    }
}

function isMapOptionAvailable(sellerchange){
    var dealer_lat = "";
    var dealer_long = "";
    var mapmmiData = "";
    $(".get-direction-km-c").addClass("dsp-none");
    $(".getdirection-main-div").addClass("dsp-none");
    if(selectAddressDefaultdealerOnload){
        var customer_lat = locationlatitude ? locationlatitude : "";
        var customer_long = locationlongitude ? locationlongitude : "";
        if(!customer_lat && !customer_long){
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    customer_lat = position.coords.latitude;
                    customer_long = position.coords.longitude;

                    dealer_lat = selectAddressDefaultdealerOnload.DealerLat ? selectAddressDefaultdealerOnload.DealerLat :"";
                    dealer_long = selectAddressDefaultdealerOnload.DealerLong ? selectAddressDefaultdealerOnload.DealerLong  :"";
                    dealer_lat = selectAddressDefaultdealerOnload.Latitude ? selectAddressDefaultdealerOnload.Latitude : dealer_lat;
                    dealer_long = selectAddressDefaultdealerOnload.Longitude ? selectAddressDefaultdealerOnload.Longitude  : dealer_long;
                    if(selectedDeliverySeller.SellerId == selectAddressDefaultdealerOnload.SellerId){
                        if(customer_lat && customer_long && dealer_lat && dealer_long){
                          var apxDist = approxDistanceForMMI(customer_lat,customer_long,dealer_lat,dealer_long);
                            mapmmiData = {
                                "customer_lat" : customer_lat,
                                "customer_long" : customer_long,
                                "dealer_lat" : dealer_lat,
                                "dealer_long" : dealer_long,
                                "apxDist" : apxDist
                            }
                            if (mmiApiflag) {
                                mmiApiflag = false;
                                callMMIAPIUtility(mapmmiData)
                            }else if(sellerchange){
                                $(".apx-distance-txt").html(parseInt(mapmmiData.apxDist.toFixed(1)))
                                $(".get-direction-km-c").removeClass("dsp-none");
                                $(".getdirection-main-div").removeClass("dsp-none");
                                $(".default-dealer_direction_event").attr("data-selected-dealer-latitude", mapmmiData.dealer_lat);
                                $(".default-dealer_direction_event").attr("data-selected-dealer-longitude", mapmmiData.dealer_long);
                                $(".default-dealer_direction_event").attr("data-selected-customer-latitude", mapmmiData.customer_lat);
                                $(".default-dealer_direction_event").attr("data-selected-customer-longitude",mapmmiData. customer_long);
                            }
                        }
                    }
                });
            }
        }
        dealer_lat = selectAddressDefaultdealerOnload.DealerLat ? selectAddressDefaultdealerOnload.DealerLat :"";
        dealer_long = selectAddressDefaultdealerOnload.DealerLong ? selectAddressDefaultdealerOnload.DealerLong  :"";
        dealer_lat = selectAddressDefaultdealerOnload.Latitude ? selectAddressDefaultdealerOnload.Latitude : dealer_lat;
        dealer_long = selectAddressDefaultdealerOnload.Longitude ? selectAddressDefaultdealerOnload.Longitude  : dealer_long;
        if(selectedDeliverySeller.SellerId == selectAddressDefaultdealerOnload.SellerId){
            if(customer_lat && customer_long && dealer_lat && dealer_long){
                var apxDist = approxDistanceForMMI(customer_lat,customer_long,dealer_lat,dealer_long);
               mapmmiData = {
                   "customer_lat" : customer_lat,
                   "customer_long" : customer_long,
                   "dealer_lat" : dealer_lat,
                   "dealer_long" : dealer_long,
                   "apxDist" : apxDist
               }
                if (mmiApiflag) {
                    mmiApiflag = false;
                    callMMIAPIUtility(mapmmiData)
                }else if(sellerchange){
                    $(".apx-distance-txt").html(parseInt(mapmmiData.apxDist.toFixed(1)))
                    $(".get-direction-km-c").removeClass("dsp-none");
                    $(".getdirection-main-div").removeClass("dsp-none");
                    $(".default-dealer_direction_event").attr("data-selected-dealer-latitude", mapmmiData.dealer_lat);
                    $(".default-dealer_direction_event").attr("data-selected-dealer-longitude", mapmmiData.dealer_long);
                    $(".default-dealer_direction_event").attr("data-selected-customer-latitude", mapmmiData.customer_lat);
                    $(".default-dealer_direction_event").attr("data-selected-customer-longitude",mapmmiData. customer_long);
                }
               // $(".apx-distance-txt").html(parseInt(apxDist.toFixed(1)))
               // $(".get-direction-km-c").removeClass("dsp-none");
               // $(".getdirection-main-div").removeClass("dsp-none");
               // $(".default-dealer_direction_event").attr("data-selected-dealer-latitude", dealer_lat);
               // $(".default-dealer_direction_event").attr("data-selected-dealer-longitude", dealer_long);
               // $(".default-dealer_direction_event").attr("data-selected-customer-latitude", customer_lat);
               // $(".default-dealer_direction_event").attr("data-selected-customer-longitude", customer_long);
           }
        }
    } 
}
function approxDistanceForMMI(lat1, lon1, lat2, lon2){
    var R = 6371;
    var dLat = toRad(lat2 - lat1);
    var dLon = toRad(lon2 - lon1);
    var lat1 = toRad(lat1);
    var lat2 = toRad(lat2);
    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    var d = R * c;
    return d;
    function toRad(Value) {
        return Value * Math.PI / 180;
    }
}
function showPosition(position) {
    fromLat = position.coords.latitude
    fromLong = position.coords.longitude;
    distanceObj.from_lat = fromLat ? fromLat : "";
    distanceObj.from_long = fromLong ? fromLong : "";
}

function revieweClickedStorage(){
    if (localStorage.getItem('reviewClicked')) {
        $(".write-review-event").click()
        localStorage.removeItem('reviewClicked')
    }
}
function productNotAvailFromAddAPi(){
    var isSellerPopup = localStorage.getItem("issellerpopupshow");
    if (isSellerPopup == "true") {
        showSellerSel(true);
        $('#seller-sel').addClass('showpopup');
        $(".no-seller-avail-info").removeClass("dsp-none");
        localStorage.setItem("issellerpopupshow", "false");
    }
}

/********* Popup Seller List End *************/

function getDeliveryStatusBySeller(selectedSeller) {
    if (productData.product_video_url != null) {
        $(".deliveryvideoanchor").attr("href", productData.product_video_url);
    } else {
        $(".deliveryvideo").hide();
    }
    var deliveryStatus = "";
    var deliveryTime = "";
    var deliverytat = selectedSeller.DeliveryCharges.tat;
    var default_tat_before5 = selectedSeller.DeliveryCharges.default_tat_before_5;
    var default_tat_after5 = selectedSeller.DeliveryCharges.default_tat_after_5;
    var tat = deliverytat;
    if (deliverytat == null || deliverytat == "") {
        if (selectedSeller.DeliveryCharges.hasOwnProperty("default_tat_before_5") || selectedSeller.DeliveryCharges.hasOwnProperty("default_tat_after_5")) {
            var fivepm = new Date(new Date().setHours(17, 0, 0));
            if (fivepm > new Date()) {
                // Before 5pm
                tat = default_tat_before5 || "";
            } else {
                // After 5pm
                tat = default_tat_after5 || "";
            }
        } else {
            tat = deliverytat;
        }
    }
    var months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
    ];

    if (tat === "" || (tat >= 0 && tat <= 5)) {
        // deliveryStatus = " "+new Date().toDateString()+" Today";
        var currDate = new Date();
        var dayRomanStr = getRomanWord(currDate);
        var aftermidnight = new Date(new Date().setHours(0, 0, 0, 0)).getTime();
        var beforeevening = new Date(new Date().setHours(17, 0, 0, 0)).getTime();
        var currtimming = new Date().getTime();

        if (aftermidnight < currtimming && currtimming < beforeevening) {
            deliveryStatus =
                '<span class="pdp-homedevltext dsp-block">Free Home Delivery by </span><span class="pdp-delv-date dsp-block ft-bold">' +
                +currDate.getDate() +
                dayRomanStr + " " +
                months[currDate.getMonth()] +
                "</span>";
            deliveryTime = '<span class="pd-instacheck-addtitle">Home delivery till</span><span class="pd-instacheck-addtitle pd-og-black">' +
                +currDate.getDate() +
                dayRomanStr + " " +
                months[currDate.getMonth()] +
                "</span>";

            var todaydateVal = currDate.getDate();
            var todaymonthVal = months[currDate.getMonth()];
            // deliveryTime = todaydateVal + " th " + todaymonthVal + "," + " Today";
            deliveryTime = todaydateVal + dayRomanStr + " " + todaymonthVal + "," + " Today";
        }
        else {

            var tommorow = new Date(new Date().getTime() + 1 * 24 * 60 * 60 * 1000);
            dayRomanStr = getRomanWord(tommorow);
            deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery by </span><span class="dsp-block pdp-delv-date ft-bold">' +
                + tommorow.getDate() +
                dayRomanStr + " " +
                months[tommorow.getMonth()] +
                "</span>";

            var tommorowdateVal = tommorow.getDate();
            var tommorowmonthVal = months[tommorow.getMonth()];
            // deliveryTime = tommorowdateVal + " th " + tommorowmonthVal + "," + " Tomorrow";
            deliveryTime = tommorowdateVal + dayRomanStr + " " + tommorowmonthVal + "," + " Tomorrow";

        }
    } else if (tat >= 6 && tat <= 24) {
        // deliveryStatus = " in 1-2 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold"> in 1-2 days</span>';
        deliveryTime = 'in 1-2 days';
    } else if (tat >= 25 && tat <= 48) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 2-3 days</span>';
        deliveryTime = 'in 2-3 days';
    }
    else if (tat >= 49 && tat <= 72) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 3-4 days</span>';
        deliveryTime = 'in 3-4 days';
    }
    else if (tat >= 73 && tat <= 96) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 4-5 days</span>';
        deliveryTime = 'in 4-5 days';
    }
    else if (tat >= 97 && tat <= 120) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 5-6 days</span>';
        deliveryTime = 'in 5-6 days';
    }
    else if (tat >= 121 && tat <= 144) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 6-7 days</span>';
        deliveryTime = 'in 6-7 days';
    }
    else if (tat >= 145 && tat <= 168) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 7-8 days</span>';
        deliveryTime = 'in 7-8 days';
    }
    else if (tat >= 169 && tat <= 192) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 8-9 days</span>';
        deliveryTime = 'in 8-9 days';
    }
    else if (tat >= 193 && tat <= 216) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 9-10 days</span>';
        deliveryTime = 'in 9-10 days';
    }
    else if (tat >= 217 && tat <= 240) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 10-11 days</span>';
        deliveryTime = 'in 10-11 days';
    }
    else if (tat >= 241 && tat <= 264) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 11-12 days</span>';
        deliveryTime = 'in 11-12 days';
    }
    else if (tat >= 265 && tat <= 288) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 12-13 days</span>';
        deliveryTime = 'in 12-13 days';
    }
    else if (tat >= 289 && tat <= 312) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 13-14 days</span>';
        deliveryTime = 'in 13-14 days';
    }
    else if (tat >= 313 && tat <= 336) {
        // deliveryStatus = "in 2-3 working days";
        deliveryStatus = '<span class="pdp-homedevltext dsp-block">Free Home Delivery </span><span class="pdp-delv-date dsp-block ft-bold">in 14-15 days</span>';
        deliveryTime = 'in 14-15 days';
    }
    else {
        console.warn("Delivery Date is not Valid ");
    }

    emiStoreApiData.set("deliveryStatus", "");
    emiStoreApiData.set("deliveryStatus", deliveryTime);
    $("#deliveryStatus").html("");
    $("#deliveryStatus").html(deliveryStatus);
    return deliveryStatus;
};

$(document).ready(function (e) {
    $(".pdp-default-selection-button").on("click", function (e) {
        interChangeSellerIdFlag = false;
        if (this.id == "homeDeliverySelector") {
            $(".visitStoreToolTip").addClass("dsp-none");
        } else {
            $(".visitStoreToolTip").removeClass("dsp-none");
        }
        var datadeliverytype = $("#defaultSelectedSeller").find("input").attr("data-deliverytype");
        //emiStoreApiData.set("datadeliverytype",datadeliverytype);
        deliveryOptionCheckDataLayer(this.id);
        if (datadeliverytype == 3) {
            $(".pdp-default-selection-button").removeClass("selected");
            $(this).addClass("selected");
            var id = this.id;
            if (id === "homeDeliverySelector") {
                showDeliverySection("show-home");

            } else if (id === "storeVisitSelector") {
                showDeliverySection("show-store");
            }

        } else {
            var id = this.id;
            //$("#seller-sel").addClass("showpopup");
            // $(".pdp-default-selection-button").removeClass("selected");
            // $(this).addClass("selected");
            if (id === "homeDeliverySelector") {
                $("#defaultSelectedSeller").find("input").attr("data-sellerId", homeDelivarySellerId);
                emiStoreApiData.set("isStorePickupSelected", false);
                setSellerList();
                // $("#homeDeliverySelector").show().addClass("selected");
                $(".pdp-default-selection-button").removeClass("selected");
                $(this).addClass("selected");
                showDeliverySection("show-home");
                $('[data-list="home"]').click();
                setSellerList();
            } else if (id === "storeVisitSelector") {
                // $("#storeVisitSelector").show().addClass("selected");
                // showDeliverySection("show-store");
                // $('[data-list="store"]').click();
                $("#defaultSelectedSeller").find("input").attr("data-sellerId", visitStoreSellerId);
                emiStoreApiData.set("isStorePickupSelected", true);
                setSellerList();
                $(".pdp-default-selection-button").removeClass("selected");
                $(this).addClass("selected");
                showDeliverySection("show-store");
                $('[data-list="store"]').click();

            }
        }
    })
})

function loanpodCongratulationPopup(){
    var urlParams = new URL(window.location.href).searchParams;
    var param1 = urlParams.get('flg');
    var param2 = urlParams.get('respcode');
    var successPodLocal = localStorage.getItem('loan-pod-wrapper');
    if(param2 && param1 && !successPodLocal == "" && successPodLocal == 1) {
        var loanPodSellerId = localStorage.getItem('loan-pod-selected-seller-id');
        var loanPodSchemeId = localStorage.getItem('loan-pod-selected-scheme-id');
        if(loanPodSellerId && loanPodSchemeId){
            $('[data-sellerid="' + loanPodSellerId + '"]').parents(".pdp-md-addr-sel").find(".select-seller-event").click();
            $('[data-scheme-data-id="' + loanPodSchemeId + '"]').click()
    
        }
        let roadPrice = selectedDeliverySeller.Offer.Price ? "₹" + selectedDeliverySeller.Offer.Price.toLocaleString() : $('.prod-m-price.txt-space').text();
        let dataOnPdpEmi  = selectedSchemeDataOnPdp.emi ? (new Intl.NumberFormat("en-IN").format(selectedSchemeDataOnPdp.emi)) : "0";
        let dataOnPdpTenure = selectedSchemeDataOnPdp.tenure ? (new Intl.NumberFormat("en-IN").format(selectedSchemeDataOnPdp.tenure)) : "";
        let dataOnPdpDownPayment = selectedSchemeDataOnPdp.hasOwnProperty("downPayment") ? selectedSchemeDataOnPdp.downPayment.toString() : selectedSchemeDataOnPdp.downpayment.toString() 
        dataOnPdpDownPayment = dataOnPdpDownPayment ? (new Intl.NumberFormat("en-IN").format(dataOnPdpDownPayment)) : "";
        let dataOnPdpSchemeIRR = !isNaN(selectedSchemeDataOnPdp.SchemeIRR) ?  true: false;
        dataOnPdpSchemeIRR = dataOnPdpSchemeIRR ? (new Intl.NumberFormat("en-IN").format(selectedSchemeDataOnPdp.SchemeIRR)) : "";
        $('.loan-pod-on-road-price').text(roadPrice);
        $('.loan-pod-emi-month .emi-amount-txt').text(dataOnPdpEmi)
        $('.loan-pod-emi-month .emi-months-txt').text(dataOnPdpTenure)
        $('.loan-pod-downPayment .downPayment-txt').text(dataOnPdpDownPayment)
        $('.loan-pod-roi .loan-pod-roi-txt').text(dataOnPdpSchemeIRR)
        show2wLoanPodScreen('loan-pod-congratulation-popup');
        localStorage.removeItem('loan-pod-selected-seller-id');
        localStorage.removeItem('loan-pod-selected-scheme-id');
        localStorage.removeItem('loan-pod-wrapper');
    }
}




/************PincodeApi Start **************************/
var interCityBuyNowCallFlag = false;
var interChangeSellerIdFlag = false;

function buttonLoaderToggle(_this, ele) {
    if (ele) {
        if ($(_this).hasClass("btn-sm-loader")) {
         //$(_this).addClass("btn-loader-active");
        }
        $(_this).children().addClass("right-circle");
        $(_this).addClass("btn-disabled");
    } else {
        $(_this).removeClass("btn-loader-active");
        $(_this).children().removeClass("right-circle");
        $(_this).removeClass("btn-disabled");

    }
}

if ((readCookie("selected_city_pincode"))) {
    registerAddressApiFunction();
}

//Pincode trigger function

//NON login POP-UP on submit btn for pincode Api
$(".pincode-submit").on("click", function () {
    var pincodevalue = $(".non-logCode").val();
    var section = 'non-loggedIn';
    var dealerId = $("#defaultSelectedSeller").find("input").attr("data-sellerId");
    emiStoreApiData.set("nonlogPinCode", pincodevalue);
    var addressId = localStorage.getItem("selectedAddress") ? localStorage.getItem("selectedAddress") : '';
    localStorage.setItem("cityChangeToaster",true);
    if (pincodevalue != "") {
        emiStoreApiData.set("selectedAddress", null);
        emiStoreApiData.set("selectedAddress", pincodevalue);

        buttonLoaderToggle(".pincode-submit", true);
        if ($(".non-logCode").val() == decodeURI(readCookie("selected_city_pincode")).split("|")[0]) {
            buttonLoaderToggle(".pincode-submit", false);
            $("#nonlog-sel").removeClass("showpopup");
            // pincodeApiTrigger(pincodevalue);



        } else {
            // pincodeApiTrigger(pincodevalue);
            //selectaddressAPiTrigger(pincodevalue, addressId, dealerId);
            api.validatePincode(pincodevalue,section,dealerId,addressId);
        }
        registerAddressApiFunction();
    }
});


//Open signUp pop up On click of Non login pin code Pop up
$(".signIn-signUp").on("click", function () {
    showPopup("show-mobile");
    $("#nonlog-sel").removeClass("showpopup");
});

/************Registered Address API End **************************/
function registerAddressApiFunction() {
    if (__is_loginUSer()) {
        var addressSelected = emiStoreApiData.get("isaddressChecked");
        var addressvalue = emiStoreApiData.get("selectedAddress") ? emiStoreApiData.get("selectedAddress") : '';
        if ((addressSelected === true) && (addressvalue)) {
            $(".pincodeText").val("");
            $(".pincodeText").val(addressvalue);
        }
        else if (!($(".pincodeText").val().trim()) && readCookie("selected_city_pincode")) {
            $(".pincodeText").val("");
            $(".pincodeText").val(decodeURI(readCookie("selected_city_pincode")).split("|")[0]);
        } else{
            $(".pincodeText").val("");
        }
    }
    else {
        //emiStoreApiData.set("selectedAddress", null);
        var pincode = emiStoreApiData.get("selectedAddress");
        if (pincode) {
            $(".pincodeText").val("");
            $(".pincodeText").val(pincode);
        }else {
            $(".pincodeText").val("");
        }
    }
}

$(".addressPincodeText").on("click", function () {
    var uncheckaddress = emiStoreApiData.get("selectedAddressID");
    $("#uncheckaddress").prop("checked", false)
    emiStoreApiData.set("selectedAddressID", null);
})

//PINcode Api  call on click of  Register address popup change btn 


//CheckAddress Function 
 var addressPopupFlag = false;
/* Nearest Product Dealers Service Api Start */
function selectaddressAPiTrigger(pincodeId, addressId, dealerId) {
    $(".error-message-div").addClass("dsp-none");
	var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : "";
    if (custToken == "" && readCookie("custToken")) {
        custToken = readCookie("custToken");
    }
    var productID = $('meta[name="productSku"]').attr("content");
    var cityId = readCookie("selected_city");
    var pincode = "";
    if (pincodeId) {
        pincode = pincodeId;
    }
    else if (readCookie("selected_city_pincode")) {
        pincode = decodeURI(readCookie("selected_city_pincode")).split("|")[0];
    }

    pincode = pincode.length > 6 ? pincode.substr(0, 6) : pincode;
    /* if (!(readCookie("pincode"))) {
        setCookie("pincode", pincode, 90);
    } */
    if(pincode){
        pincode=toEncryptDecryptAES(pincode, "en");
    }
    // var dealerId = $("#defaultSelectedSeller").find("input").attr("data-sellerId");
    var dealerId = dealerId;
    //$(".pincodeText").val(pincode);
    var assettype = emiStoreApiData.get("asset_type");
    var addressID = "";
    if (addressId) {
        addressID = addressId;
    }

    var latitude = "";
    var longitude = "";
    var preferredGrpid = "";
    var customer_user_id = " ";
    var customerKey = "";
    var cardStatus = "";
    var doc_required_flag = "";

    if (__is_loginUSer()) {
        if (localStorage.getItem("selectedAddress")) {
            //     addressId = localStorage.getItem("selectedAddress");
        }
        var stringFormat = decodeURIComponent(readCookie("perpetual_session")).split("|");
        customer_user_id = __get_perpetual_session("customer_id");
        latitude = __get_perpetual_session("customer_lat");
        longitude = __get_perpetual_session("customer_long");
        preferredGrpid = __get_perpetual_session("preferred_dealer");
        customerKey = __get_perpetual_session("customer_rank");
        cardStatus = __get_perpetual_session("card_status");
        doc_required_flag = __get_perpetual_session("doc_required_flag");
    }

    if (preferredGrpid == undefined) {
        preferredGrpid = "";
    }
  var cityType = decodeURI(readCookie("selected_city_pincode")).split("|")[1] ? decodeURI(readCookie("selected_city_pincode")).split("|")[1]: "urban";
    var _gaVal = "";
    if (readCookie("_ga")) {
        var _gaarr = readCookie("_ga").split(".");
        _gaarr.splice(0, 2);
        _gaVal = _gaarr.join(".");
    }
    // reqObj = {
    //     "addressId": addressId,
    //     "customer_user_id": customer_user_id,
    //     "productId": productID,
    //     "cityId": cityId,
    //     "pincode": pincode,
    //     "preferredGrpid": preferredGrpid,
    //     "asseType": assettype,
    //     "cityType": city,
    //     "customerKey": customerKey,
    //     "GaId": _gaVal,
    //     "CardStatus": cardStatus
    // }

    reqObj = {
        "customer_user_id": customer_user_id,
        "productId": productID,
        "latitude": latitude,
        "longitude": longitude,
        "cityId": cityId,
        "pincode": pincode,
        "preferredGrpid": preferredGrpid,
        "asseType": assettype,
        "cityType": cityType,
        "customerKey": customerKey,
        "GaId": _gaVal,
        "CardStatus": cardStatus,
        "documentFlag": doc_required_flag,
        "cust_token": custToken,
        "dealer_id": dealerId,
        "addressId": addressID
    }
    var url = baseUrl + "/signin/address/selectaddress";
    //var url = appConfig.apiRoot + "." + apiConfig.SELECT_ADDRESS.selector + appConfig.apiExtension;
    //"https://bfsd.qa.bfsgodirect.com/emistore/rest/V1/nearestdealer";
    sendApiRequest(reqObj, url, bearerTokenConfig, "POST", nddServiceAPiResponseHandler, "", "json", false, "");
}

function nddServiceAPiResponseHandler(status, resp) {
    var response = resp;
    if (status) {
        selectaddressCalledDL = true;
        var selectedCity = readCookie("selected_city");
        var cityName = "";
        if (response.city_name) {
            cityName = response.city_name;
        }
        var cityId = response.city_id;
        custLatFromNdd = response.cust_latitude ? response.cust_latitude : "";
        custlongFromNdd = response.cust_longitude ? response.cust_longitude : "";
        var pincode = decodeURI(readCookie("selected_city_pincode")).split("|")[0];
        if (cityId == selectedCity) {
            if (productData.status == false) {
                setCookie("selected_city_name", cityName, 90);
                setCookie("selected_city", cityId, 90);
                // setCookie("pincode", pincode, 90);
                localStorage.setItem("cityId", cityId);
                localStorage.setItem("cityName", cityName);
                localStorage.setItem("pincode", pincode);
                var uncheckaddress = emiStoreApiData.get("selectedAddressID");
                $("#uncheckaddress").prop("checked", false)
                emiStoreApiData.set("selectedAddressID", null);
                // localStorage.setItem('schemeChanged', true);
                $("#uncheckaddress").prop("checked", false)
                emiStoreApiData.set("selectedAddressID", null);
                location.reload();
            }
            var isstorePickup = $('#storeVisitSelector').hasClass('selected');
            if (response.is_disabled == 1 && isstorePickup == false) {
                $(".pincodeText").addClass("pincode-color-textfield");
                $(".main-pincode-input").addClass("input-color-change");
                $(".pincodeText").val("");
                $(".pincodeText").val("Unavailable for pincode -" + pincode);
                emiStoreApiData.set("selectedAddress", null);
                emiStoreApiData.set("selectedAddress","Unavailable for pincode -" + pincode);
                registerAddressApiFunction();

            } else {
                emiStoreApiData.set("selectedAddress", null);
                $(".pincodeText").removeClass("pincode-color-textfield");
                $(".main-pincode-input").removeClass("input-color-change");

            }
            setCookie("selected_city_name", cityName, 90);
            setCookie("selected_city", cityId, 90);
            // setCookie("pincode", pincode, 90);
            localStorage.setItem("cityId", cityId);
            localStorage.setItem("cityName", cityName);
            localStorage.setItem("pincode", pincode);
            togglePopupLoader(false);
            buttonLoaderToggle(".addresspincode", false);
            buttonLoaderToggle(".pincode-submit", false);
            buttonLoaderToggle($(".pincodeChange"), false);
            $("#nonlog-sel").removeClass("showpopup");
            $("#del-address-sel").removeClass("showpopup");
            emiStoreApiData.set("PreferredDealer", "");
            var nddServiceSellers = [];
            var PreferredDealer = [];
            var DefaultDealer = [];
            var PreferredDealerSellerName = [];
            var DefaultDealerSellerName = [];
            var popupflag = false;

			
            if (response.result.DefaultDealer) {
                globalDataLayerObj.Distance = response.result.DefaultDealer.Distance ? response.result.DefaultDealer.Distance : "";
            }

            for (var j = 0; response.result.PreferredDealer && j < response.result.PreferredDealer.length; j++) {
                for (var i = 0; productData.sellers && i < productData.sellers.length; i++) {
                    if (response.result.PreferredDealer[j].DealerId == productData.sellers[i].SellerId) {
                        productData.sellers[i].DeliveryType = response.result.PreferredDealer[j].DeliveryType;
                        productData.sellers[i].SellerScore = "";
                        productData.sellers[i].Distance = response.result.PreferredDealer[j].Distance ? response.result.PreferredDealer[j].Distance : '';
                        productData.sellers[i].Latitude = response.result.PreferredDealer[j].latitude ? response.result.PreferredDealer[j].latitude : '';
                        productData.sellers[i].Longitude = response.result.PreferredDealer[j].longitude ? response.result.PreferredDealer[j].longitude : '';
                        // productData.sellers[i].store_direction_config = response.result.PreferredDealer[j].store_direction_config ? response.result.PreferredDealer[j].store_direction_config : '';
                        nddServiceSellers.push(productData.sellers[i]);
                        PreferredDealer.push(productData.sellers[i]);
                        PreferredDealerSellerName.push(productData.sellers[i].SellerName)
                        break;
                    }
                }
            }

            for (var j = 0; response.result.DefaultDealer && j < response.result.DefaultDealer.length; j++) {
                for (var i = 0; productData.sellers && i < productData.sellers.length; i++) {
                    if (response.result.DefaultDealer[j].DealerId == productData.sellers[i].SellerId) {
                        productData.sellers[i].DeliveryType = response.result.DefaultDealer[j].DeliveryType;
                        productData.sellers[i].is_disabled = response.result.DefaultDealer[j].is_disabled;
                        productData.sellers[i].SellerScore = "";
                        productData.sellers[i].Distance = "";
                        productData.sellers[i].SellerScore = (response.result.DefaultDealer[j].Score).split(".")[0];
                        productData.sellers[i].Distance = response.result.DefaultDealer[j].Distance ? response.result.DefaultDealer[j].Distance : '';
                        productData.sellers[i].Latitude = response.result.DefaultDealer[j].latitude ? response.result.DefaultDealer[j].latitude : '';
                        productData.sellers[i].Longitude = response.result.DefaultDealer[j].longitude ? response.result.DefaultDealer[j].longitude : '';
                        productData.sellers[i].Distance = response.result.DefaultDealer[j].Distance;
                        // productData.sellers[i].store_direction_config = response.result.PreferredDealer[j].store_direction_config ? response.result.PreferredDealer[j].store_direction_config : '';
                        nddServiceSellers.push(productData.sellers[i]);
                        DefaultDealer.push(productData.sellers[i]);
                        DefaultDealerSellerName.push(productData.sellers[i].SellerName)
                        break;
                    }
                }
            }


            for (var j = 0; response.result.NearestDealerKm && j < response.result.NearestDealerKm.length; j++) {
                for (var i = 0; productData.sellers && i < productData.sellers.length; i++) {
                    if (response.result.NearestDealerKm[j].DealerId == productData.sellers[i].SellerId) {
                        productData.sellers[i].DeliveryType = response.result.NearestDealerKm[j].DeliveryType;
                        productData.sellers[i].SellerScore = "";
                        productData.sellers[i].Distance = response.result.NearestDealerKm[j].Distance ? response.result.NearestDealerKm[j].Distance : '';
                        nddServiceSellers.push(productData.sellers[i]);
                        break;
                    }
                }
            }


            for (var j = 0; response.result.Nearest10dealer && j < response.result.Nearest10dealer.length; j++) {
                for (var i = 0; productData.sellers && i < productData.sellers.length; i++) {
                    if (response.result.Nearest10dealer[j].DealerId == productData.sellers[i].SellerId) {
                        productData.sellers[i].DeliveryType = response.result.Nearest10dealer[j].DeliveryType;
                        productData.sellers[i].SellerScore = "";
                        productData.sellers[i].Distance = response.result.Nearest10dealer[j].Distance ? response.result.Nearest10dealer[j].Distance : '';
                        nddServiceSellers.push(productData.sellers[i]);
                        break;
                    }
                }
            }


            for (var j = 0; response.result.Remainingdealers && j < response.result.Remainingdealers.length; j++) {
                for (var i = 0; productData.sellers && i < productData.sellers.length; i++) {
                    if (response.result.Remainingdealers[j].DealerId == productData.sellers[i].SellerId) {
                        productData.sellers[i].DeliveryType = response.result.Remainingdealers[j].DeliveryType;
                        productData.sellers[i].SellerScore = "";
                        productData.sellers[i].Distance = response.result.Remainingdealers[j].Distance ? response.result.Remainingdealers[j].Distance : '';
                        nddServiceSellers.push(productData.sellers[i]);
                        break;
                    }
                }
            }
            emiStoreApiData.set("nddServiceSellers", nddServiceSellers);
            emiStoreApiData.set("PreferredDealer", PreferredDealer);
            var PreferredDealerId = emiStoreApiData.get("PreferredDealer");
            var cityChangeFlag = emiStoreApiData.get("city_change_popUp");
            var onpageLoadSeller = emiStoreApiData.get("pdp_page_buynowseller");
            var nddservicesellerId = emiStoreApiData.get("nddServiceSellers");

            if ((cityChangeFlag === false) && (onpageLoadSeller)) {
                emiStoreApiData.get("pdp_page_buynowseller", null);
                emiStoreApiData.set("city_change_popUp", true);
                var nameOfUser = localStorage.getItem("emiStoreName");
                if (PreferredDealerId && PreferredDealerId.length) {
                    var PreferredDealerPopup = "Show"
                    PreferredDealerId.forEach(function (each, index) {
                        if (each.SellerId == onpageLoadSeller) {
                            PreferredDealerPopup = "Hide"
                            $("#defaultSelectedSeller").find("input").attr("data-sellerId", each.SellerId);
                            setSellerList();
                            registerAddressApiFunction();
                            var functionName = dataStoreUtility.getPDS("emiStore-PDP").get("addToCartBuyNowApiCall");
                            var functionBuynow = emiStoreApiData.get("callBuyNowApi");
                            if (functionName) {
                                functionName();
                                emiStoreApiData.set("addToCartBuyNowApiCall", null);
                            }
                            else if (functionBuynow) {
                                functionBuynow();
                                emiStoreApiData.get("callBuyNowApi", null);
                            }
                        }
                    });

                    if (PreferredDealerPopup == "Show") {
                        popupflag = true;
                        //emiStoreApiData.set("popupflag", true);
                        $("#defaultSelectedSeller").find("input").attr("data-sellerId", PreferredDealer[0].SellerId);
                        setSellerList();
                        registerAddressApiFunction();
                        $(".nameOfUser").text(nameOfUser);
                        //$(".sellerName").text(PreferredDealerSellerName[0].SellerName);
                        $(".preferred").removeClass("hide-elem");
                        $(".preferred").show();
                        // $('#loggedin-preferred').addClass('showpopup');
                        emiStoreApiData.set("city_change_popUp", null);
                    }
                }
                else if (DefaultDealer && DefaultDealer.length) {
                    var DefaultDealerPopup = "Show"
                    DefaultDealer.forEach(function (each, index) {
                        if (each.SellerId == onpageLoadSeller) {
                            DefaultDealerPopup = "Hide";
                            $("#defaultSelectedSeller").find("input").attr("data-sellerId", each.SellerId);
                            setSellerList();
                            registerAddressApiFunction();
                            var functionName = dataStoreUtility.getPDS("emiStore-PDP").get("addToCartBuyNowApiCall");
                            var functionBuynow = emiStoreApiData.get("callBuyNowApi");
                            if (functionName) {
                                functionName();
                                emiStoreApiData.set("addToCartBuyNowApiCall", null);
                            }
                            else if (functionBuynow) {
                                functionBuynow();
                                emiStoreApiData.get("callBuyNowApi", null);
                            }
                        }
                    });

                    if (DefaultDealerPopup == "Show") {
                        popupflag = true;
                        //emiStoreApiData.set("popupflag", true);
                        $("#defaultSelectedSeller").find("input").attr("data-sellerId", nddServiceSellers[0].SellerId);
                        setSellerList();
                        registerAddressApiFunction();
                        $(".nameOfUser").text(nameOfUser);
                        // $(".sellerName").text(DefaultDealerSellerName[0].SellerName);
                        $(".updateofDealer").text("");
                        $(".updateofDealer").text("Your address just got updated. We have found a dealer around you! ");
                        $(".preferred").addClass("hide-elem");
                        $(".preferred").hide();
                        // $('#loggedin-preferred').addClass('showpopup');
                        emiStoreApiData.set("city_change_popUp", null);
                    }

                }
                emiStoreApiData.get("pdp_page_buynowseller", "");
                emiStoreApiData.set("city_change_popUp", null);
            }
            else {

                if (PreferredDealerId && PreferredDealerId.length) {
                    $("#defaultSelectedSeller").find("input").attr("data-sellerId", PreferredDealer[0].SellerId);
                    setSellerList();
                    registerAddressApiFunction();
                } else {
                    $("#defaultSelectedSeller").find("input").attr("data-sellerId", nddServiceSellers[0].SellerId);
                    setSellerList();
                    registerAddressApiFunction();
                }
            }

            $('#loggedin-preferred').removeClass('showpopup');
            if (popupflag === true) {
                var sellername;
                if (productData.sellers[onChangeSellerIndex].SellerName) {
                    sellername = productData.sellers[onChangeSellerIndex].SellerName;
                }
                else if (DefaultDealerSellerName[0].SellerName) {
                    sellername = DefaultDealerSellerName[0].SellerName;
                }
                else if (PreferredDealerSellerName[0].SellerName) {
                    sellername = PreferredDealerSellerName[0].SellerName;
                }
                $(".sellernamepopup").text(sellername);
                // $('#loggedin-preferred').addClass('showpopup');
                showNTBPreferedSellerSkeleton(true);
                showNTBPreferedSeller(true);
                setTimeout(function () {
                    showNTBPreferedSellerSkeleton(false);
                }, 2000);
                setTimeout(closeSellerPopup, 15000);
                popupflag = false;
            }
            else {
                // $('#loggedin-preferred').removeClass('showpopup');
                showNTBPreferedSeller(false);
            }
        }
        else {
            setCookie("selected_city_name", cityName, 90);
            setCookie("selected_city", cityId, 90);
            // setCookie("pincode", pincode, 90);
            localStorage.setItem("cityId", cityId);
            localStorage.setItem("cityName", cityName);
            localStorage.setItem("pincode", pincode);
            var uncheckaddress = emiStoreApiData.get("selectedAddressID");
            $("#uncheckaddress").prop("checked", false)
            emiStoreApiData.set("selectedAddressID", null);
            // localStorage.setItem('schemeChanged', true);
            location.reload();
        }
        var loadingDealerName = '';
        if(PreferredDealerSellerName || DefaultDealerSellerName){
            loadingDealerName =  PreferredDealerSellerName[0] ? PreferredDealerSellerName[0] : DefaultDealerSellerName[0] ;
            globalDataLayerObj.loadingDealerName = loadingDealerName;
        }
    }
    checkExtendWarrAfterLogin2wPDP()
    ProductDataImpressions();
}




//close Seller Popup After 15 sec
function closeSellerPopup() {

    // $('#loggedin-preferred').removeClass('showpopup');
    showNTBPreferedSeller(false);
}

// Get Address Api FunctionTrigger 
function getAddressApiTrigger() {
    // $("#del-address-sel").addClass("showpopup");
    showDelAddressSkeleton(true);
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : "";
	if (custToken == "" && readCookie("custToken")) {
        custToken = readCookie("custToken");
    }
    // var dealerId = $(".deliverysellerlistitem").find("input").attr("data-sellerId");
    var dealerId = $("#defaultSelectedSeller").find("input").attr("data-sellerId");
    var productID = $('meta[name="productSku"]').attr("content");
    var latitude = "";
    var longitude = "";
    var preferredGrpid = "";
    var customer_user_id = " ";
    var customerKey = "";
    var cardStatus = "";
    var cityId = readCookie("selected_city");
    var assettype = emiStoreApiData.get("asset_type");
    var pincode = decodeURI(readCookie("selected_city_pincode")).split("|")[0]
    if (__is_loginUSer()) {

        var stringFormat = decodeURIComponent(readCookie("perpetual_session")).split("|");
        customer_user_id = __get_perpetual_session("customer_id");
        latitude = __get_perpetual_session("customer_lat");
        longitude = __get_perpetual_session("customer_long");
        preferredGrpid = __get_perpetual_session("preferred_dealer");
        customerKey = __get_perpetual_session("customer_rank");
        cardStatus = __get_perpetual_session("card_status");
    }

    if (latitude == undefined) {
        latitude = "";
    }
    if (longitude == undefined) {
        longitude = "";
    }
    if (latitude == "null") {
        latitude = "";
    }
    if (longitude == "null") {
        longitude = "";
    }
    if (preferredGrpid == undefined) {
        preferredGrpid = "";
    }
    var city = decodeURI(readCookie("selected_city_pincode")).split("|")[1];
    var citytype = "";
    if (city == "R") {
        citytype = "rural";
    } else if (city == "U") {
        citytype = "urban"
    }
    var _gaVal = "";
    if (readCookie("_ga")) {
        var _gaarr = readCookie("_ga").split(".");
        _gaarr.splice(0, 2);
        _gaVal = _gaarr.join(".");
    }
    reqObj = {
        "customer_user_id": customer_user_id,
        "productId": productID,
        "latitude": latitude,
        "longitude": longitude,
        "cityId": cityId,
        "pincode": pincode,
        "preferredGrpid": preferredGrpid,
        "asseType": assettype,
        "cityType": "urban",
        "customerKey": customerKey,
        "GaId": _gaVal,
        "CardStatus": cardStatus,
        "cust_token": custToken,
        "dealer_id": dealerId
    }
    var url = baseUrl + "/rest/V1/get-address";
    //"https://bfsd.qa.bfsgodirect.com/emistore/signin/address/defaultaddress";
    sendApiRequest(reqObj, url, bearerTokenConfig, "POST", getAddressApiResponseHandler, "", "json", false, "");
}

//Response Function Of GetAddress Api
function getAddressApiResponseHandler(status, responseObj) {
    var selectedAddress = '';
    buttonLoaderToggle($(".pincodeChange"), false);
    if ($(".pincodeText").hasClass("pincode-color-textfield")) {
        $(".addresspopupError").removeClass("dsp-none");
        $(".addresspopupError").text("");
        $(".addresspopupError").text("Seller is not serviceable. Please change the PIN code");
        $(".address-input-Field").addClass("input-color-change");
    }
    else {
        $(".addresspopupError").addClass("dsp-none");
        $(".addresspopupError").text("");
        $(".address-input-Field").removeClass("input-color-change");
        $(".addressPincodeText").removeClass("pincode-color-textfield");
    }
    if (getAddressPopupFlag == true) {

        $("#del-address-sel").addClass("showpopup");
        // $("#del-address-sel").addClass("showpopup");
        showDelAddressSkeleton(true);
        showDelAddress(true);
        setTimeout(function () {
            showDelAddressSkeleton(false);
        }, 2000);
        getAddressPopupFlag = false;
        showDelAddressSkeleton(false);

    }
    if (emiStoreApiData.get("addToCartBuynowPopUpFlag")) {

        $(".addresspopupError").removeClass("dsp-none");
        $(".addresspopupError").text("");
        $(".addresspopupError").text("Seller is not serviceable. Please change the PIN code");
        emiStoreApiData.set("addToCartBuynowPopUpFlag", false);
    }

    if (status && responseObj.status) {
        buttonLoaderToggle($(".pincodeChange"), false);
        if (readCookie("selected_city_pincode")) {
            $(".addressPincodeText").val("");
            $(".addressPincodeText").val(decodeURI(readCookie("selected_city_pincode")).split("|")[0]);
            $(".addresspincode").removeClass("pdprev-disabled");
            $(".addressPincodeText").focus();
        } else if ($(".addressPincodeText").val() == "") {
            $(".addressPincodeText").focus();
        }

        var addressList = responseObj.addresses;
        var deliverytype = responseObj.delivery_type;
        var adddressListHtml = "";
        if(addressList != null && addressList != undefined){
        for (var i = 0; addressList && i < addressList.length; i++) {
            var firstName = addressList[i].firstname;
            var id = addressList[i].id;
            var lastName = addressList[i].lastname;
            var fullname = firstName + " " + lastName;
            var address = addressList[i].street;
            var city = addressList[i].city;
            var postCode = addressList[i].postcode;
            var addressDeliveryType = "";
            var ischecked = '';
            var disableAddress = addressList[i].is_disabled;
            var isstorePickup = $('#storeVisitSelector').hasClass('selected');
            var addressdisableClass = "";
            var namedisabled = "";
            var adddisabled = "";
            var rdbtndiabsled = "";
            if ((disableAddress)) {
                if (isstorePickup) {

                }
                else {
                    addressdisableClass = "address-disabled";
                    rdbtndiabsled = "not-active-rd-btn";
                    namedisabled = "name-disabled";
                    adddisabled = "add-disabled";
                }

            }
            var servicehere = "";
            if ((disableAddress != 1)) {
                servicehere = "dsp-none";
            }
            if (isstorePickup) {
                servicehere = "dsp-none";
            }
            var addressType = "";
            if (addressList[i].Addresstype) {

                if (addressList[i].Addresstype == "Home" || addressList[i].Addresstype == "home") {
                    addressType = "Home";
                }
                else if (addressList[i].Addresstype == "Other" || addressList[i].Addresstype == "other") {
                    addressType = "Other";
                }
                else if (addressList[i].Addresstype == "Default" || addressList[i].Addresstype == "default") {
                    addressType = "Default";
                }
                else if (addressList[i].Addresstype == "Office" || addressList[i].Addresstype == "office") {
                    addressType = "Office";
                }
                else if (addressList[i].Addresstype == "null" || addressList[i].Addresstype == "Null") {
                    addressType = "Default";
                }
                else {
                    addressType = "Default";
                }

            }

            if (localStorage.getItem("selectedAddress")) {
                var getselectedAddressID = localStorage.getItem("selectedAddress");
                if (getselectedAddressID == id) {
                    emiStoreApiData.set("isaddressChecked", true);
                    selectedAddress = address + ', ' + city + ', ' + postCode;
                    emiStoreApiData.set("selectedAddress", "");
                    emiStoreApiData.set("selectedAddressID", "");
                    emiStoreApiData.set("selectedAddress", selectedAddress);
                    emiStoreApiData.set("selectedAddressID", id);
                    ischecked = 'checked';
                    if (disableAddress) {
                        emiStoreApiData.set("ischecked", ischecked);
                    }
                }
            }
            if (deliverytype == 1 || deliverytype == "") {

                addressDeliveryType = "Home Delivery";
            }
            else if (deliverytype == 2) {

                addressDeliveryType = "Store Pickup";
            }
            else if (deliverytype == 3) {

                addressDeliveryType = "Home Delivery";
            }
            // '        <span class="seller-not-here ' + servicehere + '">Seller does not service here</span>' +
            adddressListHtml += '' +
                '<div class="pdp-md-address-li mb-8 listOfAddress ' + addressdisableClass + '">' +
                '    <label class="pdp-md-addr-chk-text">' +
                '        <label class="pdp-md-addr-sel">' +
                '            <input class="pdp-md-addr-rd checkaddresspincode" ' + ischecked + ' id="' + id + '" type="radio" name="pdp-pickup-sel">' +
                '            <span class="pdp-md-addr-rd-des ' + rdbtndiabsled + '"></span>' +
                '        </label>' +
                '        <div class="pdp-md-address-w selectaddress">' +
                '        <span class="seller-not-here ' + servicehere + '">Seller does not service here</span>' +
                '            <span class="pdp-spn12 mb-2 pd-black ft-med  ' + namedisabled + '">' +
                '           <span class="fullname">' + addressType + ' </span>' +
                // '                <span class="fullname">' + fullname + ' </span>' +
                '            </span>' +
                '            <span class="pdp-spn12 pd-black ft-reg pdp-md-addr-text  ' + adddisabled + '">' +
                '                <span class="address">' + address + '</span>' +
                '                <span class="city">' + "..." + city + '</span>' +
                '                <span class="postcode"> ' + postCode + '</span>' +
                '            </span>' +
                '        </div>' +
                '    </label>' +
                '    <div class="pdp-md-label hide-elem">' +
                '        <span class="pdp-md-tag ">' + addressDeliveryType + '</span>' +
                '    </div>' +
                '</div>';

        }
    }

        $(".listOfAddressWrap").html("");
        $(".listOfAddressWrap").html(adddressListHtml);



        $(".checkaddresspincode").on("click", function (e) {
            localStorage.removeItem("selectedAddress");
            var picodenumber = $(this).parents(".listOfAddress").find(".postcode").text().trim();
            var userAddress = $(this).parents(".listOfAddress").find(".address").text().trim();
            var userCity = $(this).parents(".listOfAddress").find(".city").text().trim();
            selectedAddress = userAddress + ".." + userCity + " " + picodenumber;
            var addresslength = selectedAddress.replace(/ /g, '').length
            if (addresslength > 14) {
                userAddress = userAddress.substring(0, 14);
                selectedAddress = userAddress + "," + userCity + "," + picodenumber;
            }
            var AddressId = $(this).attr("id");
            emiStoreApiData.set("selectedAddress", "");
            emiStoreApiData.set("selectedAddressID", "");
            emiStoreApiData.set("selectedAddress", selectedAddress);
            emiStoreApiData.set("selectedAddressID", AddressId);
            localStorage.setItem("selectedAddress", AddressId);
            emiStoreApiData.set("checkedPincode", picodenumber);
            emiStoreApiData.set("isaddressChecked", true);
            togglePopupLoader(true, $('#del-address-sel'));
            // pincodeApiTrigger(picodenumber);
            var dealerId = $("#defaultSelectedSeller").find("input").attr("data-sellerId");

            selectaddressAPiTrigger(picodenumber, AddressId, dealerId);
            // $("#del-address-sel").removeClass("showpopup");
            var addressType = $(this).parents('.listOfAddress').find('.fullname').text().trim();
            dlAddressChange(addressType);
        });

        registerAddressApiFunction();

    }
}
var getAddressPopupFlag = false;
window.addEventListener('DOMContentLoaded', function() {
    /*  if (emiStoreApiData.get("ischecked")) {
         $(".buy-emi-btn").addClass("btn-disabled");
         $(".add-cart-btn").addClass("btn-disabled");
     }
     else {
         $(".buy-emi-btn").removeClass("btn-disabled");
         $(".add-cart-btn").removeClass("btn-disabled");
     } */
    if (readCookie("selected_city_pincode")) {
        $(".non-logCode").val("");
        $(".non-logCode").val(decodeURI(readCookie("selected_city_pincode")).split("|")[0]);
        $(".non-logCode").focus();
    }
    if (__is_loginUSer()) {
        registerAddressApiFunction();
        // getAddressApiTrigger();
    }

   
});

$("#signOut").on("click", function () {
    if (localStorage.getItem("selectedAddress")) {
        localStorage.removeItem("selectedAddress");
    }
    emiStoreApiData.set("selectedAddress", null);
});


function showNTBPreferedSeller(val) {
    if (val) {
        $("#loggedin-preferred").addClass("showpopup");
    } else {
        $("#loggedin-preferred").removeClass("showpopup");

    }
}
function showNTBPreferedSellerSkeleton(val) {
    if (val) {
        $("#loggedin-preferred").find(".prefered-seller-skeleton").removeClass("dsp-none");
        $("#loggedin-preferred").find(".pdp-modal-wh-content").addClass("dsp-none");
    } else {
        $("#loggedin-preferred").find(".prefered-seller-skeleton").addClass("dsp-none");
        $("#loggedin-preferred").find(".pdp-modal-wh-content").removeClass("dsp-none");
    }
}


window.addEventListener('DOMContentLoaded',function(){
    $(".addresspincode").on("click", function () {
        var section = 'loggedIn';
        localStorage.removeItem("selectedAddress");
        emiStoreApiData.set("selectedAddress", null);
        var pincodevalue = $(".addressPincodeText").val();
        emiStoreApiData.set("selectedAddress", pincodevalue);
        var dealerId = $("#defaultSelectedSeller").find("input").attr("data-sellerId");
        emiStoreApiData.set("RegisterAddress", pincodevalue);
        var addressId = localStorage.getItem("selectedAddress") ? localStorage.getItem("selectedAddress") : '';
        if (pincodevalue != "") {
            buttonLoaderToggle(".addresspincode", true);
            if ($(".addressPincodeText").val() == decodeURI(readCookie("selected_city_pincode")).split("|")[0]) {
                buttonLoaderToggle(".addresspincode", false);
                // pincodeApiTrigger(pincodevalue);
                $(".pdp-modal-overlay").removeClass("showpopup");
                $(".pdp-modal").parent().removeClass("showpopup");


            } else {
                // pincodeApiTrigger(pincodevalue);
                api.validatePincode(pincodevalue,section,dealerId,addressId);
                // moreEmiOptions();
            }
            registerAddressApiFunction();
        }
        dlPincodeChange()
    });

    function apiValidatePincode(pincode,section,dealerId,addressId) {
        var url = baseUrl + "/rest/V1/postcode/info";
        var reqobj = {
            "pincode": pincode,
        }
        sendApiRequest(reqobj, url, "", "POST", function (status, resp) {
            /* resp = {
                "status": true,
                 "city": "THANE",
                 "state": "MAHARASHTRA"
              }
              status = true */
            if(status && resp){
                if(resp.status){
                    $(".error-message-div").addClass("dsp-none");
                    $(".pincodeText").removeClass("pincode-color-textfield");
                    $('.addresspincode').removeClass('pdprev-disabled');
                    $(".main-pincode-input").removeClass("input-color-change");
                    $('.addresspopupError').addClass("dsp-none");
                    $('.pincode-div-out-border').removeClass('pdp-error-border');
                    selectaddressAPiTrigger(pincode,addressId,dealerId);
                }else{
                    if(section == 'non-loggedIn'){
                        //show error on non-logged in
                        // buttonLoaderToggle(".pincode-submit ", false);
                        $(".pincode-submit").addClass("btn-disabled");
                        $(".pincodeText").removeClass("pincode-color-textfield");
                        $(".pincode-submit").removeClass("btn-loader-active");
                        $(".pincode-submit").children().removeClass("right-circle");
                        $(".non-logCode").addClass("pincode-color-textfield");
                        $(".main-pincode-input").addClass("input-color-change");
                        if(productData.status == false){
                            $(".error-message-div").removeClass("dsp-none");
                            buttonLoaderToggle($(".change-btn"), false);
                            $(".pdprev-oos-btn-jn").addClass("pdprev-disabled").css("opacity","0.5","pointer-events","none");
                            $('.pincode-div-out-border').removeClass("focus").addClass('pdp-error-border');
                        }
                    }else{
                        $('.addresspopupError').text("Please enter a valid pincode");
                        $('.addresspopupError').removeClass("dsp-none");
                        $('.addressPincodeText').addClass('pincode-color-textfield');
                        $('.addresspincode').addClass('pdprev-disabled');
                        $(".pincodeText").addClass("pincode-color-textfield");
                        //show error on logged in
                        $(".addresspincode").removeClass("btn-loader-active");
                        $(".addresspincode").children().removeClass("right-circle");
                        $(".main-pincode-input").addClass("input-color-change");
                    }
                }
            }else{
                console.log("piuncode api nhi chala");
            }
        }, "", "JSON");
    }
    api.validatePincode = apiValidatePincode;

    /******** Pincode api trigger for out of stock  start ********/
    $(".change-btn").on("click", function () {
        buttonLoaderToggle($(".change-btn"), true);
        var dealerId = $("#defaultSelectedSeller").find("input").attr("data-sellerId");
        var addressId = localStorage.getItem("selectedAddress") ? localStorage.getItem("selectedAddress") : '';
        var pincodevalue = $(".pincode-val").val();
        var section = 'non-loggedIn';
        if (pincodevalue) {
            api.validatePincode(pincodevalue,section,dealerId,addressId);
            // selectaddressAPiTrigger(enteredpincode, addressId, dealerId);
        }
        else {
            var customerPincode = __get_perpetual_session("customer_pincode");
            api.validatePincode(customerPincode,section,dealerId,addressId);
            // selectaddressAPiTrigger(customerPincode, addressId, dealerId);
        }

    });
    /******** Pincode api trigger for out of stock  end ********/

    $(".pincodeChange,.pincodeText ,.ChangeAddress").on("click", function () {
        buttonLoaderToggle($(".pincodeChange"), true);
        dlChangePincode();


        /* shantanu */
        if (__is_loginUSer()) {
            $("#del-address-sel").addClass("showpopup");
            getAddressPopupFlag = true;
            showDelAddressSkeleton(true);
            getAddressApiTrigger();
        }
        else {
            buttonLoaderToggle($(".pincodeChange"), false);
            $("#nonlog-sel").addClass("showpopup");
            if (decodeURI(readCookie("selected_city_pincode")).split("|")[0]) {
                if ($(".pincodeText").hasClass("pincode-color-textfield")) {
                    $(".nonLogpopup-input-Field").addClass("input-color-change");
                    $(".nonLoginPopup").removeClass("dsp-none");
                    $(".nonLoginPopup").text("Seller is not serviceable. Please change the PIN code");
                }
                else {
                    $(".nonLogpopup-input-Field").removeClass("input-color-change");
                    $(".nonLoginPopup").addClass("dsp-none");
                }
                $(".non-logCode").val("");
                $(".non-logCode").val(decodeURI(readCookie("selected_city_pinitcode")).split("|")[0]);
                $(".non-logCode").focus();
            }
            else if ($(".non-logCode").val() == "") {
                $(".non-logCode").focus();
            }
        }
    });

    /******** Pincode validation logged-in start ********/
        $(".addressPincodeText").on('input', function(){
            $(".addresspincode").removeAttr('style');
            $(".pincode-submit").removeAttr('style'); 
        })

        $(".addressPincodeText").keypress(function (e) {
            var keyCode = e.keyCode || e.which;
            var regex =/^[{1}+0-9]+$/;
            var isValid = regex.test(String.fromCharCode(keyCode));
            return isValid;
            });
    /******** Pincode validation logged-in end ********/
})
console.log("PDP Gallery Api JS");
/****************************** PDP GALLERY API START ******************************/
/********** WISHLIST API START **********/
function apiOnloadWishList() {
    var url = baseUrl + "/rest/V1/wishlist";
	var dataMapping = _getDataMapping();
	var customerId = dataMapping.customerDetails.api.customerToken;
	customerId = customerId ? customerId : "";
	
    var reqObj = {
        "customer_id": customerId,
        "sku": skuName
    };
    sendApiRequest(reqObj, url, bearerTokenConfig, "POST", function (status, resp) {
        if (status && resp && resp.status) {
            $('.wishlist-icon').addClass('active');
        } else {
            $('.wishlist-icon').removeClass('active');
        }
    }, "", "JSON", false);
}
api.onloadWishList = apiOnloadWishList;

function apiRemoveWishList() {
    var url = baseUrl + "/rest/V1/removewishlist";
	var dataMapping = _getDataMapping();
	var customerId = dataMapping.customerDetails.api.customerToken;
	customerId = customerId ? customerId : "";
    var reqObj = {
        "customer_id": customerId,
        "sku": skuName
    };
	var dataMapping = _getDataMapping();
	var custtoken = dataMapping.customerDetails.api.customerToken;
	custtoken = custtoken ? custtoken : "";
    sendApiRequest(reqObj, url, bearerTokenConfig, "POST", function (status, resp) {
        if (status && resp) {
            if (resp.status) {
                $('.wishlist-icon').removeClass('active');
                sendMessage(resp.message);
            }
        }
    });
}
api.removeWishList = apiRemoveWishList;

/********** WISHLIST API END   **********/
/********** RATING API START **********/
// function ratingTrigger() {
//     productID = parseInt($('meta[name="entityID"]').attr("content"));
//     sendApiRequest(
//         "",
//         "/content/emistoremarketplace/api.product-rating." + productID + ".json",
//         "",
//         "GET",
//         dispalyRatingSuccess,
//         "",
//         "json"
//     );
// }
/********** RATING API END   **********/
/********** PUTNAME API START **********/
/********** PUTNAME API END   **********/
/****************************** PDP GALLERY API END ********************************/
console.log("PDP Gallery Render JS");

/****************************** PDP GALLERY RENDER START ******************************/
/********** BUYNOW RENDER START **********/
function enableBuyNowBtn(val){
    if(val){
        $(".buy-emi-btn").css({ "pointer-events": "auto", opacity: 1 });
    }else{
        $(".buy-emi-btn").css({ "pointer-events": "auto", opacity: 0.7 });
    }
}
/********** BUYNOW RENDER END   **********/
/********** ADDTOCART RENDER START **********/
function enableAddToCartBtn(val){
    if(val){
        $(".add-cart-btn").css({ "pointer-events": "auto", opacity: 1 });
    }else{
        $(".add-cart-btn").css({ "pointer-events": "auto", opacity: 0.7 });
    }
}
/********** ADDTOCART RENDER END   **********/

/********** PUTNAME RENDER START **********/
/********** PUTNAME RENDER END   **********/
/****************************** PDP GALLERY RENDER END ********************************/
/****************************** PDP DETAILS INIT START ******************************/
/********** PDP PRICE INIT START **********/

/********** PDP PRICE INIT END   **********/
/********** PDP EMI INIT START **********/
window.addEventListener('DOMContentLoaded',function(){
    showBottomNudgeMsgInViewMoreEmi();
})
/********** PDP EMI INIT END   **********/
/********** PDP SPECIAL OFFER INIT START **********/
/********** PDP SPECIAL OFFER INIT END   **********/
/********** PDP OTHER INIT START **********/
/********** PDP OTHER INIT END   **********/
/****************************** PDP DETAILS INIT END ********************************/

/****************************** PDP DELIVERY API START ******************************/
/********** PUTNAME API START **********/
/********** PUTNAME API END   **********/
/****************************** PDP DELIVERY API END ********************************/

/****************************** PDP SELLER API START ******************************/

/********** About dealer API START **********/
window.addEventListener('DOMContentLoaded',function(){
    function apiOnLoadAboutDealer() {
        var url = domainUrl + "/emistore/rest/V1/aem/dealerdescription";
        var dealerId = selectedDeliverySeller.SellerId;
        var reqObj = { "supplierid": dealerId };
    
        sendApiRequest(reqObj, url, bearerTokenConfig, "POST", function (status, resp) {
          /*   resp = {
                "status": true,
                "description": "Testing in qa"
            }; */
            if (status && resp && resp.description) {
                var dealerdescription = resp.description;
                $('.abt-seller-info-span').text(dealerdescription);
                $('.about-dealer-parent').removeClass('dsp-none');
            } else {
                $('.about-dealer-parent').addClass('dsp-none');
            }
        }, "", "JSON", false);
    }
    api.onLoadAboutDealer = apiOnLoadAboutDealer;
})
/********** About dealer API END   **********/


/********** PUTNAME API START **********/
/********** PUTNAME API END   **********/
/****************************** PDP SELLER API END ********************************/


var emiStoreApiData = "";
emiStoreApiData = dataStoreUtility.getPDS("emiStore-PDP");

if (!emiStoreApiData) {
    var emiStoreApiData = dataStoreUtility.createPDS("emiStore-PDP");
}

var reqObj = {};
var instabuypopupflag = false;

/******** Default UI Display Start ********/

$(".rating-div").hide();
/******** Default UI Display End ********/

var callSelectedProductVas = function callToSelectedProductVas() {
    var selectedVas = $(".vas-selectbutton");
    var vasSelectedArray = [];
    var selectedProductVas = "";
    var firstSelected = 1;
    for (var i = 0; i < selectedVas.length; i++) {
        var isSelected = selectedVas[i].classList.contains("selected");
        vasSelectedArray.push(isSelected);
        if (isSelected) {
            var data = selectedVas[i].attributes;
            var selectedNodeVal = data[1].nodeValue;
            var nodevalue = JSON.parse(selectedNodeVal.replace(/\'/g, '"'));
            selectedProductVas +=
                firstSelected == 1 ? nodevalue.id : "," + nodevalue.id;
            firstSelected++;
        }
    }
    return selectedProductVas;
};



var callAddToCartApi = function callAddToCart(status, data) {
    if (status) {
        buttonLoaderToggle($(".add-cart-btn"), false);
        emiStoreApiData.set("addToCartData", data);
        if (data.popup == 3) {    ///Doc Req Flag
            showLoader(false);
            $(".restricted-cust-modal").removeClass("dsp-none");
            return;
        } else if (data.is_bflcustomer == 0) {
            // var custFirstName = decodeURIComponent(readCookie("perpetual_session")).split("|")[1].split("+")[0];
            var isProspectCustomer = getProspectCustomerDeatils();
            if (isProspectCustomer.isProspCust) {
                showLoader(false);
                $(".popup-user-name").text("Congratulations " + isProspectCustomer.customerName + "!");
                $('.prospect_limit').text(isProspectCustomer.amount)
                $(".prospect-popup-parent").removeClass("dsp-none");
            } else {
                var custFirstName = __get_perpetual_session("customer_name");
                $(".firstName-txt").text(custFirstName);
            /*     $("#noemicard-popup").addClass("showpopup");
                showNTBHelloUserSkeleton(true);
                showNTBHelloUser(true); */
                setTimeout(function () {
                    showNTBHelloUserSkeleton(false);
                }, 1000)
                showLoader(false);
            }
            return;
        }
        var addToCartResponse = emiStoreApiData.get("addToCartData");
        var otpMessage = addToCartResponse.message;
        var firstWordOfOtp = otpMessage.split(" ")[0];
        // showToasterMsg(addToCartResponse.message, addToCartResponse.status);
        if (addToCartResponse.status) {
            if (addToCartResponse.items_count) {
                localStorage.setItem("emiStoreCartCount", addToCartResponse.items_count);
                $(".cart-count-txt").html(addToCartResponse.items_count);
                setPerpetualCookies(12, addToCartResponse.items_count, 30);
                showToasterMsg(addToCartResponse.message, addToCartResponse.status);
            }
            else if (addToCartResponse.popup == 1) {  ///city mismatch 
                delete_cookie("selected_city_pincode");
                localStorage.removeItem("selectedAddress");
                emiStoreApiData.set("selectedAddressID", null);
                emiStoreApiData.set("selectedAddress", null);
                $(".pincodeText").val("");
                var registeredCity = __get_perpetual_session("reg_city_id");
                var currentCity = $("#selectedCity").html();
                var name = localStorage.getItem("emiStoreName");
                $(".nameofuserinmobile").html(name).show();
                var cityIdLocalStorage = localStorage.getItem("cityId");

                $(".nameofuser").html(name);
                /***City change pop up  */
                $("#fromcity").text($("#selectedCity").text());
                $("#fromcity").text($("#mselectedCity").text());
                $("#tocity").text(__get_perpetual_session("reg_city_name"));
                $("#fromcity").text(currentCity);
                $("#selectedCity").html(__get_perpetual_session("reg_city_name"));
                $("#mselectedCity").html(__get_perpetual_session("reg_city_name"));
                localStorage.setItem("cityName", __get_perpetual_session("reg_city_name"));
                localStorage.setItem("cityId", registeredCity);
                setCookie("selected_city_name", __get_perpetual_session("reg_city_name"), "");
                setCookie("selected_city", registeredCity, "");
                $(".registeredcityspan").html(__get_perpetual_session("reg_city_name"));
                if ($("#tocity").text() != $("#fromcity").text()) {
                    $(".overlay-login").css("display", "block");
                }
                registerAddressApiFunction();
                productPageLoadData();
            }
            else if (addToCartResponse.popup == 2) {    //not avail for pincode
                emiStoreApiData.set("addToCartBuynowPopUpFlag", true);
                getAddressPopupFlag = true;
                getAddressApiTrigger();

            }
            if (addToCartResponse.message == "Product already in Cart") {
                window.location.href = testUrl + "/viewcart/";
            }
            // sendMessage(addToCartResponse.message);
        } else {
            showToasterMsg(addToCartResponse.message, addToCartResponse.status);
            if (addToCartResponse.city_mismatch) {
                var registeredCity = __get_perpetual_session("reg_city_id");
                var currentCity = $("#selectedCity").html();
                var name = localStorage.getItem("emiStoreName");
                $(".nameofuserinmobile").html(name).show();
                var cityIdLocalStorage = localStorage.getItem("cityId");

                $(".nameofuser").html(name);
                /***City change pop up  */
                $("#fromcity").text($("#selectedCity").text());
                $("#fromcity").text($("#mselectedCity").text());
                $("#tocity").text(__get_perpetual_session("reg_city_name"));
                $("#fromcity").text(currentCity);
                $("#selectedCity").html(__get_perpetual_session("reg_city_name"));
                $("#mselectedCity").html(__get_perpetual_session("reg_city_name"));
                localStorage.setItem("cityName", __get_perpetual_session("reg_city_name"));
                localStorage.setItem("cityId", registeredCity);
                setCookie("selected_city_name", __get_perpetual_session("reg_city_name"), "");
                setCookie("selected_city", registeredCity, "");
                if ($("#tocity").text() != $("#fromcity").text()) {
                    $(".overlay-login").css("display", "block");
                }
                productPageLoadData();
            } else if (firstWordOfOtp == "Otp") {
                emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
                var data = otpMessage.split(" ");
                var mobileNumber = data[data.length - 1];
                emiStoreApiData.set("mobileNumber", mobileNumber);
                sendMessage(addToCartResponse.message);
                showPopup("show-otp");

            } else if (otpMessage.includes("Received HTTP code 503")) {
                emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
                var mobileno = __get_perpetual_session("mobile_number");
                emiStoreApiData.set("mobileNumber", mobileno);
                showPopup("show-otp");

            } else {
                if (
                    addToCartResponse.message.indexOf("not authorized to access") != -1
                ) {
                    emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
                    unauthorizeCustomer();
                }
            }
        }
    } else if (status == false) {
        showToasterMsg(data.message, data.status);
        buttonLoaderToggle($(".add-cart-btn"), false);
        var authorizedMessage = data.message;
        if (authorizedMessage.indexOf("not authorized to access") != -1) {
            emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
            unauthorizeCustomer();
        }
    } else {
        var cityId = localStorage.getItem("cityId");
        var x = $(".fonesafeparentwrapper").find(".fonesafeprotec.selected");
        var customerUserId = __get_perpetual_session("customer_id");
        var dataMapping = _getDataMapping();
	     custToken = dataMapping.customerDetails.api.customerToken;
	    custToken = custToken ? custToken : "";
		var custAddressType = "";
        if (readCookie("perpetual_session")) {
            custAddressType = localStorage.getItem("selectedAddress");
        }
        if (custToken == "" && readCookie("custToken")) {
            custToken = readCookie("custToken");
        }

        if (!custToken) {
            var mobileno = __get_perpetual_session("mobile_number");
            $('#mobile').val(mobileno);
            emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
            resendMobileOtp();
            return false;
        }

        var selectNetflix = $(".select-neflix-offer-icon").length == 0 ? false : $(".select-neflix-offer-icon").hasClass("selected");
        var insurance = [];
        if (noIDontWishClicked) {
            insurance = [];
        } else {
            if (ewDataForAddApi.term) {
                var obj = {};
                obj.term = ewDataForAddApi.term;
                obj.no_of_emis = ewDataForAddApi.noOfEmis;
                obj.price = ewDataForAddApi.price;
                obj.emi_per_month = ewDataForAddApi.emiPerMonth;
                obj.type = ewDataForAddApi.type;
                obj.code = ewDataForAddApi.ins_code;
                insurance.push(obj);
            } else {
                insurance = [];
            }
        }

        var customerpreference = "";
        var homeDelivery = $("#homeDeliverySelector").hasClass("selected");
        var storeVisitDelivery = $("#storeVisitSelector").hasClass("selected");
        if (homeDelivery == true) {
            customerpreference = 1;
        }
        else if (storeVisitDelivery == true) {
            customerpreference = 2;
        }
        var dealertype = $("#defaultSelectedSeller").find("input").attr("data-deliveryType");
        var scheme_id = emiStoreApiData.get("scheme_id");
        var sellerChangedVal = localStorage.getItem("is_seller_changed") ? localStorage.getItem("is_seller_changed") : 0;
        isInstallationChargesChecked(); //function to check is installtion checked
        var url = new URL(window.location.href);
        var urlSellerId = url.searchParams.get("sid")
        var campaignVal = urlSellerId ? "1" : "0";
        reqObj = {
            type: "addtocart",
            customer_user_id: customerUserId,
            campaign:campaignVal,
            item: {
                sku: skuName,
                customer_address_id: custAddressType,
                seller_id: onChangeSellerID,
                scheme_id: scheme_id,
                city_id: cityId,
                qty: 1,
                insurance: insurance,
                netflix_selected: selectNetflix,
                customer_preference: customerpreference,
                Dealer_type: dealertype,
                is_seller_changed: sellerChangedVal,
                installation_charges: installationChargesData.installationCharges,
                installation_flag: installationChargesData.installationFlag
                
            }
        };
        console.log("delear Type: "+reqObj.item.Dealer_type+ " | type: addtocart |"+"cust_userId: "+reqObj.customer_user_id)

        sendApiRequest(
            reqObj,
            testUrl + "/rest/V1/cart/add",
            "",
            "POST",
            callAddToCartApi,
            custToken,
            "json"
        );
    }
};

/*****************************************addtocartlog START*********************************************/
function apicallAddToCartLog(){
	try{
		var url =  domainUrl + "/dps/web/api/addtocartlog" ;
        var customerMagentoId = __get_perpetual_session("m_customer_id");
        var custMobileNo = __get_perpetual_session("mobile_number")?__get_perpetual_session("mobile_number"):"";
        custMobileNo = custMobileNo;
		var dataMapping = _getDataMapping();
		var customerUserId = dataMapping.customerDetails.api.customerToken;
		customerUserId = customerUserId ? customerUserId : "";
        var reqObj = {
            "key" : "abc",
            "data":
            {
                "sku": skuName,
                "customerId": customerUserId,
                "addtocart": "true",
                "mcustomerid": customerMagentoId,
                "mobileno": custMobileNo,
                "page_type": page_Type
            }
        }
		sendApiRequest(reqObj, url, "", "POST", function (status, response) {
			console.log("response of apicallAddToCartLog");
		},"","json", false);
	}catch(error){
		console.error("addtocartlog api error"+error);
	}
}
api.callAddtoCartLog =	apicallAddToCartLog

/*****************************************addtocartlog END*********************************************/
///////////////////////////////////////////////////Buy Now Start///////////////////

var callBuyNowApi = function callBuyNow(status, data) {
    $('body').addClass('overflow-hidden');
    if (status) {
        buttonLoaderToggle($(" .book-now-btn"), false);
        emiStoreApiData.set("buyNow", data);
        /* if (data.popup == 3) {
            showLoader(false);
            $(".restricted-cust-modal").removeClass("dsp-none");
            enableBuyNowBtn(true);
            return;
        } 
         */
        var buyNowResponse = emiStoreApiData.get("buyNow");
        var otpMessage = buyNowResponse.message;
        var firstWordOfOtp = otpMessage.split(" ")[0];
        if (buyNowResponse.status) {
            $(" .book-now-btn").css({ "pointer-events": "auto", opacity: 1 });
            if (buyNowResponse.popup == 0) {
                if (buyNowResponse.redirect_to_checkout) {
                    showLoader(false);
                    // window.location.href = testUrl + "/instacheckout?referrer_url=" + window.location.href; redirect to thank you page 
                    showLoader(false);

                } else {
                    showInstaPopupFlag = "show-insta-limit"
                    api.instaPopup()
                }
            }
           /*  else if (buyNowResponse.popup == 1) {
                delete_cookie("selected_city_pincode");
                localStorage.removeItem("selectedAddress");
                emiStoreApiData.set("selectedAddressID", null);
                emiStoreApiData.set("selectedAddress", null);
                $(".pincodeText").val("");
                //var cookieString = decodeURIComponent(readCookie("perpetual_session")).split("|");
                delete_cookie("selected_city_pincode");
                localStorage.removeItem("selectedAddress");
                emiStoreApiData.set("selectedAddressID", null);
                emiStoreApiData.set("selectedAddress", null);
                $(".pincodeText").val("");
                var registeredCity = __get_perpetual_session("reg_city_id");
                var currentCity = $("#selectedCity").html();
                var name = localStorage.getItem("emiStoreName");
                $(".nameofuserinmobile").html(name).show();
                var cityIdLocalStorage = localStorage.getItem("cityId");
                $(".nameofuser").html(name);
                // City change pop up  
                $("#fromcity").text($("#selectedCity").text());
                $("#fromcity").text($("#mselectedCity").text());
                $("#tocity").text(__get_perpetual_session("reg_city_name"));
                $("#fromcity").text(currentCity);
                $("#selectedCity").html(__get_perpetual_session("reg_city_name"));
                $("#mselectedCity").html(__get_perpetual_session("reg_city_name"));
                localStorage.setItem("cityName", __get_perpetual_session("reg_city_name"));
                localStorage.setItem("cityId", registeredCity);
                setCookie("selected_city_name", __get_perpetual_session("reg_city_name"), "");
                setCookie("selected_city", registeredCity, "");
                $(".registeredcityspan").html(__get_perpetual_session("reg_city_name"));
                showLoader(false);
                $(".overlay-login").css("display", "block");
                registerAddressApiFunction();
                if (buyNowResponse.popup != 2) {
                    productPageLoadData();
                }
                $(".buy-emi-btn").css({ "pointer-events": "auto", opacity: 1 });
            }
            else if (buyNowResponse.popup == 2) {
                emiStoreApiData.set("addToCartBuynowPopUpFlag", true);
                getAddressPopupFlag = true;
                getAddressApiTrigger();
                showLoader(false);

            }
 */

        } else {
            if (firstWordOfOtp == "Otp") {
                var data = otpMessage.split(" ");
                var mobileNumber = data[data.length - 1];
                emiStoreApiData.set("mobileNumber", mobileNumber);
                showLoader(false);
                $(".instacheck-popup").removeClass("instacheck-pop-hide");
                $(".allproductreview").hide();
                var instaPopupData = dataStoreUtility.getPDS("emiStore-PDP").get("instaBuyPopup");
                var dynamicDownPayment = instaPopupData.dynamic_down_payment;
                var offerPrice = dynamicDownPayment.offer_price;
                $(".verify-offerprice").text(offerPrice.split(".")[0]);

                $(".otpmassage").css("opacity", "1");
                $(".verifyotp").show();
            } else if (otpMessage.includes("Selected product not available")) {
                localStorage.setItem("issellerpopupshow", "true");
                location.reload();
                showLoader(false);
            } else {
                if (buyNowResponse.message.indexOf("not authorized to access") != -1) {
                    emiStoreApiData.set("addToCartBuyNowApiCall", callBuyNowApi);
                    emiStoreApiData.set("callBuyNowApi", callBuyNowApi);
                    unauthorizeCustomer();
                }
                showLoader(false);
            }
        }
    } else if (status == false) {
        $('body').removeClass('overflow-hidden');
        buttonLoaderToggle($(".book-now-btn"), false);
        $(".book-now-btn").css({ "pointer-events": "auto", opacity: 1 });
        var authorizedMessage = data.message;
        if (authorizedMessage.indexOf("not authorized to access") != -1) {
            emiStoreApiData.set("addToCartBuyNowApiCall", callBuyNowApi);
            emiStoreApiData.set("callBuyNowApi", callBuyNowApi);
            unauthorizeCustomer();
        }
        showLoader(false);
    } else {
        showLoader(true);
        var x = $(".fonesafeparentwrapper").find(".fonesafeprotec.selected");
        var cityId = localStorage.getItem("cityId");
        var dataMapping = _getDataMapping();
    	custToken = dataMapping.customerDetails.api.customerToken;
    	custToken = custToken ? custToken : "";
		var custAddressType = "";
        if (readCookie("perpetual_session")) {
            custAddressType = localStorage.getItem("selectedAddress");
        }
        if (custToken == "" && readCookie("custToken")) {
            custToken = readCookie("custToken");
        }

        if (!custToken) {
            var mobileno = __get_perpetual_session("mobile_number");
            $('#mobile').val(mobileno);
            emiStoreApiData.set("addToCartBuyNowApiCall", callBuyNowApi);
            emiStoreApiData.set("callBuyNowApi", callBuyNowApi);
            resendMobileOtp();
            return false;
        }

        var customerUserId = __get_perpetual_session("customer_id");
        var selectNetflix = $(".select-neflix-offer-icon").length == 0 ? false : $(".select-neflix-offer-icon").hasClass("selected");
        var insurance = [];
        if (noIDontWishClicked) {
            insurance = [];
        } else {
            if (ewDataForAddApi.term) {
                var obj = {};
                obj.term = ewDataForAddApi.term;
                obj.no_of_emis = ewDataForAddApi.noOfEmis;
                obj.price = ewDataForAddApi.price;
                obj.emi_per_month = ewDataForAddApi.emiPerMonth;
                obj.type = ewDataForAddApi.type;
                obj.code = ewDataForAddApi.ins_code;
                insurance.push(obj);
            } else {
                insurance = [];
            }
        }
        /*  var insurance = [];
         for (var i = 0; i < x.length && emiStoreApiData.get("sellerhasInsurance"); i++) {
             var obj = {};
             obj.no_of_emis = x[i].getElementsByClassName("noOfemis")[0].innerText;
             obj.price = x[i].getElementsByClassName("fonesafeEMIoffer-costvalue")[0].innerText;
             obj.emi_per_month = x[i].getElementsByClassName("fonesafeEMI-cost")[0].innerText;
             obj.type = x[i].getElementsByClassName("fonesafepolicy-details-heading")[0].getAttribute("data-ins-type");
             obj.code = x[i].getAttribute("data-ins-code");
             insurance.push(obj);
         } */
        var customerpreference = "";
        var pincode = null;
        var homeDelivery = $("#homeDeliverySelector").hasClass("selected");
        var storeVisitDelivery = $("#storeVisitSelector").hasClass("selected");
        if (homeDelivery == true) {
            customerpreference = 1;
        }
        else if (storeVisitDelivery == true) {
            customerpreference = 2;
        }
        
        pincode = readCookie("selected_city_pincode") ? decodeURI(readCookie("selected_city_pincode")).split("|")[0] : '';
        var dealertype = $("#defaultSelectedSeller").find("input").attr("data-deliveryType");
        var scheme_id = emiStoreApiData.get("scheme_id");
        var sellerChangedVal = localStorage.getItem("is_seller_changed") ? localStorage.getItem("is_seller_changed") : 0;
        isInstallationChargesChecked();  //function to check is installtion checked
        var url = new URL(window.location.href);
        var urlSellerId = url.searchParams.get("sid")
        var campaignVal = urlSellerId ? "1" : "0";
        reqObj = {
            type: "buynow",
            customer_user_id: customerUserId,
            campaign:campaignVal,
            item: {
                sku: skuName,
                customer_address_id: custAddressType, 
                seller_id: onChangeSellerID,
                scheme_id: scheme_id,
                city_id: cityId,
                qty: 1,
                insurance: insurance,
                netflix_selected: selectNetflix,
                customer_preference: customerpreference,
                Dealer_type: dealertype,
                pincode: pincode,
                is_seller_changed: sellerChangedVal,
                installation_charges: installationChargesData.installationCharges,
                installation_flag: installationChargesData.installationFlag
            },

        };
     console.log("delear Type: "+reqObj.item.Dealer_type+ " | type: buynow"+" | cust_userId: "+reqObj.customer_user_id)
        sendApiRequest(
            reqObj,
            testUrl + "/rest/V1/cart/add",
            "",
            "POST",
            callBuyNowApi,
            custToken,
            "json"
        );
    }
};

function isInstallationChargesChecked(){
    /* installation charges onpdp sleected or not logic Start */
    var isInstallationChargeSelected = $('.installation-charges-check-uncheck-event').prop('checked');
    if (isInstallationChargeSelected) {
        installationChargesData.installationFlag = 1;
    } else {
        installationChargesData.installationFlag = 0;
    }
    /* installation charges onpdp sleected or not logic End */
}




$(".otpdiv-btndiv .verifyPDP").on("click", function () {
    $(".verifyPDP .page-loader-circle").addClass("right-circle");
    $(".verifyPDP").css({ "pointer-events": "none", opacity: 0.7 });
    emiStoreApiData.set("addToCartBuyNowApiCall", callInstaPopupApi);
    $(".otpmassage").css("opacity", "0");
    var otp = $(".OTPenterip").val();
    validateOtp(callInstaPopupApi, otp);
    $(".instacheck-placeorder").css({ "pointer-events": "auto", opacity: 1 });
});

var callInstaPopupApi = function callToInstaPopupApi(status, data) {
    if (status) {
        emiStoreApiData.set("instaBuyPopup", data);
        if (emiStoreApiData.get("placeorder-btn-trigger")) {
            api.instaBuyPlaceOrder();
        } else {
            callInstaPopup();
        }
    } else if (status == false) {
        emiStoreApiData.set("placeorder-btn-trigger", false);
        showLoader(false);
    } else {
        var customerUserId = __get_perpetual_session("customer_id");
        var dataMapping = _getDataMapping();
    	custToken = dataMapping.customerDetails.api.customerToken;
    	custToken = custToken ? custToken : "";
		if (custToken == "" && readCookie("custToken")) {
            custToken = readCookie("custToken");
        }

        if (!custToken) {
            var mobileno = reverseStr(atob(cookieString[2])).split('_')[1];
            $('#mobile').val(mobileno);
            emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
            resendMobileOtp();
            return false;
        }

       

        reqObj = {
            customer_user_id: customerUserId
        };
        sendApiRequest(
            reqObj,
            testUrl + "/rest/V1/instabuy/popup",
            "",
            "POST",
            callInstaPopupApi,
            custToken,
            "json"
        );
    }
};

var callAddInsurance = function callAddInsuranceApi(status, data) {
    if (status) {
        emiStoreApiData.set("addInsurance", data);
        callInstaPopupApi();
    } else if (status == false) {
        callInstaPopupApi();
    } else {
        var dataMapping = _getDataMapping();
    	var custToken = dataMapping.customerDetails.api.customerToken;
    	custToken = custToken ? custToken : "";
		if (custToken == "" && readCookie("custToken")) {
            custToken = readCookie("custToken");
        }
        reqObj = data;
      
        sendApiRequest(
            reqObj,
            testUrl + "/rest/V1/cart/add-insurance",
            "",
            "POST",
            callAddInsurance,
            custToken,
            "text"
        );
    }
};

var callRemoveInsurance = function callRemoveInsuranceApi(status, data) {
    if (status) {
        emiStoreApiData.set("removeInsurance", data);
        callInstaPopupApi();
    } else if (status == false) {
        callInstaPopupApi();
    } else {
        var dataMapping = _getDataMapping();
    	var custToken = dataMapping.customerDetails.api.customerToken;
    	custToken = custToken ? custToken : "";
		var insuranceQuoteid = parseInt(data.quote_item_id);
        var subsku = data.sub_sku;
        reqObj = {
            quote_item_id: insuranceQuoteid,
            sub_sku: subsku
        };
       
        sendApiRequest(
            reqObj,
            testUrl + "/rest/V1/cart/remove-insurance",
            "",
            "POST",
            callRemoveInsurance,
            custToken,
            "text"
        );
        // */
    }
};

function sendMessage(message) {
    showToasterMsg(message, true);
}

function unauthorizeCustomer() {
    var mobileno = __get_perpetual_session("mobile_number");
    $("#mobile").val(mobileno);
    resendMobileOtp();
}

/*Function For updateExchangeApi start*/
function callReviewResponse(e, response) {
    if (e == true) {
        emiStoreApiData = dataStoreUtility.getPDS("emiStore-PDP");
        if (!emiStoreApiData) {
            emiStoreApiData = dataStoreUtility.createPDS("emiStore-PDP");
        }
        emiStoreApiData.set("reviewResponseData", response);
        var reviewResponseData = dataStoreUtility.getPDS("emiStore-PDP").get("reviewResponseData");
        if (reviewResponseData.status) {
            callReviewSuccess();
        } else {
            $(".user-ratings-viewoption").hide();

        }
    } else {
        console.log("Done");
    }
}

function reviewTrigger(pgno) {
    var productID = parseInt($('meta[name="entityID"]').attr("content"));
    var pageNo = pgno;
    pageNo === 1 ? displayFullReviewFlag = false : displayFullReviewFlag = true;

    sendApiRequest(
        "",
        "/content/emistoremarketplace/api.product-review." + productID + "." + pageNo + ".json",
        "",
        "GET",
        callReviewResponse,
        "",
        "json",
        false
    );
}

/* Add Coupon to cart */
function callAddCouponApi(status, data) {
    if (status) {
        emiStoreApiData.set("addCoupon", data);
        var addCouponResponse = emiStoreApiData.get("addCoupon");
        if (addCouponResponse.status) {
            var promoName = addCouponResponse.promo_name;
            var promocode = addCouponResponse.promo_code;
            var promoDescription = addCouponResponse.promo_description;
            var message = addCouponResponse.message;
            var coupondiv = "";
            coupondiv +=
                '<div class="coupanwrapper"><div class="coupancode">' +
                promocode +
                '</div><div class="coupancode-text"><span class="couponname">' +
                promoName +
                '</span><span class="coupancode-benifitcost"></span><span class="coupancode-tick"><i class="tick-green fa fa-check" aria-hidden="true"></i></span></div></div><div class="coupan-detailstext"><p>' +
                promoDescription +
                "</p></div>";
            $(".maincoupan").html("");
            $(".maincoupan").append(coupondiv);
            $(".mainpromomessage").text(message);
            $(".promocodescreen2").addClass("hidepromocodescreen");
            $(".promocodescreen3").show();
            callInstaPopupApi();

        } else {
            var message = addCouponResponse.message;
            $(".promomessage").text(message);
            $(".promomessage").show();
            $(".promocodescreen2").removeClass("hidepromocodescreen");
        }
        $(".promocode-apply-button-text .page-loader-circle").removeClass("right-circle");
    } else if (status == false) {
        $(".promocode-apply-button-text .page-loader-circle").removeClass("right-circle");
    } else {
        var couponCode = $(".promocodeIPfield input:text").val();
        var dataMapping = _getDataMapping();
    	var custToken = dataMapping.customerDetails.api.customerToken;
    	custToken = custToken ? custToken : "";
		if (custToken == "" && readCookie("custToken")) {
            custToken = readCookie("custToken");
        }
        var cityID = "";
        if (__is_loginUSer()) {
            cityID = __get_perpetual_session("reg_city_id");
        } else {
            cityID = localStorage.getItem("cityId");
        }
        var coupondiv = "";
        reqObj = {
            coupon_code: couponCode,
            city_id: cityID
        };
        sendApiRequest(
            reqObj,
            testUrl + "/rest/V1/cart/coupon/apply",
            "",
            "POST",
            callAddCouponApi,
            custToken,
            "json"
        );
    }
}

/* remove coupon from cart*/
function callRemoveCouponApi(status, data) {
    if (status) {
        emiStoreApiData.set("removeCoupon", data);
        var removeCouponResponse = emiStoreApiData.get("removeCoupon");
        if (removeCouponResponse.status) {
            var message = removeCouponResponse.message;
            $(".screen1promomessage").text(message);
            $(".promocodeQue").on("click", function () {
                $(".promocodescreen1").addClass("hidepromocodescreen");
                $(".promocodescreen2").removeClass("hidepromocodescreen");
            });
            $(".promocodeIPfield input:text").val("");
            $(".promomessage").hide();
            callInstaPopupApi();
        }
    } else if (status == false) {
        console.log("Remove Coupon Fail");
    } else {
        var couponCode = $(".promocodeIPfield input:text").val();
        var dataMapping = _getDataMapping();
    	var custToken = dataMapping.customerDetails.api.customerToken;
    	custToken = custToken ? custToken : "";
		if (custToken == "" && readCookie("custToken")) {
            custToken = readCookie("custToken");
        }
        reqObj = {
            coupon_code: couponCode,
            city_id: 1948
        };
        sendApiRequest(
            reqObj,
            testUrl + "/rest/V1/cart/coupon/remove",
            "",
            "POST",
            callRemoveCouponApi,
            custToken,
            "json"
        );
    }
}

var callToWishlist = function callWishlist() {
    //var customerID = __get_perpetual_session("m_customer_id");
	var dataMapping = _getDataMapping();
    var customerID = dataMapping.customerDetails.api.customerToken;
    customerID = customerID ? customerID : "";

    reqObj = {
        requestJson: {
            customer_id: customerID
        },
        entityId: productID
    };
    $(document).trigger("api:wishlist", {
        data: reqObj,
        cb: function (e, responseObj) {
            if (e == true) {
                var wishMessage = "Item has been added to wishlist";
                var wishlistData = emiStoreApiData.get("wishlist");
                if (wishlistData.status) {
                    $(".heart-icon .heart-label").text(wishlistData.wishlist_count);
                    $('.wishlist-icon').addClass('active');
                }
                else {
                }
                showToasterMsg(wishlistData.message, wishlistData.status);
            } else {
                console.log("Done");
            }
        }
    });
};

var callToNotifyMe = function callNotifyMe() {
    var cityID = "";
    if (__is_loginUSer()) {
        cityID = __get_perpetual_session("reg_city_id");
    } else {
        cityID = localStorage.getItem("cityId");
    }
    var customerId;
    if (__is_loginUSer()) {
        customerId = __get_perpetual_session("customer_id");
    } else {
        customerId = "";
    }

    var mobileNo = $(".mobile-no-outofstock").val();
    var emailID = $(".email-id-outofstock").val();
    reqObj = {
        requestJson: {
            cust_id: customerId,
            city_id: cityID,
            mobile: mobileNo,
            email: emailID,
            sku: skuName,
            product_id: productID
        }
    };
    $(document).trigger("api:notifyMe", {
        data: reqObj,
        cb: function (e, responseObj) {
            if (e == true) {
                var notifyData = emiStoreApiData.get("notifyMe");
                $(".outofstock-message").text("").text(notifyData.message);
                if (window.innerWidth > 991) {
                    $("#outofstock-pop-up").addClass("popactive");
                    $("#outofstock-pop-up").children().addClass("activepopup");
                    $("body").addClass("noscrollbody");
                } else {
                    $("#outofstockmobile-pop-up").removeClass("popactive");
                    $("#outofstockmobile-pop-up").children().removeClass("activepopup");
                    $("#outofstock-pop-up").addClass("popactive");
                    $("#outofstock-pop-up").children().addClass("activepopup");
                    $("body").addClass("noscrollbody");
                }
            } else {
                console.log("Done");
            }
        }
    });
};

var callToWriteReview = function callWriteReview() {
    var rating = $(".wr-rated-str-section .rating-stars .mainstar .selected").length;
    var textValue = $("#titleField").val();
    var descriptionValue = $("#descriptionField").val();
    var dataMapping = _getDataMapping();
    var customerToken = dataMapping.customerDetails.api.customerToken;
    customerToken = customerToken ? customerToken : "";
	if (customerToken == "" && readCookie("custToken")) {
        customerToken = readCookie("custToken");
    }
    if (textValue == undefined) {
        textValue = "";
    }
    if (descriptionValue == undefined) {
        descriptionValue = "";
    }
    var customerId = __is_loginUSer() ? __get_perpetual_session("m_customer_id") : "";
    reqObj = {
        requestJson: {
            customer_id: customerId,
            product_id: productID,
            ratings: rating,
            title: textValue,
            desc: descriptionValue,
            order_id: ""
        }
    };
    $(document).trigger("api:addReview", {
        data: reqObj,
        cb: function (e, responseObj) {
            if (e == true) {
                var reviewData = emiStoreApiData.get("addReview");
                // sendMessage(reviewData.message);
                showToasterMsg(reviewData.message, reviewData.status);
            } else {
                console.log("Done");
            }
        }
    });
};



window.addEventListener('DOMContentLoaded', function() {

    $(document).on("api:addExchange", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .addExchange(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("addExchange", response);
                    callback(true, response);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });
    $(document).on("api:deleteExchange", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .deleteExchange(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("deleteExchange", response);
                    callback(true, response);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });
    $(document).on("api:addCdExchange", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .addCdExchange(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("addCdExchange", response);
                    callback(true, response);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });
    $(document).on("api:cdExchangePopup", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .cdExchangePopup(uiObj)
            .then(function (response) {
                emiStoreApiData.set("cdExchangePopup", response);
                if (jsHelper.isFunction(callback)) {
                    callback(true, response);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });
    $(document).on("api:addReview", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .addReview(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("addReview", response);
                    callback(true, uiObj);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });
    $(document).on("api:notifyMe", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .notifyMe(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("notifyMe", response);
                    callback(true, uiObj);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });
    $(document).on("api:wishlist", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .wishlist(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("wishlist", response);
                    callback(true, uiObj);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });
    $(document).on("api:reviewAndRating", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .reviewAndRating(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("reviewAndRating", response);
                    callback(true, uiObj);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });
    $(document).on("api:productVas", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .productVas(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("productVas", response);
                    callback(true, response);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });

    $(document).on("api:callMe", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .callMe(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("callMe", response);
                    callback(true, response);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });

    $(document).on("api:saveData", function (e, obj) {
        console.info("", e, obj);
        console.info("data: ", obj.data);
        var uiObj = obj.data;
        var callback = obj.cb;
        apiUtility
            .saveData(uiObj)
            .then(function (response) {
                if (jsHelper.isFunction(callback)) {
                    emiStoreApiData.set("saveData", response);
                    callback(true, response);
                } else {
                    console.warn("Callback is not a function!");
                }
            })
            .catch(function (error) {
                console.log("error: ", error);
                if (jsHelper.isFunction(callback)) {
                    callback(false, "error");
                } else {
                    console.warn("Callback is not a function!");
                }
            });
    });

    $(".instacheck-placeorder").on("click", function () {
        instaBuyNowDataLayer("TwoWheeler_Place_Order");
        // instaBuyNowDataLayer("Place_Order");
        $(".instacheck-placeorder .page-loader-circle").addClass("right-circle");
        $(".instacheck-placeorder").css({ "pointer-events": "none", opacity: "0.7" });
        // if (readCookie("perpetual_session")) {
        emiStoreApiData.set("placeorder-btn-trigger", true);
        // callPlaceOrderApi();
        callInstaPopupApi();
        instaCheckPlaceorderLoad();
    });
    
    $(".cust-btn-cm.buy-emi-btn").on("click", function (e) {
        if (__is_loginUSer()) {
            buttonLoaderToggle(this, true);
            showLoader(true);
            $(".buy-emi-btn").css({ "pointer-events": "none", opacity: 0.7 });
            callBuyNowApi();
            buyNow_Click_Product_Details_Datalayer(); //buyNow click dataLayer
        } else {
            loginCallBack = selectaddressAPiTrigger;
            interCityBuyNowCallFlag = true;
            emiStoreApiData.set('lastSelectedSchemeId', selectedSchemeDataOnPdp.schemeId);
            emiStoreApiData.set('isLastSelectedScheme', true);
            buyNow_Click_Product_Details_Datalayer();
            emiStoreApiData.set("pdp_page_buynowseller", "");
            emiStoreApiData.set("pdp_page_buynowseller", onChangeSellerID);
            showPopup("show-mobile");
            var cityId = readCookie("selected_city");
            var cityIdLocalStorage = localStorage.getItem("cityId");
            if (cityIdLocalStorage == cityId) {
                emiStoreApiData.set("addToCartBuyNowApiCall", callBuyNowApi);
                emiStoreApiData.set("callBuyNowApi", callBuyNowApi);
                $(".verifybtns").on("click", function () {
                    $(".verifyPDP .page-loader-circle").addClass("right-circle");
                    emiStoreApiData.set("addToCartBuyNowApiCall", callBuyNowApi);
                    emiStoreApiData.set("callBuyNowApi", callBuyNowApi);
                    $(".verifyPDP .page-loader-circle").removeClass("right-circle");
                    $(".verifyPDP").css({ "pointer-events": "auto", opacity: 1 });
                });
            }
        }
     
    });
    $(".add-cart-btn").on("click", function () {
        if (!__is_loginUSer()) {
            showPopup("show-mobile");
        }
        if (!emiStoreApiData.get("iscallFromAutho")) {
            emiStoreApiData.set("iscallAddToCartFromAutho", true);
            // triggerTokenApi();
            loginAuthTokenApi()
            return true;
        }
        emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
    
        // if (readCookie("perpetual_session")) {
        if (__is_loginUSer()) {
            buttonLoaderToggle(this, true);
            callAddToCartApi();
             var addToCartLogData = {};
            addToCartLogData.pid = skuName;
            addToCartLogData.qty = 1;
            addToCartLogData.requestId = "";
            try {
                Unbxd.track("addToCart", addToCartLogData)
            } catch (error) {
                console.log(error);
            } 
        } else {
            // $(".loginpopup").show();
            showPopup("show-mobile");
            var cityId = readCookie("selected_city");
            var cityIdLocalStorage = localStorage.getItem("cityId");
            if (cityIdLocalStorage == cityId) {
                emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
                $(".verifybtns").on("click", function () {
                    emiStoreApiData.set("addToCartBuyNowApiCall", callAddToCartApi);
                });
            }
        }
    });
    $(".remove-coupan-cross").on("click", function () {
        $(".promocodescreen3").hide();
        $(".promocodescreen1").removeClass("hidepromocodescreen");
        callRemoveCouponApi();
    });
    $(".OTPresend").on("click", function (event) {
        event.preventDefault();
        var mobileno = __get_perpetual_session("mobile_number");
        $("#mobile").val(mobileno);
        reSendOtp();
    });
});

$(".book-now-btn").click(function(){
    apicallAddToCartLog();
    var dataMapping = _getDataMapping();
    var resp = dataMapping.productDetails.api.extendWarranty.response;
    if(!resp){
        bookNow2wextendWarr = false
        api.extendWarrantyOnLoad();
    }
    if (__is_loginUSer()) {
        // buttonLoaderToggle(this, true);
        if((icorseStatus == '7001') || (icorseStatus == '200')){
            $(".book-now-btn").css({ "pointer-events": "none", opacity: 0.7 });
            var dataMapping = _getDataMapping();
            var status = dataMapping.customerDetails.api.icorsFetchOffer.status;
            var status_code = dataMapping.customerDetails.api.icorsFetchOffer.status_code;
            var fetchOfferData = dataMapping.customerDetails.api.icorsFetchOffer.response;
            var is_loan_pod_config = localStorage.getItem("is_loan_pod_config_2w");
            var userFlag ="";
            var offerDetailCheck = fetchOfferData.offer_details ? fetchOfferData.offer_details.length : 0;
            if(status && offerDetailCheck){
                userFlag =status ? fetchOfferData.offer_details[0].flag : "";
            }
            if(status_code == "200" && selectedDeliverySeller.instant_credit_approval == "1" && is_loan_pod_config == "1"){
                loanpodBooknowdl();
                api.addressListOnload();
            }else if(status_code == "200" && (selectedDeliverySeller.instant_credit_approval == "0" || is_loan_pod_config == "0")){
                var thankYouPageUrl = baseUrl + "/success?mode=ofn"
                window.location.href = thankYouPageUrl;
            }else if(status_code == "7001" && userFlag == "PTB" && selectedDeliverySeller.instant_credit_approval == "1" && is_loan_pod_config == "1" && (selectedDeliverySeller.Offer.ProductCode == "RTW" || selectedDeliverySeller.Offer.ProductCode == "UTW")){
               // loanpodBooknowdl();
                api.addressListOnload();
            }else if(status_code == "7001"){
                var offerid =status && fetchOfferData.offer_details ? fetchOfferData.offer_details[0].offerId : "";
                var offerDetail=status && fetchOfferData.offer_details? fetchOfferData.offer_details[0] :"";
                var offerValidity = status && fetchOfferData.offer_details ?fetchOfferData.offer_details[0].offerValidity :"";
                var assetCategoryCData = selectedSchemeDataOnPdp.twoWheelerAssetType;
                var assetCategoryCDataLowerCase = assetCategoryCData ? assetCategoryCData.toLowerCase() : assetCategoryCData;
                assetCategoryCDataLowerCase += "Ltv";
                var customerLtvCheck = "";
                /* changes */ 
                var offerValidityCheck = "";
                offerValidityCheck = status && fetchOfferData.offer_details[0].offerValidity  ? fetchOfferData.offer_details[0].offerValidity : "";
                offerValidityCheck = status && offerValidityCheck ? offerValidityCheck.toLowerCase() : offerValidityCheck;
                offerValidityCheck = status && offerValidityCheck.replaceAll(" ","");
                /* -- */
                if (assetCategoryCData == "ELECTRIC VEHICLE") {
                    Object.keys(offerDetail).forEach(function (el) {
                        if (assetCategoryCData == "ELECTRIC VEHICLE" && el == "offerColumn11") {
                            customerLtvCheck = true;
                        }
                    })
                } else {
                    Object.keys(offerDetail).forEach(function (el) {
                        if (el == assetCategoryCDataLowerCase) {
                            customerLtvCheck = true;
                        }
                    })
                }
                /* --- */
                if(offerValidityCheck == null || offerValidityCheck == "hold" || offerValidityCheck == "") {
                    var thankYouPageUrl = baseUrl + "/success?mode=ofn"
                    window.location.href = thankYouPageUrl;
                }
                /* --- */
                else if (offerid && !customerLtvCheck && !offerValidity) {
                    var thankyouPageUrl = baseUrl + "/success?mode=ofy"
                    window.location.href = thankyouPageUrl
        
                } else if (!offerid && !customerLtvCheck && !offerValidity) {
                    var thankYouPageUrl = baseUrl + "/success?mode=ofn"
                    window.location.href = thankYouPageUrl;
                } else if (offerid && customerLtvCheck && offerValidity) {
                    if(bookNow2wextendWarr == false){
                        setTimeout(function(){
                        callBuyNowApi();
                        },1000)
                    }else{
                        callBuyNowApi();
                    }
                }
            }
            



        }else{
            var thankYouPageUrl = baseUrl + "/success?mode=ofn"
            window.location.href = thankYouPageUrl;
        }

        

            // buyNow_Click_Product_Details_Datalayer(); //buyNow click dataLayer
    } else {
        // $(".loginpopup").show();
        // triggerTokenApi();
        loginCallBack = selectaddressAPiTrigger;
        interCityBuyNowCallFlag = true;
        emiStoreApiData.set('lastSelectedSchemeId', selectedSchemeDataOnPdp.schemeId);
        emiStoreApiData.set('isLastSelectedScheme', true);
        // buyNow_Click_Product_Details_Datalayer();
        emiStoreApiData.set("pdp_page_buynowseller", "");
        emiStoreApiData.set("pdp_page_buynowseller", onChangeSellerID);
        showPopup("show-mobile");
    }

    $("body").addClass("overflow-hidden")
})
console.log("PDP Gallery Init JS");

document.addEventListener("DOMContentLoaded", function (e) {
    if (!__is_loginUSer()) {
        return false;
    }
    //api.onloadWishList();
})

/****************************** PDP GALLERY INIT START ******************************/
/********** PUTNAME INIT START **********/
/********** PUTNAME INIT END   **********/
/****************************** PDP GALLERY INIT END ********************************/
/* ----- [ PDP REVISED - EVENTS - START ] -----*/

function emiOptionsListTrim() {
    $('.pdprev-emistable-cnt-fn').each(function(){
        var list = $(this).find('.pdprev-emistable-cnt-li');
        if(list.length > 2){
            list.slice(2).addClass('dsp-none');
            $(this).find('.pdprev-emioptions-viewall-w').removeClass('dsp-none');
        } else {
            $(this).find('.pdprev-emioptions-viewall-w').addClass('dsp-none');
            $(this).find('.pdpemi-viewall-fn').text('View More Offers').attr('data-stat','more');
        }
    });
}

/*----------  POPUP LOADER - JS - START  ----------*/
var loaderHTML = '' +
    '<div class="popLoaderComponent">' +
    '    <div class="load-spinner">' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '        <div></div>' +
    '    </div>' +
    '</div>';

function togglePopupLoader(stat, popupElement) {
    if (stat) {
        $(popupElement).find('.pdp-modal-wh-content').append(loaderHTML);
    }
    else {
        if ($('.pdp-modal-overlay').find('.popLoaderComponent').length) {
            $('.pdp-modal-overlay').find('.popLoaderComponent').remove();
        }
    }
}
/*----------  ***************** ----------*/

$(document).ready(function(){
    $('.pdpemi-viewall-fn').on('click',emiViewLessViewMore);
});

function emiViewLessViewMore(){
    var btnStat = $(this).attr('data-stat');
    if(btnStat == 'more'){
        $(this).text("View Less Offers").attr("data-stat", "less");
        $(this).parents('.pdprev-emistable-cnt-fn').find('.pdprev-emistable-cnt-li').removeClass('dsp-none');
    } else {
         $(this).text("View More Offers").attr("data-stat", "more");
         $(this).parents('.pdprev-emistable-cnt-fn').find('.pdprev-emistable-cnt-li').slice(2).addClass('dsp-none');
    }
}

/* ----- [ PDP REVISED - EVENTS - END ] -----*/


function showDeliverySection(val) {
    if (val == "show-home") {
        $(".homeDeliverySelectorBody").show();
        $(".storeDeliverySelectorBody").hide();
    } else if (val == "show-store") {
        var currDate = new Date(new Date().setDate(new Date().getDate() + 3));
        var romanword = getRomanWord(currDate);
        var dateVal = (currDate.getDate()) + romanword + " " + __months_in_words[currDate.getMonth()];
        $(".homeDeliverySelectorBody").hide();
        $(".storeDeliverySelectorBody").show();
        $(".store-pickup-date-span").text(dateVal);
    }
}

function showSellerSel(val){
    if(val){
        sellersListPopUpFlag = true ;
        $("#seller-sel").addClass("showpopup");
    }else{
        sellersListPopUpFlag = false ;
        $("#seller-sel").removeClass("showpopup");
    }
}
function showSellerSelskeleton(val){
    if(val){
        $("#seller-sel").find(".pdp-modal-wh-content").addClass("dsp-none");
        $("#seller-sel").find(".seller-selection-skeleton").removeClass("dsp-none");
    }else{
        $("#seller-sel").find(".pdp-modal-wh-content").removeClass("dsp-none");
        $("#seller-sel").find(".seller-selection-skeleton").addClass("dsp-none");
    }
}

function showDelAddress(val){
    if(val){
        $("#del-address-sel").addClass("showpopup");
    }else{
        $("#del-address-sel").removeClass("showpopup");
    }
}
function showDelAddressSkeleton(val){
    if(val){
        $("#del-address-sel").find(".pdp-modal-wh-content").addClass("dsp-none");
        $("#del-address-sel").find(".address-sell-skeleton-content").removeClass("dsp-none");
    }else{
        $("#del-address-sel").find(".pdp-modal-wh-content").removeClass("dsp-none");
        $("#del-address-sel").find(".address-sell-skeleton-content").addClass("dsp-none");
    }
}

function showEmiPopup(val){
    if(val){
        $("#EMI-pop-up").addClass("showpopup");
    }else{
        $("#EMI-pop-up").removeClass("showpopup");
    }
}
function showEmiPopupSkeleton(val){
    if(val){
        $("#EMI-pop-up").find(".emi-popup-on-view").addClass("dsp-none");
        $("#EMI-pop-up").find(".no-cost-emi-seller-skeleton-w").removeClass("dsp-none");
    }else{
        $("#EMI-pop-up").find(".emi-popup-on-view").removeClass("dsp-none");
        $("#EMI-pop-up").find(".no-cost-emi-seller-skeleton-w").addClass("dsp-none");
    }
}

window.addEventListener('DOMContentLoaded', function() {
    $('.inp-focus').on('blur',function(){
        if($(this).val()) {
            $(this).parent().addClass('focus');
        }
        else {
            $(this).parent().removeClass('focus');
        }
    });

    $('.jn-inp-focus').on('focus',function(){
        $(this).parents('.jn-inp-focus-w').addClass('focus');
    }).on('blur',function(){
        if($(this).val()) {
            $(this).parents('.jn-inp-focus-w').addClass('focus');
        }
        else {
            $(this).parents('.jn-inp-focus-w').removeClass('focus');
        }
    });
});

function installationCharges() {
    var installation = "";
    var productdata = productData;

    var sellers = productdata.sellers;
    sellers && sellers.forEach(function (e) {
        if (e.SellerId == onChangeSellerID) {
            installation = e["Installation Charges"];
        }
    });
    installation = installation ? installation.split("₹")[1] : ""
    if (installation > "0" && installation != "free" && installation != null && installation != "") {
        $(".installtion-parent-div").removeClass("dsp-none")
        $(".title4").removeClass("dsp-none");
        $(".install-subtext-paid").removeClass("dsp-none");
        $(".install-subtext-free").addClass("dsp-none");
        $(".installtion-amount").text("₹" + installation);
        installationChargesData.installationCharges = installation;
    }
    if (installation == "0") {
        $(".installtion-parent-div").removeClass("dsp-none")
        $(".title4").addClass("dsp-none");
        $(".install-subtext-paid").addClass("dsp-none");
        $(".install-subtext-free").removeClass("dsp-none");
        installationChargesData.installationCharges = 0;
    }
    if (installation == "free" || installation == null || installation == "") {
        $(".installtion-parent-div").addClass("dsp-none")
    }
}
window.addEventListener('DOMContentLoaded',function(){

    $(".installation-charges-view-details-event").on("click",function(e){
        dlInstallationAndChargesViewDetailClick();
    });
    
    $(".installation-charges-check-uncheck-event").on("click",function(){   
         dlInstallationAndChargesSelectUnselect();    
    });
    
    $('.view-tooltip').click(function(){
        $('.details-tooltip').hide();
    });
        
    $('.view-tooltip').mouseenter(showIcTooltip);
    $('.details-tooltip').mouseleave(hideIcTooltip);

})

function showIcTooltip(){
    $('.details-tooltip').show();
}
function hideIcTooltip(){
    $('.details-tooltip').hide();
}
window.addEventListener('DOMContentLoaded', function() {

    var modelviewer = $('.mv-container').html();
    
    
    // Model loading animation
    var modelDiv = document.querySelector('.mv-element');
    
    modelDiv && modelDiv.addEventListener('progress', function (event) {
        var loadPercentage = event.detail.totalProgress.toFixed(1) * 100;

        $('.mv-loading-div-desk').removeClass('dsp-none');
        $('.loader-inner').css('width', loadPercentage + '%');
    });
    
    modelDiv && modelDiv.addEventListener('model-visibility', function (event) {
        $('.mv-loading-div-desk').addClass('dsp-none');
    });

    // 

    
    if($(window).innerWidth() >= 992){
        // Load 3d model
        $('.load-mv-icon').click(function(){
            $(this).parents('.pc-single-preview-img').addClass('i-dsp-none').siblings('.mv-container').removeClass('dsp-none');
            
            // MODEL - Rating - Show / Hide
            $('.specialOfferdiv').addClass('visibility-hidden');
            $('.mv-zoom-in').removeClass('visibility-hidden');

            $(this).parents('.mv-slide-main').addClass('model-active');
        })

        // MODEL - Rating - Show / Hide
        $('.single-image-slider, .vertical-thumbnail-slider').on('afterChange', function (event, slick, direction) {
            if ($('.model-active').hasClass('slick-current')) {
                $('.specialOfferdiv').addClass('visibility-hidden');
                $('.mv-zoom-in').removeClass('visibility-hidden');
            }
            else {
                $('.specialOfferdiv').removeClass('visibility-hidden');
                $('.mv-zoom-in').addClass('visibility-hidden');
            }
        });

        // Exit fullscreen bottom-right button
        $('.mv-zoom-out').click(exitModal);
    }

    if($(window).innerWidth() <= 991){
        // Show model in fullscreen
        $('.load-mv-icon').click(function(){
            openModal();
            $('body').css('position', 'fixed');

            // Model loading animation
            var modelDivMob = document.querySelector('.model-fullscreen > .mv-element');
            modelDivMob.addEventListener('progress', function (event) {        
                var loadPercentage = event.detail.totalProgress.toFixed(1) * 100;
        
                $('.mv-loading-div-mob').removeClass('dsp-none');
                $('.loader-inner').css('width', loadPercentage + '%');
            });
            
            modelDivMob.addEventListener('model-visibility', function (event) {
                $('.mv-loading-div-mob').addClass('dsp-none');
            });
        });

        // Mobile zoom image
        $('.mv-zoom-in-and-out').click(toggleZoomImg);
            
            function toggleZoomImg(){
                $('.zoom-out-img').show();
                $('.zoom-in-img').hide();
                $('.mv-element').css('transform', 'scale(1.24)');
                $('.mv-zoom-in-and-out').click(function(){
                    $('.zoom-out-img').hide();
                    $('.zoom-in-img').show();
                    $('.mv-element').css('transform', 'scale(1)');
                    $('.mv-zoom-in-and-out').click(toggleZoomImg);
                })
            }
    }
    var innerProductInfo = $('.inner-product-info');
    // Open Fullscreen model function
    function openModal(){
        $('.model-viewer-modal').show();
        $('.model-fullscreen').html(modelviewer);
        $('.mv-element').attr("camera-controls", "");
        $('.talktoexpert').hide();
    }

    // Exit Fullscreen Modal function
    function exitModal(){
        $('.model-viewer-modal').hide();
        $('.mv-element').removeAttr("camera-controls", "");
        //$('.talktoexpert').show();
        $('body').css('position', 'static');
        innerProductInfo.removeClass('product-info-z-1');
    }

    // Show model in fullscreen
    $('.mv-zoom-in').click(function(){
        openModal();
        showToasterMsg();
        innerProductInfo.addClass('product-info-z-1');
    });

    // Press esc to exit fullscreen
    $(document).keydown(function(event) { 
        if (event.keyCode == 27) { 
            exitModal();
        }
    });
    
    // Show esc fullscreen toaster
    function showToasterMsg(){
        $('#esc-fs-toaster').fadeIn( function(){
            $('#esc-fs-toaster').delay(2000).fadeOut(); 
         });
    }
    
    // Model viewer back button in mobile view
    $('.esc-fs-btn').click(exitModal);

    
})

window.addEventListener('scroll', onScrollApiCalls)

function onScrollApiCalls(){
    if(productData.status){
        /* Extend warranty  api call START */
        if (selectedSchemeEWFlag || !extendWarrantyCallFlag2W  || !bookNow2wextendWarr ) {
            api.extendWarrantyOnLoad();
        }            
        /* Extend warranty  api call  */
    
        /* Dealer Description api call START */
            api.onLoadAboutDealer();
        /* Dealer Description api call END */
    }
        
    /* Compare Similar Product api call START */
        callCompareProduct();
    /* Compare Similar Product api call END */

    window.removeEventListener('scroll', onScrollApiCalls);
};




var editAddressObj = {};
var addressInfo = {}
/********** ADDRESS API START **********/
function apiAddressListOnload() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : "";
    var apiUrl = baseUrl + "/rest/V1/listshippingaddress";
    sendApiRequest("", apiUrl, "", "POST", function (status, resp) { 
        console.log("successfull to enter api");
        if (resp && resp.status == "success") {
            $(".add-address-pop-up-main-container").addClass('dsp-none');
            $(".edit-address-pop-up-main-container").addClass('dsp-none');
            $(".other-saved-addresses").addClass("listResponse")
            var dataMapping = _getDataMapping();
            dataMapping.customerDetails.api.listAddress.response = resp;
            _setDataMapping(dataMapping);
            if(resp.addresses.length){
                biz.addressListOnload();
            }else{
                $('.twoWheeler-btn_add-address').trigger("click");
            }
        }
    }, custToken, "json");
}
api.addressListOnload = apiAddressListOnload;

function apiAddressDelete(addressId) {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : "";
    var reqobj = {
        requestJson: {
            address_id: addressId,
        },
        headerJson: {
            Authorization: "Bearer " + custToken, //"Bearer rx0uf19p0g0si6nsoixr9v980j5puuva",
            "Content-Type": "application/json",
        }
    };
    apiUtility.removeAddressApiCall(reqobj).then(function (resp) {
        var status = resp.status == "success" ? true : false;
        if(resp.status == "success"){
            $('[data-addressId="' + addressId + '"]').remove();
        }else if(resp.status == "Fail"){
            showToasterMsg(resp.message,false)
        }
    }).catch(function (err) {
        console.error(err);
    });
}
api.addressDelete = apiAddressDelete;
/********** ADDRESS API END **********/

/********** LoanPod Edit & Add Address API START   **********/
function apiLpAddressAddNEdit() {
    var dataMapping = _getDataMapping();
    var custToken = dataMapping.customerDetails.api.customerToken;
    custToken = custToken ? custToken : "";
    var reqObj = {
        firstname: editAddressObj.firstname,
        lastname: editAddressObj.lastname,
        addressId: editAddressObj.addressId,
        city: editAddressObj.city,
        region: editAddressObj.region,
        telephone: editAddressObj.telephone,
        addresstype: editAddressObj.addresstype,
        nickname: editAddressObj.nickname,
        addressline1: editAddressObj.addressline1 + ",",
        addressline2: editAddressObj.addressline2,
        postcode: editAddressObj.postcode,
    };
    var apiUrl = baseUrl + "/rest/V1/editshippingaddress";
    sendApiRequest(reqObj, apiUrl, "", "POST", function (status, resp) {
        var status = resp.status == "success" ? true : false;
        showToasterMsg(resp.message, status);
        if (resp.status == "success") {
            api.addressListOnload();
        }
    }, custToken, "json");
}
api.lpaddressAddNEdit = apiLpAddressAddNEdit;
/********** LoanPod Edit & Add Address API END   **********/

/********** Pincode API START   **********/
function apiLPPincodeChange() {
    var url = baseUrl + "/rest/V1/postcode/info";
    var reqobj = {
        "pincode": pincodeChange,
    }   
    sendApiRequest(reqobj, url, "", "POST", function (status, resp) {
   /*      
    resp = { 
            "status": true, 
             "city": "THANE", 
             "state": "MAHARASHTRA" 
          }       
          status = true  */
        if(status && resp && resp.status){
            render.lpPouplateCityAndState(resp)
        }else{
            if(resp && resp.message){
                $(".lp-edit-addr-state-ev").val("");
                $(".lp-edit-addr-city-ev").val("");
                $(".lp-add-state").val("");
                $(".lp-add-city").val("");
                $(".lp-add-pincode-error").removeClass("dsp-none");
                $(".lp-add-pincode-error-txt").html(resp.message);
                $(".lp-edit-pincode-error").removeClass("dsp-none");
                $(".lp-edit-pincode-error-txt").html(resp.message);
                profileInputValidation()
                editProfileAdd()
            }
        }
    }, "", "JSON");
}
api.lPPincodeChange = apiLPPincodeChange;
/********** Pincode API END   **********/


/********** ADDRESS BIZ START **********/
function bizAddressListOnload() {
    var dataMapping = _getDataMapping();
    var resp = dataMapping.customerDetails.api.listAddress.response;
    dataMapping.customerDetails.addressListArr = [];
    if (resp.status == "success") {
        resp.addresses.forEach(function (eachAddress) {
            var obj = {};
			obj.firstname = eachAddress.firstname;
			obj.lastname = eachAddress.lastname;
			obj.telephone = eachAddress.telephone;
            obj.addressLine1 = eachAddress.addressline1;
            obj.addressLine2 = eachAddress.addressline2;
            obj.addressType = eachAddress.address_type;
            obj.addressId = eachAddress.address_id;
            obj.cityName = eachAddress.city;
            obj.regionName = eachAddress.region;
            obj.postCode = eachAddress.postcode;
            obj.countryId = eachAddress.country_id;
            obj.status = eachAddress.status;
            obj.lastUpdate = eachAddress.updated_at;
            obj.isRegisterAddress = eachAddress.registered_flag;
            dataMapping.customerDetails.addressListArr.push(obj);
        });
    }
    if(!resp.addresses.length){
        $(".book-now-btn").css({ "pointer-events": "", opacity: "1" });
        $(".twoWheeler-pdp-address-popup ").addClass('dsp-none')
    }else{
        $(".book-now-btn").css({ "pointer-events": "none", opacity: "0.7" });
    }
    _setDataMapping(dataMapping);
    render.addressListOnload();
}
biz.addressListOnload = bizAddressListOnload;

function loanPodAddrClickEvents() {
    selected_loanPod_add = $("input:radio.twoWheeler-address-box-input:checked").parents(".twoWheeler-pdp-popup-address-box").attr("data-address-info");
    selected_loanPod_add = selected_loanPod_add ? JSON.parse(selected_loanPod_add):"";
    $(".twoWheeler-pdp-popup-address-box").on('click', function (e) {   
        selected_loanPod_add = $("input:radio.twoWheeler-address-box-input:checked").parents(".twoWheeler-pdp-popup-address-box").attr("data-address-info");
        selected_loanPod_add = selected_loanPod_add ? JSON.parse(selected_loanPod_add):"";
        e.stopImmediatePropagation();
    })
    /********** ADDRESS BIZ END **********/
    $('.editbtn-event').click(function (e) {
        e.preventDefault();
        $(".error-name-msg").addClass("dsp-none");
        $(".edit-conatin-input").each(function (i, e) {
            $(e).val("");
            $(e).removeClass("error-border-red");
        })
        var addressData = $(this).parents(".twoWheeler-pdp-popup-address-box").attr("data-address-info")
        var edit_add_id = $(this).parents(".twoWheeler-pdp-popup-address-box").attr("data-addressId") // as per harish changes
        editAddressObj.addressId = edit_add_id;
        addressData = JSON.parse(addressData)
        $(".lp-edit-addr-name-ev").val(addressData.firstname);
        $(".lp-edit-addr-lname-ev").val(addressData.lastname);
        $(".lp-edit-addr-build-flat-ev").val(addressData.addressLine1);
        $(".lp-edit-addr-locality-street-ev").val(addressData.addressLine2);
        $(".lp-edit-addr-pincode-ev").val(addressData.postCode);
        $(".lp-edit-addr-state-ev").val(addressData.regionName);
        $(".lp-edit-addr-city-ev").val(addressData.cityName);
        $(".lp-edit-addr-contact-ev").val(addressData.telephone);
        if (addressData.addressType == "Home") {
            $("#addr-home").prop("checked", true);
        } else if (addressData.addressType == "Work") {
            $("#addr-work").prop("checked", true);
        } else {
            $("#addr-other").prop("checked", true);
        }   
        editProfileAdd() 
        $(".edit-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" })
        $(".twoWheeler-pdp-address-popup ").addClass('dsp-none');
        $(".edit-address-pop-up-main-container").removeClass('dsp-none');
        $(".edit-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
    });
}

window.addEventListener('DOMContentLoaded',function(){
    
    if ($('.twoWheeler-pdp-address-popup').hasClass('dsp-none')) {
        $('body').removeClass('overflow-hidden')
    } else {
        $('body').addClass('overflow-hidden')
    }

    if ($(window).width() < 767) {
        $('.edit-address-pop-up-contain').css('height',window.innerHeight - 171);
        $('.add-address-pop-up-contain').css('height',window.innerHeight - 171);
    }
    
    if ($('.twoWheeler-pdp-popup-address-box.active')) {
        $('.twoWheeler-pdp-popup-address-box.active').children('.inputHolder').find('input[type=radio]').attr('checked',true);
    }
    $('.twoWheeler-pdp-popup-cross-btn').on('click', function(e) {
        if ($('.twoWheeler-pdp-address-popup').hasClass('dsp-none')) {
            $('.mobile-twoWheeler-tooltip').addClass('dsp-none')
            $('.mobile-twoWheeler-btn').addClass('dsp-none')
            $('.twoWheeler-pdp-address-popup').removeClass('dsp-none');
            $('body').addClass('overflow-hidden')
            $('body').css('overflow','hidden');
        } else {
            if(!$('.twoWheeler-pdp-address-popup').hasClass('show-single-item')){
                $('.show-single-item').removeClass('hide-change-cta');
                $('.hide-change-cta').addClass('show-single-item');
            }else{
                $(".book-now-btn").css({ "pointer-events": "", opacity: "1" });
                $('.twoWheeler-pdp-address-popup').addClass('dsp-none');
                $('body').removeClass('overflow-hidden')
                $('body').css('overflow','');
            }
        }	
		if($('.hide-change-cta').length){
			$('.hide-change-cta').addClass('show-single-item');
			$('.show-single-item').removeClass('hide-change-cta');
		}
    })

    $('body').on('click', function (e) {
        var cur = e.target;
        if($(cur).hasClass("twoWheeler-pdp-popup-overlay") || $(cur).hasClass("twoWheeler-pdp-popup-container") || $(cur).hasClass("twoWheeler-pdp-popup-cross-btn") || $(cur).hasClass("twoWheeler-pdp-popup")){
            $("body").removeClass("overflow-hidden")
        }else{
            if ($('.twoWheeler-pdp-address-popup').hasClass("dsp-none")) {
                $("body").removeClass("overflow-hidden")
                $('body').css('overflow','');
            } else {
                $("body").addClass("overflow-hidden")
                $('body').css('overflow','hidden');
            }
        }
    });

    $('body').on('click', function(e) {
        e.stopPropagation();
        var cur = e.target;
        if ($(cur).hasClass('twoWheeler-tooltip-popup') || $(cur).hasClass('twoWheeler-pdp-popup-toolTip-img')) {
            if ($('.twoWheeler-pdp-popup-toolTip-img').hasClass('clicked')) {
                $('.mobile-twoWheeler-tooltip .twoWheeler-tooltip-popup').addClass('dsp-none');   
            } else {
                $('.mobile-twoWheeler-tooltip .twoWheeler-tooltip-popup').removeClass('dsp-none');   
            }
            // $('.twoWheeler-tooltip-popup').removeClass('dsp-none');
        } else {
            if ($(window).width() < 991) {
                // $('.twoWheeler-pdp-popup').addClass('dsp-none');
                if ($('.twoWheeler-pdp-popup')) {
                    $('.backArrow').addClass('dsp-none')
                    $('.mobile-twoWheeler-tooltip').addClass('dsp-none')
                    $('.mobile-twoWheeler-btn').addClass('dsp-none')
                    $('.twoWheeler-pdp-popup-toolTip').removeClass('i-dsp-none');
                    $('.twoWheeler-pdp-popup-btn.d-flex').removeClass('dsp-none');
                    $('.twoWheeler-pdp-popup-address-box-Container').removeClass('dsp-none')
                    $('.twoWheeler-pdp-popup-cross-btn.backArrow').removeClass('dsp-none').show();
                    if ($('.twoWheeler-pdp-address-popup').hasClass('dsp-none')) {
                        $('body').removeClass('overflow-hidden')
                    } else {
                        $('body').addClass('overflow-hidden')
                    }
                }
            } else {
                $('.twoWheeler-tooltip-popup').addClass('dsp-none');
            }
        }
    })

    $('.twoWheeler-pdp-popup-heading .backArrow,.twoWheeler_gotIt_btn').on('click', function(e) {
        $('.twoWheeler-pdp-popup-cross-btn.backArrow').show();
        if ($('.backArrow').hasClass('dsp-none') && $('.mobile-twoWheeler-tooltip').hasClass('dsp-none') && $('.mobile-twoWheeler-btn').hasClass('dsp-none')) {
            $('.mobile-twoWheeler-tooltip').removeClass('dsp-none')
            $('.mobile-twoWheeler-btn').removeClass('dsp-none')
            $('.backArrow').removeClass('dsp-none') 
            $('.twoWheeler-pdp-popup-toolTip').addClass('i-dsp-none');
            $('.twoWheeler-pdp-popup-btn.d-flex').addClass('dsp-none');
            $('.twoWheeler-pdp-popup-address-box-Container').addClass('dsp-none')
            if ($('.twoWheeler-pdp-address-popup').hasClass('dsp-none')) {
                $('body').removeClass('overflow-hidden')
            } else {
                $('body').addClass('overflow-hidden')
            }
        } else {
            $('.backArrow').addClass('dsp-none')
            $('.mobile-twoWheeler-tooltip').addClass('dsp-none')
            $('.mobile-twoWheeler-btn').addClass('dsp-none')
            $('.twoWheeler-pdp-popup-toolTip').removeClass('i-dsp-none');
            $('.twoWheeler-pdp-popup-btn.d-flex').removeClass('dsp-none');
            $('.twoWheeler-pdp-popup-address-box-Container').removeClass('dsp-none')
            if ($('.twoWheeler-pdp-address-popup').hasClass('dsp-none')) {
                $('body').removeClass('overflow-hidden')
            } else {
                $('body').addClass('overflow-hidden')
            }
        }
    })

    if ($(window).width() < 767) {
        console.log('mobile');
        $('.twoWheeler-pdp-popup-toolTip-img').on('click', function(e) {
            if ($('.backArrow').hasClass('dsp-none') && $('.mobile-twoWheeler-tooltip').hasClass('dsp-none') && $('.mobile-twoWheeler-btn').hasClass('dsp-none')) {
                $('.twoWheeler-pdp-popup-cross-btn.backArrow').hide();
                $('.backArrow').removeClass('dsp-none');
                $('.mobile-twoWheeler-tooltip').removeClass('dsp-none');
                $('.twoWheeler-pdp-popup-toolTip').addClass('i-dsp-none');
                $('.twoWheeler-pdp-popup-btn.d-flex').addClass('dsp-none');
                $('.mobile-twoWheeler-btn').removeClass('dsp-none')
            } else {
                $('.backArrow').addClass('dsp-none')
                $('.mobile-twoWheeler-tooltip').addClass('dsp-none')
                $('.twoWheeler-pdp-popup-toolTip').removeClass('i-dsp-none');
                $('.twoWheeler-pdp-popup-btn.d-flex').removeClass('dsp-none');
                $('.mobile-twoWheeler-btn').addClass('dsp-none')
            }
    
            if ($('.twoWheeler-pdp-popup-address-box-Container').hasClass('dsp-none')) {
                $('.twoWheeler-pdp-popup-address-box-Container').removeClass('dsp-none')
            } else {
                $('.twoWheeler-pdp-popup-address-box-Container').addClass('dsp-none');
            }
        })   
    } else {
        console.log('desktop');
        $('.twoWheeler-pdp-popup-toolTip-img').on('click', function(e) {
            e.stopPropagation();
            $(this).toggleClass('clicked');
            if ($('.twoWheeler-tooltip-popup').hasClass('dsp-none')) {
                $('.twoWheeler-tooltip-popup').removeClass('dsp-none')
            } else {
                $('.twoWheeler-tooltip-popup').addClass('dsp-none')
            }
        })
    }

    $('.edit-addr-popup-close-btn-hmevt').on("click", function () {
        $(".book-now-btn").css({ "pointer-events": "", opacity: "1" });
        $(".edit-address-pop-up-main-container").addClass('dsp-none');
        biz.addressListOnload();
    })
    $('.left-arrow-back-btn-hmevt').on('click', function () {
        $(".book-now-btn").css({ "pointer-events": "", opacity: "1" });
        $(".edit-address-pop-up-main-container").addClass('dsp-none');
        biz.addressListOnload();
    })

    $('.add-addr-popup-close-btn-hmevt').on("click", function () {
        $(".book-now-btn").css({ "pointer-events": "", opacity: "1" });
        $(".add-address-pop-up-main-container").addClass('dsp-none');
        biz.addressListOnload();
    })

    $('.add-cancel-btn-hmevt').on("click", function () {
        newAddressCancelDl();
        $(".add-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
        $(".book-now-btn").css({ "pointer-events": "", opacity: "1" });
        $(".add-address-pop-up-main-container").addClass('dsp-none');
        biz.addressListOnload();
    })

    $('.add-addr-left-arrow-back-btn-hmevt').on('click', function () {
        $(".book-now-btn").css({ "pointer-events": "", opacity: "1" });
        $(".add-address-pop-up-main-container").addClass('dsp-none');
        biz.addressListOnload();
    })

    $('.edit-addr-cancel-btn-event').click(function (e) {
        $(".edit-address-pop-up-main-container").addClass('dsp-none');
        biz.addressListOnload();

    })

    $('.twoWheeler-btn_add-address').click(function () {
        newAddressClickdl();
        $(".add-addr-error-name-msg").addClass("dsp-none");
        $('.add-work-type').prop('checked', false);
        $(".add-conatin-input").each(function (i, e) {
            $(e).val("")
            $(e).removeClass("error-border-red");
        })
        $(".add-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
        $(".twoWheeler-pdp-address-popup ").addClass('dsp-none');
        $(".add-address-pop-up-main-container").removeClass('dsp-none');
    })

        //Submit edited address
        $(".edit-addr-save-btn").on("click", function () {
            editAddressObj.firstname = $(".lp-edit-addr-name-ev").val();
            editAddressObj.lastname = $(".lp-edit-addr-lname-ev").val();
            editAddressObj.city = $(".lp-edit-addr-city-ev").val();
            editAddressObj.region = $(".lp-edit-addr-state-ev").val();
            editAddressObj.telephone = $('.lp-edit-addr-contact-ev').val();
            editAddressObj.addresstype = $("input:radio.addr-input-field-radio:checked").val();
            editAddressObj.nickname = __get_perpetual_session("customer_name").split(' ')[0].toLowerCase();
            editAddressObj.addressline1 = $(".lp-edit-addr-build-flat-ev").val();
            editAddressObj.addressline2 = $(".lp-edit-addr-locality-street-ev").val();
            editAddressObj.postcode = $(".lp-edit-addr-pincode-ev").val();
            editAddressObj._this = this;
            api.lpaddressAddNEdit();
        });
    
        $(".add-addr-save-btn-event").on('click', function () {
            newAddressSavePopupdl(); 
            editAddressObj.addressId = "";
            editAddressObj.firstname = $(".lp-add-name-input").val();
            editAddressObj.lastname = $(".lp-add-lname-input").val();
            editAddressObj.city = $(".lp-add-city").val();
            editAddressObj.region = $(".lp-add-state").val();
            editAddressObj.telephone = $('.lp-add-number-input').val();
            editAddressObj.addresstype = $("input:radio.add-addr-input-field-radio:checked").val();
            editAddressObj.nickname = $(".lp-add-name-input").val()
            editAddressObj.addressline1 = $(".lp-add-addr1-input").val();
            editAddressObj.addressline2 = $(".lp-add-addr2-input").val();
            editAddressObj.postcode = $(".lp-add-pincode-input").val();
            editAddressObj._this = this;
            api.lpaddressAddNEdit();
        });

        $(".add-work-type").on('input', function () {
            profileInputValidation()
        
        })
        
        $(".edit-work-type").on('input', function() {
            editProfileAdd();
        })
        
        $('.lp-edit-addr-name-ev , .lp-edit-addr-lname-ev ,.lp-add-name-input, .lp-add-lname-input').on('input', function (e) {
            var regName = /^[a-zA-Z]+[a-zA-Z\s]+$/;
            var val = e.target.value;
            if (val && regName.test(val)) {
                $(e.target).removeClass("error-border-red");
                $(e.target).parent().find(".error-name-msg").addClass("dsp-none");
                $(e.target).parent().find(".add-addr-error-name-msg").addClass("dsp-none");
                $(".edit-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" })
                $(".add-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" })
            } else {
                $(e.target).addClass("error-border-red");
                $(e.target).parent().find(".error-name-msg").removeClass("dsp-none");
                $(e.target).parent().find(".add-addr-error-name-msg").removeClass("dsp-none");
                $(".edit-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
                $(".add-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
            }
            profileInputValidation()
            editProfileAdd()
        })


        $('.lp-edit-addr-build-flat-ev , .lp-edit-addr-locality-street-ev,  .lp-add-addr1-input , .lp-add-addr2-input').on('input', function (e) {
            var regName = /^[() ,.\/a-zA-Z0-9-]+$/;
            var val = e.target.value;
            if (val && regName.test(val)) {
                $(e.target).removeClass("error-border-red");
                $(e.target).parent().find(".error-name-msg").addClass("dsp-none");
                $(e.target).parent().find(".add-addr-error-name-msg").addClass("dsp-none");
                $(".edit-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" })
                $(".add-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" })
            }else{
                $(e.target).addClass("error-border-red");
                $(e.target).parent().find(".error-name-msg").removeClass("dsp-none");
                $(e.target).parent().find(".add-addr-error-name-msg").removeClass("dsp-none");
                $(".edit-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
                $(".add-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
            }
            profileInputValidation()
            editProfileAdd()
        })

        $(".lp-edit-addr-contact-ev, .lp-add-number-input").on('input', function (e) {
            var regName = /^(\+\d{1,3}[- ]?)?\d{10}$/;
            e.target.value = e.target.value.substr(0, 10);
            var val = e.target.value;
            var el = e.target;
            if (val && regName.test(val) && val.length == 10) {
                $(e.target).removeClass("error-border-red");
                $(e.target).parent().find(".error-name-msg").addClass("dsp-none");
                $(e.target).parent().find(".add-addr-error-name-msg").addClass("dsp-none");
                $(".edit-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" })
                $(".add-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" })
            }else{
                $(e.target).addClass("error-border-red");
                $(e.target).parent().find(".error-name-msg").removeClass("dsp-none");
                $(e.target).parent().find(".add-addr-error-name-msg").removeClass("dsp-none");
                $(".edit-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
                $(".add-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
            }
            profileInputValidation()
            editProfileAdd()
        })

        $(".lp-edit-addr-pincode-ev , .lp-add-pincode-input").on("input", function () {
            $(".lp-add-pincode-error").addClass("dsp-none");
            $(".lp-edit-pincode-error").addClass("dsp-none");
            var pincodeVal = $(this).val();
            if (pincodeVal.length == 6) {
                pincodeChange = pincodeVal;
                api.lPPincodeChange();
            }else{
                $(".lp-add-pincode-error").removeClass("dsp-none");
                $(".lp-edit-pincode-error").removeClass("dsp-none");
                $(".edit-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
                $(".add-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" })
            }
        });
        
        $(".lp-edit-addr-contact-ev , .lp-edit-addr-pincode-ev , .lp-add-number-input , .lp-add-pincode-input").keypress(function (e) {
            var keyCode = e.keyCode || e.which;
            $(".lp-edit-addr-contact-ev").html("");
            var regex = /^[0-9]+$/;
            var isValid = regex.test(String.fromCharCode(keyCode));
            return isValid;
        });

        $('.lastName-add-addr, .lastName-edit-addr').on("keypress",function( e ) {
            if(e.which === 32){
                return false;
            }
        })
        // $(".loan-approval-crros-btn-hmevt").on("click", function(){
        //     $(".loan-pod-ntb-congratulation-popup-main-container").addClass('dsp-none')
        // })

})



function profileInputValidation() {
    var inputBlankEdit = false;
    var inputValid = false;
    $(".add-conatin-input").each(function (i, e) {
        if (!$(e).val()) {
            inputBlankEdit = true;
        }
    })
    $(".add-address-pop-up-main-container").find(".error-name-msg").each(function (i, e) {
        if (!$(e).hasClass("dsp-none")) {
            inputValid = true;
        }
    })
    if (!inputValid) {
        $(".add-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" });
        inputValid = true
    } else {
        $(".add-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" });
        inputValid = false
    }
    // indra
        if ($('.add-work-type').is(':checked') && $(".lp-add-pincode-input").val().length >= 6 && $(".lp-add-number-input").val().length >= 10 && inputValid && !inputBlankEdit) {
            $(".add-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" });
        } else {
            $(".add-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" });
        }
}

function editProfileAdd() {
    var inputBlankEdit = false;
    var inputValid = false;
    // edit
    $(".edit-conatin-input").each(function (i, e) {
        if (!$(e).val()) {
            inputBlankEdit = true;
        }
    })
    $(".edit-address-pop-up-main-container").find(".error-name-msg").each(function (i, e) {
        if (!$(e).hasClass("dsp-none")) {
            inputValid = true;
        }
    })
    if (!inputValid) {
        $(".edit-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" });
        inputValid = true
    } else {
        $(".edit-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" });
        inputValid = false
    }
    //indra
        if ($('.edit-work-type').is(':checked') && $(".lp-edit-addr-pincode-ev").val().length >= 6 && $(".lp-edit-addr-contact-ev").val().length >= 10 && inputValid && !inputBlankEdit) {
            $(".edit-addr-save-btn-event").css({ "pointer-events": "", opacity: "1" });
        } else {
            $(".edit-addr-save-btn-event").css({ "pointer-events": "none", opacity: "0.5" });
        }   
}


function renderLoanPodAddressListOnload() {
	// why to run the code if the DOM was already rendered.
	// pass hardRender as true in case of building the DOM from dataMapping
	var dataMapping = _getDataMapping();
	var addressListArr = dataMapping.customerDetails.addressListArr;
	var addressListLength = addressListArr ? addressListArr.length : 0
	if(addressListLength > 0){
		var index=0;
		$('#twoWheeler-pdp-address-parent').html("");
	    addressListArr && addressListArr.forEach(function (eachAddress,eachindex) {
		index++;
		var activeClassName = index==1 ? 'active' : '';
		var isChecked = index==1 ? 'checked' : '';
		addressInfo = {
			"addressLine1": eachAddress.addressLine1,
			"addressLine2": eachAddress.addressLine2,
			"cityName": eachAddress.cityName,
			"regionName": eachAddress.regionName,
			"addressType": eachAddress.addressType,
			"addressId": eachAddress.addressId,
			"postCode": eachAddress.postCode,
			"firstname": eachAddress.firstname,
			"lastname": eachAddress.lastname,
			"telephone": eachAddress.telephone,
		}

		
		addressInfo = " data-address-info='" + JSON.stringify(eachAddress) + "' "
        var addressCard = ''+'<div  class="twoWheeler-pdp-popup-address-box '+activeClassName+'"  data-addressId="' + eachAddress.addressId + '" ' +addressInfo+'>'+
			'<div class="inputHolder">' +
			'<input '+ isChecked+' type="radio" name="twoWheeler-address-box-input" id="address-'+eachindex+'" class="twoWheeler-address-box-input">' +
			'<label for="address-'+eachindex+'" class="radio_label d-flex">' +
			'<span class="labelText">'+eachAddress.firstname + ' ' +  eachAddress.lastname +'</span>' +
			'<span class="address_tag">' + eachAddress.addressType + '</span>' +
			'</label>' +
			'</div>' +
			'<p class="address-text">'  + '<span class="address-line1"> ' + eachAddress.addressLine1 + ' </span>' + '<span class="address-line2"> ' + eachAddress.addressLine2 + ' </span>' + '<span class="cityName"> ' + eachAddress.cityName + ' </span>' + '<span class="regionName"> ' + eachAddress.regionName + ' </span>' + '<span class="postCode"> ' + eachAddress.postCode +'.' + ' </span>' + '</p>' +
			'<div class="twoWheeler-number-btn d-flex">' +
			'<span class="telephone">'+eachAddress.telephone+'</span>' +
			'<a href="#" class="changeAddBtn '+activeClassName+'">Change Address</a>' +
			'</div>' +
			'<div class="twoWheeler-number-btn curd-btns justify d-flex"> <a href="#" class="editBtn editbtn-event">Edit</a>' +
			'<a href="#" class="removeBtn" data-addressIdRmv="' + eachAddress.addressId +'">Remove</a>' +
			'</div>' +
			'</div>';
			$('#twoWheeler-pdp-address-parent').append($(addressCard));
	    });
		$(".twoWheeler-pdp-address-popup ").removeClass('dsp-none')
		if (window.matchMedia("(max-width: 766px)").matches) {
			if ($('.twoWheeler-pdp-popup-toolTip').hasClass('dsp-none') && $('.twoWheeler-pdp-popup-toolTip').hasClass('i-dsp-none') && $('.twoWheeler-pdp-popup-btn').hasClass('dsp-none') && $('.twoWheeler-pdp-popup-address-box-Container').hasClass('dsp-none') && $('.mobile-twoWheeler-tooltip').hasClass('dsp-none') && $('.mobile-twoWheeler-btn').hasClass('dsp-none')) {
				$('.twoWheeler-pdp-popup-toolTip').addClass('i-dsp-none');
				$('.twoWheeler-pdp-popup-btn').addClass('dsp-none');
				$('.twoWheeler-pdp-popup-address-box-Container').addClass('dsp-none');
				$('.twoWheeler-pdp-popup-heading .backArrow').removeClass('dsp-none');
				$('.mobile-twoWheeler-tooltip').removeClass('dsp-none');
				$('.mobile-twoWheeler-btn').removeClass('dsp-none');
			} else {
				$('.twoWheeler-pdp-popup-toolTip').removeClass('i-dsp-none');
				$('.twoWheeler-pdp-popup-btn').removeClass('dsp-none');
				$('.twoWheeler-pdp-popup-address-box-Container').removeClass('dsp-none');
				$('.twoWheeler-pdp-popup-heading .backArrow').addClass('dsp-none');
				$('.mobile-twoWheeler-tooltip').addClass('dsp-none');
				$('.mobile-twoWheeler-btn').addClass('dsp-none');
			}	
		}
		$('.twoWheeler-pdp-popup').removeClass('dsp-none');
		$('.changeAddBtn').click(function(){
				$('.show-single-item').addClass('hide-change-cta');
				$('.hide-change-cta').removeClass('show-single-item');
		});
		$('.removeBtn').click(function(e){
			e.stopPropagation();
			var addressId = $(this).attr("data-addressIdRmv");
			api.addressDelete(addressId);
		});
	}
		loanPodAddrClickEvents();
	}
render.addressListOnload = renderLoanPodAddressListOnload;

/********** PINCODE CITY STATE RENDER START   **********/
function renderLpPouplateCityAndState(resp) {
    var city_data = resp.city
    var state_data = resp.state
    $(".lp-add-pincode-error").addClass("dsp-none");
    $(".lp-edit-addr-state-ev").val(state_data);
    $(".lp-edit-addr-city-ev").val(city_data);
    $(".lp-add-state").val(state_data);
    $(".lp-add-city").val(city_data);
	profileInputValidation()
	editProfileAdd()
}
render.lpPouplateCityAndState = renderLpPouplateCityAndState
/********** PINCODE CITY STATE RENDER END   **********/

function clevertap_click_events(type) {
    clevertap.event.push("2W_MARKETPLACE_3in1",
        {
            "PAGE_TYPE": "PDP",
            "PAGE_TYPE_CLICK_PDP": type,
            "PRODUCT_CATEGORY":"two-wheeler",
            "PRODUCT_NAME": $(".info-prod-head").text(),
            "PRODUCT_BRAND": $(".info-prod-head").text() ? $(".info-prod-head").text().split(" ")[0] : "",
            "PDP_VARIANT": ($(".variant_type-html").html() != "") ? $(".variant_type-html").find(".active").attr("data-name") : "",
            "PDP_SELLER_NAME": selectedDeliverySeller ? selectedDeliverySeller.SellerName : "",
            "PDP_COLOR": (!$(".prod-color-container").hasClass("dsp-none")) ? $(".prod-color-container").find(".active").attr("data-name") : "",
            "PDP_CITY": localStorage.getItem("cityName"),
            "PDP_ON_ROAD_PRICE": $(".absolute-discount-calc-offer-price").text().replace(",", ""),
            
        })
}
function clevertap_click_events_instabuy(type) {
    clevertap.event.push("2W_MARKETPLACE_3in1",
        {
            "PAGE_TYPE": "INSTABUY",
            "PAGE_TYPE_CLICK_INSTABUY": type,
            "PRODUCT_CATEGORY":"two-wheeler",
            "PRODUCT_NAME": $(".info-prod-head").text(),
            "PRODUCT_BRAND": $(".info-prod-head").text() ? $(".info-prod-head").text().split(" ")[0] : "",
            "PDP_VARIANT": ($(".variant_type-html").html() != "") ? $(".variant_type-html").find(".active").attr("data-name") : "",
            "PDP_SELLER_NAME": selectedDeliverySeller ? selectedDeliverySeller.SellerName : "",
            "PDP_COLOR": (!$(".prod-color-container").hasClass("dsp-none")) ? $(".prod-color-container").find(".active").attr("data-name") : "",
            "PDP_CITY": localStorage.getItem("cityName"),
            "PDP_ON_ROAD_PRICE": $(".absolute-discount-calc-offer-price").text().replace(",", ""),
            
        })
}
window.addEventListener('DOMContentLoaded', function () {
    clevertap.event.push("2W_MARKETPLACE_3in1",
    {
        "PAGE_VIEW": "PDP",
        "PRODUCT_CATEGORY": $('meta[name="category"]').attr("content")
    })
    $("body").on("click", ".book-now-btn", function (e) {
        clevertap.event.push("2W_MARKETPLACE_3in1",
            {
                "PAGE_TYPE": "PDP",
                "PAGE_TYPE_CLICK_PDP": "Book Now",
                "PRODUCT_CATEGORY":"two-wheeler",
                "PRODUCT_NAME": $(".info-prod-head").text(),
                "PDP_VARIANT": ($(".variant_type-html").html() != "") ? $(".variant_type-html").find(".active").attr("data-name") : "",
                "PDP_SELLER_NAME": selectedDeliverySeller ? selectedDeliverySeller.SellerName : "",
                "PDP_COLOR": (!$(".prod-color-container").hasClass("dsp-none")) ? $(".prod-color-container").find(".active").attr("data-name") : "",
                "PDP_CITY": localStorage.getItem("cityName"),
                "PDP_ON_ROAD_PRICE": $(".absolute-discount-calc-offer-price").text().replace(",", ""),
                "PRODUCT_BRAND": $(".info-prod-head").text() ? $(".info-prod-head").text().split(" ")[0] : ""
            })
    })
    $("body").on("click", "#insta-place-your-order-btn", function (e) {
        clevertap.event.push("2W_MARKETPLACE_3in1",
            {
                "PAGE_TYPE": "INSTABUY",
                "PAGE_TYPE_CLICK_INSTABUY": "PROCEED",
                "PRODUCT_NAME": $(".info-prod-head").text(),
                "PRODUCT_CATEGORY":"two-wheeler",
                "PRODUCT_BRAND": $(".info-prod-head").text() ? $(".info-prod-head").text().split(" ")[0] : ""
            })
    })
    $("body").on("click", ".wishlist-icon", function (e) {
        clevertap_click_events("WISHLIST");
    })
    $("body").on("click", ".get-direction-spn", function (e) {
        clevertap_click_events("Directions");
    })
    $("body").on("click", ".shareIcon", function (e) {
        clevertap_click_events("Share");
    })
    $("body").on("click", ".pincodeChange", function (e) {
        clevertap_click_events("Check_Availability");
    })
    $("body").on("click", ".price-brkup", function (e) {
        clevertap_click_events("PRICE_BREAKUP");
    })
    $("body").on("click", ".pd-emi-stfrom-opt", function (e) {
        clevertap_click_events("VIEW_EMI_OPTIONS");
    })
    $("body").on("click", ".sellerlistpopup", function (e) {
        clevertap_click_events("View more sellers");
    })
    $("body").on("click", ".coupon-list-event", function (e) {
        clevertap_click_events_instabuy("Promo Code");
    })
    $("body").on("click", ".placeorder-submit-btn", function (e) {
        clevertap_click_events_instabuy("Submit_OTP");
    })
    $("body").on("click", ".placeorder-resend-btn", function (e) {
        clevertap_click_events_instabuy("Resend OTP");
    })
    $("body").on("click", ".placeorder-cancel-btn", function (e) {
        clevertap_click_events_instabuy("Cancel");
    })
})
