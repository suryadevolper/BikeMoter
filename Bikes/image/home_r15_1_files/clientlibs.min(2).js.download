window.addEventListener("DOMContentLoaded",function(){$(".loan-pod-cancel-hmevt").on("click",function(){show2wLoanPodScreen();$(".book-now-btn").css({"pointer-events":"auto",opacity:1});loanpodPopupCanceldl()});$(".loan-pod-tooltip-img-hmevt").on("click",function(){$(this).parents(".nam-price-div").find(".loan-pod-tooltip-new").hasClass("dsp-none")?($(".loan-pod-tooltip-new").addClass("dsp-none"),$(this).parents(".nam-price-div").find(".loan-pod-tooltip-new").removeClass("dsp-none")):$(this).parents(".nam-price-div").find(".loan-pod-tooltip-new").addClass("dsp-none")});
$(".annual-roi-loan-pod-hmevt").on("click",function(){$(this).parents(".annualise-roi-div").find(".loan-pod-tooltip-new").hasClass("dsp-none")?($(".loan-pod-tooltip-new").addClass("dsp-none"),$(this).parents(".annualise-roi-div").find(".loan-pod-tooltip-new").removeClass("dsp-none")):$(this).parents(".annualise-roi-div").find(".loan-pod-tooltip-new").addClass("dsp-none")});$(".got-it-btn-div, .headinng-wrap-div .backArrow-event").on("click",function(a){$(this).parents(".loan-pod-tooltip-new").addClass("dsp-none");
$(this).parent().addClass("dsp-none")});$("body").click(function(a){window.matchMedia("(max-width: 767px)").matches?$(a.target).hasClass("loan-pod-tooltip-new")&&$(".nam-price-div .loan-pod-tooltip-new").addClass("dsp-none"):$(a.target).hasClass("loan-pod-tooltip-new")||$(a.target).parents().hasClass("nam-price-div")||$(".nam-price-div .loan-pod-tooltip-new").addClass("dsp-none")})});
function api2WLoanPodPlaceOrder(){$(".otp-attempts-text").removeClass("dsp-none");$(".loan-pod-otp-input-box").removeClass("error-border-color");$(".loan-pod-otp-input-box").val("");var a=$user.getCustomerUserId(),b=_getDataMapping().customerDetails.api.customerToken;reqObj={customer_user_id:a,payment_method:{method:"checkmo"},amazon_kindel:null,isInstaBuy:!0,lpd:1};sendApiRequest(reqObj,testUrl+"/rest/V1/place/order","","POST",function(a,b){if(a&&b&&b.status){var c=_getDataMapping();c.loanPodPlaceOrder.status=
a;c.loanPodPlaceOrder.response=b;_setDataMapping(c);toEncryptDecryptAES("100","en");a=__get_perpetual_session("mobile_number").slice(-4);$(".mobile-last-4-digit").text("XXXXXX"+a);$(".otp-attempts-text").html("Maximum 3 OTP's allowed");$(".otp-attempts-text").removeClass("otp-wrong-text");show2wLoanPodScreen("loan-pod-otp-popup");loan_pod_orider_id=b.order_id;resendTimeout();b=!1;try{autoOtpReadOn()}catch(g){b=!0}try{b&&BflAutoReadOTP()}catch(g){console.log(g)}var d=180;intervalTimeout=setInterval(function(){var a=
Math.floor(d/60),b=d%60;$(".timeOut-text-show").html(("0"+a).slice(-2)+":"+("0"+b).slice(-2));d--;0>d&&(clearInterval(intervalTimeout),show2wLoanPodScreen(),$(".book-now-btn").css({"pointer-events":"auto",opacity:1}),location.href=baseUrl+"/success/index/indexntb?respcode\x3dMTAw")},1E3)}},b?b:"","json")}
var loanpodcallBuyNowApi=function(){$(".fonesafeparentwrapper").find(".fonesafeprotec.selected");var a=localStorage.getItem("cityId"),b=_getDataMapping(),d=b.customerDetails.api.customerToken;d=d?d:"";var c="";readCookie("perpetual_session")&&(c=JSON.parse(localStorage.getItem("loanpodSelectedAddress")).addressId,localStorage.removeItem("loanpodSelectedAddress"));var f=__get_perpetual_session("customer_id"),h=0==$(".select-neflix-offer-icon").length?!1:$(".select-neflix-offer-icon").hasClass("selected"),
g=[];if(noIDontWishClicked)g=[];else if(ewDataForAddApi.term){var e={};e.term=ewDataForAddApi.term;e.no_of_emis=ewDataForAddApi.noOfEmis;e.price=ewDataForAddApi.price;e.emi_per_month=ewDataForAddApi.emiPerMonth;e.type=ewDataForAddApi.type;e.code=ewDataForAddApi.ins_code;g.push(e)}else g=[];e="";var k=null;k=$("#homeDeliverySelector").hasClass("selected");var l=$("#storeVisitSelector").hasClass("selected");1==k?e=1:1==l&&(e=2);k=readCookie("selected_city_pincode")?decodeURI(readCookie("selected_city_pincode")).split("|")[0]:
"";l=$("#defaultSelectedSeller").find("input").attr("data-deliveryType");var q=emiStoreApiData.get("scheme_id"),r=localStorage.getItem("is_seller_changed")?localStorage.getItem("is_seller_changed"):0;isInstallationChargesChecked();var t=(new URL(window.location.href)).searchParams.get("sid")?"1":"0",m=$(".express-standard-radio-btns-parent").hasClass("dsp-none")?0:$(".express-radio-btn").prop("checked")?1:0,n=b.customerDetails.api.icorsFetchOffer.status_code;b=b.customerDetails.api.icorsFetchOffer.flag;
var p=0;if("7001"==n&&"PTB"==b||"200"==n)p=1;localStorage.setItem("isExpressDelSelected",m);reqObj={type:"buynow",customer_user_id:f,campaign:t,twoWloanpodjourney:p,item:{sku:skuName,customer_address_id:c,seller_id:onChangeSellerID,scheme_id:q,city_id:a,qty:1,insurance:g,netflix_selected:h,customer_preference:e,Dealer_type:l,pincode:k,is_seller_changed:r,installation_charges:installationChargesData.installationCharges,installation_flag:installationChargesData.installationFlag,express_delivery:m}};
null!==localStorage.getItem("offerNudge")&&(a=selectedDeliverySeller&&selectedDeliverySeller.Offer.SpecialOfferDeals.length?selectedDeliverySeller.Offer.SpecialOfferDeals[0].id:null,null!==a&&(reqObj.offer_id=a),localStorage.removeItem("offerNudge"));sendApiRequest(reqObj,testUrl+"/rest/V1/cart/add","","POST",function(a,b){a&&b&&b.status&&load2WPaymentSummarySection()},d,"json")};
function apiLoanPodVerifyOtp(a,b){$(".loan-pod-otp-confirm-hmevt").addClass("loan-pod-confirm-disable");var d=baseUrl+"/rest/V1/loanpod/verifyotp";a=toEncryptDecryptAES(a,"en");var c=_getDataMapping(),f=c.customerDetails.api.customerToken;f=f?f:"";c=c.loanPodPlaceOrder.response.order_id;var h=locationlatitude?locationlatitude+"":"0.00000",g=locationlongitude?locationlongitude+"":"0.00000",e=localStorage.getItem("Source_Request_Id")?localStorage.getItem("Source_Request_Id"):"";sendApiRequest({otp:a,
Place_Order_OTP_generation_customer_Location:h+g,Place_Order_OTP_submission_customer_Location:h+g,source_request_id:e,order_id:c},d,"Bearer "+f,"POST",function(a,c){a&&c&&("Otp verified"==c.message&&($(".otp-attempts-text").addClass("dsp-none"),$(".loan-pod-otp-input-box").removeClass("error-border-color"),window.location.href=toEncryptDecryptAES(c.url,"dec")),"Otp verified"!=c.message&&($(".otp-attempts-text").addClass("otp-wrong-text"),$(".otp-attempts-text").html(c.message),$(".otp-attempts-text").removeClass("dsp-none"),
$(".loan-pod-otp-input-box").addClass("error-border-color"),_getDataMapping(),$(".resend-otp-hmevt").addClass("dsp-none"),clearInterval(resendIntervalTimeout),resendTimeout(),3==b&&(window.location.href=toEncryptDecryptAES(c.url,"dec"))))},"","json")}
function api2WLoanPodThankYouPage(){verifyDetailsPopup();show2wLoanPodScreen("loan-pod-loader");var a=_getDataMapping(),b=a.customerDetails.api.customerToken;b=b?b:"";a=_getDataMapping();var d=a.customerDetails.offerAmount.amount,c="undefined"==__get_perpetual_session("mobile_number")?"":__get_perpetual_session("mobile_number"),f="undefined"==__get_perpetual_session("customer_dob")?"":__get_perpetual_session("customer_dob");reqObj={mobile:c,dob:f,address1:selected_loanPod_add.addressLine1?selected_loanPod_add.addressLine1:
"",address2:selected_loanPod_add.addressLine2?selected_loanPod_add.addressLine2:"",city:selected_loanPod_add.cityName?selected_loanPod_add.cityName:"",state:selected_loanPod_add.regionName?selected_loanPod_add.regionName:"",dealercode:onChangeSellerID?onChangeSellerID:"",sku:skuName,source_Return_url:window.location.href,invoice_Amount:selectedDeliverySeller.Offer.Price?selectedDeliverySeller.Offer.Price:"",Loan_Amount:selectedDeliverySeller.Offer.Price?selectedDeliverySeller.Offer.Price:"",scheme:selectedSchemeDataOnPdp.schemeId,
Prospect_Id:a.customerDetails.api.icorsFetchOffer.response.offer_details?a.customerDetails.api.icorsFetchOffer.response.offer_details[0].customerId:"",Prospect_Limit:d,zipcode:selected_loanPod_add.postCode,offerprice:selectedDeliverySeller.Offer.Price?selectedDeliverySeller.Offer.Price:"",appliedLTV:selectedSchemeDataOnPdp.SchemeLtvPercentage};sendApiRequest(reqObj,testUrl+"/rest/V1/loanpod/loanPodApproval","","POST",function(a,b){if(a&&b){localStorage.setItem("Source_Request_Id",b.source_request_id?
b.source_request_id:"");if("true"==b.status||1==b.status)localStorage.setItem("loan-pod-wrapper",1),localStorage.setItem("loan-pod-selected-seller-id",selectedDeliverySeller.SellerId),localStorage.setItem("loan-pod-selected-scheme-id",selectedSchemeDataOnPdp.schemeId);location.href=b.redirect_url}},b,"json")}
function load2WPaymentSummarySection(){var a=decodeURIComponent(readCookie("perpetual_session")).split("|")[0],b=_getDataMapping().customerDetails.api.customerToken;sendApiRequest({customer_user_id:a},baseUrl+"/rest/V1/instabuy/popup","","POST",function(a,b){a&&b&&(loadSkuAndStoreDetails(),renderPaymentSummaryDetails(b),show2wLoanPodScreen("loan-pod-insta-buy"))},b?b:"","json")}
function apiLoanPodResendOtp(){var a=_getDataMapping(),b=a.customerDetails.api.customerToken;b=b?b:"";a=_getDataMapping();sendApiRequest({order_id:a.loanPodPlaceOrder.response.order_id},baseUrl+"/rest/V1/loanpod/resendotp","Bearer "+b,"POST",function(a,b){a&&b&&(1<=b.otp_attempt_remaining?($(".loan-pod-otp-input-box").removeClass("error-border-color"),1==b.otp_attempt_remaining?$(".otp-attempts-text").text("This is your last OTP attempt"):$(".otp-attempts-text").text("You have only "+b.otp_attempt_remaining+
" attempts left"),$(".otp-attempts-text").removeClass("dsp-none"),$(".resend-otp-hmevt").addClass("dsp-none"),$(".otp-attempts-text").removeClass("otp-wrong-text"),resendTimeout()):($(".otp-attempts-text").addClass("dsp-none"),$(".resend-otp-hmevt").addClass("dsp-none")))},"","json")}
window.addEventListener("DOMContentLoaded",function(){$(".loan-pod-proceed-btn-hmevt").on("click",function(){api2WLoanPodPlaceOrder();loanPodInstabuy()});$(".loan-pod-cross-icon-img-eve").on("click",function(){$(".book-now-btn").css({"pointer-events":"",opacity:"1"});$("#loan-pod-checkoutPage").addClass("dsp-none")});$(".address-pop-up-continue-event").on("click",function(){selected_loanPod_add=(selected_loanPod_add=$("input:radio.twoWheeler-address-box-input:checked").parents(".twoWheeler-pdp-popup-address-box").attr("data-address-info"))?
JSON.parse(selected_loanPod_add):"";localStorage.setItem("loanpodSelectedAddress",JSON.stringify(selected_loanPod_add));$(".twoWheeler-pdp-address-popup").addClass("dsp-none");loanpodcontinuectaDl();$(".address-one").text(selected_loanPod_add.addressLine1);$(".address-two").text(selected_loanPod_add.addressLine2);$(".address-city").text(selected_loanPod_add.cityName);$(".address-state").text(selected_loanPod_add.regionName);$(".address-pincode").text(selected_loanPod_add.postCode);$(".customer-mobile-text").text("+91 "+
selected_loanPod_add.telephone);$(".loan-pod-proceed-button").addClass("loan-pod-proceed-opacity");$(".loan-pod-oncheck-hmevt").prop("checked",!1);show2wLoanPodScreen("loan-pod-checkoutPage")});$(".resend-otp-hmevt").on("click",function(){loanpodResenddl();apiLoanPodResendOtp()});$(".loan-pod-oncheck-hmevt").on("click",function(){$(".loan-pod-proceed-button").hasClass("loan-pod-proceed-opacity")?($(".checkout-proceed-btn-hmevt").removeClass("p-event"),$(".loan-pod-proceed-button").removeClass("loan-pod-proceed-opacity")):
($(".checkout-proceed-btn-hmevt").addClass("p-event"),$(".loan-pod-proceed-button").addClass("loan-pod-proceed-opacity"))});$(".emi-pan-proceed-hmevt").on("click",function(){loanApprovedEmiPlan();loanpodcallBuyNowApi()});window.matchMedia("(max-width: 767px)").matches?(console.log("mobile view working"),$(".loan-pod-oncheck-hmevt").eq(1).is(":checked")?$(".checkout-proceed-btn-hmevt").removeClass("p-event"):$(".checkout-proceed-btn-hmevt").addClass("p-event")):(console.log("Desktop view working"),
$(".loan-pod-oncheck-hmevt").eq(0).is(":checked")?$(".checkout-proceed-btn-hmevt").removeClass("p-event"):$(".checkout-proceed-btn-hmevt").addClass("p-event"));$(".checkout-proceed-btn-hmevt").on("click",function(){api2WLoanPodThankYouPage()});$(".loan-pod-otp-input-box").on("keyup",function(a){var b=$(this);0==b.val().length&&8==a.which?b.prev(".loan-pod-otp-input-box").focus():b.val().length==parseInt(b.attr("maxlength"))&&b.next(".loan-pod-otp-input-box").focus();var d="";$(".loan-pod-otp-input-box").each(function(){d+=
$(this).val()});6==d.length?($(".loan-pod-otp-confirm-hmevt").removeClass("loan-pod-confirm-disable"),$(".loan-pod-otp-input-box").removeClass("error-border-color"),$(".otp-attempts-text").addClass("dsp-none")):$(".loan-pod-otp-confirm-hmevt").addClass("loan-pod-confirm-disable")});$(".loan-pod-otp-input-box").on("keydown",function(a){var b=$(this);0==b.val().length&&8==a.which&&b.prev(".loan-pod-otp-input-box").focus()});$(".loan-pod-otp-confirm-hmevt").on("click",function(a){confirm_otp_flag+=1;
var b="";$(".loan-pod-otp-input-box").each(function(a,c){b+=$(c).val()});otpSubmitdl();apiLoanPodVerifyOtp(b,confirm_otp_flag)})});function resendTimeout(){var a=15;$(".resend-text-timer").removeClass("dsp-none");$(".otp-timer").html("00:"+a);resendIntervalTimeout=setInterval(function(){a--;$(".otp-timer").html("00:"+a.toString().padStart(2,"0"));0===a&&(clearInterval(resendIntervalTimeout),$(".resend-text-timer").addClass("dsp-none"),$(".resend-otp-hmevt").removeClass("dsp-none"))},1E3)}
var loadSkuAndStoreDetails=function(){setSkuDetails();setStoreDetails()},renderPaymentSummaryDetails=function(a){$(".ex-price-text").text(__common_service.getAmount(selectedDeliverySeller.Ex_Showroom_Price__c));$(".rt-price-text").text(__common_service.getAmount(selectedDeliverySeller.RTO__c));$(".insurance-price-text").text(__common_service.getAmount(selectedDeliverySeller.Insurance__c));$(".orp-price-text").text(__common_service.getAmount(selectedDeliverySeller.on_road_price));$(".dp-price-text").text(a.dynamic_down_payment.down_payment_amount);
$(".pdd-c-price-text").text(a.dynamic_down_payment.hypothecation_charges);$(".dc-price-text").text(a.dynamic_down_payment.documentation_charges);$(".pf-price-text").text(__common_service.getAmount(a.dynamic_down_payment.processing_fee));a.dynamic_down_payment.stamp_duty&&$(".sd-price-text").text(a.dynamic_down_payment.stamp_duty);$(".upd-price-text").text(a.dynamic_down_payment.payment_to_dealer);var b=a.dynamic_down_payment.emi_amount+" x "+a.dynamic_down_payment.remaining_emis+"m";$(".emis-price-text").text(b);
$(".pc-price-text").text(b);b=$(".payable-emi-main-div .roi-txt").text().replace("19",a.dynamic_down_payment.scheme_irr);$(".payable-emi-main-div .roi-txt").text(b);a=$(".annualise-roi-div .annualtitle").text().replace("19",a.dynamic_down_payment.scheme_irr);$(".annualise-roi-div .annualtitle").text(a)};
function setSkuDetails(){var a=$(".info-prod-head").eq(0).text(),b=$(".absolute-discount-calc-offer-price").text(),d=$(".absolute-discount-calc-offer-mrpprice").text(),c=$(".productDiscountAmt-rs").text(),f=$(".pc-single-img").attr("src"),h=b==d;h&&($(".price-discount-div .text-two-price").addClass("dsp-none"),$(".price-discount-div .text-three-price").addClass("dsp-none"));$(".product-title-loanpod-txt").text(a);$(".price-discount-div .text-one-price").text(b);h||($(".price-discount-div .text-two-price").text(d),
$(".price-discount-div .text-three-price").text(c));$(".two-wheel-datail-box-div .img-box-div img").attr("src",f)}
function setStoreDetails(){$(".address-detail-div-loan .bike-title-txt").text(selectedDeliverySeller.SellerName);$(".address-detail-div-loan .bike-address-txt").text(selectedDeliverySeller.Location);selectedDeliverySeller.Contact?$(".address-detail-div-loan .cont-number").text(selectedDeliverySeller.Contact):($(".contact-txt").addClass("dsp-none"),$(".cont-number").addClass("dsp-none"))}var selected_loanPod_add="",loan_pod_orider_id="",confirm_otp_flag=0,resendIntervalTimeout="",intervalTimeout="";